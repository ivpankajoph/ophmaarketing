{"file_contents":{"client/src/pages/reports/Credits.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Download, Coins } from \"lucide-react\";\n\nconst transactions = [\n  { id: 1, date: \"Nov 27, 2025\", type: \"Recharge\", amount: \"+$50.00\", balance: \"$74.50\", status: \"Success\" },\n  { id: 2, date: \"Nov 26, 2025\", type: \"Usage - Marketing\", amount: \"-$12.40\", balance: \"$24.50\", status: \"Success\" },\n  { id: 3, date: \"Nov 25, 2025\", type: \"Usage - Utility\", amount: \"-$5.20\", balance: \"$36.90\", status: \"Success\" },\n  { id: 4, date: \"Nov 20, 2025\", type: \"Recharge\", amount: \"+$20.00\", balance: \"$42.10\", status: \"Success\" },\n  { id: 5, date: \"Nov 15, 2025\", type: \"Monthly Subscription\", amount: \"-$29.00\", balance: \"$22.10\", status: \"Success\" },\n];\n\nexport default function Credits() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Credits & Transactions</h2>\n            <p className=\"text-muted-foreground\">Monitor your wallet balance and usage history.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Credits\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n           <Card className=\"bg-primary text-primary-foreground\">\n              <CardHeader>\n                 <CardTitle className=\"flex items-center gap-2\">\n                   <Coins className=\"h-5 w-5\" />\n                   Current Balance\n                 </CardTitle>\n              </CardHeader>\n              <CardContent>\n                 <div className=\"text-5xl font-bold\">$74.50</div>\n                 <p className=\"text-primary-foreground/80 mt-2\">Auto-recharge disabled</p>\n              </CardContent>\n           </Card>\n           \n           <Card>\n              <CardHeader>\n                 <CardTitle>Low Balance Alert</CardTitle>\n                 <CardDescription>Get notified when your credits fall below a threshold.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                 <div className=\"text-sm text-muted-foreground mb-4\">\n                   Current threshold: <span className=\"font-bold text-foreground\">$10.00</span>\n                 </div>\n                 <Button variant=\"outline\" size=\"sm\">Configure Alert</Button>\n              </CardContent>\n           </Card>\n        </div>\n\n        <Card>\n           <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                 <CardTitle>Transaction History</CardTitle>\n                 <Button variant=\"ghost\" size=\"sm\">\n                   <Download className=\"mr-2 h-4 w-4\" /> Export\n                 </Button>\n              </div>\n           </CardHeader>\n           <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Balance</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {transactions.map((tx) => (\n                    <TableRow key={tx.id}>\n                      <TableCell>{tx.date}</TableCell>\n                      <TableCell>{tx.type}</TableCell>\n                      <TableCell className={tx.amount.startsWith('+') ? 'text-green-600 font-medium' : ''}>\n                        {tx.amount}\n                      </TableCell>\n                      <TableCell>{tx.balance}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"bg-green-50 text-green-700 border-green-200\">\n                          {tx.status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4452,"size_tokens":null},"server/modules/whatsapp/whatsapp.controller.ts":{"content":"import { Request, Response } from 'express';\nimport { getMappingByFormId } from '../mapping/mapping.service';\nimport { getAgentById, getAllAgents } from '../aiAgents/agent.service';\nimport { generateAgentResponse } from '../ai/ai.service';\nimport { getAllLeads } from '../facebook/fb.service';\nimport { storage } from '../../storage';\nimport * as aiAnalytics from '../aiAnalytics/aiAnalytics.service';\nimport * as broadcastService from '../broadcast/broadcast.service';\nimport * as contactAgentService from '../contactAgent/contactAgent.service';\nimport * as prefilledTextService from '../prefilledText/prefilledText.service';\nimport { credentialsService } from '../credentials/credentials.service';\nimport * as whatsappService from './whatsapp.service';\nimport { isContactBlocked, isPhoneBlocked, listAllBlockedContacts } from '../contacts/contacts.routes';\nimport { getUserId } from '../auth/auth.routes';\nimport { contactAnalyticsService } from '../contactAnalytics/contactAnalytics.service';\n\nconst WHATSAPP_TOKEN = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN;\nconst PHONE_NUMBER_ID = process.env.PHONE_NUMBER_ID;\nconst VERIFY_TOKEN = process.env.VERIFY_TOKEN || 'whatsapp_webhook_verify_token_2025';\n\nasync function resolveUserIdFromPhoneNumberId(phoneNumberId: string): Promise<string | undefined> {\n  try {\n    const result = await credentialsService.getCredentialsByPhoneNumberId(phoneNumberId);\n    if (result) {\n      console.log(`[Webhook] Resolved userId ${result.userId} for phone_number_id ${phoneNumberId}`);\n      return result.userId;\n    }\n    console.log(`[Webhook] No user found for phone_number_id ${phoneNumberId}, using system credentials`);\n    return undefined;\n  } catch (error) {\n    console.error('[Webhook] Error resolving userId:', error);\n    return undefined;\n  }\n}\n\ninterface ConversationHistory {\n  [phone: string]: { role: 'user' | 'assistant'; content: string }[];\n}\n\nconst conversationHistory: ConversationHistory = {};\n\nexport async function verifyWebhook(req: Request, res: Response) {\n  const mode = req.query['hub.mode'];\n  const token = req.query['hub.verify_token'];\n  const challenge = req.query['hub.challenge'];\n\n  console.log('WhatsApp webhook verification:', { mode, token, challenge });\n\n  if (mode === 'subscribe' && token === VERIFY_TOKEN) {\n    console.log('Webhook verified successfully');\n    return res.status(200).send(challenge);\n  }\n\n  console.log('Webhook verification failed');\n  return res.sendStatus(403);\n}\n\nexport async function handleWebhook(req: Request, res: Response) {\n  try {\n    const body = req.body;\n    console.log('WhatsApp webhook received:', JSON.stringify(body, null, 2));\n\n    if (body.object !== 'whatsapp_business_account') {\n      return res.sendStatus(404);\n    }\n\n    const entry = body.entry?.[0];\n    const changes = entry?.changes?.[0];\n    const value = changes?.value;\n    const messages = value?.messages;\n\n    if (!messages || messages.length === 0) {\n      return res.sendStatus(200);\n    }\n\n    const webhookPhoneNumberId = value?.metadata?.phone_number_id;\n    const resolvedUserId = webhookPhoneNumberId \n      ? await resolveUserIdFromPhoneNumberId(webhookPhoneNumberId)\n      : undefined;\n\n    const message = messages[0];\n    const from = message.from;\n    const messageType = message.type;\n    \n    // Check if contact is blocked - works with or without resolved userId\n    console.log(`[Webhook] Checking if phone ${from} is blocked...`);\n    \n    // Debug: list all blocked contacts\n    const allBlocked = await listAllBlockedContacts();\n    console.log(`[Webhook] Total blocked contacts in DB: ${allBlocked.length}`);\n    \n    if (resolvedUserId) {\n      console.log(`[Webhook] Checking block for user ${resolvedUserId}, phone ${from}`);\n      const isBlocked = await isContactBlocked(resolvedUserId, from);\n      if (isBlocked) {\n        console.log(`[Webhook] BLOCKED! Message from blocked contact ${from} for user ${resolvedUserId}, ignoring`);\n        return res.sendStatus(200);\n      }\n    } else {\n      console.log(`[Webhook] No resolved userId, checking if phone ${from} is blocked by any user`);\n      // Check if phone is blocked by any user\n      const blockResult = await isPhoneBlocked(from);\n      if (blockResult.blocked) {\n        console.log(`[Webhook] BLOCKED! Message from blocked contact ${from} (blocked by user ${blockResult.userId}), ignoring`);\n        return res.sendStatus(200);\n      }\n    }\n    \n    console.log(`[Webhook] Phone ${from} is NOT blocked, proceeding with message`)\n    \n    // Extract message content based on type\n    let messageText = '';\n    let buttonPayload = '';\n    let mediaUrl = '';\n    let isMediaMessage = false;\n    \n    if (messageType === 'text') {\n      messageText = message.text?.body || '';\n    } else if (messageType === 'button') {\n      // Quick reply button response\n      messageText = message.button?.text || '';\n      buttonPayload = message.button?.payload || '';\n      console.log(`Button response from ${from}: text=\"${messageText}\", payload=\"${buttonPayload}\"`);\n    } else if (messageType === 'interactive') {\n      // Interactive message response (button_reply or list_reply)\n      const interactive = message.interactive;\n      if (interactive?.type === 'button_reply') {\n        messageText = interactive.button_reply?.title || '';\n        buttonPayload = interactive.button_reply?.id || '';\n        console.log(`Interactive button reply from ${from}: title=\"${messageText}\", id=\"${buttonPayload}\"`);\n      } else if (interactive?.type === 'list_reply') {\n        messageText = interactive.list_reply?.title || '';\n        buttonPayload = interactive.list_reply?.id || '';\n        console.log(`Interactive list reply from ${from}: title=\"${messageText}\", id=\"${buttonPayload}\"`);\n      }\n    } else if (messageType === 'image') {\n      // Image message\n      isMediaMessage = true;\n      mediaUrl = message.image?.id || '';\n      const caption = message.image?.caption || '';\n      messageText = caption ? `[Image] ${caption}` : '[Image message]';\n      console.log(`Image message from ${from}: id=${mediaUrl}, caption=\"${caption}\"`);\n    } else if (messageType === 'video') {\n      // Video message\n      isMediaMessage = true;\n      mediaUrl = message.video?.id || '';\n      const caption = message.video?.caption || '';\n      messageText = caption ? `[Video] ${caption}` : '[Video message]';\n      console.log(`Video message from ${from}: id=${mediaUrl}, caption=\"${caption}\"`);\n    } else if (messageType === 'audio') {\n      // Audio/voice message\n      isMediaMessage = true;\n      mediaUrl = message.audio?.id || '';\n      messageText = '[Audio message]';\n      console.log(`Audio message from ${from}: id=${mediaUrl}`);\n    } else if (messageType === 'document') {\n      // Document message\n      isMediaMessage = true;\n      mediaUrl = message.document?.id || '';\n      const filename = message.document?.filename || 'document';\n      const caption = message.document?.caption || '';\n      messageText = caption ? `[Document: ${filename}] ${caption}` : `[Document: ${filename}]`;\n      console.log(`Document message from ${from}: id=${mediaUrl}, filename=\"${filename}\"`);\n    } else if (messageType === 'sticker') {\n      // Sticker message\n      isMediaMessage = true;\n      mediaUrl = message.sticker?.id || '';\n      messageText = '[Sticker message]';\n      console.log(`Sticker message from ${from}: id=${mediaUrl}`);\n    } else if (messageType === 'location') {\n      // Location message\n      const lat = message.location?.latitude || 0;\n      const lng = message.location?.longitude || 0;\n      const name = message.location?.name || '';\n      messageText = name ? `[Location: ${name}] (${lat}, ${lng})` : `[Location] (${lat}, ${lng})`;\n      console.log(`Location message from ${from}: ${lat}, ${lng}`);\n    } else if (messageType === 'contacts') {\n      // Contact card message\n      const contacts = message.contacts || [];\n      const contactNames = contacts.map((c: any) => c.name?.formatted_name || 'Unknown').join(', ');\n      messageText = `[Contact shared: ${contactNames}]`;\n      console.log(`Contacts message from ${from}: ${contactNames}`);\n    } else if (messageType === 'reaction') {\n      // Reaction message\n      const emoji = message.reaction?.emoji || '';\n      messageText = `[Reaction: ${emoji}]`;\n      console.log(`Reaction from ${from}: ${emoji}`);\n    } else {\n      // Unsupported message type\n      messageText = `[Unsupported message type: ${messageType}]`;\n      console.log(`Unsupported message type from ${from}: ${messageType}`);\n    }\n\n    console.log(`Received ${messageType} message from ${from}: ${messageText}`);\n\n    // Get WhatsApp message ID for deduplication\n    const whatsappMessageId = message.id || '';\n    \n    // Save the inbound message with actual button text and media info (with deduplication)\n    const savedMessage = await saveInboundMessage(from, messageText || buttonPayload, messageType, buttonPayload, mediaUrl, whatsappMessageId);\n    \n    // If message was a duplicate, skip AI processing\n    if (!savedMessage) {\n      console.log(`[Webhook] Duplicate message detected (${whatsappMessageId}), skipping AI processing`);\n      return res.sendStatus(200);\n    }\n\n    // For media messages, we still save them but don't process with AI\n    if (isMediaMessage) {\n      console.log(`Media message saved, skipping AI processing for type: ${messageType}`);\n      return res.sendStatus(200);\n    }\n\n    // Process message if we have content (text, button, or interactive)\n    if (!messageText && !buttonPayload) {\n      console.log(`No processable content for message type: ${messageType}`);\n      return res.sendStatus(200);\n    }\n    \n    // Use messageText or buttonPayload for AI processing\n    const contentForAI = messageText || buttonPayload;\n\n    // Check if this is a button response - log it but continue with AI processing\n    const isButtonResponse = messageType === 'button' || messageType === 'interactive';\n    \n    if (isButtonResponse) {\n      console.log(`[Webhook] Button response from ${from}: \"${contentForAI}\" - continuing with AI processing`);\n    }\n    \n    // Check if auto-reply is disabled for this contact (set manually by user in inbox)\n    // Note: Button clicks no longer disable auto-reply, only manual inbox actions do\n    const autoReplyDisabled = await contactAgentService.isAutoReplyDisabled(from);\n    if (autoReplyDisabled) {\n      console.log(`[Webhook] Auto-reply manually disabled for ${from} - skipping AI response`);\n      return res.sendStatus(200);\n    }\n    \n    // For all messages, check if this contact has a manually assigned agent\n    const contactAgentAssignment = await contactAgentService.getAgentForContact(from);\n    let agentToUse = null;\n    let useStoredHistory = false;\n    \n    // First try manually assigned agent\n    if (contactAgentAssignment) {\n      console.log(`[Webhook] Found assigned agent for ${from}: ${contactAgentAssignment.agentName} (${contactAgentAssignment.agentId})`);\n      agentToUse = await getAgentById(contactAgentAssignment.agentId);\n      \n      if (agentToUse && agentToUse.isActive) {\n        useStoredHistory = true;\n        console.log(`[Webhook] Using assigned agent: ${agentToUse.name}`);\n      } else {\n        // Agent was deleted or is inactive - clear the stale assignment\n        console.log(`[Webhook] Assigned agent not found or inactive for ${from}, clearing assignment and falling back`);\n        await contactAgentService.removeAgentFromContact(from);\n        agentToUse = null;\n      }\n    }\n    \n    // If no valid assigned agent, try pre-filled text mapping\n    if (!agentToUse) {\n      const prefilledMapping = await prefilledTextService.findMatchingAgentForMessage(contentForAI);\n      if (prefilledMapping) {\n        console.log(`[Webhook] Found pre-filled text mapping for \"${contentForAI}\" -> Agent: ${prefilledMapping.agentName}`);\n        agentToUse = await getAgentById(prefilledMapping.agentId);\n        \n        // Auto-assign this agent to the contact for future messages\n        if (agentToUse && agentToUse.isActive) {\n          await contactAgentService.assignAgentToContact(\n            '', // contactId - will be set later\n            from,\n            prefilledMapping.agentId,\n            prefilledMapping.agentName\n          );\n          useStoredHistory = true;\n          console.log(`[Webhook] Auto-assigned agent ${prefilledMapping.agentName} to WhatsApp lead ${from}`);\n        } else {\n          agentToUse = null;\n        }\n      }\n    }\n    \n    // Fall back to lead-form mapping if no pre-filled text match\n    if (!agentToUse) {\n      const lead = await findLeadByPhone(from);\n      if (lead) {\n        const mapping = await getMappingByFormId(lead.formId);\n        if (mapping && mapping.isActive) {\n          const mappedAgent = await getAgentById(mapping.agentId);\n          if (mappedAgent && mappedAgent.isActive) {\n            agentToUse = mappedAgent;\n          }\n        }\n      }\n    }\n\n    // Fall back to any active agent only if nothing else matched\n    if (!agentToUse) {\n      const agents = await getAllAgents();\n      agentToUse = agents.find((a: any) => a.isActive);\n      if (agentToUse) {\n        console.log(`[Webhook] Using fallback active agent: ${agentToUse.name}`);\n      }\n    }\n\n    if (!agentToUse) {\n      console.log('[Webhook] No active agent found - skipping AI response');\n      return res.sendStatus(200);\n    }\n    \n    // Validate agent has required fields before proceeding\n    if (!agentToUse.id || !agentToUse.name) {\n      console.log(`[Webhook] Agent is missing required fields (id: ${agentToUse.id}, name: ${agentToUse.name}) - skipping AI response`);\n      return res.sendStatus(200);\n    }\n    \n    // Get conversation history - prioritize stored MongoDB history for assigned agents\n    let recentHistory: { role: 'user' | 'assistant'; content: string }[] = [];\n    \n    if (useStoredHistory) {\n      recentHistory = await contactAgentService.getConversationHistory(from);\n      console.log(`[Webhook] Using stored history with ${recentHistory.length} messages for agent: ${agentToUse.name}`);\n    } else {\n      if (!conversationHistory[from]) {\n        conversationHistory[from] = [];\n      }\n      recentHistory = conversationHistory[from].slice(-10);\n    }\n    \n    const historyForAI = [...recentHistory, { role: 'user' as const, content: contentForAI }];\n\n    let aiResponse: string;\n    try {\n      aiResponse = await generateAgentResponse(contentForAI, agentToUse, historyForAI.slice(0, -1), resolvedUserId);\n    } catch (aiError) {\n      console.error(`[Webhook] Error generating AI response for ${from}:`, aiError);\n      return res.sendStatus(200); // Return 200 to prevent retries\n    }\n    \n    if (useStoredHistory) {\n      await contactAgentService.addMessageToHistory(from, 'user', contentForAI);\n      await contactAgentService.addMessageToHistory(from, 'assistant', aiResponse);\n    } else {\n      conversationHistory[from].push({ role: 'user', content: contentForAI });\n      conversationHistory[from].push({ role: 'assistant', content: aiResponse });\n    }\n\n    await whatsappService.sendTextMessage(from, aiResponse, resolvedUserId);\n    \n    await saveOutboundMessage(from, aiResponse);\n\n    // Track AI agent interaction for analytics (only if we have valid agent ID)\n    if (agentToUse.id && agentToUse.name) {\n      try {\n        await contactAnalyticsService.trackAgentInteraction(from, agentToUse.id, agentToUse.name);\n      } catch (trackError) {\n        console.error('[Webhook] Error tracking agent interaction:', trackError);\n      }\n    }\n\n    // Analyze conversation for interest level (async, non-blocking)\n    (async () => {\n      try {\n        const contacts = await storage.getContacts();\n        const contact = contacts.find(c => {\n          const contactPhone = (c.phone || '').replace(/\\D/g, '');\n          const normalizedFrom = from.replace(/\\D/g, '');\n          return contactPhone.includes(normalizedFrom) || normalizedFrom.includes(contactPhone);\n        });\n        \n        if (contact) {\n          const fullHistory = useStoredHistory \n            ? await contactAgentService.getConversationHistory(from)\n            : conversationHistory[from] || [];\n          \n          const messagesForAnalysis = fullHistory.map(m => ({\n            direction: m.role === 'user' ? 'inbound' : 'outbound',\n            content: m.content,\n            timestamp: new Date().toISOString()\n          }));\n          \n          await contactAnalyticsService.analyzeAndUpdateContact(\n            contact.id,\n            from,\n            contact.name || from,\n            messagesForAnalysis,\n            resolvedUserId\n          );\n          console.log(`[Webhook] Contact analytics updated for ${from}`);\n        }\n      } catch (analyticsError) {\n        console.error('[Webhook] Error analyzing contact:', analyticsError);\n      }\n    })();\n\n    console.log(`AI auto-reply sent to ${from}: ${aiResponse.substring(0, 100)}...`);\n\n    return res.sendStatus(200);\n  } catch (error) {\n    // CRITICAL: Always return 200 to prevent Meta webhook retries\n    // Returning 500 causes Meta to retry the webhook, creating duplicate messages\n    console.error('Error handling webhook:', error);\n    return res.sendStatus(200);\n  }\n}\n\nasync function findLeadByPhone(phone: string) {\n  const leads = await getAllLeads();\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  \n  return leads.find(lead => {\n    const leadPhone = (lead.phone || '').replace(/\\D/g, '');\n    return leadPhone.includes(normalizedPhone) || normalizedPhone.includes(leadPhone);\n  });\n}\n\nasync function saveInboundMessage(from: string, content: string, type: string, buttonPayload?: string, mediaUrl?: string, whatsappMessageId?: string): Promise<any | null> {\n  try {\n    const normalizedPhone = from.replace(/\\D/g, '');\n    \n    // Check for duplicate message using WhatsApp message ID\n    if (whatsappMessageId) {\n      const existingMessages = await storage.getMessages();\n      const isDuplicate = existingMessages.some(m => \n        m.direction === 'inbound' && \n        (m as any).whatsappMessageId === whatsappMessageId\n      );\n      if (isDuplicate) {\n        console.log(`[Webhook] Skipping duplicate message: ${whatsappMessageId}`);\n        return null;\n      }\n    }\n    \n    // Mark broadcast logs as replied when we receive a message from this phone\n    try {\n      const repliedCount = await broadcastService.markBroadcastLogAsReplied(from);\n      if (repliedCount > 0) {\n        console.log(`[Webhook] Marked ${repliedCount} broadcast logs as replied for ${from}`);\n      }\n    } catch (err) {\n      console.error('[Webhook] Error marking broadcast as replied:', err);\n    }\n    \n    const contacts = await storage.getContacts();\n    let contact = contacts.find(c => {\n      const contactPhone = (c.phone || '').replace(/\\D/g, '');\n      return contactPhone.includes(normalizedPhone) || normalizedPhone.includes(contactPhone);\n    });\n\n    if (!contact) {\n      const formattedPhone = from.startsWith('+') ? from : `+${from}`;\n      contact = await storage.createContact({\n        name: formattedPhone,\n        phone: from,\n        email: '',\n        tags: ['WhatsApp'],\n        notes: 'Auto-created from WhatsApp message',\n      });\n      console.log('Created new contact:', contact.id);\n    }\n\n    // Format message content based on type\n    let displayContent = content;\n    if (type === 'button' || type === 'interactive') {\n      // Show button text with payload info for clarity\n      displayContent = content;\n      if (buttonPayload && buttonPayload !== content) {\n        displayContent = `${content} [Button: ${buttonPayload}]`;\n      }\n    }\n\n    const validTypes = ['text', 'image', 'video', 'document', 'audio', 'sticker', 'location', 'contacts'] as const;\n    const messageType = validTypes.includes(type as any) ? type as typeof validTypes[number] : 'text';\n    \n    const messageData: any = {\n      contactId: contact.id,\n      content: displayContent || `[${type} message]`,\n      type: messageType,\n      direction: 'inbound',\n      status: 'read' as const,\n      mediaUrl: mediaUrl || undefined,\n    };\n    \n    // Store WhatsApp message ID for deduplication\n    if (whatsappMessageId) {\n      messageData.whatsappMessageId = whatsappMessageId;\n    }\n    \n    const message = await storage.createMessage(messageData);\n    console.log('Saved inbound message:', message.id, 'type:', messageType, 'whatsappId:', whatsappMessageId || 'none');\n\n    await storage.updateChatInboundTime(contact.id);\n    console.log('Updated chat inbound time for contact:', contact.id);\n\n    try {\n      const lead = await findLeadByPhone(from);\n      let agentToUse = null;\n      let source: 'ai_chat' | 'campaign' | 'ad' | 'lead_form' | 'manual' = 'ai_chat';\n      \n      if (lead) {\n        source = 'lead_form';\n        const mapping = await getMappingByFormId(lead.formId);\n        if (mapping && mapping.isActive) {\n          agentToUse = await getAgentById(mapping.agentId);\n        }\n      }\n      \n      if (!agentToUse) {\n        const agents = await getAllAgents();\n        agentToUse = agents.find((a: any) => a.isActive);\n      }\n      \n      const displayName = contact.name && !contact.name.startsWith('WhatsApp ') \n        ? contact.name \n        : (from.startsWith('+') ? from : `+${from}`);\n      await aiAnalytics.createOrUpdateQualification(\n        from,\n        displayName,\n        content,\n        source,\n        {\n          contactId: contact.id,\n          agentId: agentToUse?.id,\n          agentName: agentToUse?.name,\n        }\n      );\n      console.log('Tracked AI qualification for:', from);\n    } catch (analyticsError) {\n      console.error('Error tracking AI qualification:', analyticsError);\n    }\n    \n    return message;\n\n  } catch (error) {\n    console.error('Error saving inbound message:', error);\n    return null;\n  }\n}\n\nasync function saveOutboundMessage(to: string, content: string) {\n  try {\n    const normalizedPhone = to.replace(/\\D/g, '');\n    \n    const contacts = await storage.getContacts();\n    const contact = contacts.find(c => {\n      const contactPhone = (c.phone || '').replace(/\\D/g, '');\n      return contactPhone.includes(normalizedPhone) || normalizedPhone.includes(contactPhone);\n    });\n\n    if (!contact) {\n      console.log('Contact not found for outbound message:', to);\n      return;\n    }\n\n    const message = await storage.createMessage({\n      contactId: contact.id,\n      content: content,\n      type: 'text' as const,\n      direction: 'outbound',\n      status: 'sent' as const,\n    });\n    console.log('Saved outbound AI message:', message.id);\n\n  } catch (error) {\n    console.error('Error saving outbound message:', error);\n  }\n}\n\nasync function sendWhatsAppMessage(to: string, message: string) {\n  if (!WHATSAPP_TOKEN || !PHONE_NUMBER_ID) {\n    throw new Error('WhatsApp credentials not configured');\n  }\n\n  const url = `https://graph.facebook.com/v18.0/${PHONE_NUMBER_ID}/messages`;\n  \n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${WHATSAPP_TOKEN}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        messaging_product: 'whatsapp',\n        recipient_type: 'individual',\n        to,\n        type: 'text',\n        text: { body: message },\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      console.error('WhatsApp API error:', error);\n      throw new Error(`WhatsApp API error: ${error}`);\n    }\n\n    const data = await response.json();\n    console.log('Message sent successfully:', data);\n    return data;\n  } catch (error) {\n    console.error('Error sending WhatsApp message:', error);\n    throw error;\n  }\n}\n\nexport async function sendMessage(req: Request, res: Response) {\n  try {\n    const { to, message } = req.body;\n    \n    if (!to || !message) {\n      return res.status(400).json({ error: 'Recipient and message are required' });\n    }\n\n    const userId = getUserId(req) || undefined;\n    \n    const credentials = await whatsappService.getWhatsAppCredentialsStrict(userId);\n    if (!credentials) {\n      return res.status(403).json({ \n        error: 'WhatsApp credentials not configured. Please set up your API keys in Settings > API Credentials.' \n      });\n    }\n    \n    const result = await whatsappService.sendTextMessage(to, message, userId);\n    \n    if (!result.success) {\n      return res.status(400).json({ error: result.error || 'Failed to send message' });\n    }\n    \n    res.json({ success: true, messageId: result.messageId });\n  } catch (error: any) {\n    console.error('Error sending message:', error);\n    res.status(500).json({ error: error.message || 'Failed to send message' });\n  }\n}\n\nexport async function getMediaUrl(req: Request, res: Response) {\n  try {\n    const { mediaId } = req.params;\n    \n    if (!mediaId) {\n      return res.status(400).json({ error: 'Media ID is required' });\n    }\n    \n    const userId = getUserId(req) || undefined;\n    const credentials = await whatsappService.getWhatsAppCredentialsStrict(userId);\n    \n    if (!credentials) {\n      return res.status(403).json({ \n        error: 'WhatsApp credentials not configured. Please set up your API keys in Settings > API Credentials.' \n      });\n    }\n\n    const mediaInfoUrl = `https://graph.facebook.com/v18.0/${mediaId}`;\n    const mediaInfoResponse = await fetch(mediaInfoUrl, {\n      headers: {\n        'Authorization': `Bearer ${credentials.token}`,\n      },\n    });\n\n    if (!mediaInfoResponse.ok) {\n      const error = await mediaInfoResponse.text();\n      console.error('WhatsApp media info error:', error);\n      return res.status(404).json({ error: 'Media not found or expired' });\n    }\n\n    const mediaInfo = await mediaInfoResponse.json();\n    const downloadUrl = mediaInfo.url;\n    const mimeType = mediaInfo.mime_type;\n    \n    console.log('[Media] Fetched media info:', { mediaId, mimeType, hasUrl: !!downloadUrl });\n\n    const mediaResponse = await fetch(downloadUrl, {\n      headers: {\n        'Authorization': `Bearer ${credentials.token}`,\n      },\n    });\n\n    if (!mediaResponse.ok) {\n      const error = await mediaResponse.text();\n      console.error('WhatsApp media download error:', error);\n      return res.status(500).json({ error: 'Failed to download media' });\n    }\n\n    const buffer = await mediaResponse.arrayBuffer();\n    \n    res.set('Content-Type', mimeType || 'application/octet-stream');\n    res.set('Cache-Control', 'public, max-age=86400');\n    res.send(Buffer.from(buffer));\n  } catch (error: any) {\n    console.error('Error fetching media:', error);\n    res.status(500).json({ error: error.message || 'Failed to fetch media' });\n  }\n}\n\nexport async function getConversations(req: Request, res: Response) {\n  try {\n    const conversations = Object.entries(conversationHistory).map(([phone, messages]) => ({\n      phone,\n      messageCount: messages.length,\n      lastMessage: messages[messages.length - 1],\n    }));\n    res.json(conversations);\n  } catch (error) {\n    console.error('Error getting conversations:', error);\n    res.status(500).json({ error: 'Failed to get conversations' });\n  }\n}\n\nexport async function getConversation(req: Request, res: Response) {\n  try {\n    const { phone } = req.params;\n    const messages = conversationHistory[phone] || [];\n    res.json({ phone, messages });\n  } catch (error) {\n    console.error('Error getting conversation:', error);\n    res.status(500).json({ error: 'Failed to get conversation' });\n  }\n}\n\nexport async function sendTemplateMessage(\n  to: string, \n  templateName: string, \n  languageCode: string = 'en', \n  components: any[] = [],\n  namedParams?: { [key: string]: string }\n) {\n  if (!WHATSAPP_TOKEN || !PHONE_NUMBER_ID) {\n    throw new Error('WhatsApp credentials not configured');\n  }\n\n  const url = `https://graph.facebook.com/v18.0/${PHONE_NUMBER_ID}/messages`;\n  \n  const payload: any = {\n    messaging_product: 'whatsapp',\n    recipient_type: 'individual',\n    to,\n    type: 'template',\n    template: {\n      name: templateName,\n      language: {\n        code: languageCode\n      }\n    }\n  };\n\n  if (namedParams && Object.keys(namedParams).length > 0) {\n    payload.template.components = [\n      {\n        type: 'body',\n        parameters: Object.entries(namedParams).map(([paramName, value]) => ({\n          type: 'text',\n          parameter_name: paramName,\n          text: value\n        }))\n      }\n    ];\n  } else if (components && components.length > 0) {\n    payload.template.components = components;\n  }\n\n  console.log(`[WhatsApp] Sending template \"${templateName}\" to ${to}:`, JSON.stringify(payload, null, 2));\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${WHATSAPP_TOKEN}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(payload),\n    });\n\n    const data = await response.json();\n    \n    if (!response.ok) {\n      console.error('[WhatsApp] Template send error:', data);\n      throw new Error(data.error?.message || 'Failed to send template');\n    }\n\n    console.log('[WhatsApp] Template sent successfully:', data);\n    return data;\n  } catch (error) {\n    console.error('[WhatsApp] Error sending template:', error);\n    throw error;\n  }\n}\n\nexport async function sendTemplateMessageEndpoint(req: Request, res: Response) {\n  try {\n    const { to, templateName, languageCode, components, namedParams } = req.body;\n    \n    if (!to || !templateName) {\n      return res.status(400).json({ error: 'Recipient (to) and templateName are required' });\n    }\n\n    const userId = getUserId(req) || undefined;\n    \n    const credentials = await whatsappService.getWhatsAppCredentialsStrict(userId);\n    if (!credentials) {\n      return res.status(403).json({ \n        error: 'WhatsApp credentials not configured. Please set up your API keys in Settings > API Credentials.' \n      });\n    }\n    \n    const resolvedLangCode = languageCode || 'en';\n    \n    const sendResult = await whatsappService.sendTemplateMessage(\n      to, \n      templateName, \n      resolvedLangCode, \n      components || [], \n      userId\n    );\n\n    if (!sendResult.success) {\n      throw new Error(sendResult.error || 'Failed to send template');\n    }\n    \n    try {\n      const normalizedPhone = to.replace(/\\D/g, '');\n      const contacts = await storage.getContacts();\n      let contact = contacts.find(c => {\n        const contactPhone = (c.phone || '').replace(/\\D/g, '');\n        return contactPhone.includes(normalizedPhone) || normalizedPhone.includes(contactPhone);\n      });\n\n      if (!contact) {\n        const formattedPhone = to.startsWith('+') ? to : `+${to}`;\n        contact = await storage.createContact({\n          name: formattedPhone,\n          phone: to,\n          email: '',\n          tags: ['WhatsApp'],\n          notes: 'Auto-created from template message',\n        });\n      }\n\n      await storage.createMessage({\n        contactId: contact.id,\n        content: `[Template: ${templateName}]`,\n        type: 'text' as const,\n        direction: 'outbound',\n        status: 'sent' as const,\n      });\n    } catch (err) {\n      console.error('Error saving outbound message:', err);\n    }\n\n    res.json({ success: true, messageId: sendResult.messageId });\n  } catch (error: any) {\n    console.error('Error sending template:', error);\n    res.status(500).json({ error: error.message || 'Failed to send template' });\n  }\n}\n","path":null,"size_bytes":31513,"size_tokens":null},"WhatsappBusinessDashboard/client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/pages/settings/Permissions.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function Permissions() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Permissions</h2>\n          <p className=\"text-muted-foreground\">Control access levels for different roles.</p>\n        </div>\n\n        <Tabs defaultValue=\"agent\" className=\"w-full\">\n          <TabsList>\n            <TabsTrigger value=\"admin\">Admin Role</TabsTrigger>\n            <TabsTrigger value=\"agent\">Agent Role</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"agent\" className=\"space-y-4 mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Module Access</CardTitle>\n                <CardDescription>Define which modules agents can access.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Dashboard</Label>\n                    <p className=\"text-sm text-muted-foreground\">View analytics and overview stats.</p>\n                  </div>\n                  <Switch defaultChecked disabled />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Inbox</Label>\n                    <p className=\"text-sm text-muted-foreground\">Read and reply to messages.</p>\n                  </div>\n                  <Switch defaultChecked />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Campaigns</Label>\n                    <p className=\"text-sm text-muted-foreground\">Create and send broadcasts.</p>\n                  </div>\n                  <Switch />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Contacts</Label>\n                    <p className=\"text-sm text-muted-foreground\">View and edit contact details.</p>\n                  </div>\n                  <Switch defaultChecked />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Settings</Label>\n                    <p className=\"text-sm text-muted-foreground\">Access global settings.</p>\n                  </div>\n                  <Switch />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"admin\">\n            <Card>\n               <CardContent className=\"pt-6\">\n                 <p className=\"text-sm text-muted-foreground\">Admins have full access to all modules by default.</p>\n               </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3444,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/dashboard.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { StatsCard } from \"@/components/ui/stats-card\";\nimport { \n  MessageCircle, \n  CheckCircle2, \n  Eye, \n  CornerUpLeft, \n  TrendingUp,\n  Users,\n  Calendar\n} from \"lucide-react\";\nimport { \n  Area, \n  AreaChart, \n  ResponsiveContainer, \n  Tooltip, \n  XAxis, \n  YAxis, \n  CartesianGrid,\n  BarChart,\n  Bar,\n  Legend\n} from \"recharts\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\n\nconst data = [\n  { name: \"Mon\", sent: 4000, delivered: 3800, read: 2400 },\n  { name: \"Tue\", sent: 3000, delivered: 2800, read: 1398 },\n  { name: \"Wed\", sent: 2000, delivered: 1900, read: 9800 },\n  { name: \"Thu\", sent: 2780, delivered: 2600, read: 3908 },\n  { name: \"Fri\", sent: 1890, delivered: 1800, read: 4800 },\n  { name: \"Sat\", sent: 2390, delivered: 2300, read: 3800 },\n  { name: \"Sun\", sent: 3490, delivered: 3300, read: 4300 },\n];\n\nexport default function Dashboard() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Dashboard</h2>\n            <p className=\"text-muted-foreground\">Overview of your messaging performance today.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\">\n              <Calendar className=\"mr-2 h-4 w-4\" />\n              Last 7 Days\n            </Button>\n            <Button>\n              Download Report\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          <StatsCard \n            title=\"Total Messages\" \n            value=\"12,345\" \n            icon={MessageCircle}\n            trend={{ value: 12, label: \"from last week\" }}\n          />\n          <StatsCard \n            title=\"Delivered\" \n            value=\"11,980\" \n            icon={CheckCircle2}\n            trend={{ value: 2.1, label: \"from last week\" }}\n          />\n          <StatsCard \n            title=\"Read Rate\" \n            value=\"84.2%\" \n            icon={Eye}\n            trend={{ value: 5.4, label: \"from last week\" }}\n          />\n          <StatsCard \n            title=\"Replied\" \n            value=\"2,103\" \n            icon={CornerUpLeft}\n            trend={{ value: -1.2, label: \"from last week\" }}\n          />\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-7\">\n          <Card className=\"col-span-4\">\n            <CardHeader>\n              <CardTitle>Message Activity</CardTitle>\n              <CardDescription>\n                Daily message volume and delivery status.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"pl-2\">\n              <div className=\"h-[300px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={data} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\n                    <defs>\n                      <linearGradient id=\"colorSent\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3}/>\n                        <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0}/>\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <XAxis \n                      dataKey=\"name\" \n                      stroke=\"hsl(var(--muted-foreground))\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                    />\n                    <YAxis \n                      stroke=\"hsl(var(--muted-foreground))\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                      tickFormatter={(value) => `${value}`}\n                    />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: \"hsl(var(--card))\", \n                        borderColor: \"hsl(var(--border))\",\n                        borderRadius: \"var(--radius)\",\n                      }}\n                      itemStyle={{ color: \"hsl(var(--foreground))\" }}\n                    />\n                    <Area \n                      type=\"monotone\" \n                      dataKey=\"sent\" \n                      stroke=\"hsl(var(--primary))\" \n                      fillOpacity={1} \n                      fill=\"url(#colorSent)\" \n                      strokeWidth={2}\n                    />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"col-span-3\">\n            <CardHeader>\n              <CardTitle>Campaign Performance</CardTitle>\n              <CardDescription>\n                Recent broadcast engagement rates.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[300px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={data}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <XAxis \n                      dataKey=\"name\" \n                      stroke=\"hsl(var(--muted-foreground))\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                    />\n                    <Tooltip \n                      cursor={{ fill: 'hsl(var(--muted)/0.2)' }}\n                      contentStyle={{ \n                        backgroundColor: \"hsl(var(--card))\", \n                        borderColor: \"hsl(var(--border))\",\n                        borderRadius: \"var(--radius)\",\n                      }}\n                    />\n                    <Legend />\n                    <Bar dataKey=\"delivered\" name=\"Delivered\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                    <Bar dataKey=\"read\" name=\"Read\" fill=\"hsl(var(--chart-2))\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        \n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          <Card>\n             <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-base font-medium\">Active Contacts</CardTitle>\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\n             </CardHeader>\n             <CardContent>\n               <div className=\"mt-4 h-[200px] flex items-center justify-center border rounded-md bg-muted/20 border-dashed\">\n                 <p className=\"text-sm text-muted-foreground\">Contact Map Visualization Placeholder</p>\n               </div>\n             </CardContent>\n          </Card>\n          \n          <Card className=\"lg:col-span-2\">\n             <CardHeader>\n                <CardTitle>Recent Activity</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"space-y-4\">\n                 {[1, 2, 3].map((i) => (\n                   <div key={i} className=\"flex items-center gap-4\">\n                     <div className=\"h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                       <MessageCircle className=\"h-4 w-4\" />\n                     </div>\n                     <div className=\"flex-1 space-y-1\">\n                       <p className=\"text-sm font-medium leading-none\">New message from +1 (555) 000-000{i}</p>\n                       <p className=\"text-xs text-muted-foreground\">2 minutes ago</p>\n                     </div>\n                     <div className=\"text-sm font-medium text-muted-foreground\">View</div>\n                   </div>\n                 ))}\n               </div>\n             </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":8341,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/pages/reports/CustomerReplies.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { MessageSquare, Loader2, ThumbsUp, ThumbsDown, Minus, AlertTriangle } from \"lucide-react\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface Reply {\n  id: string;\n  contactId: string;\n  name: string;\n  phone: string;\n  message: string;\n  fullMessage: string;\n  time: string;\n  timestamp: string;\n  type: string;\n  sentiment: 'Positive' | 'Negative' | 'Neutral';\n}\n\ninterface CustomerRepliesData {\n  replies: Reply[];\n  summary: {\n    totalReplies: number;\n    positiveSentiment: number;\n    unsubscribeRequests: number;\n    sentimentBreakdown: {\n      positive: number;\n      negative: number;\n      neutral: number;\n    };\n  };\n  period: string;\n}\n\nexport default function CustomerReplies() {\n  const [period, setPeriod] = useState(\"week\");\n\n  const { data, isLoading, error } = useQuery<CustomerRepliesData>({\n    queryKey: [\"/api/reports/customer-replies\", period],\n    queryFn: async () => {\n      const res = await fetchWithAuth(`/api/reports/customer-replies?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch customer replies\");\n      return res.json();\n    },\n  });\n\n  const getSentimentIcon = (sentiment: string) => {\n    switch (sentiment) {\n      case 'Positive':\n        return <ThumbsUp className=\"h-4 w-4 text-green-600\" />;\n      case 'Negative':\n        return <ThumbsDown className=\"h-4 w-4 text-red-600\" />;\n      default:\n        return <Minus className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getSentimentBadge = (sentiment: string) => {\n    const variants: Record<string, string> = {\n      'Positive': 'text-green-600 bg-green-50 border-green-200',\n      'Negative': 'text-red-600 bg-red-50 border-red-200',\n      'Neutral': 'text-gray-600 bg-gray-50 border-gray-200',\n    };\n    return (\n      <Badge variant=\"outline\" className={variants[sentiment] || variants['Neutral']}>\n        <span className=\"flex items-center gap-1\">\n          {getSentimentIcon(sentiment)}\n          {sentiment}\n        </span>\n      </Badge>\n    );\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Customers Who Replied</h2>\n            <p className=\"text-muted-foreground\">Track incoming messages and customer sentiment.</p>\n          </div>\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-[150px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Today</SelectItem>\n              <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n              <SelectItem value=\"week\">Last 7 Days</SelectItem>\n              <SelectItem value=\"month\">Last 30 Days</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : error ? (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">Failed to load customer replies data</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Replies</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalReplies || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">This {period}</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <ThumbsUp className=\"h-4 w-4 text-green-600\" />\n                    Positive Sentiment\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-green-600\">{data?.summary.positiveSentiment || 0}%</div>\n                  <p className=\"text-xs text-muted-foreground\">{data?.summary.sentimentBreakdown?.positive || 0} positive replies</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <ThumbsDown className=\"h-4 w-4 text-red-600\" />\n                    Negative Sentiment\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-red-600\">{data?.summary.sentimentBreakdown?.negative || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">Negative replies</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <AlertTriangle className=\"h-4 w-4 text-orange-600\" />\n                    Unsubscribe Requests\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-orange-600\">{data?.summary.unsubscribeRequests || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">Stop/unsubscribe requests</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Recent Replies</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {data?.replies && data.replies.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Customer</TableHead>\n                        <TableHead>Message</TableHead>\n                        <TableHead>Time</TableHead>\n                        <TableHead>Sentiment</TableHead>\n                        <TableHead className=\"text-right\">Action</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {data.replies.map((reply) => (\n                        <TableRow key={reply.id}>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center gap-2\">\n                              <Avatar className=\"h-8 w-8\">\n                                <AvatarFallback className=\"text-xs\">\n                                  {reply.name.charAt(0).toUpperCase()}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div>\n                                <div className=\"font-medium\">{reply.name}</div>\n                                <div className=\"text-xs text-muted-foreground\">{reply.phone}</div>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-muted-foreground max-w-[300px] truncate\">\n                            \"{reply.message}\"\n                          </TableCell>\n                          <TableCell className=\"text-muted-foreground\">{reply.time}</TableCell>\n                          <TableCell>\n                            {getSentimentBadge(reply.sentiment)}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Button variant=\"ghost\" size=\"sm\">\n                              <MessageSquare className=\"mr-2 h-4 w-4\" /> Reply\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No customer replies found for this period.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9254,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation/AutoLeads.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Facebook, Instagram, Globe, MessageSquare } from \"lucide-react\";\n\nexport default function AutoLeads() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Auto-messages to Leads</h2>\n          <p className=\"text-muted-foreground\">Configure automatic welcome messages for new leads from different sources.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-blue-600 flex items-center justify-center text-white\">\n                     <Facebook className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Facebook Leads</CardTitle>\n                     <CardDescription>Leads from FB Lead Forms</CardDescription>\n                   </div>\n                 </div>\n                 <Switch defaultChecked />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Hi {{name}}, thanks for your interest in our product! We have received your inquiry and will get back to you shortly.\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n\n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-pink-600 flex items-center justify-center text-white\">\n                     <Instagram className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Instagram Leads</CardTitle>\n                     <CardDescription>Leads from IG Direct</CardDescription>\n                   </div>\n                 </div>\n                 <Switch />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Hello {{name}}! Thanks for reaching out on Instagram.\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n          \n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-green-600 flex items-center justify-center text-white\">\n                     <Globe className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Website Form</CardTitle>\n                     <CardDescription>Leads from your website</CardDescription>\n                   </div>\n                 </div>\n                 <Switch defaultChecked />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Thanks for signing up on our website, {{name}}!\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4471,"size_tokens":null},"WhatsappBusinessDashboard/shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":584,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"WhatsappBusinessDashboard/client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"WhatsappBusinessDashboard/client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/inbox.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Search, Paperclip, Send, Smile, MoreVertical, Phone, Video } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\n\nconst chats = [\n  { id: 1, name: \"Alice Johnson\", lastMessage: \"Thanks for the update!\", time: \"10:30 AM\", unread: 2, avatar: \"AJ\" },\n  { id: 2, name: \"Bob Smith\", lastMessage: \"When will the order ship?\", time: \"09:15 AM\", unread: 0, avatar: \"BS\" },\n  { id: 3, name: \"Carol Williams\", lastMessage: \"Can I speak to an agent?\", time: \"Yesterday\", unread: 1, avatar: \"CW\" },\n  { id: 4, name: \"David Brown\", lastMessage: \"Is this service available in...\", time: \"Yesterday\", unread: 0, avatar: \"DB\" },\n  { id: 5, name: \"Eva Davis\", lastMessage: \"Refund processed.\", time: \"2 days ago\", unread: 0, avatar: \"ED\" },\n];\n\nconst messages = [\n  { id: 1, sender: \"them\", text: \"Hi, I have a question about my recent order.\", time: \"10:00 AM\" },\n  { id: 2, sender: \"me\", text: \"Hello! I'd be happy to help. Can you provide your order number?\", time: \"10:02 AM\" },\n  { id: 3, sender: \"them\", text: \"Sure, it's #12345.\", time: \"10:05 AM\" },\n  { id: 4, sender: \"me\", text: \"Thanks, checking that for you now...\", time: \"10:06 AM\" },\n  { id: 5, sender: \"me\", text: \"I see it has been shipped and will arrive by Friday.\", time: \"10:08 AM\" },\n  { id: 6, sender: \"them\", text: \"Great, thanks for the update!\", time: \"10:30 AM\" },\n];\n\nexport default function Inbox() {\n  return (\n    <DashboardLayout>\n      <div className=\"h-[calc(100vh-8rem)] flex bg-card border border-border rounded-lg overflow-hidden shadow-sm animate-in fade-in duration-500\">\n        {/* Chat List */}\n        <div className=\"w-80 border-r border-border flex flex-col bg-background\">\n          <div className=\"p-4 border-b border-border\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input placeholder=\"Search chats...\" className=\"pl-9 bg-secondary/50\" />\n            </div>\n            <div className=\"flex gap-2 mt-4\">\n              <Badge variant=\"default\" className=\"cursor-pointer\">All</Badge>\n              <Badge variant=\"outline\" className=\"cursor-pointer hover:bg-secondary\">Unread</Badge>\n              <Badge variant=\"outline\" className=\"cursor-pointer hover:bg-secondary\">Groups</Badge>\n            </div>\n          </div>\n          \n          <ScrollArea className=\"flex-1\">\n            <div className=\"divide-y divide-border\">\n              {chats.map((chat) => (\n                <div \n                  key={chat.id} \n                  className={`p-4 flex items-start gap-3 hover:bg-muted/50 cursor-pointer transition-colors ${chat.id === 1 ? 'bg-muted/50' : ''}`}\n                >\n                  <Avatar>\n                    <AvatarFallback className=\"bg-primary/10 text-primary\">{chat.avatar}</AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <span className=\"font-medium truncate\">{chat.name}</span>\n                      <span className=\"text-xs text-muted-foreground whitespace-nowrap\">{chat.time}</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground truncate\">{chat.lastMessage}</p>\n                  </div>\n                  {chat.unread > 0 && (\n                    <div className=\"h-5 w-5 rounded-full bg-primary text-primary-foreground text-[10px] flex items-center justify-center font-medium\">\n                      {chat.unread}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        </div>\n\n        {/* Chat View */}\n        <div className=\"flex-1 flex flex-col bg-[#efeae2] dark:bg-zinc-900 bg-opacity-50\">\n          {/* Chat Header */}\n          <div className=\"h-16 bg-background border-b border-border flex items-center justify-between px-6\">\n            <div className=\"flex items-center gap-3\">\n              <Avatar>\n                <AvatarFallback className=\"bg-primary/10 text-primary\">AJ</AvatarFallback>\n              </Avatar>\n              <div>\n                <h3 className=\"font-medium\">Alice Johnson</h3>\n                <p className=\"text-xs text-muted-foreground\">Online</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"ghost\" size=\"icon\"><Phone className=\"h-5 w-5 text-muted-foreground\" /></Button>\n              <Button variant=\"ghost\" size=\"icon\"><Video className=\"h-5 w-5 text-muted-foreground\" /></Button>\n              <Button variant=\"ghost\" size=\"icon\"><MoreVertical className=\"h-5 w-5 text-muted-foreground\" /></Button>\n            </div>\n          </div>\n\n          {/* Messages Area */}\n          <ScrollArea className=\"flex-1 p-6 bg-[url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png')] bg-repeat opacity-95\">\n             <div className=\"space-y-4\">\n               {messages.map((msg) => (\n                 <div \n                   key={msg.id} \n                   className={`flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'}`}\n                 >\n                   <div \n                     className={`\n                       max-w-[70%] rounded-lg px-4 py-2 shadow-sm relative\n                       ${msg.sender === 'me' \n                         ? 'bg-[#d9fdd3] dark:bg-primary/20 text-foreground rounded-tr-none' \n                         : 'bg-white dark:bg-card text-card-foreground rounded-tl-none'\n                       }\n                     `}\n                   >\n                     <p className=\"text-sm leading-relaxed\">{msg.text}</p>\n                     <span className=\"text-[10px] text-muted-foreground/80 block text-right mt-1\">\n                       {msg.time}\n                     </span>\n                   </div>\n                 </div>\n               ))}\n             </div>\n          </ScrollArea>\n\n          {/* Input Area */}\n          <div className=\"p-4 bg-background border-t border-border\">\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground\">\n                <Smile className=\"h-6 w-6\" />\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground\">\n                <Paperclip className=\"h-6 w-6\" />\n              </Button>\n              <Input \n                placeholder=\"Type a message\" \n                className=\"flex-1 bg-secondary/50 border-none focus-visible:ring-1\" \n              />\n              <Button size=\"icon\" className=\"rounded-full h-10 w-10\">\n                <Send className=\"h-5 w-5\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7226,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"WhatsappBusinessDashboard/vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/DeliveryReport.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { \n  AreaChart, \n  Area, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  Legend \n} from \"recharts\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download } from \"lucide-react\";\n\nconst data = [\n  { date: 'Mon', sent: 4000, delivered: 3800, read: 2400, failed: 200 },\n  { date: 'Tue', sent: 3000, delivered: 2800, read: 1398, failed: 200 },\n  { date: 'Wed', sent: 2000, delivered: 1900, read: 980, failed: 100 },\n  { date: 'Thu', sent: 2780, delivered: 2600, read: 1908, failed: 180 },\n  { date: 'Fri', sent: 1890, delivered: 1800, read: 1200, failed: 90 },\n  { date: 'Sat', sent: 2390, delivered: 2300, read: 1800, failed: 90 },\n  { date: 'Sun', sent: 3490, delivered: 3300, read: 2300, failed: 190 },\n];\n\nexport default function DeliveryReport() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Message Delivery Report</h2>\n            <p className=\"text-muted-foreground\">Detailed analysis of message delivery rates over time.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n             <Select defaultValue=\"7d\">\n                <SelectTrigger className=\"w-[120px]\">\n                  <SelectValue placeholder=\"Period\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"24h\">Last 24 Hours</SelectItem>\n                  <SelectItem value=\"7d\">Last 7 Days</SelectItem>\n                  <SelectItem value=\"30d\">Last 30 Days</SelectItem>\n                </SelectContent>\n             </Select>\n             <Button variant=\"outline\">\n               <Download className=\"mr-2 h-4 w-4\" />\n               Export CSV\n             </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-4\">\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Sent</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">19,550</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Delivered</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-green-600\">18,500</div>\n               <div className=\"text-xs text-muted-foreground\">94.6% Delivery Rate</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Read</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-blue-600\">11,986</div>\n               <div className=\"text-xs text-muted-foreground\">64.8% Read Rate</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Failed</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-destructive\">1,050</div>\n               <div className=\"text-xs text-muted-foreground\">5.4% Failure Rate</div>\n             </CardContent>\n           </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Delivery Timeline</CardTitle>\n             <CardDescription>Message status trends over the selected period.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[400px] w-full\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={data} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\n                  <defs>\n                    <linearGradient id=\"colorSent\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#8884d8\" stopOpacity={0.1}/>\n                      <stop offset=\"95%\" stopColor=\"#8884d8\" stopOpacity={0}/>\n                    </linearGradient>\n                    <linearGradient id=\"colorDelivered\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#22c55e\" stopOpacity={0.1}/>\n                      <stop offset=\"95%\" stopColor=\"#22c55e\" stopOpacity={0}/>\n                    </linearGradient>\n                    <linearGradient id=\"colorRead\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.1}/>\n                      <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n                    </linearGradient>\n                  </defs>\n                  <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                  <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                  <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                  <Tooltip \n                    contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                  />\n                  <Legend />\n                  <Area type=\"monotone\" dataKey=\"sent\" stroke=\"#8884d8\" fillOpacity={1} fill=\"url(#colorSent)\" name=\"Sent\" />\n                  <Area type=\"monotone\" dataKey=\"delivered\" stroke=\"#22c55e\" fillOpacity={1} fill=\"url(#colorDelivered)\" name=\"Delivered\" />\n                  <Area type=\"monotone\" dataKey=\"read\" stroke=\"#3b82f6\" fillOpacity={1} fill=\"url(#colorRead)\" name=\"Read\" />\n                </AreaChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6349,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport {\n  insertContactSchema,\n  insertMessageSchema,\n  insertCampaignSchema,\n  insertTemplateSchema,\n  insertAutomationSchema,\n  insertTeamMemberSchema,\n} from \"@shared/schema\";\n\nimport agentRoutes from \"./modules/aiAgents/agent.routes\";\nimport fbRoutes from \"./modules/facebook/fb.routes\";\nimport mappingRoutes from \"./modules/mapping/mapping.routes\";\nimport whatsappRoutes from \"./modules/whatsapp/whatsapp.routes\";\nimport leadAutoReplyRoutes from \"./modules/leadAutoReply/leadAutoReply.routes\";\nimport broadcastRoutes from \"./modules/broadcast/broadcast.routes\";\nimport aiAnalyticsRoutes from \"./modules/aiAnalytics/aiAnalytics.routes\";\nimport prefilledTextRoutes from \"./modules/prefilledText/prefilledText.routes\";\nimport authRoutes from \"./modules/auth/auth.routes\";\nimport credentialsRoutes from \"./modules/credentials/credentials.routes\";\nimport contactsRoutes from \"./modules/contacts/contacts.routes\";\nimport reportsRoutes from \"./modules/reports/reports.routes\";\nimport usersRoutes from \"./modules/users/users.routes\";\nimport contactAnalyticsRoutes from \"./modules/contactAnalytics/contactAnalytics.controller\";\nimport leadManagementRoutes from \"./modules/leadManagement/leadManagement.routes\";\nimport * as broadcastService from \"./modules/broadcast/broadcast.service\";\nimport * as agentService from \"./modules/aiAgents/agent.service\";\nimport * as openaiService from \"./modules/openai/openai.service\";\nimport * as aiService from \"./modules/ai/ai.service\";\nimport * as templateService from \"./modules/leadAutoReply/templateMessages.service\";\nimport * as mongodb from \"./modules/storage/mongodb.adapter\";\nimport * as contactAgentService from \"./modules/contactAgent/contactAgent.service\";\nimport * as leadManagementService from \"./modules/leadManagement/leadManagement.service\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n\n  app.get(\"/api/dashboard/stats\", async (req, res) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get dashboard stats\" });\n    }\n  });\n\n  app.get(\"/api/reports/campaign\", async (req, res) => {\n    try {\n      const days = parseInt(req.query.days as string) || 7;\n      const messages = await storage.getMessages();\n      const campaigns = await storage.getCampaigns();\n      const templates = await storage.getTemplates();\n      const broadcastLogs = await broadcastService.getBroadcastLogs({ limit: 10000 });\n      \n      const now = new Date();\n      const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n      \n      const periodMessages = messages.filter(m => new Date(m.timestamp) >= startDate);\n      const outbound = periodMessages.filter(m => m.direction === 'outbound');\n      const inbound = periodMessages.filter(m => m.direction === 'inbound');\n      \n      const totalSent = outbound.length;\n      const delivered = outbound.filter(m => m.status === 'delivered' || m.status === 'read').length;\n      const read = outbound.filter(m => m.status === 'read').length;\n      const replied = inbound.length;\n      const failed = outbound.filter(m => m.status === 'failed').length;\n      \n      const deliveryRate = totalSent > 0 ? Math.round((delivered / totalSent) * 100 * 10) / 10 : 0;\n      const readRate = delivered > 0 ? Math.round((read / delivered) * 100 * 10) / 10 : 0;\n      const replyRate = read > 0 ? Math.round((replied / read) * 100 * 10) / 10 : 0;\n      \n      const deliveryData = [\n        { name: 'Delivered', value: delivered, color: '#22c55e' },\n        { name: 'Read', value: read, color: '#3b82f6' },\n        { name: 'Replied', value: replied, color: '#8b5cf6' },\n        { name: 'Failed', value: failed, color: '#ef4444' },\n      ];\n      \n      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n      const dailyStats = [];\n      for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);\n        const dayMsgs = periodMessages.filter(m => {\n          const msgDate = new Date(m.timestamp);\n          return msgDate.toDateString() === date.toDateString();\n        });\n        const dayOutbound = dayMsgs.filter(m => m.direction === 'outbound');\n        const dayInbound = dayMsgs.filter(m => m.direction === 'inbound');\n        dailyStats.push({\n          name: dayNames[date.getDay()],\n          date: date.toISOString().split('T')[0],\n          sent: dayOutbound.length,\n          read: dayOutbound.filter(m => m.status === 'read').length,\n          replied: dayInbound.length,\n        });\n      }\n      \n      const campaignStats = campaigns.map(c => ({\n        name: c.name,\n        type: 'Marketing',\n        sent: c.sentCount || 0,\n        delivered: c.deliveredCount || 0,\n        read: c.readCount || 0,\n        replied: c.repliedCount || 0,\n        cost: (c.sentCount || 0) * 0.01,\n        date: c.scheduledAt || c.createdAt,\n      })).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()).slice(0, 10);\n      \n      const templateUsage: Record<string, { sent: number; delivered: number; read: number; replied: number }> = {};\n      for (const log of broadcastLogs) {\n        if (log.templateName) {\n          if (!templateUsage[log.templateName]) {\n            templateUsage[log.templateName] = { sent: 0, delivered: 0, read: 0, replied: 0 };\n          }\n          templateUsage[log.templateName].sent++;\n          if (log.status === 'delivered' || log.status === 'sent') {\n            templateUsage[log.templateName].delivered++;\n          }\n          if (log.replied) {\n            templateUsage[log.templateName].replied++;\n          }\n        }\n      }\n      \n      for (const msg of periodMessages) {\n        if (msg.content && msg.content.startsWith('[Template:')) {\n          const match = msg.content.match(/\\[Template:\\s*([^\\]]+)\\]/);\n          if (match) {\n            const templateName = match[1];\n            if (!templateUsage[templateName]) {\n              templateUsage[templateName] = { sent: 0, delivered: 0, read: 0, replied: 0 };\n            }\n            if (msg.direction === 'outbound') {\n              templateUsage[templateName].sent++;\n              if (msg.status === 'delivered' || msg.status === 'read') {\n                templateUsage[templateName].delivered++;\n              }\n              if (msg.status === 'read') {\n                templateUsage[templateName].read++;\n              }\n            }\n          }\n        }\n      }\n      \n      const templatePerformance = Object.entries(templateUsage).map(([name, stats]) => ({\n        name,\n        sent: stats.sent,\n        delivered: stats.delivered,\n        read: stats.read,\n        replied: stats.replied,\n        readRate: stats.delivered > 0 ? Math.round((stats.read / stats.delivered) * 100) : 0,\n        replyRate: stats.read > 0 ? Math.round((stats.replied / stats.read) * 100) : 0,\n        cost: stats.sent * 0.01,\n      })).sort((a, b) => b.sent - a.sent).slice(0, 10);\n      \n      const totalCost = totalSent * 0.01;\n      const costTrend = dailyStats.map(d => ({\n        date: d.date,\n        cost: d.sent * 0.01,\n        messages: d.sent,\n      }));\n      \n      res.json({\n        totalSent,\n        totalDelivered: delivered,\n        totalRead: read,\n        totalReplied: replied,\n        totalFailed: failed,\n        totalCost,\n        deliveryRate,\n        readRate,\n        replyRate,\n        deliveryData,\n        dailyStats,\n        campaignStats,\n        templatePerformance,\n        costTrend,\n      });\n    } catch (error) {\n      console.error('Failed to get campaign report:', error);\n      res.status(500).json({ message: \"Failed to get campaign report\" });\n    }\n  });\n\n  app.get(\"/api/reports/delivery\", async (req, res) => {\n    try {\n      const days = parseInt(req.query.days as string) || 7;\n      const messages = await storage.getMessages();\n      const broadcastLogs = await broadcastService.getBroadcastLogs({ limit: 10000 });\n      \n      const now = new Date();\n      const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n      \n      const periodMessages = messages.filter(m => new Date(m.timestamp) >= startDate);\n      const outbound = periodMessages.filter(m => m.direction === 'outbound');\n      \n      const totalSent = outbound.length;\n      const delivered = outbound.filter(m => m.status === 'delivered' || m.status === 'read').length;\n      const read = outbound.filter(m => m.status === 'read').length;\n      const failed = outbound.filter(m => m.status === 'failed').length;\n      const pending = outbound.filter(m => m.status === 'sent').length;\n      \n      const deliveryRate = totalSent > 0 ? Math.round((delivered / totalSent) * 100 * 10) / 10 : 0;\n      const readRate = delivered > 0 ? Math.round((read / delivered) * 100 * 10) / 10 : 0;\n      const failureRate = totalSent > 0 ? Math.round((failed / totalSent) * 100 * 10) / 10 : 0;\n      \n      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n      const dailyData = [];\n      for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);\n        const dayMsgs = periodMessages.filter(m => {\n          const msgDate = new Date(m.timestamp);\n          return msgDate.toDateString() === date.toDateString();\n        });\n        const dayOutbound = dayMsgs.filter(m => m.direction === 'outbound');\n        dailyData.push({\n          date: dayNames[date.getDay()],\n          fullDate: date.toISOString().split('T')[0],\n          sent: dayOutbound.length,\n          delivered: dayOutbound.filter(m => m.status === 'delivered' || m.status === 'read').length,\n          read: dayOutbound.filter(m => m.status === 'read').length,\n          failed: dayOutbound.filter(m => m.status === 'failed').length,\n        });\n      }\n      \n      const hourlyData = [];\n      for (let hour = 0; hour < 24; hour++) {\n        const hourMsgs = outbound.filter(m => {\n          const msgDate = new Date(m.timestamp);\n          return msgDate.getHours() === hour;\n        });\n        hourlyData.push({\n          hour: `${hour.toString().padStart(2, '0')}:00`,\n          sent: hourMsgs.length,\n          delivered: hourMsgs.filter(m => m.status === 'delivered' || m.status === 'read').length,\n        });\n      }\n      \n      res.json({\n        totalSent,\n        delivered,\n        read,\n        failed,\n        pending,\n        deliveryRate,\n        readRate,\n        failureRate,\n        dailyData,\n        hourlyData,\n      });\n    } catch (error) {\n      console.error('Failed to get delivery report:', error);\n      res.status(500).json({ message: \"Failed to get delivery report\" });\n    }\n  });\n\n  // Mount contacts module routes FIRST (includes /block, /unblock, /blocked)\n  app.use(\"/api/contacts\", contactsRoutes);\n\n  app.get(\"/api/contacts\", async (req, res) => {\n    try {\n      // Get contacts from both in-memory storage and MongoDB imported_contacts\n      const memContacts = await storage.getContacts();\n      const importedContacts = await mongodb.readCollection<{\n        id: string;\n        name: string;\n        phone: string;\n        email?: string;\n        tags?: string[];\n      }>('imported_contacts');\n      \n      // Combine and deduplicate by phone number\n      const phoneSet = new Set<string>();\n      const allContacts: typeof memContacts = [];\n      \n      // Add imported contacts first (they have user-provided names)\n      for (const contact of importedContacts) {\n        const normalizedPhone = contact.phone.replace(/\\D/g, '');\n        if (!phoneSet.has(normalizedPhone)) {\n          phoneSet.add(normalizedPhone);\n          allContacts.push({\n            id: contact.id,\n            name: contact.name,\n            phone: contact.phone,\n            email: contact.email || '',\n            tags: contact.tags || [],\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString(),\n          });\n        }\n      }\n      \n      // Add memory contacts that don't overlap\n      for (const contact of memContacts) {\n        const normalizedPhone = contact.phone.replace(/\\D/g, '');\n        if (!phoneSet.has(normalizedPhone)) {\n          phoneSet.add(normalizedPhone);\n          allContacts.push(contact);\n        }\n      }\n      \n      res.json(allContacts);\n    } catch (error) {\n      console.error(\"Error fetching contacts:\", error);\n      res.status(500).json({ message: \"Failed to get contacts\" });\n    }\n  });\n\n  app.get(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const contact = await storage.getContact(req.params.id);\n      if (!contact) {\n        return res.status(404).json({ message: \"Contact not found\" });\n      }\n      res.json(contact);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get contact\" });\n    }\n  });\n\n  app.post(\"/api/contacts\", async (req, res) => {\n    try {\n      const parsed = insertContactSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid contact data\", errors: parsed.error.errors });\n      }\n      const contact = await storage.createContact(parsed.data);\n      res.status(201).json(contact);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create contact\" });\n    }\n  });\n\n  app.put(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const contact = await storage.updateContact(req.params.id, req.body);\n      if (!contact) {\n        return res.status(404).json({ message: \"Contact not found\" });\n      }\n      res.json(contact);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update contact\" });\n    }\n  });\n\n  app.delete(\"/api/contacts/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteContact(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Contact not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete contact\" });\n    }\n  });\n\n  app.post(\"/api/contacts/import\", async (req, res) => {\n    try {\n      const { contacts } = req.body;\n      if (!Array.isArray(contacts)) {\n        return res.status(400).json({ message: \"Invalid data format\" });\n      }\n      const imported = [];\n      for (const contact of contacts) {\n        const parsed = insertContactSchema.safeParse(contact);\n        if (parsed.success) {\n          const newContact = await storage.createContact(parsed.data);\n          imported.push(newContact);\n        }\n      }\n      res.json({ imported: imported.length, contacts: imported });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to import contacts\" });\n    }\n  });\n\n  app.get(\"/api/messages\", async (req, res) => {\n    try {\n      const { contactId } = req.query;\n      const messages = await storage.getMessages(contactId as string | undefined);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", async (req, res) => {\n    try {\n      const parsed = insertMessageSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid message data\", errors: parsed.error.errors });\n      }\n      const message = await storage.createMessage(parsed.data);\n      res.status(201).json(message);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  app.get(\"/api/debug/user/:email\", async (req, res) => {\n    try {\n      const { SystemUser } = await import('./modules/users/user.model');\n      const { User } = await import('./modules/storage/mongodb.adapter');\n      const email = req.params.email;\n      \n      const systemUser = await SystemUser.findOne({ email });\n      const regularUser = await User.findOne({ $or: [{ email }, { username: email }] });\n      \n      res.json({\n        systemUser: systemUser ? {\n          id: systemUser.id,\n          email: systemUser.email,\n          name: systemUser.name,\n          role: systemUser.role,\n          isActive: systemUser.isActive\n        } : null,\n        regularUser: regularUser ? {\n          id: regularUser.id,\n          email: regularUser.email,\n          name: regularUser.name,\n          role: regularUser.role\n        } : null\n      });\n    } catch (error) {\n      console.error('Debug error:', error);\n      res.status(500).json({ error: String(error) });\n    }\n  });\n\n  app.get(\"/api/chats\", async (req, res) => {\n    try {\n      const userId = req.headers['x-user-id'] as string;\n      const userRole = (req.headers['x-user-role'] as string) || 'super_admin';\n      const userName = req.headers['x-user-name'] as string;\n      \n      console.log(`[Inbox Filter] User: ${userName}, Role: ${userRole}, ID: ${userId}`);\n      console.log(`[Inbox Filter] All headers:`, JSON.stringify(req.headers));\n      \n      let chats = await storage.getChats();\n      \n      if (userId && userRole !== 'super_admin' && userRole !== 'sub_admin') {\n        const permittedContactIds = await leadManagementService.getFilteredChatsForUser({\n          userId,\n          role: userRole as any,\n          name: userName,\n        });\n        \n        if (permittedContactIds.length > 0) {\n          chats = chats.filter(chat => permittedContactIds.includes(chat.contact.id));\n        } else if (userRole === 'user') {\n          chats = [];\n        }\n      }\n      \n      const assignments = await leadManagementService.getAllLeadAssignments({ \n        status: ['assigned', 'in_progress']\n      });\n      const assignmentMap = new Map(assignments.map((a: any) => [a.contactId, a]));\n      \n      const chatsWithAssignment = chats.map(chat => ({\n        ...chat,\n        assignment: assignmentMap.get(chat.contact.id) || null,\n      }));\n      \n      res.json(chatsWithAssignment);\n    } catch (error) {\n      console.error('Error getting chats:', error);\n      res.status(500).json({ message: \"Failed to get chats\" });\n    }\n  });\n\n  app.get(\"/api/chats/window\", async (req, res) => {\n    try {\n      const userId = req.headers['x-user-id'] as string;\n      const userRole = (req.headers['x-user-role'] as string) || 'super_admin';\n      const userName = req.headers['x-user-name'] as string;\n      \n      let chats = await storage.getChats();\n      \n      if (userId && userRole !== 'super_admin' && userRole !== 'sub_admin') {\n        const permittedContactIds = await leadManagementService.getFilteredChatsForUser({\n          userId,\n          role: userRole as any,\n          name: userName,\n        });\n        \n        if (permittedContactIds.length > 0) {\n          chats = chats.filter(chat => permittedContactIds.includes(chat.contact.id));\n        } else if (userRole === 'user') {\n          chats = [];\n        }\n      }\n      \n      const now = new Date();\n      const windowChats = chats.filter(chat => {\n        if (chat.lastInboundMessageTime) {\n          const lastInbound = new Date(chat.lastInboundMessageTime);\n          const hoursDiff = (now.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n          return hoursDiff <= 24;\n        }\n        return false;\n      });\n      res.json(windowChats);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get window chats\" });\n    }\n  });\n\n  app.get(\"/api/chats/:id\", async (req, res) => {\n    try {\n      const chat = await storage.getChat(req.params.id);\n      if (!chat) {\n        return res.status(404).json({ message: \"Chat not found\" });\n      }\n      res.json(chat);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get chat\" });\n    }\n  });\n\n  app.post(\"/api/chats/:contactId/mark-read\", async (req, res) => {\n    try {\n      await storage.markMessagesAsRead(req.params.contactId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to mark messages as read\" });\n    }\n  });\n\n  app.post(\"/api/chats/:contactId/mark-unread\", async (req, res) => {\n    try {\n      await storage.markMessagesAsUnread(req.params.contactId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to mark messages as unread\" });\n    }\n  });\n\n  app.post(\"/api/inbox/send\", async (req, res) => {\n    try {\n      const { contactId, phone, name, messageType, templateName, customMessage, agentId } = req.body;\n      \n      if (!phone) {\n        return res.status(400).json({ error: \"Phone number is required\" });\n      }\n      \n      if (!messageType) {\n        return res.status(400).json({ error: \"Message type is required\" });\n      }\n      \n      console.log(`[InboxSend] Sending ${messageType} message to ${phone}`);\n      \n      let result: { success: boolean; messageId?: string; error?: string; aiMessage?: string } = { success: false };\n      let messageContent = \"\";\n      \n      switch (messageType) {\n        case \"template\": {\n          if (!templateName) {\n            return res.status(400).json({ error: \"Template name is required for template messages\" });\n          }\n          result = await broadcastService.sendTemplateMessage(phone, templateName, name);\n          messageContent = `[Template: ${templateName}]`;\n          break;\n        }\n        \n        case \"custom\": {\n          if (!customMessage) {\n            return res.status(400).json({ error: \"Message content is required for custom messages\" });\n          }\n          result = await broadcastService.sendCustomMessage(phone, customMessage);\n          messageContent = customMessage;\n          break;\n        }\n        \n        case \"ai\": {\n          if (!agentId) {\n            return res.status(400).json({ error: \"Agent ID is required for AI messages\" });\n          }\n          \n          const agent = await agentService.getAgentById(agentId);\n          if (!agent) {\n            return res.status(404).json({ error: \"AI Agent not found\" });\n          }\n          \n          console.log(`[InboxSend] Generating AI response with agent: ${agent.name}`);\n          \n          // Assign this agent to the contact for future messages and enable auto-reply\n          await contactAgentService.assignAgentToContact(contactId, phone, agentId, agent.name);\n          await contactAgentService.enableAutoReply(phone);\n          console.log(`[InboxSend] Assigned agent ${agent.name} to contact ${phone} (auto-reply enabled)`);\n          \n          // Get conversation history from MongoDB (stored per contact-agent assignment)\n          let conversationHistory = await contactAgentService.getConversationHistory(phone);\n          \n          // If no stored history, fetch from messages\n          if (conversationHistory.length === 0 && contactId) {\n            try {\n              const recentMessages = await storage.getMessages(contactId);\n              const lastMessages = recentMessages.slice(-10);\n              conversationHistory = lastMessages.map((m: any) => ({\n                role: m.direction === 'inbound' ? 'user' as const : 'assistant' as const,\n                content: m.content\n              }));\n            } catch (e) {\n              console.log(\"[InboxSend] Could not fetch conversation context\");\n            }\n          }\n          \n          console.log(`[InboxSend] Using ${conversationHistory.length} messages for context, agent model: ${agent.model || 'default'}`);\n          \n          // Get the last inbound message to respond to, or use a greeting prompt\n          const lastInboundMessage = conversationHistory.filter(m => m.role === 'user').pop();\n          const promptMessage = lastInboundMessage?.content || \n            `Greet ${name || 'the customer'} warmly and introduce yourself as per your instructions.`;\n          \n          const aiMessage = await aiService.generateAgentResponse(\n            promptMessage,\n            agent,\n            conversationHistory.slice(0, -1) // Exclude the last message since we're using it as the prompt\n          );\n          \n          if (!aiMessage) {\n            return res.status(500).json({ error: \"Failed to generate AI response. Check if API key is configured for the agent model.\" });\n          }\n          \n          console.log(`[InboxSend] AI generated: \"${aiMessage.substring(0, 100)}...\"`);\n          \n          // Store the AI response in conversation history\n          await contactAgentService.addMessageToHistory(phone, 'assistant', aiMessage);\n          \n          result = await broadcastService.sendCustomMessage(phone, aiMessage);\n          result.aiMessage = aiMessage;\n          messageContent = aiMessage;\n          \n          if (!result.success && result.error?.includes(\"24\")) {\n            console.log(\"[InboxSend] Outside 24-hour window, trying template fallback\");\n            result = await templateService.sendHelloWorldTemplate(phone);\n            messageContent = \"[Template: hello_world] (AI fallback)\";\n          }\n          break;\n        }\n        \n        default:\n          return res.status(400).json({ error: \"Invalid message type. Use: template, custom, or ai\" });\n      }\n      \n      if (result.success && contactId) {\n        try {\n          await storage.createMessage({\n            contactId,\n            content: messageContent,\n            type: \"text\" as const,\n            direction: \"outbound\",\n            status: \"sent\" as const,\n          });\n          console.log(`[InboxSend] Saved message to conversation for contact ${contactId}`);\n        } catch (saveError) {\n          console.error(\"[InboxSend] Failed to save message to conversation:\", saveError);\n        }\n      }\n      \n      if (result.success) {\n        res.json({ \n          success: true, \n          messageId: result.messageId,\n          message: messageContent,\n          sent: true \n        });\n      } else {\n        res.status(400).json({ \n          success: false, \n          error: result.error || \"Failed to send message\" \n        });\n      }\n    } catch (error: any) {\n      console.error(\"[InboxSend] Error:\", error);\n      res.status(500).json({ error: error.message || \"Failed to send message\" });\n    }\n  });\n\n  app.post(\"/api/inbox/send-ai-response\", async (req, res) => {\n    try {\n      const { contactId, phone, name, agentId, userMessage } = req.body;\n      \n      if (!phone || !agentId) {\n        return res.status(400).json({ error: \"Phone and agentId are required\" });\n      }\n      \n      const agent = await agentService.getAgentById(agentId);\n      if (!agent) {\n        return res.status(404).json({ error: \"AI Agent not found\" });\n      }\n      \n      console.log(`[InboxSendAI] Generating contextual AI response with agent: ${agent.name} (model: ${agent.model || 'default'})`);\n      \n      // Use the user message directly as the prompt, or a simple greeting request\n      const promptMessage = userMessage || 'Hello';\n      \n      const aiMessage = await aiService.generateAgentResponse(promptMessage, agent, []);\n      \n      if (!aiMessage) {\n        return res.status(500).json({ error: \"Failed to generate AI response. Check if API key is configured for the agent model.\" });\n      }\n      \n      const result = await broadcastService.sendCustomMessage(phone, aiMessage);\n      \n      if (result.success && contactId) {\n        await storage.createMessage({\n          contactId,\n          content: aiMessage,\n          type: \"text\" as const,\n          direction: \"outbound\",\n          status: \"sent\" as const,\n        });\n      }\n      \n      res.json({ \n        success: result.success, \n        message: aiMessage,\n        error: result.error \n      });\n    } catch (error: any) {\n      console.error(\"[InboxSendAI] Error:\", error);\n      res.status(500).json({ error: error.message || \"Failed to send AI response\" });\n    }\n  });\n\n  app.get(\"/api/campaigns\", async (req, res) => {\n    try {\n      const campaigns = await storage.getCampaigns();\n      res.json(campaigns);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get campaigns\" });\n    }\n  });\n\n  app.get(\"/api/campaigns/:id\", async (req, res) => {\n    try {\n      const campaign = await storage.getCampaign(req.params.id);\n      if (!campaign) {\n        return res.status(404).json({ message: \"Campaign not found\" });\n      }\n      res.json(campaign);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get campaign\" });\n    }\n  });\n\n  app.post(\"/api/campaigns\", async (req, res) => {\n    try {\n      const parsed = insertCampaignSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid campaign data\", errors: parsed.error.errors });\n      }\n      const campaign = await storage.createCampaign(parsed.data);\n      res.status(201).json(campaign);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create campaign\" });\n    }\n  });\n\n  app.put(\"/api/campaigns/:id\", async (req, res) => {\n    try {\n      const campaign = await storage.updateCampaign(req.params.id, req.body);\n      if (!campaign) {\n        return res.status(404).json({ message: \"Campaign not found\" });\n      }\n      res.json(campaign);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update campaign\" });\n    }\n  });\n\n  app.delete(\"/api/campaigns/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteCampaign(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Campaign not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete campaign\" });\n    }\n  });\n\n  app.post(\"/api/campaigns/:id/send\", async (req, res) => {\n    try {\n      const campaign = await storage.getCampaign(req.params.id);\n      if (!campaign) {\n        return res.status(404).json({ message: \"Campaign not found\" });\n      }\n      const sentCount = campaign.contactIds.length;\n      const deliveredCount = Math.floor(sentCount * 0.95);\n      const readCount = Math.floor(deliveredCount * 0.7);\n      const repliedCount = Math.floor(readCount * 0.2);\n\n      const updatedCampaign = await storage.updateCampaign(req.params.id, {\n        status: \"completed\",\n        sentCount,\n        deliveredCount,\n        readCount,\n        repliedCount,\n      });\n      res.json(updatedCampaign);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to send campaign\" });\n    }\n  });\n\n  app.get(\"/api/templates\", async (req, res) => {\n    try {\n      const templates = await storage.getTemplates();\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get templates\" });\n    }\n  });\n\n  app.get(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.getTemplate(req.params.id);\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get template\" });\n    }\n  });\n\n  app.post(\"/api/templates\", async (req, res) => {\n    try {\n      const parsed = insertTemplateSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid template data\", errors: parsed.error.errors });\n      }\n      const template = await storage.createTemplate(parsed.data);\n      res.status(201).json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create template\" });\n    }\n  });\n\n  app.put(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.updateTemplate(req.params.id, req.body);\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update template\" });\n    }\n  });\n\n  app.delete(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteTemplate(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete template\" });\n    }\n  });\n\n  // Get templates directly from Meta/Facebook (live data, not from database)\n  app.get(\"/api/templates/meta\", async (req, res) => {\n    try {\n      const { credentialsService } = await import('./modules/credentials/credentials.service');\n      \n      const userId = (req as any).session?.user?.id;\n      let token: string | undefined;\n      let wabaId: string | undefined;\n      \n      if (userId) {\n        const credentials = await credentialsService.getDecryptedCredentials(userId);\n        if (credentials?.whatsappToken) {\n          token = credentials.whatsappToken;\n        }\n        if (credentials?.businessAccountId) {\n          wabaId = credentials.businessAccountId;\n        }\n      }\n      \n      if (!token) {\n        token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN || process.env.FB_ACCESS_TOKEN;\n      }\n      if (!wabaId) {\n        wabaId = process.env.WABA_ID;\n      }\n      \n      if (!token || !wabaId) {\n        return res.status(400).json({ \n          message: \"WhatsApp credentials not configured\",\n          hint: \"Please configure your WhatsApp Access Token and Business Account ID in Settings.\"\n        });\n      }\n\n      console.log(`[TemplatesMeta] Fetching templates directly from Meta for WABA: ${wabaId}`);\n\n      const response = await fetch(\n        `https://graph.facebook.com/v18.0/${wabaId}/message_templates?fields=id,name,status,category,language,quality_score,components,rejected_reason&limit=100&access_token=${token}`\n      );\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error(\"[TemplatesMeta] Meta API Error:\", errorData);\n        return res.status(response.status).json({ \n          message: \"Failed to fetch templates from Meta\",\n          error: errorData.error?.message || \"Unknown error\"\n        });\n      }\n\n      const data = await response.json();\n      const metaTemplates = data.data || [];\n\n      const templates = metaTemplates.map((t: any) => {\n        let content = \"\";\n        let header = \"\";\n        let footer = \"\";\n        let buttons: any[] = [];\n        \n        if (t.components) {\n          for (const comp of t.components) {\n            if (comp.type === \"HEADER\") {\n              header = comp.text || comp.format || \"\";\n            } else if (comp.type === \"BODY\") {\n              content = comp.text || \"\";\n            } else if (comp.type === \"FOOTER\") {\n              footer = comp.text || \"\";\n            } else if (comp.type === \"BUTTONS\") {\n              buttons = comp.buttons || [];\n            }\n          }\n        }\n\n        return {\n          id: t.id,\n          name: t.name,\n          status: t.status?.toLowerCase() || 'pending',\n          category: t.category?.toLowerCase() || 'utility',\n          language: t.language || 'en',\n          content,\n          header,\n          footer,\n          buttons,\n          qualityScore: t.quality_score,\n          rejectedReason: t.rejected_reason,\n        };\n      });\n\n      const summary = {\n        total: templates.length,\n        approved: templates.filter((t: any) => t.status === 'approved').length,\n        pending: templates.filter((t: any) => t.status === 'pending').length,\n        rejected: templates.filter((t: any) => t.status === 'rejected').length,\n      };\n\n      res.json({ templates, summary });\n    } catch (error) {\n      console.error(\"[TemplatesMeta] Error:\", error);\n      res.status(500).json({ message: \"Failed to fetch templates from Meta\" });\n    }\n  });\n\n  // Sync templates from Meta Business Suite\n  app.post(\"/api/templates/sync-meta\", async (req, res) => {\n    try {\n      const { credentialsService } = await import('./modules/credentials/credentials.service');\n      \n      // Get user credentials from session\n      const userId = (req as any).session?.user?.id;\n      let token: string | undefined;\n      let wabaId: string | undefined;\n      \n      if (userId) {\n        const credentials = await credentialsService.getDecryptedCredentials(userId);\n        if (credentials?.whatsappToken) {\n          token = credentials.whatsappToken;\n        }\n        if (credentials?.businessAccountId) {\n          wabaId = credentials.businessAccountId;\n        }\n      }\n      \n      // Fallback to environment variables\n      if (!token) {\n        token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN || process.env.FB_ACCESS_TOKEN;\n      }\n      if (!wabaId) {\n        wabaId = process.env.WABA_ID;\n      }\n      \n      if (!token) {\n        return res.status(400).json({ message: \"WhatsApp access token not configured. Please configure your API credentials in Settings.\" });\n      }\n\n      if (!wabaId) {\n        return res.status(400).json({ message: \"WhatsApp Business Account ID (WABA_ID) not configured. Please configure it in Settings.\" });\n      }\n\n      console.log(`[TemplateSync] Fetching templates from WABA ID: ${wabaId}`);\n\n      // Fetch templates from Meta Graph API with more fields\n      const response = await fetch(\n        `https://graph.facebook.com/v18.0/${wabaId}/message_templates?fields=name,status,category,language,components&access_token=${token}`\n      );\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error(\"[TemplateSync] Meta API Error:\", errorData);\n        return res.status(response.status).json({ \n          message: \"Failed to fetch templates from Meta\",\n          error: errorData.error?.message || \"Unknown error\",\n          hint: \"Make sure WABA_ID is set to your WhatsApp Business Account ID (not Phone Number ID)\"\n        });\n      }\n\n      const data = await response.json();\n      const metaTemplates = data.data || [];\n      let synced = 0;\n      let updated = 0;\n      const approvedTemplates: string[] = [];\n\n      console.log(`[TemplateSync] Found ${metaTemplates.length} templates from Meta`);\n\n      for (const metaTemplate of metaTemplates) {\n        // Log template info\n        console.log(`[TemplateSync] Template: ${metaTemplate.name}, Status: ${metaTemplate.status}, Language: ${metaTemplate.language}`);\n        \n        if (metaTemplate.status === \"APPROVED\") {\n          approvedTemplates.push(`${metaTemplate.name} (${metaTemplate.language})`);\n        }\n\n        // Check if template already exists\n        const existingTemplates = await storage.getTemplates();\n        const exists = existingTemplates.find(t => t.name === metaTemplate.name);\n        \n        // Extract content from components\n        let content = \"\";\n        let variables: string[] = [];\n        \n        if (metaTemplate.components) {\n          const bodyComponent = metaTemplate.components.find((c: any) => c.type === \"BODY\");\n          if (bodyComponent) {\n            content = bodyComponent.text || \"\";\n            const matches = content.match(/\\{\\{(\\d+)\\}\\}/g);\n            if (matches) {\n              variables = matches.map((m: string, i: number) => `var${i + 1}`);\n            }\n          }\n        }\n\n        const status = metaTemplate.status === \"APPROVED\" ? \"approved\" : \n                      metaTemplate.status === \"REJECTED\" ? \"rejected\" : \"pending\";\n        const now = new Date().toISOString();\n\n        if (!exists) {\n          const newTemplate = await storage.createTemplate({\n            name: metaTemplate.name,\n            category: (metaTemplate.category || \"utility\").toLowerCase() as any,\n            content: content,\n            variables: variables,\n          });\n          await storage.updateTemplate(newTemplate.id, { \n            status,\n            language: metaTemplate.language || 'en',\n            metaTemplateId: metaTemplate.id,\n            metaStatus: metaTemplate.status,\n            lastSyncedAt: now,\n          } as any);\n          synced++;\n        } else {\n          await storage.updateTemplate(exists.id, { \n            status,\n            content: content || exists.content,\n            language: metaTemplate.language || 'en',\n            metaTemplateId: metaTemplate.id,\n            metaStatus: metaTemplate.status,\n            lastSyncedAt: now,\n          } as any);\n          updated++;\n        }\n      }\n\n      console.log(`[TemplateSync] Approved templates: ${approvedTemplates.join(', ')}`);\n\n      res.json({ \n        success: true, \n        synced, \n        updated,\n        total: metaTemplates.length,\n        approvedTemplates,\n        message: `Synced ${synced} new templates, updated ${updated} existing templates from Meta. ${approvedTemplates.length} are approved.`\n      });\n    } catch (error) {\n      console.error(\"[TemplateSync] Error:\", error);\n      res.status(500).json({ message: \"Failed to sync templates from Meta\" });\n    }\n  });\n\n  // Submit template for Meta approval\n  app.post(\"/api/templates/:id/submit-approval\", async (req, res) => {\n    try {\n      const template = await storage.getTemplate(req.params.id) as any;\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n\n      if (template.metaStatus === 'APPROVED' || template.metaStatus === 'approved') {\n        return res.status(400).json({ message: \"Template is already approved by Meta\" });\n      }\n      if (template.metaStatus === 'REJECTED' || template.metaStatus === 'rejected') {\n        return res.status(400).json({ message: \"Template was rejected by Meta. Please edit and resubmit.\" });\n      }\n      if (template.metaTemplateId) {\n        return res.status(400).json({ message: \"Template has already been submitted to Meta. Please sync to check status.\" });\n      }\n\n      const { credentialsService } = await import('./modules/credentials/credentials.service');\n      \n      const userId = (req as any).session?.user?.id;\n      let token: string | undefined;\n      let wabaId: string | undefined;\n      \n      if (userId) {\n        const credentials = await credentialsService.getDecryptedCredentials(userId);\n        if (credentials?.whatsappToken) {\n          token = credentials.whatsappToken;\n        }\n        if (credentials?.businessAccountId) {\n          wabaId = credentials.businessAccountId;\n        }\n      }\n      \n      if (!token) {\n        token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN || process.env.FB_ACCESS_TOKEN;\n      }\n      if (!wabaId) {\n        wabaId = process.env.WABA_ID;\n      }\n      \n      if (!token) {\n        return res.status(400).json({ message: \"WhatsApp access token not configured. Please configure your API credentials in Settings.\" });\n      }\n\n      if (!wabaId) {\n        return res.status(400).json({ message: \"WABA_ID not configured. Please configure it in Settings.\" });\n      }\n\n      // Convert template name to Meta format\n      const metaTemplateName = template.name.toLowerCase().replace(/\\s+/g, '_').replace(/[^a-z0-9_]/g, '');\n      \n      console.log(`[TemplateSubmit] Submitting template \"${metaTemplateName}\" to Meta WABA: ${wabaId}`);\n\n      // Prepare template for Meta submission\n      // Variables in Meta must be {{1}}, {{2}}, etc. - not named variables\n      let processedContent = template.content;\n      let variableIndex = 1;\n      const variableMatches = template.content.match(/\\{\\{([^}]+)\\}\\}/g) || [];\n      for (const match of variableMatches) {\n        processedContent = processedContent.replace(match, `{{${variableIndex}}}`);\n        variableIndex++;\n      }\n\n      // Create example values for body parameters if there are variables\n      const bodyComponent: any = {\n        type: \"BODY\",\n        text: processedContent\n      };\n\n      // Add example if there are variables\n      if (variableIndex > 1) {\n        bodyComponent.example = {\n          body_text: [\n            Array.from({ length: variableIndex - 1 }, (_, i) => `Sample${i + 1}`)\n          ]\n        };\n      }\n\n      const templateData = {\n        name: metaTemplateName,\n        category: template.category.toUpperCase(),\n        language: \"en\",\n        components: [bodyComponent]\n      };\n\n      console.log(`[TemplateSubmit] Sending to Meta:`, JSON.stringify(templateData, null, 2));\n\n      // Submit to Meta Graph API\n      const response = await fetch(\n        `https://graph.facebook.com/v18.0/${wabaId}/message_templates`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Authorization\": `Bearer ${token}`,\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify(templateData)\n        }\n      );\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        console.error(\"[TemplateSubmit] Meta error:\", data);\n        \n        // Handle specific error codes\n        let errorMessage = data.error?.message || \"Unknown error\";\n        if (data.error?.code === 100) {\n          errorMessage = \"Template name already exists in Meta. Please use a different name.\";\n        } else if (data.error?.code === 190) {\n          errorMessage = \"Invalid access token. Please check your WHATSAPP_TOKEN.\";\n        } else if (data.error?.error_subcode === 2388093) {\n          errorMessage = \"Template contains prohibited content. Please check Meta's template guidelines.\";\n        }\n        \n        return res.status(response.status).json({ \n          message: \"Failed to submit template to Meta\",\n          error: errorMessage,\n          details: data.error\n        });\n      }\n\n      console.log(`[TemplateSubmit] Successfully created template in Meta. ID: ${data.id}, Status: ${data.status}`);\n\n      // Update template status to pending (Meta will review it)\n      await storage.updateTemplate(req.params.id, { status: \"pending\" });\n\n      res.json({ \n        success: true, \n        message: `Template \"${metaTemplateName}\" submitted to Meta for approval. It will appear in your Meta Business Suite templates list. Approval typically takes 1-24 hours.`,\n        metaTemplateId: data.id,\n        metaTemplateName: metaTemplateName,\n        status: data.status\n      });\n    } catch (error) {\n      console.error(\"[TemplateSubmit] Error:\", error);\n      res.status(500).json({ message: \"Failed to submit template for approval\" });\n    }\n  });\n\n  app.get(\"/api/automations\", async (req, res) => {\n    try {\n      const automations = await storage.getAutomations();\n      res.json(automations);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get automations\" });\n    }\n  });\n\n  app.get(\"/api/automations/:id\", async (req, res) => {\n    try {\n      const automation = await storage.getAutomation(req.params.id);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n      res.json(automation);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get automation\" });\n    }\n  });\n\n  app.post(\"/api/automations\", async (req, res) => {\n    try {\n      const parsed = insertAutomationSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid automation data\", errors: parsed.error.errors });\n      }\n      const automation = await storage.createAutomation(parsed.data);\n      res.status(201).json(automation);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create automation\" });\n    }\n  });\n\n  app.put(\"/api/automations/:id\", async (req, res) => {\n    try {\n      const automation = await storage.updateAutomation(req.params.id, req.body);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n      res.json(automation);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update automation\" });\n    }\n  });\n\n  app.delete(\"/api/automations/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteAutomation(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete automation\" });\n    }\n  });\n\n  app.get(\"/api/team-members\", async (req, res) => {\n    try {\n      const members = await storage.getTeamMembers();\n      res.json(members);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get team members\" });\n    }\n  });\n\n  app.get(\"/api/team-members/:id\", async (req, res) => {\n    try {\n      const member = await storage.getTeamMember(req.params.id);\n      if (!member) {\n        return res.status(404).json({ message: \"Team member not found\" });\n      }\n      res.json(member);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get team member\" });\n    }\n  });\n\n  app.post(\"/api/team-members\", async (req, res) => {\n    try {\n      const parsed = insertTeamMemberSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid team member data\", errors: parsed.error.errors });\n      }\n      const member = await storage.createTeamMember(parsed.data);\n      res.status(201).json(member);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create team member\" });\n    }\n  });\n\n  app.put(\"/api/team-members/:id\", async (req, res) => {\n    try {\n      const member = await storage.updateTeamMember(req.params.id, req.body);\n      if (!member) {\n        return res.status(404).json({ message: \"Team member not found\" });\n      }\n      res.json(member);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update team member\" });\n    }\n  });\n\n  app.delete(\"/api/team-members/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteTeamMember(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Team member not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete team member\" });\n    }\n  });\n\n  app.get(\"/api/settings/whatsapp\", async (req, res) => {\n    try {\n      const settings = await storage.getWhatsappSettings();\n      res.json(settings || {});\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get WhatsApp settings\" });\n    }\n  });\n\n  app.post(\"/api/settings/whatsapp\", async (req, res) => {\n    try {\n      const settings = await storage.saveWhatsappSettings(req.body);\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to save WhatsApp settings\" });\n    }\n  });\n\n  app.post(\"/api/settings/whatsapp/test\", async (req, res) => {\n    try {\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      const isValid = req.body.accessToken && req.body.phoneNumberId;\n      if (isValid) {\n        res.json({ success: true, message: \"Connection successful!\" });\n      } else {\n        res.status(400).json({ success: false, message: \"Invalid credentials. Please check your API settings.\" });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to test connection\" });\n    }\n  });\n\n  app.get(\"/api/billing\", async (req, res) => {\n    try {\n      const billing = await storage.getBilling();\n      res.json(billing);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get billing info\" });\n    }\n  });\n\n  app.post(\"/api/billing/purchase\", async (req, res) => {\n    try {\n      const { amount } = req.body;\n      if (!amount || amount <= 0) {\n        return res.status(400).json({ message: \"Invalid amount\" });\n      }\n      const billing = await storage.addTransaction({\n        type: \"purchase\",\n        amount,\n        description: `Purchased ${amount} credits`,\n      });\n      res.json(billing);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to purchase credits\" });\n    }\n  });\n\n  app.get(\"/api/reports/delivery\", async (req, res) => {\n    try {\n      const messages = await storage.getMessages();\n      const campaigns = await storage.getCampaigns();\n      \n      const report = {\n        totalSent: messages.filter(m => m.direction === \"outbound\").length,\n        delivered: messages.filter(m => m.direction === \"outbound\" && (m.status === \"delivered\" || m.status === \"read\")).length,\n        read: messages.filter(m => m.direction === \"outbound\" && m.status === \"read\").length,\n        failed: messages.filter(m => m.direction === \"outbound\" && m.status === \"failed\").length,\n        campaignStats: campaigns.map(c => ({\n          id: c.id,\n          name: c.name,\n          sent: c.sentCount,\n          delivered: c.deliveredCount,\n          read: c.readCount,\n          replied: c.repliedCount,\n        })),\n      };\n      res.json(report);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get delivery report\" });\n    }\n  });\n\n  app.get(\"/api/reports/campaign/:id\", async (req, res) => {\n    try {\n      const campaign = await storage.getCampaign(req.params.id);\n      if (!campaign) {\n        return res.status(404).json({ message: \"Campaign not found\" });\n      }\n      res.json({\n        ...campaign,\n        deliveryRate: campaign.sentCount > 0 ? (campaign.deliveredCount / campaign.sentCount) * 100 : 0,\n        readRate: campaign.deliveredCount > 0 ? (campaign.readCount / campaign.deliveredCount) * 100 : 0,\n        replyRate: campaign.readCount > 0 ? (campaign.repliedCount / campaign.readCount) * 100 : 0,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get campaign report\" });\n    }\n  });\n\n  app.get(\"/api/reports/agent-performance\", async (req, res) => {\n    try {\n      const messages = await storage.getMessages();\n      const teamMembers = await storage.getTeamMembers();\n      \n      const performance = teamMembers.map(member => {\n        const agentMessages = messages.filter(m => m.agentId === member.userId && m.direction === \"outbound\");\n        return {\n          id: member.id,\n          name: member.name,\n          messagesSent: agentMessages.length,\n          avgResponseTime: \"2.5 min\",\n          satisfaction: 4.5,\n        };\n      });\n      res.json(performance);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get agent performance\" });\n    }\n  });\n\n  app.get(\"/api/contact-agents/stats\", async (req, res) => {\n    try {\n      const stats = await contactAgentService.getAutoReplyStats();\n      res.json(stats);\n    } catch (error) {\n      console.error('[ContactAgents] Error getting stats:', error);\n      res.status(500).json({ message: \"Failed to get contact agent stats\" });\n    }\n  });\n\n  app.post(\"/api/contact-agents/enable-all-auto-reply\", async (req, res) => {\n    try {\n      const result = await contactAgentService.enableAutoReplyForAll();\n      console.log(`[ContactAgents] Bulk enabled auto-reply: ${result.updated}/${result.total} contacts`);\n      res.json({ \n        message: `Re-enabled auto-reply for ${result.updated} contacts`,\n        ...result \n      });\n    } catch (error) {\n      console.error('[ContactAgents] Error enabling all auto-reply:', error);\n      res.status(500).json({ message: \"Failed to enable auto-reply for all contacts\" });\n    }\n  });\n\n  app.use(\"/api/auth\", authRoutes);\n  app.use(\"/api/credentials\", credentialsRoutes);\n  app.use(\"/api/agents\", agentRoutes);\n  app.use(\"/api/facebook\", fbRoutes);\n  app.use(\"/api/map-agent\", mappingRoutes);\n  app.use(\"/api/webhook/whatsapp\", whatsappRoutes);\n  app.use(\"/api/leads/auto-reply\", leadAutoReplyRoutes);\n  app.use(\"/api/broadcast\", broadcastRoutes);\n  app.use(\"/api/ai-analytics\", aiAnalyticsRoutes);\n  app.use(\"/api/prefilled-text\", prefilledTextRoutes);\n  app.use(\"/api/reports\", reportsRoutes);\n  app.use(\"/api/users\", usersRoutes);\n  app.use(\"/api/contact-analytics\", contactAnalyticsRoutes);\n  app.use(\"/api/lead-management\", leadManagementRoutes);\n\n  app.get(\"/api/chats/whatsapp-leads\", async (req, res) => {\n    try {\n      const allChats = await storage.getChats();\n      \n      const memContacts = await storage.getContacts();\n      const importedContacts = await mongodb.readCollection<{\n        id: string;\n        name: string;\n        phone: string;\n        email?: string;\n        tags?: string[];\n      }>('imported_contacts');\n      \n      const knownPhones = new Set<string>();\n      for (const contact of memContacts) {\n        const normalized = contact.phone.replace(/\\D/g, '');\n        knownPhones.add(normalized);\n        if (normalized.length >= 10) {\n          knownPhones.add(normalized.slice(-10));\n        }\n      }\n      for (const contact of importedContacts) {\n        const normalized = contact.phone.replace(/\\D/g, '');\n        knownPhones.add(normalized);\n        if (normalized.length >= 10) {\n          knownPhones.add(normalized.slice(-10));\n        }\n      }\n      \n      const leadChats = allChats.filter(chat => {\n        const chatPhone = chat.contact.phone.replace(/\\D/g, '');\n        const chatPhoneLast10 = chatPhone.slice(-10);\n        return !knownPhones.has(chatPhone) && !knownPhones.has(chatPhoneLast10);\n      });\n      \n      res.json(leadChats);\n    } catch (error) {\n      console.error(\"Error fetching WhatsApp leads:\", error);\n      res.status(500).json({ message: \"Failed to get WhatsApp leads\" });\n    }\n  });\n\n  // Start the broadcast scheduler\n  broadcastService.startScheduler();\n\n  return httpServer;\n}\n","path":null,"size_bytes":57396,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"server/modules/aiAgents/agent.routes.ts":{"content":"import { Router } from 'express';\nimport * as controller from './agent.controller';\n\nconst router = Router();\n\nrouter.get('/', controller.listAgents);\nrouter.post('/migrate-to-gemini', controller.migrateAllToGemini);\nrouter.get('/:id', controller.getAgent);\nrouter.post('/', controller.createAgent);\nrouter.put('/:id', controller.updateAgent);\nrouter.delete('/:id', controller.deleteAgent);\nrouter.post('/:id/test', controller.testAgent);\n\nexport default router;\n","path":null,"size_bytes":463,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation/NewLeads.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Bell, Mail, Smartphone } from \"lucide-react\";\n\nexport default function NewLeads() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n           <h2 className=\"text-3xl font-bold tracking-tight\">New Lead Alerts</h2>\n           <p className=\"text-muted-foreground\">Notify your team when a new lead comes in.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n           <Card>\n             <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center\">\n                      <Mail className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Email Notifications</CardTitle>\n                     <CardDescription>Send an email to admins.</CardDescription>\n                   </div>\n                </div>\n             </CardHeader>\n             <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                   <Label>Enable Email Alerts</Label>\n                   <Switch defaultChecked />\n                </div>\n                <div className=\"grid gap-2\">\n                   <Label>Recipient Email(s)</Label>\n                   <Input defaultValue=\"admin@acme.com, sales@acme.com\" />\n                   <p className=\"text-xs text-muted-foreground\">Comma separated for multiple emails.</p>\n                </div>\n             </CardContent>\n             <CardFooter>\n                <Button>Save Settings</Button>\n             </CardFooter>\n           </Card>\n\n           <Card>\n             <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center\">\n                      <Smartphone className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>WhatsApp Admin Alert</CardTitle>\n                     <CardDescription>Send a WhatsApp message to your phone.</CardDescription>\n                   </div>\n                </div>\n             </CardHeader>\n             <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                   <Label>Enable WhatsApp Alerts</Label>\n                   <Switch />\n                </div>\n                <div className=\"grid gap-2\">\n                   <Label>Admin Phone Number</Label>\n                   <Input placeholder=\"+1 555 123 4567\" />\n                </div>\n             </CardContent>\n             <CardFooter>\n                <Button>Save Settings</Button>\n             </CardFooter>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3251,"size_tokens":null},"client/src/pages/settings/WebhookAPI.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle2, Copy, RefreshCw, Activity, Link as LinkIcon, Loader2, Eye, EyeOff, X, Shield, Key, Bot } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface CredentialsStatus {\n  hasWhatsApp: boolean;\n  hasOpenAI: boolean;\n  hasGemini: boolean;\n  hasFacebook: boolean;\n  isVerified: boolean;\n}\n\ninterface CredentialsResponse {\n  hasCredentials: boolean;\n  credentials: Record<string, string> | null;\n  status: CredentialsStatus;\n  isVerified?: boolean;\n  lastVerifiedAt?: string;\n}\n\nexport default function WebhookAPI() {\n  const [showWhatsAppToken, setShowWhatsAppToken] = useState(false);\n  const [showOpenAIKey, setShowOpenAIKey] = useState(false);\n  const [showGeminiKey, setShowGeminiKey] = useState(false);\n  const [showFacebookToken, setShowFacebookToken] = useState(false);\n  \n  const [whatsappToken, setWhatsappToken] = useState(\"\");\n  const [phoneNumberId, setPhoneNumberId] = useState(\"\");\n  const [businessAccountId, setBusinessAccountId] = useState(\"\");\n  const [webhookVerifyToken, setWebhookVerifyToken] = useState(\"\");\n  const [appId, setAppId] = useState(\"\");\n  const [appSecret, setAppSecret] = useState(\"\");\n  const [openaiApiKey, setOpenaiApiKey] = useState(\"\");\n  const [geminiApiKey, setGeminiApiKey] = useState(\"\");\n  const [facebookAccessToken, setFacebookAccessToken] = useState(\"\");\n  const [facebookPageId, setFacebookPageId] = useState(\"\");\n  \n  const queryClient = useQueryClient();\n\n  const { data: credentialsData, isLoading } = useQuery<CredentialsResponse>({\n    queryKey: [\"/api/credentials\"],\n    queryFn: async () => {\n      const res = await fetchWithAuth(\"/api/credentials\");\n      if (!res.ok) throw new Error(\"Failed to fetch credentials\");\n      return res.json();\n    },\n  });\n\n  const saveMutation = useMutation({\n    mutationFn: async (credentials: Record<string, string>) => {\n      const res = await fetchWithAuth(\"/api/credentials\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(credentials),\n      });\n      if (!res.ok) throw new Error(\"Failed to save credentials\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/credentials\"] });\n      toast.success(\"Credentials saved and encrypted successfully\");\n      setWhatsappToken(\"\");\n      setPhoneNumberId(\"\");\n      setBusinessAccountId(\"\");\n      setWebhookVerifyToken(\"\");\n      setAppId(\"\");\n      setAppSecret(\"\");\n      setOpenaiApiKey(\"\");\n      setGeminiApiKey(\"\");\n      setFacebookAccessToken(\"\");\n      setFacebookPageId(\"\");\n    },\n    onError: () => {\n      toast.error(\"Failed to save credentials\");\n    },\n  });\n\n  const testWhatsAppMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetchWithAuth(\"/api/credentials/test/whatsapp\", {\n        method: \"POST\",\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error || data.details || \"Test failed\");\n      return data;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/credentials\"] });\n      toast.success(`WhatsApp connected: ${data.verifiedName || data.phoneNumber}`);\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"WhatsApp connection test failed\");\n    },\n  });\n\n  const testOpenAIMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetchWithAuth(\"/api/credentials/test/openai\", {\n        method: \"POST\",\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error || data.details || \"Test failed\");\n      return data;\n    },\n    onSuccess: () => {\n      toast.success(\"OpenAI API connection successful\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"OpenAI connection test failed\");\n    },\n  });\n\n  const testFacebookMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetchWithAuth(\"/api/credentials/test/facebook\", {\n        method: \"POST\",\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error || data.details || \"Test failed\");\n      return data;\n    },\n    onSuccess: (data) => {\n      toast.success(`Facebook connected: ${data.name}`);\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"Facebook connection test failed\");\n    },\n  });\n\n  const handleSaveWhatsApp = () => {\n    const credentials: Record<string, string> = {};\n    if (whatsappToken) credentials.whatsappToken = whatsappToken;\n    if (phoneNumberId) credentials.phoneNumberId = phoneNumberId;\n    if (businessAccountId) credentials.businessAccountId = businessAccountId;\n    if (webhookVerifyToken) credentials.webhookVerifyToken = webhookVerifyToken;\n    if (appId) credentials.appId = appId;\n    if (appSecret) credentials.appSecret = appSecret;\n    \n    if (Object.keys(credentials).length === 0) {\n      toast.error(\"Please enter at least one credential\");\n      return;\n    }\n    saveMutation.mutate(credentials);\n  };\n\n  const handleSaveOpenAI = () => {\n    if (!openaiApiKey) {\n      toast.error(\"Please enter your OpenAI API key\");\n      return;\n    }\n    saveMutation.mutate({ openaiApiKey });\n  };\n\n  const handleSaveGemini = () => {\n    if (!geminiApiKey) {\n      toast.error(\"Please enter your Gemini API key\");\n      return;\n    }\n    saveMutation.mutate({ geminiApiKey });\n  };\n\n  const handleSaveFacebook = () => {\n    const credentials: Record<string, string> = {};\n    if (facebookAccessToken) credentials.facebookAccessToken = facebookAccessToken;\n    if (facebookPageId) credentials.facebookPageId = facebookPageId;\n    \n    if (Object.keys(credentials).length === 0) {\n      toast.error(\"Please enter at least one credential\");\n      return;\n    }\n    saveMutation.mutate(credentials);\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast.success(\"Copied to clipboard\");\n  };\n\n  const webhookUrl = typeof window !== 'undefined' \n    ? `${window.location.origin}/api/webhook/whatsapp` \n    : '';\n\n  const status = credentialsData?.status || { hasWhatsApp: false, hasOpenAI: false, hasGemini: false, hasFacebook: false, isVerified: false };\n  const maskedCreds = credentialsData?.credentials || {};\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">API Credentials</h2>\n            <p className=\"text-muted-foreground\">Securely manage your API keys and webhook configurations.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            {status.hasWhatsApp && (\n              <Badge variant={status.isVerified ? \"default\" : \"secondary\"} className=\"gap-1\">\n                {status.isVerified ? (\n                  <><CheckCircle2 className=\"h-3 w-3\" /> WhatsApp Connected</>\n                ) : (\n                  <><X className=\"h-3 w-3\" /> WhatsApp Not Verified</>\n                )}\n              </Badge>\n            )}\n            {status.hasOpenAI && (\n              <Badge variant=\"default\" className=\"gap-1 bg-purple-600\">\n                <Bot className=\"h-3 w-3\" /> AI Ready\n              </Badge>\n            )}\n          </div>\n        </div>\n\n        <Alert className=\"bg-blue-50 border-blue-200\">\n          <Shield className=\"h-4 w-4 text-blue-600\" />\n          <AlertTitle className=\"text-blue-800\">Secure Storage</AlertTitle>\n          <AlertDescription className=\"text-blue-700\">\n            All your API keys are encrypted using AES-256-GCM before being stored. \n            Your credentials are never exposed in plain text after saving.\n          </AlertDescription>\n        </Alert>\n\n        <Tabs defaultValue=\"whatsapp\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"whatsapp\" className=\"gap-2\">\n              <LinkIcon className=\"h-4 w-4\" />\n              WhatsApp API\n            </TabsTrigger>\n            <TabsTrigger value=\"openai\" className=\"gap-2\">\n              <Bot className=\"h-4 w-4\" />\n              OpenAI\n            </TabsTrigger>\n            <TabsTrigger value=\"gemini\" className=\"gap-2\">\n              <Bot className=\"h-4 w-4\" />\n              Gemini\n            </TabsTrigger>\n            <TabsTrigger value=\"facebook\" className=\"gap-2\">\n              <Key className=\"h-4 w-4\" />\n              Facebook\n            </TabsTrigger>\n            <TabsTrigger value=\"webhook\" className=\"gap-2\">\n              <Activity className=\"h-4 w-4\" />\n              Webhook\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"whatsapp\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-8 w-8 rounded-full bg-green-500 flex items-center justify-center text-white\">\n                    <LinkIcon className=\"h-4 w-4\" />\n                  </div>\n                  <div>\n                    <CardTitle>WhatsApp Business API</CardTitle>\n                    <CardDescription>Connect your WhatsApp Business account</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {status.hasWhatsApp && maskedCreds.whatsappToken && (\n                  <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg mb-4\">\n                    <p className=\"text-sm text-green-700\">\n                      <CheckCircle2 className=\"h-4 w-4 inline mr-1\" />\n                      Credentials saved. Token: {maskedCreds.whatsappToken}\n                    </p>\n                  </div>\n                )}\n                \n                <div className=\"grid gap-2\">\n                  <Label>Access Token</Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Input \n                        type={showWhatsAppToken ? \"text\" : \"password\"}\n                        placeholder={status.hasWhatsApp ? \"Enter new token to update...\" : \"Enter your WhatsApp Access Token\"}\n                        value={whatsappToken}\n                        onChange={(e) => setWhatsappToken(e.target.value)}\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute right-0 top-0 h-full\"\n                        onClick={() => setShowWhatsAppToken(!showWhatsAppToken)}\n                      >\n                        {showWhatsAppToken ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"grid md:grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>Phone Number ID</Label>\n                    <Input \n                      placeholder={status.hasWhatsApp ? maskedCreds.phoneNumberId || \"Enter to update...\" : \"Phone Number ID\"}\n                      value={phoneNumberId}\n                      onChange={(e) => setPhoneNumberId(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>Business Account ID (WABA ID)</Label>\n                    <Input \n                      placeholder={status.hasWhatsApp ? maskedCreds.businessAccountId || \"Enter to update...\" : \"WABA ID\"}\n                      value={businessAccountId}\n                      onChange={(e) => setBusinessAccountId(e.target.value)}\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"grid md:grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>App ID</Label>\n                    <Input \n                      placeholder={status.hasWhatsApp ? maskedCreds.appId || \"Enter to update...\" : \"Meta App ID\"}\n                      value={appId}\n                      onChange={(e) => setAppId(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>App Secret</Label>\n                    <Input \n                      type=\"password\"\n                      placeholder={status.hasWhatsApp ? \"Enter to update...\" : \"Meta App Secret\"}\n                      value={appSecret}\n                      onChange={(e) => setAppSecret(e.target.value)}\n                    />\n                  </div>\n                </div>\n              </CardContent>\n              <CardFooter className=\"flex justify-between bg-muted/50 border-t p-6\">\n                <Button \n                  variant=\"outline\"\n                  onClick={() => testWhatsAppMutation.mutate()}\n                  disabled={testWhatsAppMutation.isPending || !status.hasWhatsApp}\n                >\n                  {testWhatsAppMutation.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Activity className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Test Connection\n                </Button>\n                <Button \n                  onClick={handleSaveWhatsApp}\n                  disabled={saveMutation.isPending}\n                >\n                  {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Save & Encrypt\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"openai\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-8 w-8 rounded-full bg-purple-500 flex items-center justify-center text-white\">\n                    <Bot className=\"h-4 w-4\" />\n                  </div>\n                  <div>\n                    <CardTitle>OpenAI API</CardTitle>\n                    <CardDescription>Connect your OpenAI account for AI agent responses</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {status.hasOpenAI && maskedCreds.openaiApiKey && (\n                  <div className=\"p-3 bg-purple-50 border border-purple-200 rounded-lg mb-4\">\n                    <p className=\"text-sm text-purple-700\">\n                      <CheckCircle2 className=\"h-4 w-4 inline mr-1\" />\n                      API Key saved: {maskedCreds.openaiApiKey}\n                    </p>\n                  </div>\n                )}\n                \n                <div className=\"grid gap-2\">\n                  <Label>OpenAI API Key</Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Input \n                        type={showOpenAIKey ? \"text\" : \"password\"}\n                        placeholder={status.hasOpenAI ? \"Enter new key to update...\" : \"sk-...\"}\n                        value={openaiApiKey}\n                        onChange={(e) => setOpenaiApiKey(e.target.value)}\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute right-0 top-0 h-full\"\n                        onClick={() => setShowOpenAIKey(!showOpenAIKey)}\n                      >\n                        {showOpenAIKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Get your API key from{\" \"}\n                    <a href=\"https://platform.openai.com/api-keys\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary underline\">\n                      OpenAI Platform\n                    </a>\n                  </p>\n                </div>\n              </CardContent>\n              <CardFooter className=\"flex justify-between bg-muted/50 border-t p-6\">\n                <Button \n                  variant=\"outline\"\n                  onClick={() => testOpenAIMutation.mutate()}\n                  disabled={testOpenAIMutation.isPending || !status.hasOpenAI}\n                >\n                  {testOpenAIMutation.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Activity className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Test Connection\n                </Button>\n                <Button \n                  onClick={handleSaveOpenAI}\n                  disabled={saveMutation.isPending}\n                >\n                  {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Save & Encrypt\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"gemini\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white\">\n                    <Bot className=\"h-4 w-4\" />\n                  </div>\n                  <div>\n                    <CardTitle>Google Gemini API</CardTitle>\n                    <CardDescription>Connect your Google AI account for Gemini-powered agents</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {status.hasGemini && maskedCreds.geminiApiKey && (\n                  <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg mb-4\">\n                    <p className=\"text-sm text-blue-700\">\n                      <CheckCircle2 className=\"h-4 w-4 inline mr-1\" />\n                      API Key saved: {maskedCreds.geminiApiKey}\n                    </p>\n                  </div>\n                )}\n                \n                <div className=\"grid gap-2\">\n                  <Label>Gemini API Key</Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Input \n                        type={showGeminiKey ? \"text\" : \"password\"}\n                        placeholder={status.hasGemini ? \"Enter new key to update...\" : \"AIza...\"}\n                        value={geminiApiKey}\n                        onChange={(e) => setGeminiApiKey(e.target.value)}\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute right-0 top-0 h-full\"\n                        onClick={() => setShowGeminiKey(!showGeminiKey)}\n                      >\n                        {showGeminiKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Get your API key from{\" \"}\n                    <a href=\"https://aistudio.google.com/app/apikey\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary underline\">\n                      Google AI Studio\n                    </a>\n                  </p>\n                </div>\n              </CardContent>\n              <CardFooter className=\"flex justify-end bg-muted/50 border-t p-6\">\n                <Button \n                  onClick={handleSaveGemini}\n                  disabled={saveMutation.isPending}\n                >\n                  {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Save & Encrypt\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"facebook\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center text-white\">\n                    <Key className=\"h-4 w-4\" />\n                  </div>\n                  <div>\n                    <CardTitle>Facebook API</CardTitle>\n                    <CardDescription>Connect for Facebook Lead Forms integration</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {status.hasFacebook && maskedCreds.facebookAccessToken && (\n                  <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg mb-4\">\n                    <p className=\"text-sm text-blue-700\">\n                      <CheckCircle2 className=\"h-4 w-4 inline mr-1\" />\n                      Token saved: {maskedCreds.facebookAccessToken}\n                    </p>\n                  </div>\n                )}\n                \n                <div className=\"grid gap-2\">\n                  <Label>Facebook Access Token</Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Input \n                        type={showFacebookToken ? \"text\" : \"password\"}\n                        placeholder={status.hasFacebook ? \"Enter new token to update...\" : \"Your Facebook Page Access Token\"}\n                        value={facebookAccessToken}\n                        onChange={(e) => setFacebookAccessToken(e.target.value)}\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute right-0 top-0 h-full\"\n                        onClick={() => setShowFacebookToken(!showFacebookToken)}\n                      >\n                        {showFacebookToken ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"grid gap-2\">\n                  <Label>Facebook Page ID</Label>\n                  <Input \n                    placeholder={status.hasFacebook ? maskedCreds.facebookPageId || \"Enter to update...\" : \"Your Facebook Page ID\"}\n                    value={facebookPageId}\n                    onChange={(e) => setFacebookPageId(e.target.value)}\n                  />\n                </div>\n              </CardContent>\n              <CardFooter className=\"flex justify-between bg-muted/50 border-t p-6\">\n                <Button \n                  variant=\"outline\"\n                  onClick={() => testFacebookMutation.mutate()}\n                  disabled={testFacebookMutation.isPending || !status.hasFacebook}\n                >\n                  {testFacebookMutation.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Activity className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Test Connection\n                </Button>\n                <Button \n                  onClick={handleSaveFacebook}\n                  disabled={saveMutation.isPending}\n                >\n                  {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Save & Encrypt\n                </Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"webhook\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Webhook Configuration</CardTitle>\n                <CardDescription>Configure your WhatsApp webhook in Meta Developer Console</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Callback URL</Label>\n                  <div className=\"flex gap-2\">\n                    <Input \n                      value={webhookUrl}\n                      readOnly\n                      className=\"font-mono bg-muted\"\n                    />\n                    <Button \n                      variant=\"outline\" \n                      size=\"icon\"\n                      onClick={() => copyToClipboard(webhookUrl)}\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Use this URL as the Callback URL in your Meta Developer Console webhook settings.\n                  </p>\n                </div>\n                \n                <div className=\"grid gap-2\">\n                  <Label>Webhook Verify Token</Label>\n                  <div className=\"flex gap-2\">\n                    <Input \n                      placeholder=\"Enter to update your verify token\"\n                      value={webhookVerifyToken}\n                      onChange={(e) => setWebhookVerifyToken(e.target.value)}\n                    />\n                    <Button \n                      onClick={() => {\n                        if (webhookVerifyToken) {\n                          saveMutation.mutate({ webhookVerifyToken });\n                        }\n                      }}\n                      disabled={saveMutation.isPending || !webhookVerifyToken}\n                    >\n                      Save\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Set a custom verify token that matches what you configure in Meta Developer Console.\n                  </p>\n                </div>\n                \n                <Alert>\n                  <Activity className=\"h-4 w-4\" />\n                  <AlertTitle>Setup Instructions</AlertTitle>\n                  <AlertDescription className=\"space-y-2\">\n                    <p>1. Go to your Meta Developer Console</p>\n                    <p>2. Navigate to WhatsApp {\">\"} Configuration {\">\"} Webhook</p>\n                    <p>3. Set the Callback URL to the URL shown above</p>\n                    <p>4. Set the Verify Token to match what you saved above</p>\n                    <p>5. Subscribe to: messages, message_deliveries, message_reads</p>\n                  </AlertDescription>\n                </Alert>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":27580,"size_tokens":null},"client/src/pages/reports/AgentPerformance.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader2, Bot, MessageSquare, Clock, Zap } from \"lucide-react\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface Agent {\n  id: string;\n  name: string;\n  model: string;\n  chatsHandled: number;\n  messagesGenerated: number;\n  avgResponseTime: string;\n  avgResponseTimeMs: number;\n  isActive: boolean;\n  temperature: number;\n}\n\ninterface AgentPerformanceData {\n  agents: Agent[];\n  summary: {\n    totalAgents: number;\n    activeAgents: number;\n    totalChats: number;\n    totalMessages: number;\n    avgResponseTime: string;\n  };\n  period: string;\n}\n\nexport default function AgentPerformance() {\n  const [period, setPeriod] = useState(\"week\");\n\n  const { data, isLoading, error } = useQuery<AgentPerformanceData>({\n    queryKey: [\"/api/reports/ai-agents\", period],\n    queryFn: async () => {\n      const res = await fetchWithAuth(`/api/reports/ai-agents?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch agent performance\");\n      return res.json();\n    },\n  });\n\n  const getModelBadge = (model: string) => {\n    if (model.startsWith('gemini')) {\n      return <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700 border-blue-200\">Gemini</Badge>;\n    }\n    return <Badge variant=\"outline\" className=\"bg-green-50 text-green-700 border-green-200\">OpenAI</Badge>;\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n              <Bot className=\"h-8 w-8 text-primary\" />\n              AI Agent Performance\n            </h2>\n            <p className=\"text-muted-foreground\">Track AI agent productivity and response metrics.</p>\n          </div>\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-[150px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Today</SelectItem>\n              <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n              <SelectItem value=\"week\">Last 7 Days</SelectItem>\n              <SelectItem value=\"month\">Last 30 Days</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : error ? (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">Failed to load agent performance data</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Bot className=\"h-4 w-4\" />\n                    Total Agents\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalAgents || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">{data?.summary.activeAgents || 0} active</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <MessageSquare className=\"h-4 w-4\" />\n                    Chats Handled\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalChats || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">Unique conversations</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Zap className=\"h-4 w-4\" />\n                    Messages Generated\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalMessages || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">AI responses sent</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4\" />\n                    Avg Response Time\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.avgResponseTime || 'N/A'}</div>\n                  <p className=\"text-xs text-muted-foreground\">Time to respond</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Agent Leaderboard</CardTitle>\n                <CardDescription>Top performing AI agents this {period === 'today' ? 'day' : period === 'yesterday' ? 'day' : period}.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {data?.agents && data.agents.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Agent</TableHead>\n                        <TableHead>Model</TableHead>\n                        <TableHead className=\"text-center\">Chats</TableHead>\n                        <TableHead className=\"text-center\">Messages</TableHead>\n                        <TableHead>Avg Response</TableHead>\n                        <TableHead>Status</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {data.agents.map((agent) => (\n                        <TableRow key={agent.id}>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar>\n                                <AvatarFallback className=\"bg-primary/10 text-primary\">\n                                  {agent.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase()}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div>\n                                <div className=\"font-medium\">{agent.name}</div>\n                                <div className=\"text-xs text-muted-foreground\">Temp: {agent.temperature}</div>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex flex-col gap-1\">\n                              {getModelBadge(agent.model)}\n                              <span className=\"text-xs text-muted-foreground\">{agent.model}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <div className=\"text-lg font-semibold\">{agent.chatsHandled}</div>\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <div className=\"text-lg font-semibold\">{agent.messagesGenerated}</div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                              <span>{agent.avgResponseTime}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant={agent.isActive ? \"default\" : \"secondary\"}>\n                              {agent.isActive ? \"Active\" : \"Inactive\"}\n                            </Badge>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <Bot className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No AI agents found. Create your first agent to see performance data.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9579,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/pages/automation.tsx":{"content":"import { useCallback } from 'react';\nimport { \n  ReactFlow, \n  MiniMap, \n  Controls, \n  Background, \n  useNodesState, \n  useEdgesState, \n  addEdge,\n  BackgroundVariant,\n  Position,\n  Handle\n} from '@xyflow/react';\nimport '@xyflow/react/dist/style.css';\n\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Save, Play, Plus } from \"lucide-react\";\n\n// Custom Node Components\nconst TriggerNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border-2 border-primary min-w-[150px]\">\n      <div className=\"font-bold text-sm text-primary mb-1\">Trigger</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      <Handle type=\"source\" position={Position.Bottom} className=\"w-3 h-3 bg-primary\" />\n    </div>\n  );\n};\n\nconst MessageNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border border-gray-200 min-w-[150px]\">\n      <Handle type=\"target\" position={Position.Top} className=\"w-3 h-3 bg-gray-400\" />\n      <div className=\"font-bold text-sm text-gray-700 mb-1\">Send Message</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      <Handle type=\"source\" position={Position.Bottom} className=\"w-3 h-3 bg-gray-400\" />\n    </div>\n  );\n};\n\nconst ConditionNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border border-orange-300 min-w-[150px] relative\">\n      <Handle type=\"target\" position={Position.Top} className=\"w-3 h-3 bg-gray-400\" />\n      <div className=\"font-bold text-sm text-orange-600 mb-1\">Condition</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      \n      <div className=\"absolute -bottom-6 left-1/4 text-[10px] text-gray-500\">Yes</div>\n      <Handle type=\"source\" position={Position.Bottom} id=\"a\" className=\"w-3 h-3 bg-green-500 left-1/4\" />\n      \n      <div className=\"absolute -bottom-6 right-1/4 text-[10px] text-gray-500\">No</div>\n      <Handle type=\"source\" position={Position.Bottom} id=\"b\" className=\"w-3 h-3 bg-red-500 left-3/4\" />\n    </div>\n  );\n};\n\nconst nodeTypes = {\n  trigger: TriggerNode,\n  message: MessageNode,\n  condition: ConditionNode,\n};\n\nconst initialNodes = [\n  { id: '1', type: 'trigger', position: { x: 250, y: 0 }, data: { label: 'Incoming Message: \"Hello\"' } },\n  { id: '2', type: 'message', position: { x: 250, y: 100 }, data: { label: 'Reply: Welcome to our service!' } },\n  { id: '3', type: 'condition', position: { x: 250, y: 200 }, data: { label: 'Is Business Hours?' } },\n  { id: '4', type: 'message', position: { x: 100, y: 300 }, data: { label: 'Reply: How can we help?' } },\n  { id: '5', type: 'message', position: { x: 400, y: 300 }, data: { label: 'Reply: We are closed.' } },\n];\n\nconst initialEdges = [\n  { id: 'e1-2', source: '1', target: '2' },\n  { id: 'e2-3', source: '2', target: '3' },\n  { id: 'e3-4', source: '3', target: '4', sourceHandle: 'a', label: 'Yes' },\n  { id: 'e3-5', source: '3', target: '5', sourceHandle: 'b', label: 'No' },\n];\n\nexport default function Automation() {\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\n  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\n\n  const onConnect = useCallback(\n    (params: any) => setEdges((eds) => addEdge(params, eds)),\n    [setEdges],\n  );\n\n  return (\n    <DashboardLayout>\n      <div className=\"flex flex-col h-[calc(100vh-8rem)] space-y-4 animate-in fade-in duration-500\">\n        <div className=\"flex items-center justify-between shrink-0\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Automation Builder</h2>\n            <p className=\"text-muted-foreground\">Design your chatbot flows visually.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n             <Button variant=\"outline\">\n               <Play className=\"mr-2 h-4 w-4\" />\n               Test Flow\n             </Button>\n             <Button>\n               <Save className=\"mr-2 h-4 w-4\" />\n               Save Flow\n             </Button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 flex gap-4 min-h-0\">\n           {/* Sidebar for Nodes */}\n           <Card className=\"w-60 shrink-0 p-4 flex flex-col gap-3 overflow-y-auto\">\n             <h3 className=\"font-medium text-sm mb-2\">Elements</h3>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm border-l-4 border-l-primary\">\n               <span className=\"font-medium text-sm\">Trigger</span>\n               <p className=\"text-xs text-muted-foreground\">Start flow</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Send Message</span>\n               <p className=\"text-xs text-muted-foreground\">Text, Image, Video</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm border-l-4 border-l-orange-400\">\n               <span className=\"font-medium text-sm\">Condition</span>\n               <p className=\"text-xs text-muted-foreground\">Branch logic</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Wait</span>\n               <p className=\"text-xs text-muted-foreground\">Delay execution</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Assign to Agent</span>\n               <p className=\"text-xs text-muted-foreground\">Handover</p>\n             </div>\n           </Card>\n\n           {/* Canvas */}\n           <Card className=\"flex-1 overflow-hidden border-2 border-muted\">\n             <ReactFlow\n               nodes={nodes}\n               edges={edges}\n               onNodesChange={onNodesChange}\n               onEdgesChange={onEdgesChange}\n               onConnect={onConnect}\n               nodeTypes={nodeTypes}\n               fitView\n             >\n               <Controls />\n               <MiniMap />\n               <Background variant={BackgroundVariant.Dots} gap={12} size={1} />\n             </ReactFlow>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6619,"size_tokens":null},"WhatsappBusinessDashboard/vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"shared/schema.ts":{"content":"import { z } from \"zod\";\n\nexport const userSchema = z.object({\n  id: z.string(),\n  username: z.string(),\n  password: z.string(),\n  name: z.string().optional(),\n  email: z.string().optional(),\n  role: z.enum([\"admin\", \"agent\"]).default(\"agent\"),\n  avatar: z.string().optional(),\n  createdAt: z.string(),\n});\n\nexport const contactSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  phone: z.string(),\n  email: z.string().optional(),\n  tags: z.array(z.string()).default([]),\n  notes: z.string().optional(),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\n\nexport const messageSchema = z.object({\n  id: z.string(),\n  contactId: z.string(),\n  content: z.string(),\n  type: z.enum([\"text\", \"image\", \"video\", \"document\", \"audio\", \"sticker\", \"location\", \"contacts\"]).default(\"text\"),\n  mediaUrl: z.string().optional(),\n  direction: z.enum([\"inbound\", \"outbound\"]),\n  status: z.enum([\"sent\", \"delivered\", \"read\", \"failed\"]).default(\"sent\"),\n  timestamp: z.string(),\n  agentId: z.string().optional(),\n  replyToMessageId: z.string().optional(),\n  replyToContent: z.string().optional(),\n});\n\nexport const campaignSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  templateId: z.string().optional(),\n  message: z.string(),\n  contactIds: z.array(z.string()),\n  status: z.enum([\"draft\", \"scheduled\", \"running\", \"completed\", \"paused\"]).default(\"draft\"),\n  scheduledAt: z.string().optional(),\n  sentCount: z.number().default(0),\n  deliveredCount: z.number().default(0),\n  readCount: z.number().default(0),\n  repliedCount: z.number().default(0),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\n\nexport const templateSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  category: z.enum([\"marketing\", \"utility\", \"authentication\"]),\n  content: z.string(),\n  variables: z.array(z.string()).default([]),\n  status: z.enum([\"pending\", \"approved\", \"rejected\"]).default(\"pending\"),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\n\nexport const automationSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  type: z.enum([\"keyword\", \"welcome\", \"follow_up\", \"drip\"]),\n  trigger: z.string(),\n  message: z.string(),\n  delay: z.number().optional(),\n  delayUnit: z.enum([\"minutes\", \"hours\", \"days\"]).optional(),\n  isActive: z.boolean().default(true),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\n\nexport const teamMemberSchema = z.object({\n  id: z.string(),\n  userId: z.string(),\n  name: z.string(),\n  email: z.string(),\n  role: z.enum([\"admin\", \"agent\"]),\n  permissions: z.array(z.string()).default([]),\n  isActive: z.boolean().default(true),\n  createdAt: z.string(),\n});\n\nexport const whatsappSettingsSchema = z.object({\n  id: z.string(),\n  phoneNumber: z.string(),\n  phoneNumberId: z.string(),\n  businessAccountId: z.string(),\n  appId: z.string(),\n  appSecret: z.string(),\n  accessToken: z.string(),\n  webhookUrl: z.string().optional(),\n  isActive: z.boolean().default(false),\n  isVerified: z.boolean().default(false),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\n\nexport const billingSchema = z.object({\n  id: z.string(),\n  credits: z.number().default(0),\n  transactions: z.array(z.object({\n    id: z.string(),\n    type: z.enum([\"purchase\", \"usage\"]),\n    amount: z.number(),\n    description: z.string(),\n    createdAt: z.string(),\n  })).default([]),\n});\n\nexport const dashboardStatsSchema = z.object({\n  totalMessages: z.number(),\n  delivered: z.number(),\n  readRate: z.number(),\n  replied: z.number(),\n  messagesChange: z.number(),\n  deliveredChange: z.number(),\n  readRateChange: z.number(),\n  repliedChange: z.number(),\n});\n\nexport const chatSchema = z.object({\n  id: z.string(),\n  contactId: z.string(),\n  contact: contactSchema,\n  lastMessage: z.string().optional(),\n  lastMessageTime: z.string().optional(),\n  lastInboundMessageTime: z.string().optional(),\n  lastInboundMessage: z.string().optional(),\n  unreadCount: z.number().default(0),\n  assignedAgentId: z.string().optional(),\n  status: z.enum([\"open\", \"pending\", \"resolved\"]).default(\"open\"),\n  notes: z.array(z.object({\n    id: z.string(),\n    content: z.string(),\n    agentId: z.string(),\n    createdAt: z.string(),\n  })).default([]),\n});\n\nexport type User = z.infer<typeof userSchema>;\nexport type Contact = z.infer<typeof contactSchema>;\nexport type Message = z.infer<typeof messageSchema>;\nexport type Campaign = z.infer<typeof campaignSchema>;\nexport type Template = z.infer<typeof templateSchema>;\nexport type Automation = z.infer<typeof automationSchema>;\nexport type TeamMember = z.infer<typeof teamMemberSchema>;\nexport type WhatsappSettings = z.infer<typeof whatsappSettingsSchema>;\nexport type Billing = z.infer<typeof billingSchema>;\nexport type DashboardStats = z.infer<typeof dashboardStatsSchema>;\nexport type Chat = z.infer<typeof chatSchema>;\n\nexport const insertUserSchema = userSchema.omit({ id: true, createdAt: true });\nexport const insertContactSchema = contactSchema.omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertMessageSchema = messageSchema.omit({ id: true, timestamp: true });\nexport const insertCampaignSchema = campaignSchema.omit({ id: true, createdAt: true, updatedAt: true, sentCount: true, deliveredCount: true, readCount: true, repliedCount: true });\nexport const insertTemplateSchema = templateSchema.omit({ id: true, createdAt: true, updatedAt: true, status: true });\nexport const insertAutomationSchema = automationSchema.omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTeamMemberSchema = teamMemberSchema.omit({ id: true, createdAt: true });\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type InsertContact = z.infer<typeof insertContactSchema>;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type InsertCampaign = z.infer<typeof insertCampaignSchema>;\nexport type InsertTemplate = z.infer<typeof insertTemplateSchema>;\nexport type InsertAutomation = z.infer<typeof insertAutomationSchema>;\nexport type InsertTeamMember = z.infer<typeof insertTeamMemberSchema>;\n","path":null,"size_bytes":5999,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\";\n\nimport * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, VariantProps } from \"class-variance-authority\";\nimport { PanelLeftIcon } from \"lucide-react\";\n\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport \"@/index.css\"\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\";\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\";\n  open: boolean;\n  setOpen: (open: boolean) => void;\n  openMobile: boolean;\n  setOpenMobile: (open: boolean) => void;\n  isMobile: boolean;\n  toggleSidebar: () => void;\n};\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null);\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext);\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\n  }\n\n  return context;\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n}) {\n  const isMobile = useIsMobile();\n  const [openMobile, setOpenMobile] = React.useState(false);\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen);\n  const open = openProp ?? _open;\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value;\n      if (setOpenProp) {\n        setOpenProp(openState);\n      } else {\n        _setOpen(openState);\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\n    },\n    [setOpenProp, open],\n  );\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);\n  }, [isMobile, setOpen, setOpenMobile]);\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault();\n        toggleSidebar();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [toggleSidebar]);\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\";\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\n  );\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className,\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  );\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\";\n  variant?: \"sidebar\" | \"floating\" | \"inset\";\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\";\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className,\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    );\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    );\n  }\n\n  return (\n    <div\n      className=\"min-h-screen group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\",\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className,\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm [&::-webkit-scrollbar]:hidden\"\n          style={{\n            scrollbarWidth: 'none',\n            msOverflowStyle: 'none',\n          } as React.CSSProperties}\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event);\n        toggleSidebar();\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  );\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar();\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        \"[&::-webkit-scrollbar]:hidden [scrollbar-width:none] [-ms-overflow-style:none]\",\n        className,\n      )}\n      style={{\n        scrollbarWidth: 'none',\n        msOverflowStyle: 'none',\n      } as React.CSSProperties}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\";\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  );\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean;\n  isActive?: boolean;\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>;\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\";\n  const { isMobile, state } = useSidebar();\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  );\n\n  if (!tooltip) {\n    return button;\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    };\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  );\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean;\n  showOnHover?: boolean;\n}) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean;\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`;\n  }, []);\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  );\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean;\n  size?: \"sm\" | \"md\";\n  isActive?: boolean;\n}) {\n  const Comp = asChild ? Slot : \"a\";\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n};\n","path":null,"size_bytes":22363,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"WhatsappBusinessDashboard/client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Inbox from \"@/pages/inbox\";\nimport Campaigns from \"@/pages/campaigns\";\nimport Automation from \"@/pages/automation\";\nimport Contacts from \"@/pages/contacts\";\nimport Settings from \"@/pages/settings\";\nimport TeamMembers from \"@/pages/settings/TeamMembers\";\nimport Permissions from \"@/pages/settings/Permissions\";\nimport WhatsAppNumber from \"@/pages/settings/WhatsAppNumber\";\nimport ProfileDetails from \"@/pages/settings/ProfileDetails\";\nimport WebhookAPI from \"@/pages/settings/WebhookAPI\";\nimport Billing from \"@/pages/settings/Billing\";\n\nimport Templates from \"@/pages/templates\";\n\n// New Imports\nimport Broadcast from \"@/pages/campaigns/Broadcast\";\nimport SelectedContacts from \"@/pages/campaigns/SelectedContacts\";\nimport Schedule from \"@/pages/campaigns/Schedule\";\nimport Single from \"@/pages/campaigns/Single\";\nimport Report from \"@/pages/campaigns/Report\";\n\nimport AutoLeads from \"@/pages/automation/AutoLeads\";\nimport Keywords from \"@/pages/automation/Keywords\";\nimport FollowUp from \"@/pages/automation/FollowUp\";\nimport Drip from \"@/pages/automation/Drip\";\nimport NewLeads from \"@/pages/automation/NewLeads\";\n\nimport ConnectApps from \"@/pages/apps/ConnectApps\";\n\nimport AddTemplate from \"@/pages/templates/AddTemplate\";\nimport TemplateStatus from \"@/pages/templates/TemplateStatus\";\nimport ManageTemplates from \"@/pages/templates/ManageTemplates\";\n\nimport NewAgent from \"@/pages/ai/NewAgent\";\nimport ManageAgents from \"@/pages/ai/ManageAgents\";\n\nimport DeliveryReport from \"@/pages/reports/DeliveryReport\";\nimport CampaignPerformance from \"@/pages/reports/CampaignPerformance\";\nimport CustomerReplies from \"@/pages/reports/CustomerReplies\";\nimport AgentPerformance from \"@/pages/reports/AgentPerformance\";\nimport Spending from \"@/pages/reports/Spending\";\nimport Credits from \"@/pages/reports/Credits\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/inbox\" component={Inbox} />\n      \n      {/* Campaigns */}\n      <Route path=\"/campaigns\" component={Campaigns} />\n      <Route path=\"/campaigns/broadcast\" component={Broadcast} />\n      <Route path=\"/campaigns/selected-contacts\" component={SelectedContacts} />\n      <Route path=\"/campaigns/schedule\" component={Schedule} />\n      <Route path=\"/campaigns/single\" component={Single} />\n      <Route path=\"/campaigns/report\" component={Report} />\n\n      {/* Automation */}\n      <Route path=\"/automation\" component={Automation} />\n      <Route path=\"/automation/leads\" component={AutoLeads} />\n      <Route path=\"/automation/keywords\" component={Keywords} />\n      <Route path=\"/automation/follow-up\" component={FollowUp} />\n      <Route path=\"/automation/drip\" component={Drip} />\n      <Route path=\"/automation/new-leads\" component={NewLeads} />\n\n      {/* Apps */}\n      <Route path=\"/apps/connect\" component={ConnectApps} />\n\n      {/* Templates */}\n      <Route path=\"/templates\" component={Templates} />\n      <Route path=\"/templates/add\" component={AddTemplate} />\n      <Route path=\"/templates/status\" component={TemplateStatus} />\n      <Route path=\"/templates/manage\" component={ManageTemplates} />\n\n      {/* AI */}\n      <Route path=\"/ai\" component={ManageAgents} />\n      <Route path=\"/ai/new\" component={NewAgent} />\n      <Route path=\"/ai/manage\" component={ManageAgents} />\n\n      {/* Reports */}\n      <Route path=\"/reports\" component={DeliveryReport} />\n      <Route path=\"/reports/delivery\" component={DeliveryReport} />\n      <Route path=\"/reports/campaigns\" component={CampaignPerformance} />\n      <Route path=\"/reports/replies\" component={CustomerReplies} />\n      <Route path=\"/reports/agents\" component={AgentPerformance} />\n      <Route path=\"/reports/spending\" component={Spending} />\n      <Route path=\"/reports/credits\" component={Credits} />\n\n      <Route path=\"/contacts\" component={Contacts} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route path=\"/settings/team\" component={TeamMembers} />\n      <Route path=\"/settings/permissions\" component={Permissions} />\n      <Route path=\"/settings/whatsapp\" component={WhatsAppNumber} />\n      <Route path=\"/settings/profile\" component={ProfileDetails} />\n      <Route path=\"/settings/api\" component={WebhookAPI} />\n      <Route path=\"/settings/billing\" component={Billing} />\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4926,"size_tokens":null},"WhatsappBusinessDashboard/drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"server/modules/openai/openai.service.ts":{"content":"import { credentialsService } from '../credentials/credentials.service';\n\nconst SYSTEM_OPENAI_API_KEY = process.env.OPENAI_API_KEY;\nconst OPENAI_MODEL = process.env.OPENAI_MODEL || 'gpt-4o';\n\ninterface ChatMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  systemPrompt?: string;\n  instructions?: string;\n  model?: string;\n  temperature?: number;\n}\n\nasync function getOpenAIApiKey(userId?: string): Promise<string | null> {\n  if (userId) {\n    try {\n      const creds = await credentialsService.getDecryptedCredentials(userId);\n      if (creds?.openaiApiKey) {\n        return creds.openaiApiKey;\n      }\n    } catch (error) {\n      console.error('[OpenAI Service] Error getting user API key:', error);\n    }\n  }\n  \n  return SYSTEM_OPENAI_API_KEY || null;\n}\n\nexport async function sendChatCompletion(\n  messages: ChatMessage[],\n  agent?: Agent,\n  userId?: string\n): Promise<string> {\n  const apiKey = await getOpenAIApiKey(userId);\n  \n  if (!apiKey) {\n    throw new Error('OpenAI API key is not configured. Please add your API key in Settings > API Credentials.');\n  }\n\n  const model = agent?.model || OPENAI_MODEL;\n  const temperature = agent?.temperature ?? 0.7;\n\n  const systemPromptContent = agent?.systemPrompt || agent?.instructions || '';\n  const systemMessages: ChatMessage[] = systemPromptContent\n    ? [{ role: 'system', content: systemPromptContent }]\n    : [];\n\n  const allMessages = [...systemMessages, ...messages];\n\n  try {\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model,\n        messages: allMessages,\n        temperature,\n        max_tokens: 1024,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`OpenAI API error: ${error}`);\n    }\n\n    const data = await response.json();\n    return data.choices[0]?.message?.content || 'No response generated';\n  } catch (error) {\n    console.error('OpenAI API error:', error);\n    throw error;\n  }\n}\n\nexport async function generateAgentResponse(\n  userMessage: string,\n  agent: Agent,\n  conversationHistory: ChatMessage[] = [],\n  userId?: string\n): Promise<string> {\n  const messages: ChatMessage[] = [\n    ...conversationHistory,\n    { role: 'user', content: userMessage },\n  ];\n\n  return sendChatCompletion(messages, agent, userId);\n}\n\nexport async function testOpenAIConnection(userId?: string): Promise<boolean> {\n  const apiKey = await getOpenAIApiKey(userId);\n  \n  if (!apiKey) {\n    return false;\n  }\n  \n  try {\n    const response = await fetch('https://api.openai.com/v1/models', {\n      headers: {\n        'Authorization': `Bearer ${apiKey}`,\n      },\n    });\n    \n    return response.ok;\n  } catch (error) {\n    console.error('[OpenAI Service] Connection test failed:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":3011,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"server/modules/leadAutoReply/leadAutoReply.service.ts":{"content":"import * as openaiService from '../openai/openai.service';\nimport * as mappingService from '../mapping/mapping.service';\nimport * as agentService from '../aiAgents/agent.service';\nimport * as mongodb from '../storage/mongodb.adapter';\nimport * as templateService from './templateMessages.service';\n\nexport interface Lead {\n  id: string;\n  formId: string;\n  formName?: string;\n  fullName?: string;\n  name?: string;\n  email?: string;\n  phoneNumber?: string;\n  phone?: string;\n  fieldData: Record<string, string>;\n  createdTime: string;\n  adName?: string;\n  campaignName?: string;\n  autoReplySent?: boolean;\n  autoReplyMessage?: string;\n  autoReplySentAt?: string;\n}\n\nfunction getLeadPhone(lead: Lead): string | undefined {\n  return lead.phoneNumber || lead.phone;\n}\n\nfunction getLeadName(lead: Lead): string | undefined {\n  return lead.fullName || lead.name;\n}\n\nfunction getWhatsAppCredentials(): { token: string; phoneNumberId: string } | null {\n  const token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN;\n  const phoneNumberId = process.env.PHONE_NUMBER_ID;\n  \n  if (!token || !phoneNumberId) {\n    return null;\n  }\n  \n  return { token, phoneNumberId };\n}\n\nasync function sendWhatsAppMessage(to: string, message: string): Promise<{ success: boolean; error?: string; messageId?: string }> {\n  const credentials = getWhatsAppCredentials();\n  \n  if (!credentials) {\n    console.error('[AutoReply] WhatsApp credentials not configured (WHATSAPP_TOKEN or PHONE_NUMBER_ID missing)');\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n\n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          recipient_type: 'individual',\n          to: to,\n          type: 'text',\n          text: { body: message }\n        }),\n      }\n    );\n\n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    } else {\n      return { success: false, error: data.error?.message || 'Failed to send message' };\n    }\n  } catch (error) {\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\nexport async function processNewLead(lead: Lead): Promise<{ success: boolean; message?: string; error?: string }> {\n  try {\n    console.log(`[AutoReply] Processing lead: ${lead.id} from form: ${lead.formId}`);\n\n    const phoneNumber = getLeadPhone(lead);\n    if (!phoneNumber) {\n      console.log(`[AutoReply] No phone number for lead ${lead.id}, skipping`);\n      return { success: false, error: 'No phone number available' };\n    }\n\n    if (lead.autoReplySent) {\n      console.log(`[AutoReply] Already sent reply to lead ${lead.id}, skipping`);\n      return { success: false, error: 'Auto-reply already sent' };\n    }\n\n    const mapping = await mappingService.getMappingByFormId(lead.formId);\n    if (!mapping || !mapping.isActive) {\n      console.log(`[AutoReply] No active mapping for form ${lead.formId}`);\n      return { success: false, error: 'No active agent mapping for this form' };\n    }\n\n    const agent = await agentService.getAgentById(mapping.agentId);\n    if (!agent || !agent.isActive) {\n      console.log(`[AutoReply] Agent ${mapping.agentId} not found or inactive`);\n      return { success: false, error: 'Agent not found or inactive' };\n    }\n\n    const leadContext = buildLeadContext(lead);\n    const welcomePrompt = `A new lead just submitted a form. Here's their information:\\n${leadContext}\\n\\nGenerate a friendly, professional welcome message to send them via WhatsApp. Keep it concise (under 200 characters). Don't include any placeholders - write the actual message ready to send.`;\n\n    const formattedPhone = formatPhoneNumber(phoneNumber);\n    console.log(`[AutoReply] Sending WhatsApp template to: ${formattedPhone}`);\n    \n    const sendResult = await templateService.sendHelloWorldTemplate(formattedPhone);\n\n    if (sendResult.success) {\n      const templateMessage = 'Welcome message sent via WhatsApp template';\n      lead.autoReplySent = true;\n      lead.autoReplyMessage = templateMessage;\n      lead.autoReplySentAt = new Date().toISOString();\n      await updateLead(lead);\n\n      console.log(`[AutoReply] Successfully sent template to ${formattedPhone}`);\n      return { success: true, message: templateMessage };\n    } else {\n      console.error(`[AutoReply] Failed to send template: ${sendResult.error}`);\n      return { success: false, error: sendResult.error };\n    }\n\n  } catch (error) {\n    console.error('[AutoReply] Error processing lead:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\nexport async function processAllPendingLeads(): Promise<{ processed: number; successful: number; failed: number }> {\n  const leads = await mongodb.readCollection<Lead>('leads');\n  const pendingLeads = leads.filter((l: Lead) => !l.autoReplySent && getLeadPhone(l));\n\n  let successful = 0;\n  let failed = 0;\n\n  for (const lead of pendingLeads) {\n    const result = await processNewLead(lead);\n    if (result.success) {\n      successful++;\n    } else {\n      failed++;\n    }\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n\n  return { processed: pendingLeads.length, successful, failed };\n}\n\nexport async function sendManualReply(leadId: string, message: string): Promise<{ success: boolean; error?: string }> {\n  const lead = await mongodb.findOne<Lead>('leads', { id: leadId });\n\n  if (!lead) {\n    return { success: false, error: 'Lead not found' };\n  }\n\n  const phoneNumber = getLeadPhone(lead);\n  if (!phoneNumber) {\n    return { success: false, error: 'No phone number for this lead' };\n  }\n\n  const formattedPhone = formatPhoneNumber(phoneNumber);\n  const result = await templateService.sendHelloWorldTemplate(formattedPhone);\n\n  if (result.success) {\n    await mongodb.updateOne('leads', { id: leadId }, {\n      autoReplySent: true,\n      autoReplyMessage: 'Welcome message sent via WhatsApp template',\n      autoReplySentAt: new Date().toISOString(),\n    });\n  }\n\n  return result;\n}\n\nfunction buildLeadContext(lead: Lead): string {\n  const lines: string[] = [];\n  \n  const name = getLeadName(lead);\n  if (name) lines.push(`Name: ${name}`);\n  if (lead.email) lines.push(`Email: ${lead.email}`);\n  if (lead.formName) lines.push(`Form: ${lead.formName}`);\n  if (lead.adName) lines.push(`Ad: ${lead.adName}`);\n  if (lead.campaignName) lines.push(`Campaign: ${lead.campaignName}`);\n\n  if (lead.fieldData) {\n    Object.entries(lead.fieldData).forEach(([key, value]) => {\n      if (!['full_name', 'email', 'phone_number'].includes(key.toLowerCase())) {\n        lines.push(`${key}: ${value}`);\n      }\n    });\n  }\n\n  return lines.join('\\n');\n}\n\nfunction formatPhoneNumber(phone: string): string {\n  let cleaned = phone.replace(/\\D/g, '');\n  \n  if (phone.trim().startsWith('+')) {\n    return cleaned;\n  }\n  \n  if (cleaned.startsWith('00')) {\n    cleaned = cleaned.substring(2);\n    return cleaned;\n  }\n  \n  const commonCountryCodes = ['1', '44', '91', '92', '93', '94', '971', '966', '965', '974', '20', '27', '61', '64', '81', '86'];\n  for (const code of commonCountryCodes) {\n    if (cleaned.startsWith(code) && cleaned.length >= 10) {\n      return cleaned;\n    }\n  }\n  \n  if (cleaned.startsWith('0')) {\n    cleaned = '92' + cleaned.substring(1);\n  }\n\n  return cleaned;\n}\n\nasync function updateLead(lead: Lead): Promise<void> {\n  await mongodb.updateOne('leads', { id: lead.id }, lead);\n}\n","path":null,"size_bytes":7774,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/pages/ai/MapAgent.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Link2, Bot, FileText, Trash2, Plus } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface Agent {\n  id: string;\n  name: string;\n  isActive: boolean;\n}\n\ninterface LeadForm {\n  id: string;\n  name: string;\n}\n\ninterface Mapping {\n  id: string;\n  formId: string;\n  formName: string;\n  agentId: string;\n  agentName: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function MapAgent() {\n  const [mappings, setMappings] = useState<Mapping[]>([]);\n  const [agents, setAgents] = useState<Agent[]>([]);\n  const [forms, setForms] = useState<LeadForm[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedForm, setSelectedForm] = useState(\"\");\n  const [selectedAgent, setSelectedAgent] = useState(\"\");\n  const { toast } = useToast();\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      const [mappingsRes, agentsRes, formsRes] = await Promise.all([\n        fetch(\"/api/map-agent\"),\n        fetch(\"/api/agents\"),\n        fetch(\"/api/facebook/forms\"),\n      ]);\n\n      if (mappingsRes.ok) setMappings(await mappingsRes.json());\n      if (agentsRes.ok) setAgents(await agentsRes.json());\n      if (formsRes.ok) setForms(await formsRes.json());\n    } catch (error) {\n      console.error(\"Error fetching data:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const createMapping = async () => {\n    if (!selectedForm || !selectedAgent) {\n      toast({\n        title: \"Missing Selection\",\n        description: \"Please select both a form and an agent.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const form = forms.find((f) => f.id === selectedForm);\n    const agent = agents.find((a) => a.id === selectedAgent);\n\n    try {\n      const response = await fetch(\"/api/map-agent\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          formId: selectedForm,\n          formName: form?.name || \"Unknown\",\n          agentId: selectedAgent,\n          agentName: agent?.name || \"Unknown\",\n          isActive: true,\n        }),\n      });\n\n      if (response.ok) {\n        const newMapping = await response.json();\n        setMappings((prev) => {\n          const existing = prev.findIndex((m) => m.formId === newMapping.formId);\n          if (existing >= 0) {\n            const updated = [...prev];\n            updated[existing] = newMapping;\n            return updated;\n          }\n          return [...prev, newMapping];\n        });\n        toast({\n          title: \"Mapping Created\",\n          description: `${form?.name} is now connected to ${agent?.name}`,\n        });\n        setDialogOpen(false);\n        setSelectedForm(\"\");\n        setSelectedAgent(\"\");\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Failed to Create Mapping\",\n          description: error.error,\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create mapping.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const deleteMapping = async (id: string) => {\n    try {\n      const response = await fetch(`/api/map-agent/${id}`, { method: \"DELETE\" });\n      if (response.ok) {\n        setMappings((prev) => prev.filter((m) => m.id !== id));\n        toast({ title: \"Mapping Deleted\", description: \"The mapping has been removed.\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to delete mapping.\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleMapping = async (mapping: Mapping) => {\n    try {\n      const response = await fetch(`/api/map-agent/${mapping.id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ isActive: !mapping.isActive }),\n      });\n\n      if (response.ok) {\n        const updated = await response.json();\n        setMappings((prev) => prev.map((m) => (m.id === mapping.id ? updated : m)));\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to update mapping.\", variant: \"destructive\" });\n    }\n  };\n\n  const unmappedForms = forms.filter((f) => !mappings.some((m) => m.formId === f.id));\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Agent-Form Mapping</h2>\n            <p className=\"text-muted-foreground\">\n              Connect AI agents to lead forms for automatic responses\n            </p>\n          </div>\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Mapping\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create Agent-Form Mapping</DialogTitle>\n                <DialogDescription>\n                  Select a lead form and an AI agent to handle responses automatically.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Lead Form</Label>\n                  <Select value={selectedForm} onValueChange={setSelectedForm}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a form\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {forms.map((form) => (\n                        <SelectItem key={form.id} value={form.id}>\n                          {form.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>AI Agent</Label>\n                  <Select value={selectedAgent} onValueChange={setSelectedAgent}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select an agent\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {agents.map((agent) => (\n                        <SelectItem key={agent.id} value={agent.id}>\n                          {agent.name} {agent.isActive ? \"(Active)\" : \"(Inactive)\"}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button onClick={createMapping}>Create Mapping</Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Link2 className=\"h-5 w-5\" />\n              Active Mappings\n            </CardTitle>\n            <CardDescription>\n              When a lead comes from a mapped form, the connected AI agent will respond via WhatsApp\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {mappings.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Link2 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No mappings created yet. Connect a form to an AI agent to get started.</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Lead Form</TableHead>\n                    <TableHead>AI Agent</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mappings.map((mapping) => (\n                    <TableRow key={mapping.id}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4 text-blue-500\" />\n                          {mapping.formName}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Bot className=\"h-4 w-4 text-purple-500\" />\n                          {mapping.agentName}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Switch\n                            checked={mapping.isActive}\n                            onCheckedChange={() => toggleMapping(mapping)}\n                          />\n                          <Badge variant={mapping.isActive ? \"default\" : \"secondary\"}>\n                            {mapping.isActive ? \"Active\" : \"Inactive\"}\n                          </Badge>\n                        </div>\n                      </TableCell>\n                      <TableCell>{new Date(mapping.createdAt).toLocaleDateString()}</TableCell>\n                      <TableCell className=\"text-right\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-destructive\"\n                          onClick={() => deleteMapping(mapping.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":11016,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation/Drip.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Calendar, ArrowRight, MessageSquare } from \"lucide-react\";\n\nexport default function Drip() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Drip Campaigns</h2>\n             <p className=\"text-muted-foreground\">Create multi-day sequences for onboarding or nurturing.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Campaign\n          </Button>\n        </div>\n\n        <Card className=\"bg-muted/20 border-dashed border-2\">\n           <CardContent className=\"p-10 flex flex-col items-center justify-center text-center space-y-4\">\n              <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                <Calendar className=\"h-6 w-6\" />\n              </div>\n              <h3 className=\"text-xl font-semibold\">New Customer Onboarding Sequence</h3>\n              <p className=\"text-muted-foreground max-w-md\">\n                This sequence triggers when a new tag \"Customer\" is added to a contact.\n              </p>\n              \n              <div className=\"w-full max-w-3xl mt-8 relative\">\n                 {/* Timeline Line */}\n                 <div className=\"absolute left-[20px] top-8 bottom-8 w-0.5 bg-border\"></div>\n\n                 {/* Day 1 */}\n                 <div className=\"relative flex gap-6 mb-8 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      1\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 1: Welcome Message</span>\n                             <Badge>Active</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"Welcome to the family! Here is your getting started guide...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n\n                 {/* Day 3 */}\n                 <div className=\"relative flex gap-6 mb-8 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      3\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 3: Product Tips</span>\n                             <Badge>Active</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"Did you know you can do X with our product? Check this out...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n                 \n                 {/* Day 7 */}\n                 <div className=\"relative flex gap-6 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      7\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 7: Review Request</span>\n                             <Badge variant=\"secondary\">Draft</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"How are you liking it so far? We would love your feedback...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n              </div>\n              \n              <Button variant=\"outline\" className=\"mt-4\">\n                 <Plus className=\"mr-2 h-4 w-4\" /> Add Step\n              </Button>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4877,"size_tokens":null},"WhatsappBusinessDashboard/client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/Permissions.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function Permissions() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Permissions</h2>\n          <p className=\"text-muted-foreground\">Control access levels for different roles.</p>\n        </div>\n\n        <Tabs defaultValue=\"agent\" className=\"w-full\">\n          <TabsList>\n            <TabsTrigger value=\"admin\">Admin Role</TabsTrigger>\n            <TabsTrigger value=\"agent\">Agent Role</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"agent\" className=\"space-y-4 mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Module Access</CardTitle>\n                <CardDescription>Define which modules agents can access.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Dashboard</Label>\n                    <p className=\"text-sm text-muted-foreground\">View analytics and overview stats.</p>\n                  </div>\n                  <Switch defaultChecked disabled />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Inbox</Label>\n                    <p className=\"text-sm text-muted-foreground\">Read and reply to messages.</p>\n                  </div>\n                  <Switch defaultChecked />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Campaigns</Label>\n                    <p className=\"text-sm text-muted-foreground\">Create and send broadcasts.</p>\n                  </div>\n                  <Switch />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Contacts</Label>\n                    <p className=\"text-sm text-muted-foreground\">View and edit contact details.</p>\n                  </div>\n                  <Switch defaultChecked />\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Settings</Label>\n                    <p className=\"text-sm text-muted-foreground\">Access global settings.</p>\n                  </div>\n                  <Switch />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"admin\">\n            <Card>\n               <CardContent className=\"pt-6\">\n                 <p className=\"text-sm text-muted-foreground\">Admins have full access to all modules by default.</p>\n               </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3444,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/contacts.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Users, \n  Search, \n  Filter, \n  Upload, \n  Download,\n  MoreHorizontal,\n  Tag\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nconst contacts = [\n  { id: 1, name: \"Alice Johnson\", phone: \"+1 555 123 4567\", tags: [\"VIP\", \"Customer\"], lastActive: \"2 hours ago\", status: \"active\" },\n  { id: 2, name: \"Bob Smith\", phone: \"+1 555 987 6543\", tags: [\"Lead\"], lastActive: \"1 day ago\", status: \"active\" },\n  { id: 3, name: \"Carol Williams\", phone: \"+1 555 456 7890\", tags: [\"Support\", \"Pending\"], lastActive: \"3 days ago\", status: \"inactive\" },\n  { id: 4, name: \"David Brown\", phone: \"+1 555 234 5678\", tags: [\"Customer\"], lastActive: \"1 week ago\", status: \"active\" },\n  { id: 5, name: \"Eva Davis\", phone: \"+1 555 876 5432\", tags: [\"New\"], lastActive: \"Just now\", status: \"active\" },\n  { id: 6, name: \"Frank Miller\", phone: \"+1 555 345 6789\", tags: [\"Lead\"], lastActive: \"5 hours ago\", status: \"active\" },\n  { id: 7, name: \"Grace Wilson\", phone: \"+1 555 765 4321\", tags: [\"VIP\"], lastActive: \"2 days ago\", status: \"inactive\" },\n];\n\nexport default function Contacts() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Contacts</h2>\n            <p className=\"text-muted-foreground\">Manage your customer database and segments.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\">\n              <Upload className=\"mr-2 h-4 w-4\" />\n              Import\n            </Button>\n            <Button variant=\"outline\">\n              <Download className=\"mr-2 h-4 w-4\" />\n              Export\n            </Button>\n            <Button>\n              <Users className=\"mr-2 h-4 w-4\" />\n              Add Contact\n            </Button>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle>All Contacts</CardTitle>\n                <CardDescription>Total 2,345 contacts in your database.</CardDescription>\n              </div>\n              <div className=\"flex items-center gap-2 w-full md:w-auto\">\n                <div className=\"relative w-64\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input placeholder=\"Search contacts...\" className=\"pl-9\" />\n                </div>\n                <Button variant=\"outline\" size=\"icon\">\n                  <Filter className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[250px]\">Name</TableHead>\n                  <TableHead>Phone Number</TableHead>\n                  <TableHead>Tags</TableHead>\n                  <TableHead>Last Active</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {contacts.map((contact) => (\n                  <TableRow key={contact.id}>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarFallback className=\"text-xs bg-primary/10 text-primary\">\n                            {contact.name.split(' ').map(n => n[0]).join('')}\n                          </AvatarFallback>\n                        </Avatar>\n                        {contact.name}\n                      </div>\n                    </TableCell>\n                    <TableCell>{contact.phone}</TableCell>\n                    <TableCell>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {contact.tags.map(tag => (\n                          <Badge key={tag} variant=\"secondary\" className=\"text-xs font-normal\">\n                            {tag}\n                          </Badge>\n                        ))}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground\">{contact.lastActive}</TableCell>\n                    <TableCell>\n                       <div className=\"flex items-center gap-2\">\n                         <span className={`h-2 w-2 rounded-full ${contact.status === 'active' ? 'bg-green-500' : 'bg-gray-300'}`} />\n                         <span className=\"capitalize text-sm text-muted-foreground\">{contact.status}</span>\n                       </div>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":5709,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation/FollowUp.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Clock, Plus, Trash2 } from \"lucide-react\";\n\nexport default function FollowUp() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Follow-up Messages</h2>\n             <p className=\"text-muted-foreground\">Re-engage leads who haven't responded.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Follow-up\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4\">\n           {/* Follow up item 1 */}\n           <Card>\n             <CardContent className=\"p-6 flex items-start gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0\">\n                   <Clock className=\"h-6 w-6\" />\n                </div>\n                <div className=\"flex-1 grid gap-4 md:grid-cols-3 items-start\">\n                   <div className=\"space-y-2\">\n                     <Label className=\"text-muted-foreground\">Trigger</Label>\n                     <div className=\"font-medium\">After 24 Hours of Inactivity</div>\n                   </div>\n                   <div className=\"space-y-2 md:col-span-2\">\n                     <Label className=\"text-muted-foreground\">Message</Label>\n                     <div className=\"p-3 bg-muted rounded-md text-sm\">\n                       Hi there! Just wanted to check if you had any further questions? We are here to help!\n                     </div>\n                   </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                   <Button variant=\"outline\" size=\"sm\">Edit</Button>\n                   <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive\">Delete</Button>\n                </div>\n             </CardContent>\n           </Card>\n           \n           {/* Follow up item 2 */}\n           <Card>\n             <CardContent className=\"p-6 flex items-start gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0\">\n                   <Clock className=\"h-6 w-6\" />\n                </div>\n                <div className=\"flex-1 grid gap-4 md:grid-cols-3 items-start\">\n                   <div className=\"space-y-2\">\n                     <Label className=\"text-muted-foreground\">Trigger</Label>\n                     <div className=\"font-medium\">After 48 Hours of No Reply</div>\n                   </div>\n                   <div className=\"space-y-2 md:col-span-2\">\n                     <Label className=\"text-muted-foreground\">Message</Label>\n                     <div className=\"p-3 bg-muted rounded-md text-sm\">\n                       Hey! We noticed you haven't completed your profile. Need any assistance?\n                     </div>\n                   </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                   <Button variant=\"outline\" size=\"sm\">Edit</Button>\n                   <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive\">Delete</Button>\n                </div>\n             </CardContent>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3815,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/facebook/LeadForms.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RefreshCw, FileText, Users, ExternalLink } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface LeadForm {\n  id: string;\n  fbFormId: string;\n  name: string;\n  status: string;\n  pageId: string;\n  createdTime: string;\n  syncedAt: string;\n}\n\nexport default function LeadForms() {\n  const [forms, setForms] = useState<LeadForm[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [syncing, setSyncing] = useState(false);\n  const { toast } = useToast();\n\n  const fetchForms = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(\"/api/facebook/forms\");\n      if (response.ok) {\n        const data = await response.json();\n        setForms(data);\n      }\n    } catch (error) {\n      console.error(\"Error fetching forms:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const syncForms = async () => {\n    setSyncing(true);\n    try {\n      const response = await fetch(\"/api/facebook/forms/sync\", { method: \"POST\" });\n      if (response.ok) {\n        const data = await response.json();\n        setForms(data.forms);\n        toast({\n          title: \"Forms Synced\",\n          description: `Successfully synced ${data.count} lead form(s) from Facebook.`,\n        });\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Sync Failed\",\n          description: error.error || \"Failed to sync forms from Facebook.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Sync Failed\",\n        description: \"Network error while syncing forms.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const syncLeads = async (formId: string) => {\n    try {\n      const response = await fetch(`/api/facebook/forms/${formId}/sync-leads`, { method: \"POST\" });\n      if (response.ok) {\n        const data = await response.json();\n        toast({\n          title: \"Leads Synced\",\n          description: `Successfully synced ${data.count} new lead(s).`,\n        });\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Sync Failed\",\n          description: error.error || \"Failed to sync leads.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Sync Failed\",\n        description: \"Network error while syncing leads.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  useEffect(() => {\n    fetchForms();\n  }, []);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Facebook Lead Forms</h2>\n            <p className=\"text-muted-foreground\">Manage and sync your Facebook lead generation forms</p>\n          </div>\n          <Button onClick={syncForms} disabled={syncing}>\n            <RefreshCw className={`h-4 w-4 mr-2 ${syncing ? \"animate-spin\" : \"\"}`} />\n            {syncing ? \"Syncing...\" : \"Sync Forms\"}\n          </Button>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Lead Forms\n            </CardTitle>\n            <CardDescription>\n              Your connected Facebook lead forms. Click \"Sync Leads\" to fetch new submissions.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <RefreshCw className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : forms.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No lead forms found. Click \"Sync Forms\" to fetch from Facebook.</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Form Name</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Facebook ID</TableHead>\n                    <TableHead>Last Synced</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {forms.map((form) => (\n                    <TableRow key={form.id}>\n                      <TableCell className=\"font-medium\">{form.name}</TableCell>\n                      <TableCell>\n                        <Badge variant={form.status === \"ACTIVE\" ? \"default\" : \"secondary\"}>\n                          {form.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"font-mono text-xs\">{form.fbFormId}</TableCell>\n                      <TableCell>{new Date(form.syncedAt).toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right space-x-2\">\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => syncLeads(form.id)}>\n                          <Users className=\"h-4 w-4 mr-1\" />\n                          Sync Leads\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6054,"size_tokens":null},"client/src/pages/automation/Keywords.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Plus, Trash2, Edit, Loader2 } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\n\ninterface Automation {\n  id: string;\n  name: string;\n  type: \"keyword\" | \"welcome\" | \"follow_up\" | \"drip\";\n  trigger: string;\n  message: string;\n  delay?: number;\n  delayUnit?: \"minutes\" | \"hours\" | \"days\";\n  isActive: boolean;\n  createdAt: string;\n}\n\nexport default function Keywords() {\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [selectedAutomation, setSelectedAutomation] = useState<Automation | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    trigger: \"\",\n    message: \"\",\n  });\n  const queryClient = useQueryClient();\n\n  const { data: automations = [], isLoading } = useQuery<Automation[]>({\n    queryKey: [\"/api/automations\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/automations\");\n      if (!res.ok) throw new Error(\"Failed to fetch automations\");\n      return res.json();\n    },\n  });\n\n  const keywordAutomations = automations.filter(a => a.type === \"keyword\");\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/automations\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          ...data,\n          type: \"keyword\",\n          isActive: true,\n        }),\n      });\n      if (!res.ok) throw new Error(\"Failed to create automation\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      setIsAddDialogOpen(false);\n      resetForm();\n      toast.success(\"Keyword rule created successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to create keyword rule\");\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const res = await fetch(`/api/automations/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to update automation\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      setIsEditDialogOpen(false);\n      setSelectedAutomation(null);\n      toast.success(\"Keyword rule updated successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to update keyword rule\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/automations/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete automation\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      toast.success(\"Keyword rule deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete keyword rule\");\n    },\n  });\n\n  const toggleMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: string; isActive: boolean }) => {\n      const res = await fetch(`/api/automations/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ isActive }),\n      });\n      if (!res.ok) throw new Error(\"Failed to toggle automation\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n    },\n    onError: () => {\n      toast.error(\"Failed to toggle automation\");\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({ name: \"\", trigger: \"\", message: \"\" });\n  };\n\n  const openEditDialog = (automation: Automation) => {\n    setSelectedAutomation(automation);\n    setFormData({\n      name: automation.name,\n      trigger: automation.trigger,\n      message: automation.message,\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleCreate = () => {\n    if (!formData.name || !formData.trigger || !formData.message) {\n      toast.error(\"Please fill in all fields\");\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  const handleUpdate = () => {\n    if (!selectedAutomation) return;\n    updateMutation.mutate({\n      id: selectedAutomation.id,\n      data: formData,\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Keyword Auto-replies</h2>\n             <p className=\"text-muted-foreground\">Set up triggers for specific words in incoming messages.</p>\n          </div>\n          <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n            <DialogTrigger asChild>\n               <Button onClick={() => { resetForm(); setIsAddDialogOpen(true); }}>\n                 <Plus className=\"mr-2 h-4 w-4\" />\n                 Add New Rule\n               </Button>\n            </DialogTrigger>\n            <DialogContent>\n               <DialogHeader>\n                 <DialogTitle>New Keyword Rule</DialogTitle>\n               </DialogHeader>\n               <div className=\"grid gap-4 py-4\">\n                 <div className=\"grid gap-2\">\n                   <Label>Rule Name</Label>\n                   <Input \n                     placeholder=\"e.g., Price Inquiry\"\n                     value={formData.name}\n                     onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                   />\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Keyword Trigger</Label>\n                   <Input \n                     placeholder=\"e.g., price, pricing, cost\"\n                     value={formData.trigger}\n                     onChange={(e) => setFormData({ ...formData, trigger: e.target.value })}\n                   />\n                   <p className=\"text-xs text-muted-foreground\">\n                     Enter the word or phrase that triggers this response\n                   </p>\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Reply Message</Label>\n                   <Textarea \n                     placeholder=\"The automated response...\"\n                     value={formData.message}\n                     onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n                     rows={4}\n                   />\n                 </div>\n               </div>\n               <DialogFooter>\n                 <Button variant=\"outline\" onClick={() => setIsAddDialogOpen(false)}>Cancel</Button>\n                 <Button onClick={handleCreate} disabled={createMutation.isPending}>\n                   {createMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                   Save Rule\n                 </Button>\n               </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Active Rules</CardTitle>\n             <CardDescription>Messages that trigger an automatic response.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : keywordAutomations.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No keyword rules yet. Create your first rule to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Keyword</TableHead>\n                    <TableHead>Reply Preview</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {keywordAutomations.map((rule) => (\n                    <TableRow key={rule.id}>\n                      <TableCell className=\"font-medium\">{rule.name}</TableCell>\n                      <TableCell className=\"font-mono font-bold text-primary\">{rule.trigger}</TableCell>\n                      <TableCell className=\"text-muted-foreground truncate max-w-[300px]\">{rule.message}</TableCell>\n                      <TableCell>\n                        <Switch\n                          checked={rule.isActive}\n                          onCheckedChange={(checked) => toggleMutation.mutate({ id: rule.id, isActive: checked })}\n                        />\n                      </TableCell>\n                      <TableCell className=\"text-right space-x-2\">\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => openEditDialog(rule)}>\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          className=\"text-destructive\"\n                          onClick={() => deleteMutation.mutate(rule.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Keyword Rule</DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label>Rule Name</Label>\n              <Input \n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Keyword Trigger</Label>\n              <Input \n                value={formData.trigger}\n                onChange={(e) => setFormData({ ...formData, trigger: e.target.value })}\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Reply Message</Label>\n              <Textarea \n                value={formData.message}\n                onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n                rows={4}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleUpdate} disabled={updateMutation.isPending}>\n              {updateMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save Changes\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":12142,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/CustomerReplies.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { MessageSquare, ExternalLink } from \"lucide-react\";\n\nconst replies = [\n  { id: 1, name: \"Alice Johnson\", message: \"Yes, I am interested in the pro plan.\", time: \"10 mins ago\", sentiment: \"Positive\" },\n  { id: 2, name: \"Bob Smith\", message: \"Stop sending me these messages.\", time: \"1 hour ago\", sentiment: \"Negative\" },\n  { id: 3, name: \"Carol Williams\", message: \"How much is shipping to NY?\", time: \"2 hours ago\", sentiment: \"Neutral\" },\n  { id: 4, name: \"David Brown\", message: \"Thanks for the update!\", time: \"Yesterday\", sentiment: \"Positive\" },\n  { id: 5, name: \"Eva Davis\", message: \"I need to speak to an agent.\", time: \"Yesterday\", sentiment: \"Neutral\" },\n];\n\nexport default function CustomerReplies() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Customers Who Replied</h2>\n          <p className=\"text-muted-foreground\">Track incoming messages and customer sentiment.</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Replies (7d)</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">342</div>\n             </CardContent>\n          </Card>\n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Positive Sentiment</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-green-600\">68%</div>\n             </CardContent>\n          </Card>\n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Unsubscribe Requests</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-red-600\">12</div>\n             </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Recent Replies</CardTitle>\n          </CardHeader>\n          <CardContent>\n             <Table>\n               <TableHeader>\n                 <TableRow>\n                   <TableHead>Customer</TableHead>\n                   <TableHead>Message Snippet</TableHead>\n                   <TableHead>Time</TableHead>\n                   <TableHead>Sentiment</TableHead>\n                   <TableHead className=\"text-right\">Action</TableHead>\n                 </TableRow>\n               </TableHeader>\n               <TableBody>\n                 {replies.map((reply) => (\n                   <TableRow key={reply.id}>\n                     <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-2\">\n                          <Avatar className=\"h-8 w-8\">\n                             <AvatarFallback className=\"text-xs\">{reply.name.charAt(0)}</AvatarFallback>\n                          </Avatar>\n                          {reply.name}\n                        </div>\n                     </TableCell>\n                     <TableCell className=\"text-muted-foreground max-w-[300px] truncate\">\"{reply.message}\"</TableCell>\n                     <TableCell>{reply.time}</TableCell>\n                     <TableCell>\n                        <Badge \n                          variant=\"outline\" \n                          className={\n                            reply.sentiment === 'Positive' ? 'text-green-600 bg-green-50 border-green-200' :\n                            reply.sentiment === 'Negative' ? 'text-red-600 bg-red-50 border-red-200' :\n                            'text-gray-600 bg-gray-50 border-gray-200'\n                          }\n                        >\n                          {reply.sentiment}\n                        </Badge>\n                     </TableCell>\n                     <TableCell className=\"text-right\">\n                        <Button variant=\"ghost\" size=\"sm\">\n                          <MessageSquare className=\"mr-2 h-4 w-4\" /> Reply\n                        </Button>\n                     </TableCell>\n                   </TableRow>\n                 ))}\n               </TableBody>\n             </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4889,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/templates/TemplateStatus.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\n\nexport default function TemplateStatus() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">Template Status</h2>\n        <Card>\n          <CardHeader>\n             <CardTitle>Approval Status</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Category</TableHead>\n                  <TableHead>Language</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Last Updated</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium\">welcome_message</TableCell>\n                  <TableCell>Marketing</TableCell>\n                  <TableCell>en_US</TableCell>\n                  <TableCell><Badge className=\"bg-green-500\">Approved</Badge></TableCell>\n                  <TableCell>2 days ago</TableCell>\n                </TableRow>\n                <TableRow>\n                  <TableCell className=\"font-medium\">promo_offer</TableCell>\n                  <TableCell>Marketing</TableCell>\n                  <TableCell>en_US</TableCell>\n                  <TableCell><Badge variant=\"secondary\">Pending</Badge></TableCell>\n                  <TableCell>1 hour ago</TableCell>\n                </TableRow>\n                <TableRow>\n                  <TableCell className=\"font-medium\">alert_msg</TableCell>\n                  <TableCell>Utility</TableCell>\n                  <TableCell>en_US</TableCell>\n                  <TableCell><Badge variant=\"destructive\">Rejected</Badge></TableCell>\n                  <TableCell>Yesterday</TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2325,"size_tokens":null},"client/src/pages/campaigns/SelectedContacts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Search, Send, Filter, Loader2, Bot, MessageSquare, FileText } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags: string[];\n  source?: string;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\ninterface SavedContact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n  source?: string;\n}\n\nexport default function SelectedContacts() {\n  const [selectedContactIds, setSelectedContactIds] = useState<string[]>([]);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai_agent\">(\"template\");\n  const [selectedTemplateId, setSelectedTemplateId] = useState(\"\");\n  const [selectedAgentId, setSelectedAgentId] = useState(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [showSendDialog, setShowSendDialog] = useState(false);\n\n  const { data: regularContacts = [], isLoading: regularLoading } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch contacts\");\n      return res.json();\n    },\n  });\n\n  const { data: importedContacts = [], isLoading: importedLoading } = useQuery<SavedContact[]>({\n    queryKey: [\"/api/broadcast/imported-contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/imported-contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch imported contacts\");\n      return res.json();\n    },\n  });\n\n  const contacts: Contact[] = [\n    ...regularContacts,\n    ...importedContacts.map(c => ({\n      id: c.id,\n      name: c.name,\n      phone: c.phone,\n      email: c.email,\n      tags: c.tags || [],\n      source: c.source || 'import',\n    })),\n  ];\n\n  const contactsLoading = regularLoading || importedLoading;\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  const approvedTemplates = templates.filter(t => t.status === \"approved\");\n  const activeAgents = agents.filter(a => a.isActive);\n\n  const sendBroadcastMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/broadcast/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to send messages\");\n      return res.json();\n    },\n    onSuccess: (result) => {\n      toast.success(`Sent: ${result.successful} successful, ${result.failed} failed`);\n      setShowSendDialog(false);\n      setSelectedContactIds([]);\n    },\n    onError: () => {\n      toast.error(\"Failed to send messages\");\n    },\n  });\n\n  const toggleSelect = (id: string) => {\n    if (selectedContactIds.includes(id)) {\n      setSelectedContactIds(selectedContactIds.filter(c => c !== id));\n    } else {\n      setSelectedContactIds([...selectedContactIds, id]);\n    }\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedContactIds.length === filteredContacts.length) {\n      setSelectedContactIds([]);\n    } else {\n      setSelectedContactIds(filteredContacts.map(c => c.id));\n    }\n  };\n\n  const handleSendMessages = () => {\n    if (selectedContactIds.length === 0) {\n      toast.error(\"Please select at least one contact\");\n      return;\n    }\n\n    if (messageType === \"template\" && !selectedTemplateId) {\n      toast.error(\"Please select a template\");\n      return;\n    }\n\n    if (messageType === \"custom\" && !customMessage.trim()) {\n      toast.error(\"Please enter a message\");\n      return;\n    }\n\n    if (messageType === \"ai_agent\" && !selectedAgentId) {\n      toast.error(\"Please select an AI agent\");\n      return;\n    }\n\n    const targetContacts = contacts\n      .filter(c => selectedContactIds.includes(c.id))\n      .map(c => ({ name: c.name, phone: c.phone }));\n\n    sendBroadcastMutation.mutate({\n      contacts: targetContacts,\n      messageType,\n      templateName: messageType === \"template\" ? (templates.find(t => t.id === selectedTemplateId)?.name || \"hello_world\") : undefined,\n      customMessage: messageType === \"custom\" ? customMessage : undefined,\n      agentId: messageType === \"ai_agent\" ? selectedAgentId : undefined,\n    });\n  };\n\n  const filteredContacts = contacts.filter(contact => \n    contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    contact.phone.includes(searchQuery)\n  );\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Send to Selected</h2>\n            <p className=\"text-muted-foreground\">Select specific contacts and send a targeted message.</p>\n          </div>\n          <Dialog open={showSendDialog} onOpenChange={setShowSendDialog}>\n            <DialogTrigger asChild>\n              <Button disabled={selectedContactIds.length === 0}>\n                <Send className=\"mr-2 h-4 w-4\" />\n                Send to {selectedContactIds.length} Contacts\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px]\">\n              <DialogHeader>\n                <DialogTitle>Compose Message</DialogTitle>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label>Message Type</Label>\n                  <Tabs value={messageType} onValueChange={(v) => setMessageType(v as any)}>\n                    <TabsList className=\"w-full\">\n                      <TabsTrigger value=\"template\" className=\"flex-1\">\n                        <FileText className=\"mr-1 h-4 w-4\" />\n                        Template\n                      </TabsTrigger>\n                      <TabsTrigger value=\"custom\" className=\"flex-1\">\n                        <MessageSquare className=\"mr-1 h-4 w-4\" />\n                        Custom\n                      </TabsTrigger>\n                      <TabsTrigger value=\"ai_agent\" className=\"flex-1\">\n                        <Bot className=\"mr-1 h-4 w-4\" />\n                        AI Agent\n                      </TabsTrigger>\n                    </TabsList>\n\n                    <TabsContent value=\"template\" className=\"mt-4\">\n                      <Select value={selectedTemplateId} onValueChange={setSelectedTemplateId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a template...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"hello_world\">hello_world (Default)</SelectItem>\n                          {approvedTemplates.map((template) => (\n                            <SelectItem key={template.id} value={template.id}>\n                              {template.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </TabsContent>\n\n                    <TabsContent value=\"custom\" className=\"mt-4\">\n                      <Textarea\n                        placeholder=\"Type your message here...\"\n                        value={customMessage}\n                        onChange={(e) => setCustomMessage(e.target.value)}\n                        className=\"min-h-[100px]\"\n                      />\n                      <p className=\"text-xs text-muted-foreground mt-2\">\n                        Note: Custom messages require the recipient to have messaged you first.\n                      </p>\n                    </TabsContent>\n\n                    <TabsContent value=\"ai_agent\" className=\"mt-4\">\n                      <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select an AI agent...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {activeAgents.length === 0 ? (\n                            <SelectItem value=\"\" disabled>No active agents available</SelectItem>\n                          ) : (\n                            activeAgents.map((agent) => (\n                              <SelectItem key={agent.id} value={agent.id}>\n                                {agent.name}\n                              </SelectItem>\n                            ))\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </TabsContent>\n                  </Tabs>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button \n                  onClick={handleSendMessages}\n                  disabled={sendBroadcastMutation.isPending}\n                >\n                  {sendBroadcastMutation.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Send className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Send Message\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Contact List</CardTitle>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative w-64\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input \n                    placeholder=\"Search contacts...\" \n                    className=\"pl-9\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                  />\n                </div>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {contactsLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin\" />\n              </div>\n            ) : filteredContacts.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No contacts found\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-[50px]\">\n                      <Checkbox \n                        checked={selectedContactIds.length === filteredContacts.length && filteredContacts.length > 0}\n                        onCheckedChange={toggleSelectAll}\n                      />\n                    </TableHead>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Phone</TableHead>\n                    <TableHead>Tags</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredContacts.map((contact) => (\n                    <TableRow \n                      key={contact.id}\n                      className={selectedContactIds.includes(contact.id) ? \"bg-muted/50\" : \"\"}\n                    >\n                      <TableCell>\n                        <Checkbox \n                          checked={selectedContactIds.includes(contact.id)}\n                          onCheckedChange={() => toggleSelect(contact.id)}\n                        />\n                      </TableCell>\n                      <TableCell className=\"font-medium\">{contact.name}</TableCell>\n                      <TableCell>{contact.phone}</TableCell>\n                      <TableCell>\n                        {contact.tags?.map(tag => (\n                          <Badge key={tag} variant=\"secondary\" className=\"mr-1\">{tag}</Badge>\n                        ))}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":13695,"size_tokens":null},"client/src/pages/reports/CampaignPerformance.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\nimport { Loader2, Target, Send, Eye, MessageSquare, DollarSign } from \"lucide-react\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface Campaign {\n  id: string;\n  name: string;\n  date: string;\n  sent: number;\n  delivered: number;\n  read: number;\n  replied: number;\n  deliveryRate: number;\n  readRate: number;\n  replyRate: number;\n  cost: string;\n}\n\ninterface ChartData {\n  name: string;\n  sent: number;\n  read: number;\n  replied: number;\n}\n\ninterface CampaignPerformanceData {\n  campaigns: Campaign[];\n  chartData: ChartData[];\n  summary: {\n    totalCampaigns: number;\n    totalSent: number;\n    totalDelivered: number;\n    totalRead: number;\n    totalReplied: number;\n    avgDeliveryRate: number;\n    avgReadRate: number;\n    avgReplyRate: number;\n    totalCost: string;\n  };\n  period: string;\n}\n\nexport default function CampaignPerformance() {\n  const [period, setPeriod] = useState(\"week\");\n\n  const { data, isLoading, error } = useQuery<CampaignPerformanceData>({\n    queryKey: [\"/api/reports/campaign-performance\", period],\n    queryFn: async () => {\n      const res = await fetchWithAuth(`/api/reports/campaign-performance?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch campaign performance\");\n      return res.json();\n    },\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n              <Target className=\"h-8 w-8 text-primary\" />\n              Campaign Performance\n            </h2>\n            <p className=\"text-muted-foreground\">ROI and engagement metrics for your broadcasts.</p>\n          </div>\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-[150px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Today</SelectItem>\n              <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n              <SelectItem value=\"week\">Last 7 Days</SelectItem>\n              <SelectItem value=\"month\">Last 30 Days</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : error ? (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">Failed to load campaign data</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-5\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Target className=\"h-4 w-4\" />\n                    Campaigns\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalCampaigns || 0}</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Send className=\"h-4 w-4\" />\n                    Total Sent\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{(data?.summary.totalSent || 0).toLocaleString()}</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Eye className=\"h-4 w-4\" />\n                    Read Rate\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-blue-600\">{data?.summary.avgReadRate || 0}%</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <MessageSquare className=\"h-4 w-4\" />\n                    Reply Rate\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-green-600\">{data?.summary.avgReplyRate || 0}%</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <DollarSign className=\"h-4 w-4\" />\n                    Total Cost\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.totalCost || '0.00'}</div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Engagement Comparison</CardTitle>\n                <CardDescription>Compare Sent vs Read vs Replied across top campaigns.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {data?.chartData && data.chartData.length > 0 ? (\n                  <div className=\"h-[350px] w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={data.chartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <XAxis dataKey=\"name\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                        <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                        <Tooltip \n                          cursor={{ fill: 'hsl(var(--muted)/0.2)' }}\n                          contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                        />\n                        <Legend />\n                        <Bar dataKey=\"sent\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} name=\"Sent\" />\n                        <Bar dataKey=\"read\" fill=\"hsl(var(--chart-2))\" radius={[4, 4, 0, 0]} name=\"Read\" />\n                        <Bar dataKey=\"replied\" fill=\"hsl(var(--chart-5))\" radius={[4, 4, 0, 0]} name=\"Replied\" />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                ) : (\n                  <div className=\"h-[350px] flex items-center justify-center text-muted-foreground\">\n                    <div className=\"text-center\">\n                      <Target className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p>No campaign data for this period.</p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Detailed Report</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {data?.campaigns && data.campaigns.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Campaign Name</TableHead>\n                        <TableHead>Date</TableHead>\n                        <TableHead>Sent</TableHead>\n                        <TableHead>Delivered</TableHead>\n                        <TableHead>Read Rate</TableHead>\n                        <TableHead>Reply Rate</TableHead>\n                        <TableHead className=\"text-right\">Cost</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {data.campaigns.map((campaign) => (\n                        <TableRow key={campaign.id}>\n                          <TableCell className=\"font-medium\">{campaign.name}</TableCell>\n                          <TableCell className=\"text-muted-foreground\">{campaign.date}</TableCell>\n                          <TableCell>{campaign.sent.toLocaleString()}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">\n                              {campaign.deliveryRate}%\n                            </Badge>\n                          </TableCell>\n                          <TableCell>{campaign.readRate}%</TableCell>\n                          <TableCell>{campaign.replyRate}%</TableCell>\n                          <TableCell className=\"text-right font-medium\">${campaign.cost}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <Target className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No campaigns found for this period. Send a broadcast to see data here.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":10357,"size_tokens":null},"server/modules/aiAgents/agent.controller.ts":{"content":"import { Request, Response } from 'express';\nimport * as agentService from './agent.service';\nimport { generateAgentResponse } from '../ai/ai.service';\n\nexport async function listAgents(req: Request, res: Response) {\n  try {\n    const agents = await agentService.getAllAgents();\n    res.json(agents);\n  } catch (error) {\n    console.error('Error listing agents:', error);\n    res.status(500).json({ error: 'Failed to list agents' });\n  }\n}\n\nexport async function getAgent(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const agent = await agentService.getAgentById(id);\n    if (!agent) {\n      return res.status(404).json({ error: 'Agent not found' });\n    }\n    res.json(agent);\n  } catch (error) {\n    console.error('Error getting agent:', error);\n    res.status(500).json({ error: 'Failed to get agent' });\n  }\n}\n\nexport async function createAgent(req: Request, res: Response) {\n  try {\n    const { name, description, systemPrompt, model, temperature, isActive } = req.body;\n    \n    if (!name || !systemPrompt) {\n      return res.status(400).json({ error: 'Name and system prompt are required' });\n    }\n\n    const agent = await agentService.createAgent({\n      name,\n      description: description || '',\n      systemPrompt,\n      model: model || 'gpt-4o',\n      temperature: temperature ?? 0.7,\n      isActive: isActive ?? true,\n    });\n\n    res.status(201).json(agent);\n  } catch (error) {\n    console.error('Error creating agent:', error);\n    res.status(500).json({ error: 'Failed to create agent' });\n  }\n}\n\nexport async function updateAgent(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const updates = req.body;\n\n    const agent = await agentService.updateAgent(id, updates);\n    if (!agent) {\n      return res.status(404).json({ error: 'Agent not found' });\n    }\n\n    res.json(agent);\n  } catch (error) {\n    console.error('Error updating agent:', error);\n    res.status(500).json({ error: 'Failed to update agent' });\n  }\n}\n\nexport async function deleteAgent(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const deleted = await agentService.deleteAgent(id);\n    \n    if (!deleted) {\n      return res.status(404).json({ error: 'Agent not found' });\n    }\n\n    res.json({ success: true, message: 'Agent deleted successfully' });\n  } catch (error) {\n    console.error('Error deleting agent:', error);\n    res.status(500).json({ error: 'Failed to delete agent' });\n  }\n}\n\nexport async function testAgent(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const { message } = req.body;\n\n    if (!message) {\n      return res.status(400).json({ error: 'Message is required' });\n    }\n\n    const agent = await agentService.getAgentById(id);\n    if (!agent) {\n      return res.status(404).json({ error: 'Agent not found' });\n    }\n\n    const response = await generateAgentResponse(message, agent);\n    res.json({ response });\n  } catch (error) {\n    console.error('Error testing agent:', error);\n    res.status(500).json({ error: 'Failed to test agent' });\n  }\n}\n\nexport async function migrateAllToGemini(req: Request, res: Response) {\n  try {\n    const result = await agentService.updateAllAgentsToGemini();\n    res.json({ \n      success: true, \n      message: `Successfully updated ${result.updated} agents to use gemini-2.0-flash`,\n      agents: result.agents\n    });\n  } catch (error) {\n    console.error('Error migrating agents to Gemini:', error);\n    res.status(500).json({ error: 'Failed to migrate agents to Gemini' });\n  }\n}\n","path":null,"size_bytes":3546,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/modules/facebook/fb.service.ts":{"content":"import { readCollection, writeCollection, findById, findByField } from '../storage';\nimport * as leadAutoReply from '../leadAutoReply/leadAutoReply.service';\n\n// Facebook tokens - we can use either a Page Access Token directly\n// or derive it from a User Access Token + Page ID\nconst FB_USER_OR_PAGE_TOKEN = process.env.FB_PAGE_ACCESS_TOKEN || process.env.FB_ACCESS_TOKEN;\nconst FB_PAGE_ID = process.env.FB_PAGE_ID;\n\n// Cache for the actual Page Access Token\nlet cachedPageAccessToken: string | null = null;\n\n// Function to get the actual Page Access Token\n// If user provides a User Access Token, we fetch the Page Access Token from /me/accounts\nasync function getPageAccessToken(): Promise<string> {\n  if (cachedPageAccessToken) {\n    return cachedPageAccessToken;\n  }\n  \n  if (!FB_USER_OR_PAGE_TOKEN) {\n    throw new Error('Facebook credentials not configured. Please set FB_PAGE_ACCESS_TOKEN.');\n  }\n  \n  // First, check if this is already a Page Access Token by trying to get page info\n  try {\n    const meResponse = await fetch(`https://graph.facebook.com/v18.0/me?access_token=${FB_USER_OR_PAGE_TOKEN}`);\n    const meData = await meResponse.json();\n    \n    // If this returns a page (has category field), it's a Page Access Token\n    if (meData.category || meData.category_list) {\n      console.log('[FB] Token is already a Page Access Token');\n      cachedPageAccessToken = FB_USER_OR_PAGE_TOKEN;\n      return cachedPageAccessToken;\n    }\n    \n    // If it's a user token, try to get the page token from /me/accounts\n    console.log('[FB] Token is a User Access Token, fetching Page Access Token...');\n    const accountsResponse = await fetch(`https://graph.facebook.com/v18.0/me/accounts?access_token=${FB_USER_OR_PAGE_TOKEN}`);\n    const accountsData = await accountsResponse.json();\n    \n    if (accountsData.data && accountsData.data.length > 0) {\n      // Find the matching page by ID, or use the first one\n      const targetPage = FB_PAGE_ID \n        ? accountsData.data.find((p: any) => p.id === FB_PAGE_ID)\n        : accountsData.data[0];\n        \n      if (targetPage && targetPage.access_token) {\n        console.log(`[FB] Found Page Access Token for page: ${targetPage.name} (${targetPage.id})`);\n        cachedPageAccessToken = targetPage.access_token;\n        return cachedPageAccessToken as string;\n      }\n    }\n    \n    // If we couldn't get a page token, use the original token\n    console.log('[FB] Could not find Page Access Token, using original token');\n    cachedPageAccessToken = FB_USER_OR_PAGE_TOKEN;\n    return cachedPageAccessToken;\n  } catch (error) {\n    console.error('[FB] Error determining token type:', error);\n    cachedPageAccessToken = FB_USER_OR_PAGE_TOKEN;\n    return cachedPageAccessToken;\n  }\n}\n\nexport interface LeadForm {\n  id: string;\n  fbFormId: string;\n  name: string;\n  status: string;\n  pageId: string;\n  createdTime: string;\n  syncedAt: string;\n}\n\nexport interface Lead {\n  id: string;\n  fbLeadId: string;\n  formId: string;\n  formName: string;\n  fieldData: Record<string, string>;\n  createdTime: string;\n  syncedAt: string;\n  phone?: string;\n  email?: string;\n  name?: string;\n  autoReplySent?: boolean;\n  autoReplyMessage?: string;\n  autoReplySentAt?: string;\n}\n\nconst FORMS_COLLECTION = 'forms';\nconst LEADS_COLLECTION = 'leads';\n\nfunction generateId(prefix: string): string {\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport async function syncLeadForms(): Promise<LeadForm[]> {\n  if (!FB_USER_OR_PAGE_TOKEN || !FB_PAGE_ID) {\n    throw new Error('Facebook credentials not configured. Please set FB_PAGE_ACCESS_TOKEN and FB_PAGE_ID.');\n  }\n\n  try {\n    const pageToken = await getPageAccessToken();\n    const url = `https://graph.facebook.com/v18.0/${FB_PAGE_ID}/leadgen_forms?access_token=${pageToken}`;\n    const response = await fetch(url);\n    \n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Facebook API error: ${error}`);\n    }\n\n    const data = await response.json();\n    const forms: LeadForm[] = [];\n    const now = new Date().toISOString();\n\n    for (const fbForm of data.data || []) {\n      const existingForm = await findByField<LeadForm>(FORMS_COLLECTION, 'fbFormId', fbForm.id);\n      \n      const form: LeadForm = {\n        id: existingForm?.id || generateId('form'),\n        fbFormId: fbForm.id,\n        name: fbForm.name || 'Unnamed Form',\n        status: fbForm.status || 'ACTIVE',\n        pageId: FB_PAGE_ID,\n        createdTime: fbForm.created_time || now,\n        syncedAt: now,\n      };\n\n      forms.push(form);\n    }\n\n    await writeCollection(FORMS_COLLECTION, forms);\n    return forms;\n  } catch (error) {\n    console.error('Error syncing lead forms:', error);\n    throw error;\n  }\n}\n\nexport async function getAllForms(): Promise<LeadForm[]> {\n  return readCollection<LeadForm>(FORMS_COLLECTION);\n}\n\nexport async function getFormById(id: string): Promise<LeadForm | null> {\n  return findById<LeadForm>(FORMS_COLLECTION, id);\n}\n\nexport async function getFormByFbId(fbFormId: string): Promise<LeadForm | null> {\n  return findByField<LeadForm>(FORMS_COLLECTION, 'fbFormId', fbFormId);\n}\n\nexport async function syncLeadsForForm(formId: string): Promise<Lead[]> {\n  if (!FB_USER_OR_PAGE_TOKEN) {\n    throw new Error('Facebook credentials not configured. Please set FB_PAGE_ACCESS_TOKEN.');\n  }\n\n  console.log(`[FB Service] Looking for form with id: ${formId}`);\n  \n  let form = await findById<LeadForm>(FORMS_COLLECTION, formId);\n  \n  if (!form) {\n    console.log(`[FB Service] Form not found by id, checking by fbFormId...`);\n    form = await findByField<LeadForm>(FORMS_COLLECTION, 'fbFormId', formId);\n    \n    if (!form) {\n      console.log(`[FB Service] Form not found by fbFormId either, checking all forms...`);\n      const allForms = await readCollection<LeadForm>(FORMS_COLLECTION);\n      console.log(`[FB Service] Total forms in database: ${allForms.length}`);\n      if (allForms.length > 0) {\n        allForms.forEach(f => console.log(`[FB Service] Form: id=${f.id}, fbFormId=${f.fbFormId}, name=${f.name}`));\n      }\n      \n      const foundForm = allForms.find(f => f.id === formId || f.fbFormId === formId);\n      if (!foundForm) {\n        console.log(`[FB Service] Form still not found after checking all forms`);\n        throw new Error('Form not found');\n      }\n      form = foundForm;\n    }\n  }\n  \n  console.log(`[FB Service] Found form: ${form.name} (fbFormId: ${form.fbFormId})`);\n  \n  if (!form.fbFormId) {\n    throw new Error('Form is missing Facebook Form ID. Please re-sync forms from Facebook.');\n  }\n\n  try {\n    const pageToken = await getPageAccessToken();\n    const url = `https://graph.facebook.com/v18.0/${form.fbFormId}/leads?access_token=${pageToken}`;\n    const response = await fetch(url);\n    \n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Facebook API error: ${error}`);\n    }\n\n    const data = await response.json();\n    const existingLeads = await readCollection<Lead>(LEADS_COLLECTION);\n    const now = new Date().toISOString();\n    const newLeads: Lead[] = [];\n\n    for (const fbLead of data.data || []) {\n      const existingLead = existingLeads.find(l => l.fbLeadId === fbLead.id);\n      if (existingLead) continue;\n\n      const fieldData: Record<string, string> = {};\n      let phone = '';\n      let email = '';\n      let name = '';\n\n      for (const field of fbLead.field_data || []) {\n        fieldData[field.name] = field.values?.[0] || '';\n        if (field.name.toLowerCase().includes('phone')) phone = field.values?.[0] || '';\n        if (field.name.toLowerCase().includes('email')) email = field.values?.[0] || '';\n        if (field.name.toLowerCase().includes('name')) name = field.values?.[0] || '';\n      }\n\n      const lead: Lead = {\n        id: generateId('lead'),\n        fbLeadId: fbLead.id,\n        formId: form.id,\n        formName: form.name,\n        fieldData,\n        createdTime: fbLead.created_time || now,\n        syncedAt: now,\n        phone,\n        email,\n        name,\n      };\n\n      newLeads.push(lead);\n    }\n\n    const allLeads = [...existingLeads, ...newLeads];\n    await writeCollection(LEADS_COLLECTION, allLeads);\n    \n    for (const lead of newLeads) {\n      if (lead.phone && !lead.autoReplySent) {\n        console.log(`[FB Service] Triggering auto-reply for new lead: ${lead.id}`);\n        const autoReplyLead: leadAutoReply.Lead = {\n          id: lead.id,\n          formId: lead.formId,\n          formName: lead.formName,\n          fullName: lead.name,\n          email: lead.email,\n          phoneNumber: lead.phone,\n          fieldData: lead.fieldData,\n          createdTime: lead.createdTime,\n          autoReplySent: lead.autoReplySent,\n        };\n        leadAutoReply.processNewLead(autoReplyLead).then(async result => {\n          if (result.success) {\n            const currentLeads = await readCollection<Lead>(LEADS_COLLECTION);\n            const idx = currentLeads.findIndex(l => l.id === lead.id);\n            if (idx !== -1) {\n              currentLeads[idx].autoReplySent = true;\n              currentLeads[idx].autoReplyMessage = result.message;\n              currentLeads[idx].autoReplySentAt = new Date().toISOString();\n              await writeCollection(LEADS_COLLECTION, currentLeads);\n              console.log(`[FB Service] Auto-reply status saved for lead ${lead.id}`);\n            }\n          }\n        }).catch(err => {\n          console.error(`[FB Service] Auto-reply failed for lead ${lead.id}:`, err);\n        });\n      }\n    }\n    \n    return newLeads;\n  } catch (error) {\n    console.error('Error syncing leads:', error);\n    throw error;\n  }\n}\n\nexport async function getAllLeads(): Promise<Lead[]> {\n  return readCollection<Lead>(LEADS_COLLECTION);\n}\n\nexport async function getLeadsByFormId(formId: string): Promise<Lead[]> {\n  const leads = await readCollection<Lead>(LEADS_COLLECTION);\n  return leads.filter(lead => lead.formId === formId);\n}\n\nexport async function getLeadById(id: string): Promise<Lead | null> {\n  return findById<Lead>(LEADS_COLLECTION, id);\n}\n","path":null,"size_bytes":10083,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/templates.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Image, FileText, Video, MapPin } from \"lucide-react\";\n\nconst templates = [\n  {\n    id: 1,\n    name: \"welcome_message\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Marketing\",\n    type: \"text\",\n    preview: \"Hi {{1}}, welcome to our store! We're excited to have you here. Check out our latest collection here: {{2}}\",\n  },\n  {\n    id: 2,\n    name: \"order_confirmation\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Hello {{1}}, your order #{{2}} has been confirmed and will be shipped soon.\",\n  },\n  {\n    id: 3,\n    name: \"promo_image_header\",\n    language: \"es_ES\",\n    status: \"Pending\",\n    category: \"Marketing\",\n    type: \"image\",\n    preview: \"Hola {{1}}, tenemos una oferta especial para ti! 20% de descuento en tu prxima compra.\",\n  },\n  {\n    id: 4,\n    name: \"shipping_update\",\n    language: \"en_US\",\n    status: \"Rejected\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Your package is on the way! Track it here: {{1}}\",\n  },\n  {\n    id: 5,\n    name: \"appointment_reminder\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Hi {{1}}, just a reminder for your appointment tomorrow at {{2}}.\",\n  }\n];\n\nexport default function Templates() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Message Templates</h2>\n            <p className=\"text-muted-foreground\">Create and manage WhatsApp message templates.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Template\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {templates.map((template) => (\n            <Card key={template.id} className=\"flex flex-col\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                   <div className=\"flex items-center gap-2\">\n                      {template.type === 'image' ? <Image className=\"h-4 w-4 text-muted-foreground\" /> : \n                       template.type === 'video' ? <Video className=\"h-4 w-4 text-muted-foreground\" /> :\n                       template.type === 'location' ? <MapPin className=\"h-4 w-4 text-muted-foreground\" /> :\n                       <FileText className=\"h-4 w-4 text-muted-foreground\" />}\n                      <CardTitle className=\"text-base font-medium truncate\">{template.name}</CardTitle>\n                   </div>\n                   <Badge variant={\n                     template.status === 'Approved' ? 'default' : \n                     template.status === 'Pending' ? 'secondary' : 'destructive'\n                   } className={template.status === 'Approved' ? 'bg-green-500 hover:bg-green-600' : ''}>\n                     {template.status}\n                   </Badge>\n                </div>\n                <div className=\"flex gap-2 mt-2\">\n                  <Badge variant=\"outline\" className=\"text-xs font-normal\">{template.language}</Badge>\n                  <Badge variant=\"outline\" className=\"text-xs font-normal\">{template.category}</Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"flex-1\">\n                <div className=\"bg-muted/30 p-3 rounded-md text-sm text-muted-foreground border border-border h-full\">\n                  {template.preview}\n                </div>\n              </CardContent>\n              <CardFooter className=\"border-t pt-4\">\n                 <Button variant=\"ghost\" size=\"sm\" className=\"w-full\">Edit Template</Button>\n              </CardFooter>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4156,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Bell, Lock, User, Smartphone, Globe, CreditCard, Facebook } from \"lucide-react\";\n\nexport default function Settings() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Settings</h2>\n          <p className=\"text-muted-foreground\">Manage your account settings and preferences.</p>\n        </div>\n\n        <Tabs defaultValue=\"general\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"general\">General</TabsTrigger>\n            <TabsTrigger value=\"business\">Business Profile</TabsTrigger>\n            <TabsTrigger value=\"api\">API & Webhooks</TabsTrigger>\n            <TabsTrigger value=\"notifications\">Notifications</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"general\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Profile Information</CardTitle>\n                <CardDescription>Update your account profile details.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center gap-4\">\n                  <Avatar className=\"h-20 w-20\">\n                    <AvatarImage src=\"https://github.com/shadcn.png\" />\n                    <AvatarFallback>CN</AvatarFallback>\n                  </Avatar>\n                  <Button variant=\"outline\">Change Avatar</Button>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"name\">Display Name</Label>\n                  <Input id=\"name\" defaultValue=\"Acme Inc Admin\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input id=\"email\" defaultValue=\"admin@acme.com\" />\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button>Save Changes</Button>\n              </CardFooter>\n            </Card>\n            \n            <Card>\n              <CardHeader>\n                <CardTitle>Appearance</CardTitle>\n                <CardDescription>Customize how the dashboard looks on your device.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Dark Mode</Label>\n                    <p className=\"text-sm text-muted-foreground\">Enable dark mode for the dashboard.</p>\n                  </div>\n                  <Switch />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"business\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>WhatsApp Business Profile</CardTitle>\n                <CardDescription>This information will be visible to your customers on WhatsApp.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Business Name</Label>\n                  <Input defaultValue=\"Acme Corporation\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Description</Label>\n                  <Input defaultValue=\"We provide the best widgets in the world.\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Address</Label>\n                  <Input defaultValue=\"123 Widget St, Tech City\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Email</Label>\n                  <Input defaultValue=\"support@acme.com\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Website</Label>\n                  <Input defaultValue=\"https://acme.com\" />\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button>Update Profile</Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"api\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>API Credentials</CardTitle>\n                <CardDescription>Manage your API keys and authentication tokens.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Phone Number ID</Label>\n                  <div className=\"flex gap-2\">\n                    <Input value=\"10928374655\" readOnly className=\"font-mono bg-muted\" />\n                    <Button variant=\"outline\" size=\"icon\"><Lock className=\"h-4 w-4\" /></Button>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>WhatsApp Business Account ID</Label>\n                  <div className=\"flex gap-2\">\n                     <Input value=\"19283746556\" readOnly className=\"font-mono bg-muted\" />\n                     <Button variant=\"outline\" size=\"icon\"><Lock className=\"h-4 w-4\" /></Button>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Permanent Access Token</Label>\n                  <div className=\"flex gap-2\">\n                     <Input value=\"EAABw...\" type=\"password\" readOnly className=\"font-mono bg-muted\" />\n                     <Button variant=\"outline\">Regenerate</Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                 <CardTitle>Integrations</CardTitle>\n                 <CardDescription>Connect with other platforms.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                 <div className=\"flex items-center justify-between border p-4 rounded-lg\">\n                    <div className=\"flex items-center gap-4\">\n                       <div className=\"h-10 w-10 bg-blue-600 rounded-full flex items-center justify-center text-white\">\n                          <Facebook className=\"h-6 w-6\" />\n                       </div>\n                       <div>\n                          <h4 className=\"font-medium\">Facebook Leads</h4>\n                          <p className=\"text-sm text-muted-foreground\">Sync leads from Facebook & Instagram Ads.</p>\n                       </div>\n                    </div>\n                    <Button variant=\"outline\">Connect</Button>\n                 </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n               <CardHeader>\n                 <CardTitle>Webhooks</CardTitle>\n                 <CardDescription>Configure where we send real-time events.</CardDescription>\n               </CardHeader>\n               <CardContent>\n                 <div className=\"grid gap-2\">\n                   <Label>Callback URL</Label>\n                   <Input placeholder=\"https://your-domain.com/webhook\" />\n                 </div>\n                 <div className=\"grid gap-2 mt-4\">\n                   <Label>Verify Token</Label>\n                   <Input placeholder=\"random_string\" />\n                 </div>\n               </CardContent>\n               <CardFooter>\n                 <Button>Save Webhook</Button>\n               </CardFooter>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"notifications\" className=\"space-y-4\">\n             <Card>\n               <CardHeader>\n                 <CardTitle>Email Notifications</CardTitle>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 <div className=\"flex items-center justify-between\">\n                   <div className=\"space-y-0.5\">\n                     <Label>Weekly Reports</Label>\n                     <p className=\"text-sm text-muted-foreground\">Receive a summary of your activity every Monday.</p>\n                   </div>\n                   <Switch defaultChecked />\n                 </div>\n                 <div className=\"flex items-center justify-between\">\n                   <div className=\"space-y-0.5\">\n                     <Label>System Alerts</Label>\n                     <p className=\"text-sm text-muted-foreground\">Get notified about API errors or downtime.</p>\n                   </div>\n                   <Switch defaultChecked />\n                 </div>\n               </CardContent>\n             </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9299,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/templates/ManageTemplates.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function ManageTemplates() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">Manage Templates</h2>\n        <Card>\n          <CardHeader>\n             <CardTitle>Edit & Delete</CardTitle>\n          </CardHeader>\n          <CardContent>\n             <p className=\"text-muted-foreground\">Manage your existing templates. Note that editing an approved template will require re-approval.</p>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":766,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { connectToMongoDB } from \"./modules/storage/mongodb.adapter\";\nimport { ensureDefaultAdmin } from \"./modules/auth/auth.service\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await connectToMongoDB();\n  await ensureDefaultAdmin();\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2754,"size_tokens":null},"client/src/pages/settings/ProfileDetails.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { useAuth, getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\nimport { User, Shield, ShieldCheck, UserCog, Crown, Mail, AtSign, Loader2 } from \"lucide-react\";\n\nconst ROLE_CONFIG: Record<string, { label: string; color: string; icon: React.ReactNode }> = {\n  super_admin: { \n    label: \"Super Admin\", \n    color: \"bg-red-100 text-red-800 border-red-200\",\n    icon: <Crown className=\"h-3 w-3\" />\n  },\n  sub_admin: { \n    label: \"Sub Admin\", \n    color: \"bg-purple-100 text-purple-800 border-purple-200\",\n    icon: <ShieldCheck className=\"h-3 w-3\" />\n  },\n  manager: { \n    label: \"Manager\", \n    color: \"bg-blue-100 text-blue-800 border-blue-200\",\n    icon: <UserCog className=\"h-3 w-3\" />\n  },\n  user: { \n    label: \"User\", \n    color: \"bg-gray-100 text-gray-800 border-gray-200\",\n    icon: <User className=\"h-3 w-3\" />\n  },\n  admin: {\n    label: \"Admin\",\n    color: \"bg-emerald-100 text-emerald-800 border-emerald-200\",\n    icon: <Shield className=\"h-3 w-3\" />\n  }\n};\n\nfunction getInitials(name: string): string {\n  return name\n    .split(\" \")\n    .map(word => word[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n}\n\nexport default function ProfileDetails() {\n  const { user, checkAuth } = useAuth();\n  const [timezone, setTimezone] = useState(\"utc\");\n  \n  const [formData, setFormData] = useState({\n    name: user?.name || \"\",\n    email: user?.email || \"\",\n    phone: \"\"\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/auth/update-profile\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\", ...getAuthHeaders() },\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update profile\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      checkAuth();\n      toast.success(\"Profile updated successfully\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message);\n    }\n  });\n\n  const roleConfig = ROLE_CONFIG[user?.role || \"user\"] || ROLE_CONFIG.user;\n\n  if (!user) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Profile Details</h2>\n            <p className=\"text-muted-foreground\">View and update your account information.</p>\n          </div>\n          <Badge className={`${roleConfig.color} flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium`}>\n            {roleConfig.icon}\n            {roleConfig.label}\n          </Badge>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Account Information</CardTitle>\n              <CardDescription>Your login and role details.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-20 w-20 border-2 border-primary/20\">\n                  <AvatarFallback className=\"bg-primary/10 text-primary text-xl font-semibold\">\n                    {getInitials(user.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"space-y-1\">\n                  <h3 className=\"text-xl font-semibold\">{user.name}</h3>\n                  <Badge variant=\"outline\" className={`${roleConfig.color} flex items-center gap-1 w-fit`}>\n                    {roleConfig.icon}\n                    {roleConfig.label}\n                  </Badge>\n                </div>\n              </div>\n\n              <div className=\"space-y-4 pt-2\">\n                <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\n                  <AtSign className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">Username</p>\n                    <p className=\"font-medium\">{user.username}</p>\n                  </div>\n                </div>\n\n                {user.email && (\n                  <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\n                    <Mail className=\"h-5 w-5 text-muted-foreground\" />\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Email Address</p>\n                      <p className=\"font-medium\">{user.email}</p>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\n                  <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">User ID</p>\n                    <p className=\"font-mono text-sm\">{user.id}</p>\n                  </div>\n                </div>\n\n                {user.pageAccess && user.pageAccess.length > 0 && (\n                  <div className=\"p-3 rounded-lg bg-muted/50\">\n                    <p className=\"text-xs text-muted-foreground mb-2\">Page Access</p>\n                    <div className=\"flex flex-wrap gap-1.5\">\n                      {user.pageAccess.map(page => (\n                        <Badge key={page} variant=\"secondary\" className=\"text-xs capitalize\">\n                          {page.replace(/_/g, \" \")}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Edit Profile</CardTitle>\n              <CardDescription>Update your personal information.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"name\">Full Name</Label>\n                <Input \n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Enter your full name\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input \n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"Enter your email\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"phone\">Phone Number</Label>\n                <Input \n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"Enter your phone number\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Timezone</Label>\n                <Select value={timezone} onValueChange={setTimezone}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"utc\">UTC (GMT+0)</SelectItem>\n                    <SelectItem value=\"ist\">IST (GMT+5:30)</SelectItem>\n                    <SelectItem value=\"est\">EST (GMT-5)</SelectItem>\n                    <SelectItem value=\"pst\">PST (GMT-8)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={() => updateProfileMutation.mutate(formData)}\n                disabled={updateProfileMutation.isPending}\n              >\n                {updateProfileMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                Update Profile\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9078,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"WhatsappBusinessDashboard/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/WhatsAppNumber.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { CheckCircle2, AlertCircle, Phone } from \"lucide-react\";\n\nexport default function WhatsAppNumber() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">WhatsApp Number Settings</h2>\n          <p className=\"text-muted-foreground\">Manage your connected phone numbers.</p>\n        </div>\n\n        <Card className=\"border-l-4 border-l-green-500\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Phone className=\"h-5 w-5\" />\n                  +1 (555) 123-4567\n                </CardTitle>\n                <CardDescription>Default Sending Number</CardDescription>\n              </div>\n              <Badge className=\"bg-green-500 hover:bg-green-600\">Active</Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-2\">\n               <div className=\"flex justify-between text-sm\">\n                 <span className=\"text-muted-foreground\">Quality Rating</span>\n                 <span className=\"font-medium text-green-600\">High</span>\n               </div>\n               <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\n                 <div className=\"h-full bg-green-500 w-full\"></div>\n               </div>\n            </div>\n            <div className=\"grid gap-2\">\n               <div className=\"flex justify-between text-sm\">\n                 <span className=\"text-muted-foreground\">Messaging Limit</span>\n                 <span className=\"font-medium\">1,000 conversations / 24h</span>\n               </div>\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" size=\"sm\">Verify</Button>\n            <Button variant=\"destructive\" size=\"sm\">Disconnect</Button>\n          </CardFooter>\n        </Card>\n\n        <Card>\n           <CardHeader>\n             <CardTitle>Add New Number</CardTitle>\n             <CardDescription>Connect another WhatsApp Business number.</CardDescription>\n           </CardHeader>\n           <CardContent className=\"space-y-4\">\n             <div className=\"grid gap-2\">\n               <Label>Phone Number</Label>\n               <Input placeholder=\"+1 (555) 000-0000\" />\n             </div>\n             <Button>Send Verification Code</Button>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3092,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/AgentPerformance.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\n\nconst agents = [\n  { id: 1, name: \"Sarah Miller\", chats: 145, avgResponse: \"2m 30s\", resolved: \"98%\", rating: 4.9, avatar: \"SM\" },\n  { id: 2, name: \"John Doe\", chats: 132, avgResponse: \"3m 15s\", resolved: \"95%\", rating: 4.7, avatar: \"JD\" },\n  { id: 3, name: \"Emily Chen\", chats: 98, avgResponse: \"1m 45s\", resolved: \"92%\", rating: 4.8, avatar: \"EC\" },\n  { id: 4, name: \"Michael Scott\", chats: 80, avgResponse: \"5m 00s\", resolved: \"85%\", rating: 4.2, avatar: \"MS\" },\n];\n\nexport default function AgentPerformance() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Agent Performance</h2>\n          <p className=\"text-muted-foreground\">Track team productivity and customer satisfaction.</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Avg Response Time</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">3m 12s</div>\n               <p className=\"text-xs text-muted-foreground text-green-600\">-15s vs last week</p>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Resolution Rate</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">94.2%</div>\n               <p className=\"text-xs text-muted-foreground text-green-600\">+1.2% vs last week</p>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Chats Closed</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">455</div>\n             </CardContent>\n           </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Agent Leaderboard</CardTitle>\n             <CardDescription>Top performing agents this week.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Agent</TableHead>\n                  <TableHead>Chats Handled</TableHead>\n                  <TableHead>Avg Response</TableHead>\n                  <TableHead>Resolution Rate</TableHead>\n                  <TableHead>CSAT Score</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {agents.map((agent) => (\n                  <TableRow key={agent.id}>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar>\n                          <AvatarFallback>{agent.avatar}</AvatarFallback>\n                        </Avatar>\n                        {agent.name}\n                      </div>\n                    </TableCell>\n                    <TableCell>{agent.chats}</TableCell>\n                    <TableCell>{agent.avgResponse}</TableCell>\n                    <TableCell>\n                       <div className=\"flex items-center gap-2\">\n                         <Progress value={parseInt(agent.resolved)} className=\"w-[60px] h-2\" />\n                         <span className=\"text-xs text-muted-foreground\">{agent.resolved}</span>\n                       </div>\n                    </TableCell>\n                    <TableCell>\n                       <div className=\"flex items-center gap-1 font-medium\">\n                         <span className=\"text-yellow-500\"></span> {agent.rating}\n                       </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4519,"size_tokens":null},"client/src/pages/reports/Spending.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, DollarSign, TrendingUp, Calendar } from \"lucide-react\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface DailySpending {\n  date: string;\n  fullDate: string;\n  marketing: number;\n  utility: number;\n  service: number;\n  total: number;\n}\n\ninterface SpendingData {\n  dailySpending: DailySpending[];\n  summary: {\n    totalSpend: number;\n    avgDailySpend: number;\n    projectedMonthly: number;\n    totalMarketing: number;\n    totalUtility: number;\n    totalService: number;\n    marketingRate: number;\n    utilityRate: number;\n    serviceRate: number;\n  };\n  period: string;\n}\n\nexport default function Spending() {\n  const [period, setPeriod] = useState(\"week\");\n\n  const { data, isLoading, error } = useQuery<SpendingData>({\n    queryKey: [\"/api/reports/spending\", period],\n    queryFn: async () => {\n      const res = await fetchWithAuth(`/api/reports/spending?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch spending data\");\n      return res.json();\n    },\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n              <DollarSign className=\"h-8 w-8 text-green-600\" />\n              WhatsApp Spending\n            </h2>\n            <p className=\"text-muted-foreground\">Track your daily expenditure on WhatsApp conversations.</p>\n          </div>\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-[150px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Today</SelectItem>\n              <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n              <SelectItem value=\"week\">Last 7 Days</SelectItem>\n              <SelectItem value=\"month\">Last 30 Days</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : error ? (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">Failed to load spending data</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <DollarSign className=\"h-4 w-4\" />\n                    Total Spend\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.totalSpend?.toFixed(2) || '0.00'}</div>\n                  <p className=\"text-xs text-muted-foreground\">This {period}</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Calendar className=\"h-4 w-4\" />\n                    Avg Daily Spend\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.avgDailySpend?.toFixed(2) || '0.00'}</div>\n                  <p className=\"text-xs text-muted-foreground\">Per day average</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <TrendingUp className=\"h-4 w-4\" />\n                    Projected Monthly\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.projectedMonthly?.toFixed(2) || '0.00'}</div>\n                  <p className=\"text-xs text-muted-foreground\">Based on current usage</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Cost Breakdown by Category</CardTitle>\n                <CardDescription>Daily spend split by conversation type (Marketing, Utility, Service).</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {data?.dailySpending && data.dailySpending.length > 0 ? (\n                  <div className=\"h-[400px] w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={data.dailySpending} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                        <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n                        <Tooltip \n                          contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                          formatter={(value: number) => [`$${value.toFixed(2)}`, \"\"]}\n                        />\n                        <Legend />\n                        <Bar dataKey=\"marketing\" name=\"Marketing\" stackId=\"a\" fill=\"hsl(var(--primary))\" radius={[0, 0, 4, 4]} />\n                        <Bar dataKey=\"utility\" name=\"Utility\" stackId=\"a\" fill=\"hsl(var(--chart-2))\" />\n                        <Bar dataKey=\"service\" name=\"Service\" stackId=\"a\" fill=\"hsl(var(--chart-3))\" radius={[4, 4, 0, 0]} />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <DollarSign className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No spending data available for this period.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center justify-between\">\n                    Marketing Conversations\n                    <Badge variant=\"outline\" className=\"bg-primary/10\">${data?.summary.totalMarketing?.toFixed(2) || '0.00'}</Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.marketingRate?.toFixed(2) || '0.08'} <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Promotions, offers, updates</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center justify-between\">\n                    Utility Conversations\n                    <Badge variant=\"outline\" className=\"bg-blue-500/10 text-blue-600\">${data?.summary.totalUtility?.toFixed(2) || '0.00'}</Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.utilityRate?.toFixed(2) || '0.05'} <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Transaction updates, post-purchase</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center justify-between\">\n                    Service Conversations\n                    <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-600\">${data?.summary.totalService?.toFixed(2) || '0.00'}</Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">${data?.summary.serviceRate?.toFixed(2) || '0.03'} <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">User-initiated support inquiries</p>\n                </CardContent>\n              </Card>\n            </div>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9441,"size_tokens":null},"server/modules/mapping/mapping.service.ts":{"content":"import { readCollection, addItem, updateItem, deleteItem, findById } from '../storage';\n\nexport interface AgentFormMapping {\n  id: string;\n  formId: string;\n  formName: string;\n  agentId: string;\n  agentName: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst COLLECTION = 'mapping';\n\nfunction generateId(): string {\n  return `map-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport async function getAllMappings(): Promise<AgentFormMapping[]> {\n  return readCollection<AgentFormMapping>(COLLECTION);\n}\n\nexport async function getMappingById(id: string): Promise<AgentFormMapping | null> {\n  return findById<AgentFormMapping>(COLLECTION, id);\n}\n\nexport async function getMappingByFormId(formId: string): Promise<AgentFormMapping | null> {\n  const mappings = await readCollection<AgentFormMapping>(COLLECTION);\n  return mappings.find(m => m.formId === formId && m.isActive) || null;\n}\n\nexport async function getMappingByAgentId(agentId: string): Promise<AgentFormMapping[]> {\n  const mappings = await readCollection<AgentFormMapping>(COLLECTION);\n  return mappings.filter(m => m.agentId === agentId);\n}\n\nexport async function createMapping(data: Omit<AgentFormMapping, 'id' | 'createdAt' | 'updatedAt'>): Promise<AgentFormMapping> {\n  const existingMappings = await readCollection<AgentFormMapping>(COLLECTION);\n  const existingForForm = existingMappings.find(m => m.formId === data.formId);\n  \n  if (existingForForm) {\n    const updated = await updateMapping(existingForForm.id, {\n      agentId: data.agentId,\n      agentName: data.agentName,\n      isActive: data.isActive,\n    });\n    return updated!;\n  }\n\n  const now = new Date().toISOString();\n  const mapping: AgentFormMapping = {\n    id: generateId(),\n    ...data,\n    createdAt: now,\n    updatedAt: now,\n  };\n  return addItem<AgentFormMapping>(COLLECTION, mapping);\n}\n\nexport async function updateMapping(id: string, data: Partial<Omit<AgentFormMapping, 'id' | 'createdAt'>>): Promise<AgentFormMapping | null> {\n  return updateItem<AgentFormMapping>(COLLECTION, id, {\n    ...data,\n    updatedAt: new Date().toISOString(),\n  });\n}\n\nexport async function deleteMapping(id: string): Promise<boolean> {\n  return deleteItem<AgentFormMapping>(COLLECTION, id);\n}\n","path":null,"size_bytes":2258,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/ai/ManageAgents.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Bot, Trash2, Edit } from \"lucide-react\";\n\nexport default function ManageAgents() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">Manage AI Agents</h2>\n        <Card>\n          <CardHeader>\n             <CardTitle>Active Agents</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Model</TableHead>\n                  <TableHead>Conversations</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium flex items-center gap-2\">\n                    <Bot className=\"h-4 w-4 text-primary\" />\n                    Support Bot Level 1\n                  </TableCell>\n                  <TableCell>GPT-4o</TableCell>\n                  <TableCell>1,234</TableCell>\n                  <TableCell><span className=\"text-green-600 font-medium\">Active</span></TableCell>\n                  <TableCell className=\"text-right space-x-2\">\n                    <Button variant=\"ghost\" size=\"icon\"><Edit className=\"h-4 w-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\"><Trash2 className=\"h-4 w-4\" /></Button>\n                  </TableCell>\n                </TableRow>\n                <TableRow>\n                  <TableCell className=\"font-medium flex items-center gap-2\">\n                    <Bot className=\"h-4 w-4 text-primary\" />\n                    Sales Assistant\n                  </TableCell>\n                  <TableCell>GPT-3.5-Turbo</TableCell>\n                  <TableCell>543</TableCell>\n                  <TableCell><span className=\"text-gray-500 font-medium\">Paused</span></TableCell>\n                  <TableCell className=\"text-right space-x-2\">\n                    <Button variant=\"ghost\" size=\"icon\"><Edit className=\"h-4 w-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\"><Trash2 className=\"h-4 w-4\" /></Button>\n                  </TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2834,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/Credits.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Download, Coins } from \"lucide-react\";\n\nconst transactions = [\n  { id: 1, date: \"Nov 27, 2025\", type: \"Recharge\", amount: \"+$50.00\", balance: \"$74.50\", status: \"Success\" },\n  { id: 2, date: \"Nov 26, 2025\", type: \"Usage - Marketing\", amount: \"-$12.40\", balance: \"$24.50\", status: \"Success\" },\n  { id: 3, date: \"Nov 25, 2025\", type: \"Usage - Utility\", amount: \"-$5.20\", balance: \"$36.90\", status: \"Success\" },\n  { id: 4, date: \"Nov 20, 2025\", type: \"Recharge\", amount: \"+$20.00\", balance: \"$42.10\", status: \"Success\" },\n  { id: 5, date: \"Nov 15, 2025\", type: \"Monthly Subscription\", amount: \"-$29.00\", balance: \"$22.10\", status: \"Success\" },\n];\n\nexport default function Credits() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Credits & Transactions</h2>\n            <p className=\"text-muted-foreground\">Monitor your wallet balance and usage history.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Credits\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n           <Card className=\"bg-primary text-primary-foreground\">\n              <CardHeader>\n                 <CardTitle className=\"flex items-center gap-2\">\n                   <Coins className=\"h-5 w-5\" />\n                   Current Balance\n                 </CardTitle>\n              </CardHeader>\n              <CardContent>\n                 <div className=\"text-5xl font-bold\">$74.50</div>\n                 <p className=\"text-primary-foreground/80 mt-2\">Auto-recharge disabled</p>\n              </CardContent>\n           </Card>\n           \n           <Card>\n              <CardHeader>\n                 <CardTitle>Low Balance Alert</CardTitle>\n                 <CardDescription>Get notified when your credits fall below a threshold.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                 <div className=\"text-sm text-muted-foreground mb-4\">\n                   Current threshold: <span className=\"font-bold text-foreground\">$10.00</span>\n                 </div>\n                 <Button variant=\"outline\" size=\"sm\">Configure Alert</Button>\n              </CardContent>\n           </Card>\n        </div>\n\n        <Card>\n           <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                 <CardTitle>Transaction History</CardTitle>\n                 <Button variant=\"ghost\" size=\"sm\">\n                   <Download className=\"mr-2 h-4 w-4\" /> Export\n                 </Button>\n              </div>\n           </CardHeader>\n           <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Balance</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {transactions.map((tx) => (\n                    <TableRow key={tx.id}>\n                      <TableCell>{tx.date}</TableCell>\n                      <TableCell>{tx.type}</TableCell>\n                      <TableCell className={tx.amount.startsWith('+') ? 'text-green-600 font-medium' : ''}>\n                        {tx.amount}\n                      </TableCell>\n                      <TableCell>{tx.balance}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"bg-green-50 text-green-700 border-green-200\">\n                          {tx.status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4452,"size_tokens":null},"server/modules/storage/index.ts":{"content":"import * as mongodb from './mongodb.adapter';\n\nexport async function readCollection<T>(collection: string): Promise<T[]> {\n  return mongodb.readCollection<T>(collection);\n}\n\nexport async function writeCollection<T>(collection: string, data: T[]): Promise<void> {\n  return mongodb.writeCollection<T>(collection, data);\n}\n\nexport async function addItem<T extends { id: string }>(collection: string, item: T): Promise<T> {\n  const result = await mongodb.insertOne<T>(collection, item);\n  return result || item;\n}\n\nexport async function updateItem<T extends { id: string }>(collection: string, id: string, updates: Partial<T>): Promise<T | null> {\n  return mongodb.updateOne<T>(collection, { id }, updates);\n}\n\nexport async function deleteItem<T extends { id: string }>(collection: string, id: string): Promise<boolean> {\n  return mongodb.deleteOne(collection, { id });\n}\n\nexport async function findById<T extends { id: string }>(collection: string, id: string): Promise<T | null> {\n  return mongodb.findOne<T>(collection, { id });\n}\n\nexport async function findByField<T>(collection: string, field: keyof T, value: any): Promise<T | null> {\n  return mongodb.findOne<T>(collection, { [field]: value });\n}\n\nexport async function updateManyItems(collection: string, query: Record<string, any>, updates: Record<string, any>): Promise<number> {\n  return mongodb.updateMany(collection, query, updates);\n}\n\nexport { connectToMongoDB } from './mongodb.adapter';\n","path":null,"size_bytes":1450,"size_tokens":null},"server/modules/leadAutoReply/leadAutoReply.controller.ts":{"content":"import { Request, Response } from 'express';\nimport * as leadAutoReplyService from './leadAutoReply.service';\n\nexport async function processAllLeads(req: Request, res: Response) {\n  try {\n    const result = await leadAutoReplyService.processAllPendingLeads();\n    res.json({\n      message: 'Lead processing completed',\n      ...result\n    });\n  } catch (error) {\n    console.error('Error processing leads:', error);\n    res.status(500).json({ \n      error: error instanceof Error ? error.message : 'Failed to process leads' \n    });\n  }\n}\n\nexport async function processLead(req: Request, res: Response) {\n  try {\n    const lead = req.body;\n    \n    if (!lead || !lead.id) {\n      return res.status(400).json({ error: 'Lead data is required' });\n    }\n\n    const result = await leadAutoReplyService.processNewLead(lead);\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        message: result.message\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        error: result.error\n      });\n    }\n  } catch (error) {\n    console.error('Error processing lead:', error);\n    res.status(500).json({ \n      error: error instanceof Error ? error.message : 'Failed to process lead' \n    });\n  }\n}\n\nexport async function sendReply(req: Request, res: Response) {\n  try {\n    const { leadId } = req.params;\n    const { message } = req.body;\n\n    if (!message) {\n      return res.status(400).json({ error: 'Message is required' });\n    }\n\n    const result = await leadAutoReplyService.sendManualReply(leadId, message);\n    \n    if (result.success) {\n      res.json({ success: true, message: 'Reply sent successfully' });\n    } else {\n      res.status(400).json({ success: false, error: result.error });\n    }\n  } catch (error) {\n    console.error('Error sending reply:', error);\n    res.status(500).json({ \n      error: error instanceof Error ? error.message : 'Failed to send reply' \n    });\n  }\n}\n","path":null,"size_bytes":1935,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns/Report.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { StatsCard } from \"@/components/ui/stats-card\";\nimport { CheckCircle2, Eye, MousePointerClick, AlertCircle } from \"lucide-react\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  Legend\n} from \"recharts\";\n\nconst deliveryData = [\n  { name: 'Delivered', value: 850, color: '#22c55e' },\n  { name: 'Read', value: 600, color: '#3b82f6' },\n  { name: 'Failed', value: 50, color: '#ef4444' },\n];\n\nconst dailyStats = [\n  { name: 'Mon', sent: 4000, read: 2400 },\n  { name: 'Tue', sent: 3000, read: 1398 },\n  { name: 'Wed', sent: 2000, read: 9800 },\n  { name: 'Thu', sent: 2780, read: 3908 },\n  { name: 'Fri', sent: 1890, read: 4800 },\n  { name: 'Sat', sent: 2390, read: 3800 },\n  { name: 'Sun', sent: 3490, read: 4300 },\n];\n\nexport default function Report() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Campaign Reports</h2>\n          <p className=\"text-muted-foreground\">Detailed insights into message delivery and engagement.</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <StatsCard \n             title=\"Sent\" \n             value=\"15,230\" \n             icon={CheckCircle2}\n             trend={{ value: 12, label: \"vs last month\" }}\n          />\n          <StatsCard \n             title=\"Delivered\" \n             value=\"98.5%\" \n             icon={CheckCircle2}\n             className=\"text-green-600\"\n          />\n          <StatsCard \n             title=\"Read Rate\" \n             value=\"64.2%\" \n             icon={Eye}\n             className=\"text-blue-600\"\n          />\n          <StatsCard \n             title=\"Failed\" \n             value=\"1.5%\" \n             icon={AlertCircle}\n             className=\"text-red-600\"\n          />\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Delivery Status</CardTitle>\n              <CardDescription>Overall breakdown of message statuses.</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[300px] flex items-center justify-center\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <PieChart>\n                    <Pie\n                      data={deliveryData}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={60}\n                      outerRadius={80}\n                      paddingAngle={5}\n                      dataKey=\"value\"\n                    >\n                      {deliveryData.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip />\n                    <Legend />\n                  </PieChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Daily Engagement</CardTitle>\n              <CardDescription>Messages sent vs read over the last 7 days.</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[300px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={dailyStats}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <XAxis dataKey=\"name\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                    <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                    />\n                    <Legend />\n                    <Bar dataKey=\"sent\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                    <Bar dataKey=\"read\" fill=\"hsl(var(--chart-2))\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4585,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/WebhookAPI.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle2, Copy, RefreshCw, Activity, Link as LinkIcon, Plus } from \"lucide-react\";\n\nexport default function WebhookAPI() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Webhook & API</h2>\n          <p className=\"text-muted-foreground\">Manage your API keys and webhook configurations.</p>\n        </div>\n\n        <Tabs defaultValue=\"api\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"api\">API Keys</TabsTrigger>\n            <TabsTrigger value=\"whatsapp\">WhatsApp API</TabsTrigger>\n            <TabsTrigger value=\"webhook\">Webhooks</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"api\" className=\"space-y-4\">\n             <Card>\n               <CardHeader>\n                 <CardTitle>API Keys</CardTitle>\n                 <CardDescription>Use these keys to authenticate requests to our API.</CardDescription>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 <div className=\"p-4 bg-muted/50 rounded-lg border space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                       <div className=\"font-medium\">Production Key</div>\n                       <Badge variant=\"outline\">Active</Badge>\n                    </div>\n                    <div className=\"flex gap-2\">\n                       <Input value=\"sk_live_51Mz...\" readOnly className=\"font-mono bg-background\" />\n                       <Button variant=\"outline\" size=\"icon\"><Copy className=\"h-4 w-4\" /></Button>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">Created on Nov 27, 2025</div>\n                 </div>\n                 <Button variant=\"outline\">\n                   <Plus className=\"mr-2 h-4 w-4\" /> Generate New Key\n                 </Button>\n               </CardContent>\n             </Card>\n          </TabsContent>\n\n          <TabsContent value=\"whatsapp\" className=\"space-y-4\">\n            <Card className=\"border-primary/20 bg-primary/5\">\n               <CardHeader>\n                 <div className=\"flex items-center gap-2\">\n                   <div className=\"h-8 w-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground\">\n                     <LinkIcon className=\"h-4 w-4\" />\n                   </div>\n                   <div>\n                     <CardTitle>Connect WhatsApp Business API</CardTitle>\n                     <CardDescription>Enter your Meta Developer credentials.</CardDescription>\n                   </div>\n                 </div>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 <div className=\"grid gap-2\">\n                   <Label>App ID</Label>\n                   <Input placeholder=\"Enter Meta App ID\" />\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>App Secret / Token</Label>\n                   <Input type=\"password\" placeholder=\"Enter Access Token\" />\n                 </div>\n                 <div className=\"grid md:grid-cols-2 gap-4\">\n                   <div className=\"grid gap-2\">\n                     <Label>Phone Number ID</Label>\n                     <Input placeholder=\"Phone Number ID\" />\n                   </div>\n                   <div className=\"grid gap-2\">\n                     <Label>Business Account ID</Label>\n                     <Input placeholder=\"WABA ID\" />\n                   </div>\n                 </div>\n               </CardContent>\n               <CardFooter className=\"flex justify-between bg-background/50 border-t p-6\">\n                  <Button variant=\"ghost\">Refresh Status</Button>\n                  <div className=\"flex gap-2\">\n                    <Button variant=\"outline\">Test Connection</Button>\n                    <Button>Save Connection</Button>\n                  </div>\n               </CardFooter>\n            </Card>\n            \n            <Alert>\n              <CheckCircle2 className=\"h-4 w-4\" />\n              <AlertTitle>API Status</AlertTitle>\n              <AlertDescription>\n                API connection is currently using Replit-hosted dummy endpoints. Switch to your own credentials above for production.\n              </AlertDescription>\n            </Alert>\n          </TabsContent>\n\n          <TabsContent value=\"webhook\" className=\"space-y-4\">\n            <Card>\n               <CardHeader>\n                 <CardTitle>Webhook Configuration</CardTitle>\n                 <CardDescription>Receive real-time updates for message status.</CardDescription>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 <div className=\"grid gap-2\">\n                   <Label>Callback URL</Label>\n                   <Input defaultValue=\"https://api.yourdomain.com/webhook/whatsapp\" />\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Verify Token</Label>\n                   <Input defaultValue=\"random_secure_token_123\" />\n                 </div>\n                 <div className=\"flex items-center gap-2 mt-2\">\n                    <Button variant=\"secondary\" size=\"sm\">\n                      <Activity className=\"mr-2 h-4 w-4\" />\n                      Test Connectivity\n                    </Button>\n                 </div>\n               </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader>\n                <CardTitle>Recent Events</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between text-sm p-2 hover:bg-muted rounded-md\">\n                     <div className=\"flex items-center gap-2\">\n                       <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">200 OK</Badge>\n                       <span>message.delivered</span>\n                     </div>\n                     <span className=\"text-muted-foreground\">Just now</span>\n                  </div>\n                  <div className=\"flex items-center justify-between text-sm p-2 hover:bg-muted rounded-md\">\n                     <div className=\"flex items-center gap-2\">\n                       <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">200 OK</Badge>\n                       <span>message.read</span>\n                     </div>\n                     <span className=\"text-muted-foreground\">2 mins ago</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7317,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/Spending.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\nimport { Badge } from \"@/components/ui/badge\";\n\nconst dailySpending = [\n  { date: 'Mon', marketing: 45, utility: 12, service: 5 },\n  { date: 'Tue', marketing: 30, utility: 15, service: 8 },\n  { date: 'Wed', marketing: 20, utility: 10, service: 4 },\n  { date: 'Thu', marketing: 50, utility: 18, service: 6 },\n  { date: 'Fri', marketing: 35, utility: 14, service: 9 },\n  { date: 'Sat', marketing: 60, utility: 20, service: 10 },\n  { date: 'Sun', marketing: 40, utility: 16, service: 7 },\n];\n\nexport default function Spending() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Daily WhatsApp Spending</h2>\n          <p className=\"text-muted-foreground\">Track your daily expenditure on WhatsApp conversations.</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Spend (7d)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">$414.00</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Avg Daily Spend</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">$59.14</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Projected Monthly</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">$1,800.00</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Cost Breakdown by Category</CardTitle>\n            <CardDescription>Daily spend split by conversation type (Marketing, Utility, Service).</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[400px] w-full\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={dailySpending} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                  <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                  <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n                  <Tooltip \n                    contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                    formatter={(value) => [`$${value}`, \"\"]}\n                  />\n                  <Legend />\n                  <Bar dataKey=\"marketing\" name=\"Marketing\" stackId=\"a\" fill=\"hsl(var(--primary))\" radius={[0, 0, 4, 4]} />\n                  <Bar dataKey=\"utility\" name=\"Utility\" stackId=\"a\" fill=\"hsl(var(--chart-2))\" />\n                  <Bar dataKey=\"service\" name=\"Service\" stackId=\"a\" fill=\"hsl(var(--chart-3))\" radius={[4, 4, 0, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n           <Card>\n             <CardHeader>\n                <CardTitle className=\"text-base\">Marketing Conversations</CardTitle>\n             </CardHeader>\n             <CardContent>\n                <div className=\"text-2xl font-bold\">$0.08 <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                <p className=\"text-xs text-muted-foreground mt-1\">Promotions, offers, updates</p>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader>\n                <CardTitle className=\"text-base\">Utility Conversations</CardTitle>\n             </CardHeader>\n             <CardContent>\n                <div className=\"text-2xl font-bold\">$0.05 <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                <p className=\"text-xs text-muted-foreground mt-1\">Transaction updates, post-purchase</p>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader>\n                <CardTitle className=\"text-base\">Service Conversations</CardTitle>\n             </CardHeader>\n             <CardContent>\n                <div className=\"text-2xl font-bold\">$0.03 <span className=\"text-sm font-normal text-muted-foreground\">/ conv</span></div>\n                <p className=\"text-xs text-muted-foreground mt-1\">User-initiated support inquiries</p>\n             </CardContent>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":5327,"size_tokens":null},"client/src/pages/campaigns/Single.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Send, Phone, User, Loader2, Bot, MessageSquare, FileText } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\nexport default function Single() {\n  const [phone, setPhone] = useState(\"\");\n  const [recipientName, setRecipientName] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [selectedTemplateId, setSelectedTemplateId] = useState(\"\");\n  const [selectedAgentId, setSelectedAgentId] = useState(\"\");\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai_agent\">(\"template\");\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  const approvedTemplates = templates.filter(t => t.status === \"approved\");\n  const activeAgents = agents.filter(a => a.isActive);\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/broadcast/send-single\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to send message\");\n      }\n      return res.json();\n    },\n    onSuccess: (result) => {\n      if (result.success) {\n        toast.success(\"Message sent successfully!\");\n        handleClearForm();\n      } else {\n        toast.error(result.error || \"Failed to send message\");\n      }\n    },\n    onError: (error: Error) => {\n      toast.error(error.message);\n    },\n  });\n\n  const handleTemplateSelect = (templateId: string) => {\n    setSelectedTemplateId(templateId);\n    const template = templates.find(t => t.id === templateId);\n    if (template) {\n      setMessage(template.content);\n    }\n  };\n\n  const handleClearForm = () => {\n    setPhone(\"\");\n    setRecipientName(\"\");\n    setMessage(\"\");\n    setSelectedTemplateId(\"\");\n    setSelectedAgentId(\"\");\n  };\n\n  const handleSendMessage = () => {\n    if (!phone.trim()) {\n      toast.error(\"Please enter a phone number\");\n      return;\n    }\n\n    if (messageType === \"template\" && !selectedTemplateId) {\n      toast.error(\"Please select a template\");\n      return;\n    }\n\n    if (messageType === \"custom\" && !message.trim()) {\n      toast.error(\"Please enter a message\");\n      return;\n    }\n\n    if (messageType === \"ai_agent\" && !selectedAgentId) {\n      toast.error(\"Please select an AI agent\");\n      return;\n    }\n\n    sendMessageMutation.mutate({\n      phone,\n      name: recipientName,\n      messageType,\n      templateName: messageType === \"template\" ? (templates.find(t => t.id === selectedTemplateId)?.name || \"hello_world\") : undefined,\n      customMessage: messageType === \"custom\" ? message : undefined,\n      agentId: messageType === \"ai_agent\" ? selectedAgentId : undefined,\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"mb-6\">\n            <h2 className=\"text-3xl font-bold tracking-tight\">Single Message</h2>\n            <p className=\"text-muted-foreground\">Quickly send a message to a specific number.</p>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Compose Message</CardTitle>\n              <CardDescription>Send a one-off message without creating a campaign.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-2\">\n                <Label>Phone Number *</Label>\n                <div className=\"relative\">\n                  <Phone className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input \n                    placeholder=\"+91 98765 43210\" \n                    className=\"pl-9\"\n                    value={phone}\n                    onChange={(e) => setPhone(e.target.value)}\n                  />\n                </div>\n              </div>\n              \n              <div className=\"grid gap-2\">\n                <Label>Recipient Name (Optional)</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input \n                    placeholder=\"John Doe\" \n                    className=\"pl-9\"\n                    value={recipientName}\n                    onChange={(e) => setRecipientName(e.target.value)}\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-4 pt-4\">\n                <Label>Message Type</Label>\n                <Tabs value={messageType} onValueChange={(v) => setMessageType(v as any)}>\n                  <TabsList className=\"w-full\">\n                    <TabsTrigger value=\"template\" className=\"flex-1\">\n                      <FileText className=\"mr-1 h-4 w-4\" />\n                      Template\n                    </TabsTrigger>\n                    <TabsTrigger value=\"custom\" className=\"flex-1\">\n                      <MessageSquare className=\"mr-1 h-4 w-4\" />\n                      Custom\n                    </TabsTrigger>\n                    <TabsTrigger value=\"ai_agent\" className=\"flex-1\">\n                      <Bot className=\"mr-1 h-4 w-4\" />\n                      AI Agent\n                    </TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"template\" className=\"space-y-4 mt-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Select Template</Label>\n                      <Select value={selectedTemplateId} onValueChange={handleTemplateSelect}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a template...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"hello_world\">hello_world (Default)</SelectItem>\n                          {approvedTemplates.map((template) => (\n                            <SelectItem key={template.id} value={template.id}>\n                              {template.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    {selectedTemplateId && selectedTemplateId !== \"hello_world\" && (\n                      <div className=\"p-3 bg-muted rounded-lg\">\n                        <p className=\"text-sm\">{message}</p>\n                      </div>\n                    )}\n                  </TabsContent>\n\n                  <TabsContent value=\"custom\" className=\"space-y-4 mt-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Message Text</Label>\n                      <Textarea \n                        placeholder=\"Type your message here...\" \n                        className=\"min-h-[150px]\"\n                        value={message}\n                        onChange={(e) => setMessage(e.target.value)}\n                      />\n                      <p className=\"text-xs text-muted-foreground\">\n                        Note: Custom messages require the recipient to have messaged you first (24-hour window rule).\n                      </p>\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"ai_agent\" className=\"space-y-4 mt-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Select AI Agent</Label>\n                      <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select an AI agent...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {activeAgents.length === 0 ? (\n                            <SelectItem value=\"\" disabled>No active agents available</SelectItem>\n                          ) : (\n                            activeAgents.map((agent) => (\n                              <SelectItem key={agent.id} value={agent.id}>\n                                {agent.name}\n                              </SelectItem>\n                            ))\n                          )}\n                        </SelectContent>\n                      </Select>\n                      {selectedAgentId && (\n                        <p className=\"text-sm text-muted-foreground\">\n                          The AI agent will generate a personalized welcome message.\n                        </p>\n                      )}\n                    </div>\n                  </TabsContent>\n                </Tabs>\n              </div>\n            </CardContent>\n            <CardFooter className=\"flex justify-between border-t pt-6\">\n              <Button variant=\"outline\" onClick={handleClearForm}>\n                Clear Form\n              </Button>\n              <Button \n                onClick={handleSendMessage}\n                disabled={sendMessageMutation.isPending || !phone.trim()}\n              >\n                {sendMessageMutation.isPending ? (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                ) : (\n                  <Send className=\"mr-2 h-4 w-4\" />\n                )}\n                Send Now\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":10674,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\nimport NotFound from \"@/pages/not-found\";\nimport Login from \"@/pages/Login\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Inbox from \"@/pages/inbox\";\nimport WindowInbox from \"@/pages/inbox/WindowInbox\";\nimport WhatsAppLeads from \"@/pages/inbox/WhatsAppLeads\";\nimport Campaigns from \"@/pages/campaigns\";\nimport Automation from \"@/pages/automation\";\nimport Contacts from \"@/pages/contacts\";\nimport Settings from \"@/pages/settings\";\nimport TeamMembers from \"@/pages/settings/TeamMembers\";\nimport Permissions from \"@/pages/settings/Permissions\";\nimport WhatsAppNumber from \"@/pages/settings/WhatsAppNumber\";\nimport ProfileDetails from \"@/pages/settings/ProfileDetails\";\nimport WebhookAPI from \"@/pages/settings/WebhookAPI\";\nimport Billing from \"@/pages/settings/Billing\";\n\nimport Templates from \"@/pages/templates\";\n\n// New Imports\nimport Broadcast from \"@/pages/campaigns/Broadcast\";\nimport SelectedContacts from \"@/pages/campaigns/SelectedContacts\";\nimport Schedule from \"@/pages/campaigns/Schedule\";\nimport Single from \"@/pages/campaigns/Single\";\nimport Report from \"@/pages/campaigns/Report\";\n\nimport AutoLeads from \"@/pages/automation/AutoLeads\";\nimport Keywords from \"@/pages/automation/Keywords\";\nimport FollowUp from \"@/pages/automation/FollowUp\";\nimport Drip from \"@/pages/automation/Drip\";\nimport NewLeads from \"@/pages/automation/NewLeads\";\n\nimport ConnectApps from \"@/pages/apps/ConnectApps\";\n\nimport AddTemplate from \"@/pages/templates/AddTemplate\";\nimport TemplateStatus from \"@/pages/templates/TemplateStatus\";\nimport ManageTemplates from \"@/pages/templates/ManageTemplates\";\n\nimport NewAgent from \"@/pages/ai/NewAgent\";\nimport ManageAgents from \"@/pages/ai/ManageAgents\";\nimport AgentsPage from \"@/pages/ai/AgentsPage\";\nimport MapAgent from \"@/pages/ai/MapAgent\";\nimport AgentReports from \"@/pages/ai/AgentReports\";\nimport PrefilledTextMappings from \"@/pages/ai/PrefilledTextMappings\";\n\nimport LeadForms from \"@/pages/facebook/LeadForms\";\nimport Leads from \"@/pages/facebook/Leads\";\n\nimport DeliveryReport from \"@/pages/reports/DeliveryReport\";\nimport CampaignPerformance from \"@/pages/reports/CampaignPerformance\";\nimport CustomerReplies from \"@/pages/reports/CustomerReplies\";\nimport AgentPerformance from \"@/pages/reports/AgentPerformance\";\nimport Spending from \"@/pages/reports/Spending\";\nimport Credits from \"@/pages/reports/Credits\";\nimport UserEngagement from \"@/pages/reports/UserEngagement\";\nimport BroadcastReports from \"@/pages/reports/BroadcastReports\";\nimport BlockedContacts from \"@/pages/reports/BlockedContacts\";\nimport ContactReports from \"@/pages/reports/ContactReports\";\nimport UserManagement from \"@/pages/UserManagement\";\nimport LeadAssignmentReports from \"@/pages/lead-assignment-reports\";\nimport UserActivityReports from \"@/pages/user-activity-reports\";\n\nfunction ProtectedRoute({ component: Component }: { component: React.ComponentType }) {\n  const { isAuthenticated } = useAuth();\n  if (!isAuthenticated) {\n    return <Redirect to=\"/login\" />;\n  }\n  return <Component />;\n}\n\nfunction Router() {\n  const { isAuthenticated } = useAuth();\n  \n  return (\n    <Switch>\n      <Route path=\"/login\">\n        {isAuthenticated ? <Redirect to=\"/\" /> : <Login />}\n      </Route>\n      <Route path=\"/\">{() => <ProtectedRoute component={Dashboard} />}</Route>\n      <Route path=\"/inbox/window\">{() => <ProtectedRoute component={WindowInbox} />}</Route>\n      <Route path=\"/inbox/leads\">{() => <ProtectedRoute component={WhatsAppLeads} />}</Route>\n      <Route path=\"/inbox\">{() => <ProtectedRoute component={Inbox} />}</Route>\n      \n      {/* Campaigns */}\n      <Route path=\"/campaigns\">{() => <ProtectedRoute component={Campaigns} />}</Route>\n      <Route path=\"/campaigns/broadcast\">{() => <ProtectedRoute component={Broadcast} />}</Route>\n      <Route path=\"/campaigns/selected-contacts\">{() => <ProtectedRoute component={SelectedContacts} />}</Route>\n      <Route path=\"/campaigns/schedule\">{() => <ProtectedRoute component={Schedule} />}</Route>\n      <Route path=\"/campaigns/single\">{() => <ProtectedRoute component={Single} />}</Route>\n      <Route path=\"/campaigns/report\">{() => <ProtectedRoute component={Report} />}</Route>\n\n      {/* Automation */}\n      <Route path=\"/automation\">{() => <ProtectedRoute component={Automation} />}</Route>\n      <Route path=\"/automation/leads\">{() => <ProtectedRoute component={AutoLeads} />}</Route>\n      <Route path=\"/automation/keywords\">{() => <ProtectedRoute component={Keywords} />}</Route>\n      <Route path=\"/automation/follow-up\">{() => <ProtectedRoute component={FollowUp} />}</Route>\n      <Route path=\"/automation/drip\">{() => <ProtectedRoute component={Drip} />}</Route>\n      <Route path=\"/automation/new-leads\">{() => <ProtectedRoute component={NewLeads} />}</Route>\n\n      {/* Apps */}\n      <Route path=\"/apps/connect\">{() => <ProtectedRoute component={ConnectApps} />}</Route>\n\n      {/* Templates */}\n      <Route path=\"/templates\">{() => <ProtectedRoute component={Templates} />}</Route>\n      <Route path=\"/templates/add\">{() => <ProtectedRoute component={AddTemplate} />}</Route>\n      <Route path=\"/templates/status\">{() => <ProtectedRoute component={TemplateStatus} />}</Route>\n      <Route path=\"/templates/manage\">{() => <ProtectedRoute component={ManageTemplates} />}</Route>\n\n      {/* AI */}\n      <Route path=\"/ai\">{() => <ProtectedRoute component={AgentsPage} />}</Route>\n      <Route path=\"/ai/new\">{() => <ProtectedRoute component={NewAgent} />}</Route>\n      <Route path=\"/ai/manage\">{() => <ProtectedRoute component={AgentsPage} />}</Route>\n      <Route path=\"/ai/agents\">{() => <ProtectedRoute component={AgentsPage} />}</Route>\n      <Route path=\"/ai/map\">{() => <ProtectedRoute component={MapAgent} />}</Route>\n      <Route path=\"/ai/prefilled\">{() => <ProtectedRoute component={PrefilledTextMappings} />}</Route>\n      <Route path=\"/ai/reports\">{() => <ProtectedRoute component={AgentReports} />}</Route>\n\n      {/* Facebook */}\n      <Route path=\"/facebook/forms\">{() => <ProtectedRoute component={LeadForms} />}</Route>\n      <Route path=\"/facebook/leads\">{() => <ProtectedRoute component={Leads} />}</Route>\n\n      {/* Reports */}\n      <Route path=\"/reports\">{() => <ProtectedRoute component={DeliveryReport} />}</Route>\n      <Route path=\"/reports/delivery\">{() => <ProtectedRoute component={DeliveryReport} />}</Route>\n      <Route path=\"/reports/campaigns\">{() => <ProtectedRoute component={CampaignPerformance} />}</Route>\n      <Route path=\"/reports/replies\">{() => <ProtectedRoute component={CustomerReplies} />}</Route>\n      <Route path=\"/reports/agents\">{() => <ProtectedRoute component={AgentPerformance} />}</Route>\n      <Route path=\"/reports/spending\">{() => <ProtectedRoute component={Spending} />}</Route>\n      <Route path=\"/reports/credits\">{() => <ProtectedRoute component={Credits} />}</Route>\n      <Route path=\"/reports/user-engagement\">{() => <ProtectedRoute component={UserEngagement} />}</Route>\n      <Route path=\"/reports/broadcast\">{() => <ProtectedRoute component={BroadcastReports} />}</Route>\n      <Route path=\"/reports/blocked\">{() => <ProtectedRoute component={BlockedContacts} />}</Route>\n      <Route path=\"/reports/contacts\">{() => <ProtectedRoute component={ContactReports} />}</Route>\n      <Route path=\"/reports/lead-assignments\">{() => <ProtectedRoute component={LeadAssignmentReports} />}</Route>\n      <Route path=\"/reports/user-activity\">{() => <ProtectedRoute component={UserActivityReports} />}</Route>\n\n      <Route path=\"/contacts\">{() => <ProtectedRoute component={Contacts} />}</Route>\n      <Route path=\"/settings\">{() => <ProtectedRoute component={Settings} />}</Route>\n      <Route path=\"/settings/team\">{() => <ProtectedRoute component={TeamMembers} />}</Route>\n      <Route path=\"/settings/permissions\">{() => <ProtectedRoute component={Permissions} />}</Route>\n      <Route path=\"/settings/whatsapp\">{() => <ProtectedRoute component={WhatsAppNumber} />}</Route>\n      <Route path=\"/settings/profile\">{() => <ProtectedRoute component={ProfileDetails} />}</Route>\n      <Route path=\"/settings/api\">{() => <ProtectedRoute component={WebhookAPI} />}</Route>\n      <Route path=\"/settings/billing\">{() => <ProtectedRoute component={Billing} />}</Route>\n      \n      {/* User Management */}\n      <Route path=\"/user-management\">{() => <ProtectedRoute component={UserManagement} />}</Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":9039,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"WhatsappBusinessDashboard/server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"WhatsappBusinessDashboard/server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { StatsCard } from \"@/components/ui/stats-card\";\nimport { \n  MessageCircle, \n  CheckCircle2, \n  Eye, \n  CornerUpLeft, \n  Bot,\n  User,\n  Clock,\n  Users,\n  UserPlus,\n  Shield,\n  Loader2,\n  ArrowUpRight,\n  ArrowDownRight,\n  TrendingUp,\n  Send,\n  Inbox\n} from \"lucide-react\";\nimport { \n  Area, \n  AreaChart, \n  ResponsiveContainer, \n  Tooltip, \n  XAxis, \n  YAxis, \n  CartesianGrid,\n  BarChart,\n  Bar,\n  Legend,\n  PieChart,\n  Pie,\n  Cell,\n  ComposedChart,\n  Line\n} from \"recharts\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\n\ninterface EnhancedDashboardStats {\n  summary: {\n    totalMessages: number;\n    outboundMessages: number;\n    inboundMessages: number;\n    delivered: number;\n    read: number;\n    deliveryRate: number;\n    readRate: number;\n    windowCompliant: number;\n    windowNonCompliant: number;\n    windowComplianceRate: number;\n    aiInWindow: number;\n    humanInWindow: number;\n    totalAiResponses: number;\n    totalHumanResponses: number;\n    aiPercentage: number;\n    activeContacts: number;\n    newContacts: number;\n    aiConversations: number;\n  };\n  dayWise: Array<{\n    day: string;\n    sent: number;\n    delivered: number;\n    read: number;\n    inbound: number;\n    ai: number;\n    human: number;\n  }>;\n  changes: {\n    messagesChange: number;\n    outboundChange: number;\n    deliveredChange: number;\n    readRateChange: number;\n    aiChange: number;\n    newContactsChange: number;\n    windowComplianceChange: number;\n  };\n  period: string;\n}\n\nconst COLORS = ['#22c55e', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];\n\nexport default function Dashboard() {\n  const [period, setPeriod] = useState<string>(\"week\");\n\n  const { data: stats, isLoading } = useQuery<EnhancedDashboardStats>({\n    queryKey: [\"/api/reports/enhanced-dashboard\", period],\n    queryFn: async () => {\n      const res = await fetch(`/api/reports/enhanced-dashboard?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch stats\");\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const { data: messages } = useQuery({\n    queryKey: [\"/api/messages\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/messages\");\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      return res.json();\n    },\n  });\n\n  const recentMessages = messages?.slice(-5).reverse() || [];\n\n  if (isLoading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-[calc(100vh-8rem)]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  const chartData = stats?.dayWise || [];\n  \n  const aiVsHumanData = [\n    { name: 'AI Responses', value: stats?.summary.totalAiResponses || 0, color: '#3b82f6' },\n    { name: 'Human Responses', value: stats?.summary.totalHumanResponses || 0, color: '#22c55e' },\n  ];\n\n  const windowComplianceData = [\n    { name: 'Within 24h', value: stats?.summary.windowCompliant || 0, color: '#22c55e' },\n    { name: 'Outside 24h', value: stats?.summary.windowNonCompliant || 0, color: '#ef4444' },\n  ];\n\n  const renderTrendIcon = (value: number) => {\n    if (value > 0) return <ArrowUpRight className=\"h-3 w-3 text-green-500\" />;\n    if (value < 0) return <ArrowDownRight className=\"h-3 w-3 text-red-500\" />;\n    return null;\n  };\n\n  const getPeriodLabel = () => {\n    switch (period) {\n      case 'today': return 'today';\n      case 'yesterday': return 'yesterday';\n      case 'week': return 'this week';\n      case 'month': return 'this month';\n      default: return 'selected period';\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Dashboard</h2>\n            <p className=\"text-muted-foreground\">Complete overview of your messaging performance {getPeriodLabel()}.</p>\n          </div>\n   \n          <div className=\"flex items-center gap-2\">\n          \n            <Select value={period} onValueChange={setPeriod}>\n              <SelectTrigger className=\"w-[140px]\">\n                <SelectValue placeholder=\"Select period\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"today\">Today</SelectItem>\n                <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n                <SelectItem value=\"week\">Last 7 Days</SelectItem>\n                <SelectItem value=\"month\">Last 30 Days</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n         <h1>ACTIVITY REPORT</h1>\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          <StatsCard \n            title=\"Total Messages\" \n            value={stats?.summary.totalMessages?.toLocaleString() || \"0\"} \n            icon={MessageCircle}\n            trend={{ value: stats?.changes.messagesChange || 0, label: \"from previous period\" }}\n          />\n          <StatsCard \n            title=\"Outbound Sent\" \n            value={stats?.summary.outboundMessages?.toLocaleString() || \"0\"} \n            icon={Send}\n            trend={{ value: stats?.changes.outboundChange || 0, label: \"from previous period\" }}\n          />\n          <StatsCard \n            title=\"Inbound Received\" \n            value={stats?.summary.inboundMessages?.toLocaleString() || \"0\"} \n            icon={Inbox}\n            trend={{ value: 0, label: \"customer replies\" }}\n          />\n          <StatsCard \n            title=\"Delivered\" \n            value={stats?.summary.delivered?.toLocaleString() || \"0\"} \n            icon={CheckCircle2}\n            trend={{ value: stats?.changes.deliveredChange || 0, label: \"from previous period\" }}\n          />\n        </div>\n        <h1>AI REPORT</h1>\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n\n          <Card className=\"border-blue-200 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-background\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">AI Responses</CardTitle>\n              <Bot className=\"h-4 w-4 text-blue-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.totalAiResponses?.toLocaleString() || \"0\"}</div>\n              <div className=\"flex items-center gap-1 mt-1\">\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {stats?.summary.aiPercentage || 0}% of outbound\n                </Badge>\n                {renderTrendIcon(stats?.changes.aiChange || 0)}\n                <span className=\"text-xs text-muted-foreground\">\n                  {stats?.changes.aiChange || 0}%\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-green-200 bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Human Responses</CardTitle>\n              <User className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.totalHumanResponses?.toLocaleString() || \"0\"}</div>\n              <div className=\"flex items-center gap-1 mt-1\">\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {100 - (stats?.summary.aiPercentage || 0)}% of outbound\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-emerald-200 bg-gradient-to-br from-emerald-50 to-white dark:from-emerald-950/20 dark:to-background\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">24h Window Compliant</CardTitle>\n              <Shield className=\"h-4 w-4 text-emerald-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.windowCompliant?.toLocaleString() || \"0\"}</div>\n              <div className=\"flex items-center gap-2 mt-1\">\n                <Progress \n                  value={stats?.summary.windowComplianceRate || 0} \n                  className=\"h-2 flex-1\"\n                />\n                <span className=\"text-sm font-medium text-emerald-600\">\n                  {stats?.summary.windowComplianceRate || 0}%\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-purple-200 bg-gradient-to-br from-purple-50 to-white dark:from-purple-950/20 dark:to-background\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">New Contacts</CardTitle>\n              <UserPlus className=\"h-4 w-4 text-purple-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.newContacts?.toLocaleString() || \"0\"}</div>\n              <div className=\"flex items-center gap-1 mt-1\">\n                {renderTrendIcon(stats?.changes.newContactsChange || 0)}\n                <span className=\"text-xs text-muted-foreground\">\n                  {stats?.changes.newContactsChange || 0}% from previous period\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        <h1>PERFORMANCE REPORT</h1>\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Delivery Rate</CardTitle>\n              <CheckCircle2 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.deliveryRate || 0}%</div>\n              <Progress value={stats?.summary.deliveryRate || 0} className=\"h-2 mt-2\" />\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Read Rate</CardTitle>\n              <Eye className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.readRate || 0}%</div>\n              <Progress value={stats?.summary.readRate || 0} className=\"h-2 mt-2\" />\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Contacts</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.activeContacts?.toLocaleString() || \"0\"}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">Unique contacts this period</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">AI Conversations</CardTitle>\n              <Bot className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats?.summary.aiConversations?.toLocaleString() || \"0\"}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">Active agent assignments</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"activity\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"activity\">Message Activity</TabsTrigger>\n            <TabsTrigger value=\"ai-human\">AI vs Human</TabsTrigger>\n            <TabsTrigger value=\"window\">24h Window</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"activity\" className=\"space-y-4\">\n            <div className=\"grid gap-4 lg:grid-cols-7\">\n              <Card className=\"lg:col-span-4\">\n                <CardHeader>\n                  <CardTitle>Message Activity Over Time</CardTitle>\n                  <CardDescription>\n                    Daily breakdown of sent, delivered, and read messages.\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"pl-2\">\n                  <div className=\"h-[350px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <ComposedChart data={chartData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\n                        <defs>\n                          <linearGradient id=\"colorSent\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3}/>\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n                          </linearGradient>\n                          <linearGradient id=\"colorInbound\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\" stopColor=\"#22c55e\" stopOpacity={0.3}/>\n                            <stop offset=\"95%\" stopColor=\"#22c55e\" stopOpacity={0}/>\n                          </linearGradient>\n                        </defs>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <XAxis \n                          dataKey=\"day\" \n                          stroke=\"hsl(var(--muted-foreground))\" \n                          fontSize={12} \n                          tickLine={false} \n                          axisLine={false} \n                        />\n                        <YAxis \n                          stroke=\"hsl(var(--muted-foreground))\" \n                          fontSize={12} \n                          tickLine={false} \n                          axisLine={false} \n                        />\n                        <Tooltip \n                          contentStyle={{ \n                            backgroundColor: \"hsl(var(--card))\", \n                            borderColor: \"hsl(var(--border))\",\n                            borderRadius: \"var(--radius)\",\n                          }}\n                        />\n                        <Legend />\n                        <Area \n                          type=\"monotone\" \n                          dataKey=\"sent\" \n                          name=\"Sent\"\n                          stroke=\"#3b82f6\" \n                          fillOpacity={1} \n                          fill=\"url(#colorSent)\" \n                          strokeWidth={2}\n                        />\n                        <Area \n                          type=\"monotone\" \n                          dataKey=\"inbound\" \n                          name=\"Inbound\"\n                          stroke=\"#22c55e\" \n                          fillOpacity={1} \n                          fill=\"url(#colorInbound)\" \n                          strokeWidth={2}\n                        />\n                        <Line \n                          type=\"monotone\" \n                          dataKey=\"delivered\" \n                          name=\"Delivered\"\n                          stroke=\"#f59e0b\" \n                          strokeWidth={2}\n                          dot={false}\n                        />\n                        <Line \n                          type=\"monotone\" \n                          dataKey=\"read\" \n                          name=\"Read\"\n                          stroke=\"#8b5cf6\" \n                          strokeWidth={2}\n                          dot={false}\n                        />\n                      </ComposedChart>\n                    </ResponsiveContainer>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"lg:col-span-3\">\n                <CardHeader>\n                  <CardTitle>Recent Activity</CardTitle>\n                  <CardDescription>Latest message interactions</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {recentMessages.length > 0 ? recentMessages.map((msg: any, i: number) => (\n                      <div key={msg.id || i} className=\"flex items-center gap-4\">\n                        <div className={`h-9 w-9 rounded-full flex items-center justify-center ${\n                          msg.direction === \"inbound\" \n                            ? \"bg-green-100 text-green-600\" \n                            : msg.agentId \n                              ? \"bg-blue-100 text-blue-600\"\n                              : \"bg-primary/10 text-primary\"\n                        }`}>\n                          {msg.direction === \"inbound\" ? (\n                            <Inbox className=\"h-4 w-4\" />\n                          ) : msg.agentId ? (\n                            <Bot className=\"h-4 w-4\" />\n                          ) : (\n                            <Send className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                        <div className=\"flex-1 space-y-1 min-w-0\">\n                          <p className=\"text-sm font-medium leading-none truncate\">\n                            {msg.direction === \"inbound\" \n                              ? \"Message received\" \n                              : msg.agentId \n                                ? \"AI response sent\"\n                                : \"Message sent\"}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground truncate\">\n                            {msg.content?.substring(0, 40)}...\n                          </p>\n                        </div>\n                        <div className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                          {new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                        </div>\n                      </div>\n                    )) : (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <MessageCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                        <p>No recent messages</p>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"ai-human\" className=\"space-y-4\">\n            <div className=\"grid gap-4 lg:grid-cols-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>AI vs Human Responses</CardTitle>\n                  <CardDescription>Distribution of automated vs manual responses</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[300px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <PieChart>\n                        <Pie\n                          data={aiVsHumanData}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          innerRadius={60}\n                          outerRadius={100}\n                          paddingAngle={5}\n                          dataKey=\"value\"\n                          label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                        >\n                          {aiVsHumanData.map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={entry.color} />\n                          ))}\n                        </Pie>\n                        <Tooltip />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </div>\n                  <div className=\"flex justify-center gap-6 mt-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-full bg-blue-500\" />\n                      <span className=\"text-sm\">AI: {stats?.summary.totalAiResponses || 0}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-full bg-green-500\" />\n                      <span className=\"text-sm\">Human: {stats?.summary.totalHumanResponses || 0}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>AI vs Human by Day</CardTitle>\n                  <CardDescription>Daily breakdown of response sources</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[300px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={chartData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <XAxis \n                          dataKey=\"day\" \n                          stroke=\"hsl(var(--muted-foreground))\" \n                          fontSize={12} \n                          tickLine={false} \n                          axisLine={false} \n                        />\n                        <YAxis \n                          stroke=\"hsl(var(--muted-foreground))\" \n                          fontSize={12} \n                          tickLine={false} \n                          axisLine={false} \n                        />\n                        <Tooltip \n                          contentStyle={{ \n                            backgroundColor: \"hsl(var(--card))\", \n                            borderColor: \"hsl(var(--border))\",\n                            borderRadius: \"var(--radius)\",\n                          }}\n                        />\n                        <Legend />\n                        <Bar dataKey=\"ai\" name=\"AI Responses\" fill=\"#3b82f6\" stackId=\"a\" radius={[0, 0, 0, 0]} />\n                        <Bar dataKey=\"human\" name=\"Human Responses\" fill=\"#22c55e\" stackId=\"a\" radius={[4, 4, 0, 0]} />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"window\" className=\"space-y-4\">\n            <div className=\"grid gap-4 lg:grid-cols-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>24-Hour Window Compliance</CardTitle>\n                  <CardDescription>Messages sent within vs outside the 24-hour reply window</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[300px]\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <PieChart>\n                        <Pie\n                          data={windowComplianceData}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          innerRadius={60}\n                          outerRadius={100}\n                          paddingAngle={5}\n                          dataKey=\"value\"\n                          label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                        >\n                          {windowComplianceData.map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={entry.color} />\n                          ))}\n                        </Pie>\n                        <Tooltip />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </div>\n                  <div className=\"flex justify-center gap-6 mt-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-full bg-green-500\" />\n                      <span className=\"text-sm\">Compliant: {stats?.summary.windowCompliant || 0}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"h-3 w-3 rounded-full bg-red-500\" />\n                      <span className=\"text-sm\">Non-Compliant: {stats?.summary.windowNonCompliant || 0}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Window Compliance Details</CardTitle>\n                  <CardDescription>Breakdown of messages within the 24-hour window</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm font-medium\">Overall Compliance Rate</span>\n                      <span className=\"text-2xl font-bold text-emerald-600\">\n                        {stats?.summary.windowComplianceRate || 0}%\n                      </span>\n                    </div>\n                    <Progress \n                      value={stats?.summary.windowComplianceRate || 0} \n                      className=\"h-3\"\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-1 p-4 rounded-lg bg-blue-50 dark:bg-blue-950/30\">\n                      <div className=\"flex items-center gap-2\">\n                        <Bot className=\"h-4 w-4 text-blue-500\" />\n                        <span className=\"text-sm font-medium\">AI in Window</span>\n                      </div>\n                      <p className=\"text-2xl font-bold\">{stats?.summary.aiInWindow || 0}</p>\n                    </div>\n                    <div className=\"space-y-1 p-4 rounded-lg bg-green-50 dark:bg-green-950/30\">\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"h-4 w-4 text-green-500\" />\n                        <span className=\"text-sm font-medium\">Human in Window</span>\n                      </div>\n                      <p className=\"text-2xl font-bold\">{stats?.summary.humanInWindow || 0}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"p-4 rounded-lg border bg-muted/50\">\n                    <div className=\"flex items-start gap-3\">\n                      <Clock className=\"h-5 w-5 text-muted-foreground mt-0.5\" />\n                      <div>\n                        <p className=\"text-sm font-medium\">WhatsApp 24-Hour Window</p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Messages sent within 24 hours of the last customer message can be free-form. \n                          Messages sent outside this window require approved templates.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":28074,"size_tokens":null},"client/src/pages/automation/NewLeads.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Bell, Mail, Smartphone } from \"lucide-react\";\n\nexport default function NewLeads() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n           <h2 className=\"text-3xl font-bold tracking-tight\">New Lead Alerts</h2>\n           <p className=\"text-muted-foreground\">Notify your team when a new lead comes in.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n           <Card>\n             <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center\">\n                      <Mail className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Email Notifications</CardTitle>\n                     <CardDescription>Send an email to admins.</CardDescription>\n                   </div>\n                </div>\n             </CardHeader>\n             <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                   <Label>Enable Email Alerts</Label>\n                   <Switch defaultChecked />\n                </div>\n                <div className=\"grid gap-2\">\n                   <Label>Recipient Email(s)</Label>\n                   <Input defaultValue=\"admin@acme.com, sales@acme.com\" />\n                   <p className=\"text-xs text-muted-foreground\">Comma separated for multiple emails.</p>\n                </div>\n             </CardContent>\n             <CardFooter>\n                <Button>Save Settings</Button>\n             </CardFooter>\n           </Card>\n\n           <Card>\n             <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center\">\n                      <Smartphone className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>WhatsApp Admin Alert</CardTitle>\n                     <CardDescription>Send a WhatsApp message to your phone.</CardDescription>\n                   </div>\n                </div>\n             </CardHeader>\n             <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                   <Label>Enable WhatsApp Alerts</Label>\n                   <Switch />\n                </div>\n                <div className=\"grid gap-2\">\n                   <Label>Admin Phone Number</Label>\n                   <Input placeholder=\"+1 555 123 4567\" />\n                </div>\n             </CardContent>\n             <CardFooter>\n                <Button>Save Settings</Button>\n             </CardFooter>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3251,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/campaigns/Schedule.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Calendar, Clock, Plus, PauseCircle, PlayCircle, Trash2, Loader2, FileSpreadsheet, Bot, MessageSquare, FileText, RefreshCw, X } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface ScheduledMessage {\n  id: string;\n  name: string;\n  messageType: 'template' | 'custom' | 'ai_agent';\n  templateName?: string;\n  customMessage?: string;\n  agentId?: string;\n  scheduledAt: string;\n  status: 'scheduled' | 'sent' | 'failed' | 'cancelled';\n  recipientCount: number;\n  sentCount: number;\n  failedCount: number;\n  createdAt: string;\n}\n\ninterface ScheduledBroadcast {\n  id: string;\n  campaignName: string;\n  messageType: \"template\" | \"custom\" | \"ai_agent\";\n  templateName?: string;\n  customMessage?: string;\n  agentId?: string;\n  contacts: Array<{ name: string; phone: string }>;\n  scheduledAt: string;\n  status: \"scheduled\" | \"sending\" | \"sent\" | \"failed\" | \"cancelled\";\n  createdAt: string;\n  sentCount?: number;\n  failedCount?: number;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\ninterface ImportedContact {\n  name: string;\n  phone: string;\n  email?: string;\n}\n\nexport default function Schedule() {\n  const [showNewSchedule, setShowNewSchedule] = useState(false);\n  const [scheduleName, setScheduleName] = useState(\"\");\n  const [scheduleTime, setScheduleTime] = useState(\"\");\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai_agent\">(\"template\");\n  const [selectedTemplateId, setSelectedTemplateId] = useState(\"\");\n  const [selectedAgentId, setSelectedAgentId] = useState(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [importedContacts, setImportedContacts] = useState<ImportedContact[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const queryClient = useQueryClient();\n\n  const { data: schedules = [], isLoading } = useQuery<ScheduledMessage[]>({\n    queryKey: [\"/api/broadcast/schedules\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/schedules\");\n      if (!res.ok) throw new Error(\"Failed to fetch schedules\");\n      return res.json();\n    },\n  });\n\n  const { data: scheduledBroadcasts = [], isLoading: isLoadingBroadcasts, refetch: refetchBroadcasts } = useQuery<ScheduledBroadcast[]>({\n    queryKey: [\"/api/broadcast/scheduled-broadcasts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/scheduled-broadcasts\");\n      if (!res.ok) throw new Error(\"Failed to fetch scheduled broadcasts\");\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  const approvedTemplates = templates.filter(t => t.status === \"approved\");\n  const activeAgents = agents.filter(a => a.isActive);\n\n  const importExcelMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      const res = await fetch(\"/api/broadcast/import-excel\", {\n        method: \"POST\",\n        body: formData,\n      });\n      if (!res.ok) throw new Error(\"Failed to import file\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setImportedContacts(data.contacts);\n      toast.success(`Imported ${data.validContacts} contacts`);\n    },\n    onError: () => {\n      toast.error(\"Failed to import file\");\n    },\n  });\n\n  const createScheduleMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/broadcast/schedules\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create schedule\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/schedules\"] });\n      toast.success(\"Schedule created successfully\");\n      handleCloseDialog();\n    },\n    onError: () => {\n      toast.error(\"Failed to create schedule\");\n    },\n  });\n\n  const deleteScheduleMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/broadcast/schedules/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete schedule\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/schedules\"] });\n      toast.success(\"Schedule deleted\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete schedule\");\n    },\n  });\n\n  const updateScheduleMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const res = await fetch(`/api/broadcast/schedules/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update schedule\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/schedules\"] });\n      toast.success(\"Schedule updated\");\n    },\n    onError: () => {\n      toast.error(\"Failed to update schedule\");\n    },\n  });\n\n  const cancelScheduledBroadcastMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/broadcast/scheduled-broadcasts/${id}/cancel`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to cancel scheduled broadcast\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/scheduled-broadcasts\"] });\n      toast.success(\"Scheduled broadcast cancelled\");\n    },\n    onError: () => {\n      toast.error(\"Failed to cancel scheduled broadcast\");\n    },\n  });\n\n  const deleteScheduledBroadcastMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/broadcast/scheduled-broadcasts/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete scheduled broadcast\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/scheduled-broadcasts\"] });\n      toast.success(\"Scheduled broadcast deleted\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete scheduled broadcast\");\n    },\n  });\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      importExcelMutation.mutate(file);\n    }\n  };\n\n  const handleCloseDialog = () => {\n    setShowNewSchedule(false);\n    setScheduleName(\"\");\n    setScheduleTime(\"\");\n    setMessageType(\"template\");\n    setSelectedTemplateId(\"\");\n    setSelectedAgentId(\"\");\n    setCustomMessage(\"\");\n    setImportedContacts([]);\n  };\n\n  const handleCreateSchedule = () => {\n    if (!scheduleName.trim()) {\n      toast.error(\"Please enter a schedule name\");\n      return;\n    }\n\n    if (!scheduleTime) {\n      toast.error(\"Please select a schedule time\");\n      return;\n    }\n\n    if (importedContacts.length === 0) {\n      toast.error(\"Please import contacts from Excel/CSV\");\n      return;\n    }\n\n    if (messageType === \"template\" && !selectedTemplateId) {\n      toast.error(\"Please select a template\");\n      return;\n    }\n\n    if (messageType === \"custom\" && !customMessage.trim()) {\n      toast.error(\"Please enter a message\");\n      return;\n    }\n\n    if (messageType === \"ai_agent\" && !selectedAgentId) {\n      toast.error(\"Please select an AI agent\");\n      return;\n    }\n\n    createScheduleMutation.mutate({\n      name: scheduleName,\n      messageType,\n      templateName: messageType === \"template\" ? (templates.find(t => t.id === selectedTemplateId)?.name || \"hello_world\") : undefined,\n      customMessage: messageType === \"custom\" ? customMessage : undefined,\n      agentId: messageType === \"ai_agent\" ? selectedAgentId : undefined,\n      scheduledAt: scheduleTime,\n      recipientCount: importedContacts.length,\n    });\n  };\n\n  const formatDateTime = (dateString: string) => {\n    return new Date(dateString).toLocaleString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n      hour: \"numeric\",\n      minute: \"2-digit\",\n      hour12: true,\n    });\n  };\n\n  const statusColors: Record<string, string> = {\n    scheduled: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300\",\n    sending: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300\",\n    sent: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\",\n    failed: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300\",\n    cancelled: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300\",\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Schedule Messages</h2>\n            <p className=\"text-muted-foreground\">Manage your upcoming scheduled campaigns.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => refetchBroadcasts()}\n              disabled={isLoadingBroadcasts}\n            >\n              {isLoadingBroadcasts ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <RefreshCw className=\"h-4 w-4\" />\n              )}\n              <span className=\"ml-2\">Refresh</span>\n            </Button>\n            <Dialog open={showNewSchedule} onOpenChange={setShowNewSchedule}>\n              <DialogTrigger asChild>\n                <Button>\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  New Schedule\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>Create Scheduled Message</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>Campaign Name *</Label>\n                    <Input\n                      placeholder=\"e.g., Weekly Newsletter\"\n                      value={scheduleName}\n                      onChange={(e) => setScheduleName(e.target.value)}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-2\">\n                    <Label>Schedule Time *</Label>\n                    <Input\n                      type=\"datetime-local\"\n                      value={scheduleTime}\n                      onChange={(e) => setScheduleTime(e.target.value)}\n                      min={new Date().toISOString().slice(0, 16)}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-2\">\n                    <Label>Import Contacts *</Label>\n                    <input\n                      type=\"file\"\n                      ref={fileInputRef}\n                      onChange={handleFileUpload}\n                      accept=\".xlsx,.xls,.csv\"\n                      className=\"hidden\"\n                    />\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => fileInputRef.current?.click()}\n                      disabled={importExcelMutation.isPending}\n                    >\n                      {importExcelMutation.isPending ? (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      ) : (\n                        <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\n                      )}\n                      Upload Excel/CSV\n                    </Button>\n                    {importedContacts.length > 0 && (\n                      <p className=\"text-sm text-green-600\">\n                        {importedContacts.length} contacts imported\n                      </p>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Message Type</Label>\n                    <Tabs value={messageType} onValueChange={(v) => setMessageType(v as any)}>\n                      <TabsList className=\"w-full\">\n                        <TabsTrigger value=\"template\" className=\"flex-1\">\n                          <FileText className=\"mr-1 h-4 w-4\" />\n                          Template\n                        </TabsTrigger>\n                        <TabsTrigger value=\"custom\" className=\"flex-1\">\n                          <MessageSquare className=\"mr-1 h-4 w-4\" />\n                          Custom\n                        </TabsTrigger>\n                        <TabsTrigger value=\"ai_agent\" className=\"flex-1\">\n                          <Bot className=\"mr-1 h-4 w-4\" />\n                          AI Agent\n                        </TabsTrigger>\n                      </TabsList>\n\n                      <TabsContent value=\"template\" className=\"mt-4\">\n                        <Select value={selectedTemplateId} onValueChange={setSelectedTemplateId}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select a template...\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"hello_world\">hello_world (Default)</SelectItem>\n                            {approvedTemplates.map((template) => (\n                              <SelectItem key={template.id} value={template.id}>\n                                {template.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TabsContent>\n\n                      <TabsContent value=\"custom\" className=\"mt-4\">\n                        <Textarea\n                          placeholder=\"Type your message...\"\n                          value={customMessage}\n                          onChange={(e) => setCustomMessage(e.target.value)}\n                          className=\"min-h-[100px]\"\n                        />\n                      </TabsContent>\n\n                      <TabsContent value=\"ai_agent\" className=\"mt-4\">\n                        <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select an AI agent...\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {activeAgents.map((agent) => (\n                              <SelectItem key={agent.id} value={agent.id}>\n                                {agent.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TabsContent>\n                    </Tabs>\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={handleCloseDialog}>\n                    Cancel\n                  </Button>\n                  <Button \n                    onClick={handleCreateSchedule}\n                    disabled={createScheduleMutation.isPending}\n                  >\n                    {createScheduleMutation.isPending && (\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    )}\n                    Create Schedule\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5\" />\n              Scheduled Broadcasts\n            </CardTitle>\n            <CardDescription>\n              Broadcasts scheduled from the Broadcast page. These will be sent automatically at the scheduled time.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoadingBroadcasts ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : scheduledBroadcasts.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Clock className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No scheduled broadcasts</p>\n                <p className=\"text-sm\">Go to Broadcast page and schedule a message to see it here</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Campaign Name</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Scheduled Time</TableHead>\n                    <TableHead>Recipients</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Results</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {scheduledBroadcasts\n                    .sort((a, b) => new Date(a.scheduledAt).getTime() - new Date(b.scheduledAt).getTime())\n                    .map((broadcast) => {\n                      const scheduledDate = new Date(broadcast.scheduledAt);\n                      const isPast = scheduledDate <= new Date();\n                      \n                      return (\n                        <TableRow key={broadcast.id}>\n                          <TableCell className=\"font-medium\">{broadcast.campaignName}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">\n                              {broadcast.messageType === \"template\" && <FileText className=\"mr-1 h-3 w-3\" />}\n                              {broadcast.messageType === \"custom\" && <MessageSquare className=\"mr-1 h-3 w-3\" />}\n                              {broadcast.messageType === \"ai_agent\" && <Bot className=\"mr-1 h-3 w-3\" />}\n                              {broadcast.messageType === \"template\" \n                                ? broadcast.templateName || \"hello_world\"\n                                : broadcast.messageType === \"custom\"\n                                  ? \"Custom\"\n                                  : \"AI Agent\"}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className={isPast && broadcast.status === \"scheduled\" ? \"text-amber-600 dark:text-amber-400\" : \"\"}>\n                                {formatDateTime(broadcast.scheduledAt)}\n                                {isPast && broadcast.status === \"scheduled\" && \" (Processing...)\"}\n                              </span>\n                            </div>\n                          </TableCell>\n                          <TableCell>{broadcast.contacts?.length || 0}</TableCell>\n                          <TableCell>\n                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColors[broadcast.status]}`}>\n                              {broadcast.status.charAt(0).toUpperCase() + broadcast.status.slice(1)}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            {broadcast.status === \"sent\" || broadcast.status === \"failed\" ? (\n                              <span className=\"text-sm\">\n                                {broadcast.sentCount || 0} sent, {broadcast.failedCount || 0} failed\n                              </span>\n                            ) : (\n                              <span className=\"text-muted-foreground text-sm\">-</span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              {broadcast.status === \"scheduled\" && (\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  title=\"Cancel\"\n                                  onClick={() => cancelScheduledBroadcastMutation.mutate(broadcast.id)}\n                                  disabled={cancelScheduledBroadcastMutation.isPending}\n                                >\n                                  {cancelScheduledBroadcastMutation.isPending ? (\n                                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                  ) : (\n                                    <X className=\"h-4 w-4\" />\n                                  )}\n                                </Button>\n                              )}\n                              {(broadcast.status === \"sent\" || broadcast.status === \"failed\" || broadcast.status === \"cancelled\") && (\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-destructive\"\n                                  title=\"Delete\"\n                                  onClick={() => deleteScheduledBroadcastMutation.mutate(broadcast.id)}\n                                  disabled={deleteScheduledBroadcastMutation.isPending}\n                                >\n                                  {deleteScheduledBroadcastMutation.isPending ? (\n                                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                  ) : (\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  )}\n                                </Button>\n                              )}\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Upcoming Schedules (Legacy)</CardTitle>\n            <CardDescription>View and manage your automated dispatch queue.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin\" />\n              </div>\n            ) : schedules.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No scheduled messages. Create one using the \"New Schedule\" button above.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Campaign Name</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Scheduled Time</TableHead>\n                    <TableHead>Recipients</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {schedules.map((schedule) => (\n                    <TableRow key={schedule.id}>\n                      <TableCell className=\"font-medium\">{schedule.name}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">\n                          {schedule.messageType === \"template\" && <FileText className=\"mr-1 h-3 w-3\" />}\n                          {schedule.messageType === \"custom\" && <MessageSquare className=\"mr-1 h-3 w-3\" />}\n                          {schedule.messageType === \"ai_agent\" && <Bot className=\"mr-1 h-3 w-3\" />}\n                          {schedule.messageType}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                          {formatDateTime(schedule.scheduledAt)}\n                        </div>\n                      </TableCell>\n                      <TableCell>{schedule.recipientCount}</TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={schedule.status === 'scheduled' ? 'default' : schedule.status === 'sent' ? 'secondary' : 'outline'}\n                          className={schedule.status === 'scheduled' ? 'bg-blue-500' : schedule.status === 'sent' ? 'bg-green-500' : ''}\n                        >\n                          {schedule.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          {schedule.status === 'scheduled' && (\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\" \n                              title=\"Cancel\"\n                              onClick={() => updateScheduleMutation.mutate({ id: schedule.id, status: 'cancelled' })}\n                            >\n                              <PauseCircle className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                          <Button \n                            variant=\"ghost\" \n                            size=\"icon\" \n                            className=\"text-destructive\" \n                            title=\"Delete\"\n                            onClick={() => deleteScheduleMutation.mutate(schedule.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":27931,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/reports/CampaignPerformance.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\n\nconst campaignData = [\n  { name: \"Summer Sale\", sent: 5000, read: 3500, replied: 450 },\n  { name: \"New Arrival\", sent: 3500, read: 2100, replied: 200 },\n  { name: \"Feedback\", sent: 1000, read: 800, replied: 300 },\n  { name: \"Promo X\", sent: 4200, read: 2800, replied: 150 },\n];\n\nconst campaigns = [\n  { id: 1, name: \"Summer Sale Blast\", date: \"Jun 15\", sent: 5000, delivered: \"99%\", read: \"70%\", replied: \"9%\", cost: \"$45.00\" },\n  { id: 2, name: \"New Arrival Alert\", date: \"Jun 20\", sent: 3500, delivered: \"98%\", read: \"60%\", replied: \"5.7%\", cost: \"$31.50\" },\n  { id: 3, name: \"Customer Feedback\", date: \"Jun 25\", sent: 1000, delivered: \"99.5%\", read: \"80%\", replied: \"30%\", cost: \"$9.00\" },\n  { id: 4, name: \"Promo X\", date: \"Jun 28\", sent: 4200, delivered: \"97%\", read: \"66%\", replied: \"3.5%\", cost: \"$37.80\" },\n];\n\nexport default function CampaignPerformance() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Campaign Performance</h2>\n          <p className=\"text-muted-foreground\">ROI and engagement metrics for your broadcasts.</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Engagement Comparison</CardTitle>\n            <CardDescription>Compare Sent vs Read vs Replied across top campaigns.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[350px] w-full\">\n               <ResponsiveContainer width=\"100%\" height=\"100%\">\n                 <BarChart data={campaignData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                   <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                   <XAxis dataKey=\"name\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                   <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                   <Tooltip \n                     cursor={{ fill: 'hsl(var(--muted)/0.2)' }}\n                     contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                   />\n                   <Legend />\n                   <Bar dataKey=\"sent\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} name=\"Sent\" />\n                   <Bar dataKey=\"read\" fill=\"hsl(var(--chart-2))\" radius={[4, 4, 0, 0]} name=\"Read\" />\n                   <Bar dataKey=\"replied\" fill=\"hsl(var(--chart-5))\" radius={[4, 4, 0, 0]} name=\"Replied\" />\n                 </BarChart>\n               </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Detailed Report</CardTitle>\n          </CardHeader>\n          <CardContent>\n             <Table>\n               <TableHeader>\n                 <TableRow>\n                   <TableHead>Campaign Name</TableHead>\n                   <TableHead>Date</TableHead>\n                   <TableHead>Sent</TableHead>\n                   <TableHead>Delivered</TableHead>\n                   <TableHead>Read Rate</TableHead>\n                   <TableHead>Reply Rate</TableHead>\n                   <TableHead className=\"text-right\">Cost</TableHead>\n                 </TableRow>\n               </TableHeader>\n               <TableBody>\n                 {campaigns.map((campaign) => (\n                   <TableRow key={campaign.id}>\n                     <TableCell className=\"font-medium\">{campaign.name}</TableCell>\n                     <TableCell className=\"text-muted-foreground\">{campaign.date}</TableCell>\n                     <TableCell>{campaign.sent.toLocaleString()}</TableCell>\n                     <TableCell><Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">{campaign.delivered}</Badge></TableCell>\n                     <TableCell>{campaign.read}</TableCell>\n                     <TableCell>{campaign.replied}</TableCell>\n                     <TableCell className=\"text-right font-medium\">{campaign.cost}</TableCell>\n                   </TableRow>\n                 ))}\n               </TableBody>\n             </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4752,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"WhatsappBusinessDashboard/client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --font-sans: \"Inter\", sans-serif;\n  --font-heading: \"Plus Jakarta Sans\", sans-serif;\n\n  --color-background: hsl(0 0% 100%);\n  --color-foreground: hsl(222 47% 11%);\n\n  --color-primary: hsl(142 76% 36%); /* WhatsApp Green-ish but professional */\n  --color-primary-foreground: hsl(0 0% 100%);\n\n  --color-secondary: hsl(210 40% 96%);\n  --color-secondary-foreground: hsl(222 47% 11%);\n\n  --color-muted: hsl(210 40% 96%);\n  --color-muted-foreground: hsl(215 16% 47%);\n\n  --color-accent: hsl(210 40% 96%);\n  --color-accent-foreground: hsl(222 47% 11%);\n\n  --color-destructive: hsl(0 84% 60%);\n  --color-destructive-foreground: hsl(0 0% 98%);\n\n  --color-border: hsl(214 32% 91%);\n  --color-input: hsl(214 32% 91%);\n  --color-ring: hsl(142 76% 36%);\n\n  --color-card: hsl(0 0% 100%);\n  --color-card-foreground: hsl(222 47% 11%);\n\n  --color-sidebar: hsl(222 47% 11%);\n  --color-sidebar-foreground: hsl(210 40% 98%);\n  --color-sidebar-primary: hsl(142 76% 36%);\n  --color-sidebar-primary-foreground: hsl(0 0% 100%);\n  --color-sidebar-accent: hsl(217 33% 17%);\n  --color-sidebar-accent-foreground: hsl(210 40% 98%);\n  --color-sidebar-border: hsl(217 33% 17%);\n  --color-sidebar-ring: hsl(142 76% 36%);\n\n  --radius-sm: 0.375rem;\n  --radius-md: 0.5rem;\n  --radius-lg: 0.75rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-gray-50 text-foreground;\n  }\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-heading font-semibold;\n  }\n}\n","path":null,"size_bytes":1568,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns/SelectedContacts.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Send, Filter, MoreHorizontal } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nconst contactsData = [\n  { id: 1, name: \"Alice Johnson\", phone: \"+1 555 123 4567\", tags: [\"VIP\"], status: \"Active\" },\n  { id: 2, name: \"Bob Smith\", phone: \"+1 555 987 6543\", tags: [\"Lead\"], status: \"Active\" },\n  { id: 3, name: \"Carol Williams\", phone: \"+1 555 456 7890\", tags: [\"Customer\"], status: \"Inactive\" },\n  { id: 4, name: \"David Brown\", phone: \"+1 555 234 5678\", tags: [\"Lead\"], status: \"Active\" },\n  { id: 5, name: \"Eva Davis\", phone: \"+1 555 876 5432\", tags: [\"VIP\"], status: \"Active\" },\n];\n\nexport default function SelectedContacts() {\n  const [selectedContacts, setSelectedContacts] = useState<number[]>([]);\n\n  const toggleSelect = (id: number) => {\n    if (selectedContacts.includes(id)) {\n      setSelectedContacts(selectedContacts.filter(c => c !== id));\n    } else {\n      setSelectedContacts([...selectedContacts, id]);\n    }\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedContacts.length === contactsData.length) {\n      setSelectedContacts([]);\n    } else {\n      setSelectedContacts(contactsData.map(c => c.id));\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n           <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Send to Selected</h2>\n             <p className=\"text-muted-foreground\">Select specific contacts and send a targeted message.</p>\n           </div>\n           <Dialog>\n             <DialogTrigger asChild>\n               <Button disabled={selectedContacts.length === 0}>\n                 <Send className=\"mr-2 h-4 w-4\" />\n                 Send to {selectedContacts.length} Contacts\n               </Button>\n             </DialogTrigger>\n             <DialogContent className=\"sm:max-w-[500px]\">\n               <DialogHeader>\n                 <DialogTitle>Compose Message</DialogTitle>\n               </DialogHeader>\n               <div className=\"grid gap-4 py-4\">\n                 <div className=\"grid gap-2\">\n                   <Label>Template</Label>\n                   <Select>\n                     <SelectTrigger>\n                       <SelectValue placeholder=\"Select a template (Optional)\" />\n                     </SelectTrigger>\n                     <SelectContent>\n                       <SelectItem value=\"none\">None (Custom Message)</SelectItem>\n                       <SelectItem value=\"promo\">Promo Offer</SelectItem>\n                       <SelectItem value=\"update\">Service Update</SelectItem>\n                     </SelectContent>\n                   </Select>\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Message</Label>\n                   <Textarea placeholder=\"Type your message here...\" className=\"min-h-[100px]\" />\n                 </div>\n               </div>\n               <DialogFooter>\n                 <Button type=\"submit\">Send Message</Button>\n               </DialogFooter>\n             </DialogContent>\n           </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Contact List</CardTitle>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative w-64\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input placeholder=\"Search contacts...\" className=\"pl-9\" />\n                </div>\n                <Button variant=\"outline\" size=\"icon\"><Filter className=\"h-4 w-4\" /></Button>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[50px]\">\n                    <Checkbox \n                      checked={selectedContacts.length === contactsData.length && contactsData.length > 0}\n                      onCheckedChange={toggleSelectAll}\n                    />\n                  </TableHead>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Phone</TableHead>\n                  <TableHead>Tags</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {contactsData.map((contact) => (\n                  <TableRow key={contact.id}>\n                    <TableCell>\n                      <Checkbox \n                        checked={selectedContacts.includes(contact.id)}\n                        onCheckedChange={() => toggleSelect(contact.id)}\n                      />\n                    </TableCell>\n                    <TableCell className=\"font-medium\">{contact.name}</TableCell>\n                    <TableCell>{contact.phone}</TableCell>\n                    <TableCell>\n                      {contact.tags.map(tag => (\n                        <Badge key={tag} variant=\"secondary\" className=\"mr-1\">{tag}</Badge>\n                      ))}\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={contact.status === 'Active' ? 'default' : 'outline'} className={contact.status === 'Active' ? 'bg-green-500 hover:bg-green-600' : ''}>\n                        {contact.status}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button variant=\"ghost\" size=\"icon\"><MoreHorizontal className=\"h-4 w-4\" /></Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6722,"size_tokens":null},"client/src/pages/ai/ManageAgents.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Bot, Trash2, Edit } from \"lucide-react\";\n\nexport default function ManageAgents() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">Manage AI Agents</h2>\n        <Card>\n          <CardHeader>\n             <CardTitle>Active Agents</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Model</TableHead>\n                  <TableHead>Conversations</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium flex items-center gap-2\">\n                    <Bot className=\"h-4 w-4 text-primary\" />\n                    Support Bot Level 1\n                  </TableCell>\n                  <TableCell>GPT-4o</TableCell>\n                  <TableCell>1,234</TableCell>\n                  <TableCell><span className=\"text-green-600 font-medium\">Active</span></TableCell>\n                  <TableCell className=\"text-right space-x-2\">\n                    <Button variant=\"ghost\" size=\"icon\"><Edit className=\"h-4 w-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\"><Trash2 className=\"h-4 w-4\" /></Button>\n                  </TableCell>\n                </TableRow>\n                <TableRow>\n                  <TableCell className=\"font-medium flex items-center gap-2\">\n                    <Bot className=\"h-4 w-4 text-primary\" />\n                    Sales Assistant\n                  </TableCell>\n                  <TableCell>GPT-3.5-Turbo</TableCell>\n                  <TableCell>543</TableCell>\n                  <TableCell><span className=\"text-gray-500 font-medium\">Paused</span></TableCell>\n                  <TableCell className=\"text-right space-x-2\">\n                    <Button variant=\"ghost\" size=\"icon\"><Edit className=\"h-4 w-4\" /></Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\"><Trash2 className=\"h-4 w-4\" /></Button>\n                  </TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2834,"size_tokens":null},"client/src/components/ui/stats-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  description?: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    label: string;\n  };\n  className?: string;\n}\n\nexport function StatsCard({ title, value, description, icon: Icon, trend, className }: StatsCardProps) {\n  return (\n    <Card className={className}>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-2xl font-bold\">{value}</div>\n        {(description || trend) && (\n          <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n            {trend && (\n              <span className={trend.value > 0 ? \"text-emerald-600 font-medium\" : \"text-destructive font-medium\"}>\n                {trend.value > 0 ? \"+\" : \"\"}{trend.value}%\n              </span>\n            )}\n            {trend && <span className=\"text-muted-foreground/60\">{trend.label}</span>}\n            {!trend && description}\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1364,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation/Keywords.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Trash2, Edit } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nconst keywords = [\n  { id: 1, keyword: \"PRICE\", matchType: \"Exact\", reply: \"Our pricing starts at $10/month. Check details here...\", status: \"Active\" },\n  { id: 2, keyword: \"HELP\", matchType: \"Contains\", reply: \"Support options: 1. Sales, 2. Tech, 3. Billing\", status: \"Active\" },\n  { id: 3, keyword: \"STOP\", matchType: \"Exact\", reply: \"You have been unsubscribed.\", status: \"Active\" },\n];\n\nexport default function Keywords() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Keyword Auto-replies</h2>\n             <p className=\"text-muted-foreground\">Set up triggers for specific words in incoming messages.</p>\n          </div>\n          <Dialog>\n            <DialogTrigger asChild>\n               <Button>\n                 <Plus className=\"mr-2 h-4 w-4\" />\n                 Add New Rule\n               </Button>\n            </DialogTrigger>\n            <DialogContent>\n               <DialogHeader>\n                 <DialogTitle>New Keyword Rule</DialogTitle>\n               </DialogHeader>\n               <div className=\"grid gap-4 py-4\">\n                 <div className=\"grid gap-2\">\n                   <Label>Keyword</Label>\n                   <Input placeholder=\"e.g., HELLO\" />\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Match Type</Label>\n                   <Select defaultValue=\"exact\">\n                     <SelectTrigger>\n                       <SelectValue />\n                     </SelectTrigger>\n                     <SelectContent>\n                       <SelectItem value=\"exact\">Exact Match</SelectItem>\n                       <SelectItem value=\"contains\">Contains</SelectItem>\n                     </SelectContent>\n                   </Select>\n                 </div>\n                 <div className=\"grid gap-2\">\n                   <Label>Reply Message</Label>\n                   <Textarea placeholder=\"The automated response...\" />\n                 </div>\n               </div>\n               <DialogFooter>\n                 <Button>Save Rule</Button>\n               </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Active Rules</CardTitle>\n             <CardDescription>Messages that trigger an automatic response.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Keyword</TableHead>\n                  <TableHead>Match Type</TableHead>\n                  <TableHead>Reply Preview</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {keywords.map((rule) => (\n                  <TableRow key={rule.id}>\n                    <TableCell className=\"font-mono font-bold\">{rule.keyword}</TableCell>\n                    <TableCell>{rule.matchType}</TableCell>\n                    <TableCell className=\"text-muted-foreground truncate max-w-[300px]\">{rule.reply}</TableCell>\n                    <TableCell>\n                      <Badge className=\"bg-green-500\">{rule.status}</Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right space-x-2\">\n                      <Button variant=\"ghost\" size=\"icon\"><Edit className=\"h-4 w-4\" /></Button>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\"><Trash2 className=\"h-4 w-4\" /></Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4776,"size_tokens":null},"WhatsappBusinessDashboard/script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/pages/inbox.tsx":{"content":"import { useState, useEffect, useRef, useMemo, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { \n  Search, \n  Paperclip, \n  Send, \n  Smile, \n  MoreVertical, \n  Phone, \n  Video, \n  Loader2, \n  Download, \n  Clock,\n  Bot,\n  FileText,\n  MessageSquare,\n  Reply,\n  X,\n  MailOpen,\n  CheckSquare,\n  Ban,\n  Trash2,\n  ArrowLeft,\n  UserPlus,\n  Users\n} from \"lucide-react\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags: string[];\n}\n\ninterface Message {\n  id: string;\n  contactId: string;\n  content: string;\n  type: string;\n  direction: \"inbound\" | \"outbound\";\n  status: string;\n  timestamp: string;\n  replyToMessageId?: string;\n  replyToContent?: string;\n  mediaUrl?: string;\n}\n\ninterface LeadAssignment {\n  id: string;\n  contactId: string;\n  assignedToUserId: string;\n  assignedToUserName: string;\n  status: string;\n  priority: string;\n}\n\ninterface AssignableUser {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n}\n\ninterface Chat {\n  id: string;\n  contactId: string;\n  contact: Contact;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  lastInboundMessageTime?: string;\n  unreadCount: number;\n  status: string;\n  fromWindowInbox?: boolean;\n  assignment?: LeadAssignment | null;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  variables: string[];\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\ninterface ImportedContact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n}\n\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, '');\n}\n\nasync function downloadMediaWithAuth(mediaUrl: string, filename: string, openInNewTab: boolean = false) {\n  try {\n    const response = await fetch(`/api/webhook/whatsapp/media/${mediaUrl}`, {\n      headers: getAuthHeaders()\n    });\n    \n    if (!response.ok) {\n      throw new Error('Failed to download media');\n    }\n    \n    const blob = await response.blob();\n    const url = URL.createObjectURL(blob);\n    \n    if (openInNewTab) {\n      window.open(url, '_blank');\n    } else {\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    }\n    \n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  } catch (error) {\n    console.error('Media download error:', error);\n    toast.error('Failed to download file. Please try again.');\n  }\n}\n\nexport default function Inbox() {\n  const [selectedChatId, setSelectedChatId] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [filter, setFilter] = useState<\"all\" | \"unread\">(\"all\");\n  const [selectedContacts, setSelectedContacts] = useState<string[]>([]);\n  const [isBulkSendOpen, setIsBulkSendOpen] = useState(false);\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai\">(\"template\");\n  const [selectedTemplate, setSelectedTemplate] = useState(\"\");\n  const [selectedAgent, setSelectedAgent] = useState(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [blockDialogOpen, setBlockDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [blockReason, setBlockReason] = useState(\"\");\n  const [mobileView, setMobileView] = useState<\"list\" | \"chat\">(\"list\");\n  const [assignDialogOpen, setAssignDialogOpen] = useState(false);\n  const [selectedUserToAssign, setSelectedUserToAssign] = useState(\"\");\n  const [assignPriority, setAssignPriority] = useState<string>(\"medium\");\n  const [bulkAssignDialogOpen, setBulkAssignDialogOpen] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const queryClient = useQueryClient();\n\n  const { data: chats = [], isLoading: chatsLoading } = useQuery<Chat[]>({\n    queryKey: [\"/api/chats\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/chats\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch chats\");\n      return res.json();\n    },\n    refetchInterval: 3000,\n  });\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  const { data: importedContacts = [] } = useQuery<ImportedContact[]>({\n    queryKey: [\"/api/contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch contacts\");\n      return res.json();\n    },\n  });\n\n  const { data: assignableUsers = [] } = useQuery<AssignableUser[]>({\n    queryKey: [\"/api/lead-management/assignable-users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/lead-management/assignable-users\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch assignable users\");\n      return res.json();\n    },\n  });\n\n  const assignLeadMutation = useMutation({\n    mutationFn: async ({ contactId, phone, contactName, assignedToUserId, priority }: { \n      contactId: string; \n      phone: string;\n      contactName: string;\n      assignedToUserId: string;\n      priority: string;\n    }) => {\n      const res = await fetch(\"/api/lead-management/assign\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", ...getAuthHeaders() },\n        body: JSON.stringify({ contactId, phone, contactName, assignedToUserId, priority }),\n      });\n      if (!res.ok) throw new Error(\"Failed to assign lead\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setAssignDialogOpen(false);\n      setSelectedUserToAssign(\"\");\n      setAssignPriority(\"medium\");\n      toast.success(\"Lead assigned successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to assign lead\");\n    }\n  });\n\n  const bulkAssignMutation = useMutation({\n    mutationFn: async ({ contactIds, assignedToUserId, priority }: { \n      contactIds: string[]; \n      assignedToUserId: string;\n      priority: string;\n    }) => {\n      const res = await fetch(\"/api/lead-management/bulk-assign\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", ...getAuthHeaders() },\n        body: JSON.stringify({ contactIds, assignedToUserId, priority }),\n      });\n      if (!res.ok) throw new Error(\"Failed to bulk assign leads\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setBulkAssignDialogOpen(false);\n      setSelectedContacts([]);\n      setSelectedUserToAssign(\"\");\n      setAssignPriority(\"medium\");\n      toast.success(`${data.assigned} leads assigned successfully`);\n    },\n    onError: () => {\n      toast.error(\"Failed to bulk assign leads\");\n    }\n  });\n\n  const { phoneToNameMap, last10ToNameMap } = useMemo(() => {\n    const phoneMap = new Map<string, string>();\n    const last10Map = new Map<string, string>();\n    \n    const isRealName = (name: string): boolean => {\n      if (!name || !name.trim()) return false;\n      if (name.startsWith('WhatsApp')) return false;\n      if (name.startsWith('+')) return false;\n      if (/^\\d[\\d\\s]*$/.test(name)) return false;\n      return true;\n    };\n    \n    importedContacts.forEach(contact => {\n      const normalizedPhone = normalizePhone(contact.phone);\n      if (isRealName(contact.name)) {\n        phoneMap.set(normalizedPhone, contact.name);\n        if (normalizedPhone.length >= 10) {\n          last10Map.set(normalizedPhone.slice(-10), contact.name);\n        }\n      }\n    });\n    \n    return { phoneToNameMap: phoneMap, last10ToNameMap: last10Map };\n  }, [importedContacts]);\n\n  const getContactName = useMemo(() => {\n    return (chatContact: Contact): string => {\n      const normalizedPhone = normalizePhone(chatContact.phone);\n      \n      if (chatContact.name && \n          !chatContact.name.startsWith('WhatsApp') && \n          !chatContact.name.startsWith('+') &&\n          !/^\\d+$/.test(chatContact.name.replace(/\\s/g, ''))) {\n        return chatContact.name;\n      }\n      \n      let name = phoneToNameMap.get(normalizedPhone);\n      if (name) return name;\n      \n      if (normalizedPhone.length >= 10) {\n        const last10 = normalizedPhone.slice(-10);\n        name = last10ToNameMap.get(last10);\n        if (name) return name;\n      }\n      \n      return chatContact.phone.startsWith('+') ? chatContact.phone : `+${chatContact.phone}`;\n    };\n  }, [phoneToNameMap, last10ToNameMap]);\n\n  const selectedChat = chats.find(c => c.id === selectedChatId);\n  const selectedContactId = selectedChat?.contactId;\n\n  const { data: rawMessages = [], isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [\"/api/messages\", selectedContactId],\n    queryFn: async () => {\n      if (!selectedContactId) return [];\n      const res = await fetch(`/api/messages?contactId=${selectedContactId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      return res.json();\n    },\n    enabled: !!selectedContactId,\n    refetchInterval: 2000,\n  });\n\n  // Deduplicate messages using message ID (keep only unique messages)\n  // This filters out any duplicate database entries based on unique message ID\n  const messages = useMemo(() => {\n    const seen = new Set<string>();\n    return rawMessages.filter(msg => {\n      if (seen.has(msg.id)) {\n        return false;\n      }\n      seen.add(msg.id);\n      return true;\n    });\n  }, [rawMessages]);\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ content, phone, contactId, replyToMessageId, replyToContent }: { \n      content: string; \n      phone: string; \n      contactId: string;\n      replyToMessageId?: string;\n      replyToContent?: string;\n    }) => {\n      const waRes = await fetch(\"/api/webhook/whatsapp/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          to: phone,\n          message: replyToContent ? `> ${replyToContent.substring(0, 50)}${replyToContent.length > 50 ? '...' : ''}\\n\\n${content}` : content,\n        }),\n      });\n      \n      if (!waRes.ok) {\n        const error = await waRes.json();\n        throw new Error(error.error || \"Failed to send WhatsApp message\");\n      }\n      \n      const res = await fetch(\"/api/messages\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          contactId,\n          content,\n          type: \"text\",\n          direction: \"outbound\",\n          status: \"sent\",\n          replyToMessageId,\n          replyToContent,\n        }),\n      });\n      \n      if (!res.ok) {\n        console.error(\"Failed to save message locally, but WhatsApp sent\");\n      }\n      \n      return { waResult: await waRes.json(), contactId };\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/messages\", data.contactId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setMessageInput(\"\");\n      setReplyingTo(null);\n      toast.success(\"Message sent via WhatsApp\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"Failed to send message\");\n    },\n  });\n\n  const sendBulkMessageMutation = useMutation({\n    mutationFn: async (data: { contacts: string[], messageType: string, content: string }) => {\n      const results: { success: number; failed: number } = { success: 0, failed: 0 };\n      \n      for (const contactId of data.contacts) {\n        const chat = chats.find(c => c.contactId === contactId);\n        if (!chat) continue;\n        \n        const phone = chat.contact.phone.replace(/\\D/g, '');\n        const name = getContactName(chat.contact);\n        const templateObj = templates.find(t => t.id === selectedTemplate);\n        \n        try {\n          const res = await fetch(\"/api/inbox/send\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              contactId,\n              phone,\n              name,\n              messageType: data.messageType,\n              templateName: templateObj?.name,\n              customMessage: data.messageType === \"custom\" ? data.content : undefined,\n              agentId: data.messageType === \"ai\" ? selectedAgent : undefined,\n            }),\n          });\n          \n          if (res.ok) {\n            results.success++;\n          } else {\n            results.failed++;\n          }\n        } catch {\n          results.failed++;\n        }\n      }\n      \n      return results;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setSelectedContacts([]);\n      setIsBulkSendOpen(false);\n      setCustomMessage(\"\");\n      setSelectedTemplate(\"\");\n      setSelectedAgent(\"\");\n      if (data.failed > 0) {\n        toast.success(`Sent to ${data.success} contacts, ${data.failed} failed`);\n      } else {\n        toast.success(`Message sent to ${data.success} contact${data.success > 1 ? 's' : ''}`);\n      }\n    },\n    onError: () => {\n      toast.error(\"Failed to send messages\");\n    },\n  });\n\n  useEffect(() => {\n    if (chats.length > 0 && !selectedChatId) {\n      setSelectedChatId(chats[0].id);\n    }\n  }, [chats, selectedChatId]);\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetch(`/api/chats/${contactId}/mark-read`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as read\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n    },\n  });\n\n  const markAsUnreadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetch(`/api/chats/${contactId}/mark-unread`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as unread\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      toast.success(\"Marked as unread\");\n    },\n  });\n\n  const blockContactMutation = useMutation({\n    mutationFn: async ({ phone, name, reason }: { phone: string; name: string; reason: string }) => {\n      const res = await fetch(\"/api/contacts/block\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phone, name, reason }),\n      });\n      if (!res.ok) throw new Error(\"Failed to block contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setBlockDialogOpen(false);\n      setBlockReason(\"\");\n      setSelectedChatId(null);\n      toast.success(\"Contact blocked successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to block contact\");\n    },\n  });\n\n  const deleteContactMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetch(`/api/contacts/${contactId}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setDeleteDialogOpen(false);\n      setSelectedChatId(null);\n      toast.success(\"Contact deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete contact\");\n    },\n  });\n\n  const handleSelectChat = (chatId: string) => {\n    setSelectedChatId(chatId);\n    setMobileView(\"chat\");\n    const chat = chats.find(c => c.id === chatId);\n    if (chat && chat.unreadCount > 0) {\n      markAsReadMutation.mutate(chat.contactId);\n    }\n  };\n\n  const handleBackToList = () => {\n    setMobileView(\"list\");\n  };\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedChat || !selectedContactId) return;\n    const phone = selectedChat.contact.phone.replace(/\\D/g, '');\n    sendMessageMutation.mutate({ \n      content: messageInput, \n      phone, \n      contactId: selectedContactId,\n      replyToMessageId: replyingTo?.id,\n      replyToContent: replyingTo?.content,\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleSelectAll = () => {\n    if (selectedContacts.length === filteredChats.length) {\n      setSelectedContacts([]);\n    } else {\n      setSelectedContacts(filteredChats.map(c => c.contactId));\n    }\n  };\n\n  const handleSelectContact = (contactId: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    setSelectedContacts(prev => \n      prev.includes(contactId) \n        ? prev.filter(id => id !== contactId) \n        : [...prev, contactId]\n    );\n  };\n\n  const handleBulkSend = () => {\n    if (selectedContacts.length === 0) {\n      toast.error(\"Please select at least one contact\");\n      return;\n    }\n\n    let content = \"\";\n    if (messageType === \"template\") {\n      const template = templates.find(t => t.id === selectedTemplate);\n      content = template?.content || \"\";\n    } else if (messageType === \"custom\") {\n      content = customMessage;\n    } else if (messageType === \"ai\") {\n      content = `[AI Agent: ${agents.find(a => a.id === selectedAgent)?.name || 'Unknown'}]`;\n    }\n\n    if (!content && messageType !== \"ai\") {\n      toast.error(\"Please enter a message or select a template\");\n      return;\n    }\n\n    sendBulkMessageMutation.mutate({\n      contacts: selectedContacts,\n      messageType,\n      content,\n    });\n  };\n\n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const days = Math.floor(diff / 86400000);\n    \n    if (days === 0) {\n      return date.toLocaleTimeString(\"en-US\", { hour: \"numeric\", minute: \"2-digit\", hour12: true });\n    } else if (days === 1) {\n      return \"Yesterday\";\n    } else if (days < 7) {\n      return `${days} days ago`;\n    } else {\n      return date.toLocaleDateString();\n    }\n  };\n\n  const isWithin24Hours = (chat: Chat) => {\n    if (!chat.lastInboundMessageTime) return false;\n    const lastInbound = new Date(chat.lastInboundMessageTime);\n    const now = new Date();\n    const hoursDiff = (now.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n    return hoursDiff <= 24;\n  };\n\n  const filteredChats = chats.filter(chat => {\n    const matchesSearch = getContactName(chat.contact).toLowerCase().includes(searchQuery.toLowerCase()) ||\n      chat.contact.phone.includes(searchQuery);\n    const matchesFilter = filter === \"all\" || (filter === \"unread\" && chat.unreadCount > 0);\n    return matchesSearch && matchesFilter;\n  });\n\n  const windowLeads = chats.filter(chat => {\n    if (chat.lastInboundMessageTime) {\n      const lastInbound = new Date(chat.lastInboundMessageTime);\n      const now = new Date();\n      const hoursDiff = (now.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n      return hoursDiff > 24;\n    }\n    return true;\n  });\n\n  const handleExportList = () => {\n    const data = windowLeads.map(chat => ({\n      name: getContactName(chat.contact),\n      phone: chat.contact.phone,\n      email: chat.contact.email || \"\",\n      lastMessage: chat.lastMessage || \"\",\n      lastMessageTime: chat.lastMessageTime || \"\",\n    }));\n\n    const headers = [\"Name\", \"Phone\", \"Email\", \"Last Message\", \"Last Message Time\"];\n    const csv = [\n      headers.join(\",\"),\n      ...data.map(row => \n        [row.name, row.phone, row.email, `\"${row.lastMessage}\"`, row.lastMessageTime].join(\",\")\n      )\n    ].join(\"\\n\");\n\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"inbox_leads_outside_window.csv\";\n    a.click();\n    URL.revokeObjectURL(url);\n    toast.success(\"List exported successfully\");\n  };\n\n  const getInitials = (contact: Contact) => {\n    const displayName = getContactName(contact);\n    if (displayName.startsWith('+')) {\n      return displayName.slice(-2);\n    }\n    return displayName.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();\n  };\n\n  const approvedTemplates = templates.filter(t => t.status === \"approved\");\n\n  const renderMessageContent = (msg: Message) => {\n    const content = msg.content;\n    const mediaUrl = msg.mediaUrl;\n    \n    if (msg.type === 'image' || content.startsWith('[Image')) {\n      if (mediaUrl) {\n        const caption = content.replace(/^\\[Image\\]\\s*/, '').replace(/^\\[Image message\\]$/, '');\n        return (\n          <div className=\"space-y-2\">\n            <img \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              alt=\"Shared image\" \n              className=\"max-w-[280px] max-h-[300px] rounded-lg object-cover cursor-pointer hover:opacity-90 transition-opacity\"\n              onClick={() => downloadMediaWithAuth(mediaUrl, 'image.jpg', true)}\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n                (e.target as HTMLImageElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\"> Image expired or unavailable</span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'video' || content.startsWith('[Video')) {\n      if (mediaUrl) {\n        const caption = content.replace(/^\\[Video\\]\\s*/, '').replace(/^\\[Video message\\]$/, '');\n        return (\n          <div className=\"space-y-2\">\n            <video \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              controls\n              className=\"max-w-[280px] max-h-[300px] rounded-lg\"\n              onError={(e) => {\n                (e.target as HTMLVideoElement).style.display = 'none';\n                (e.target as HTMLVideoElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\"> Video expired or unavailable</span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'audio' || content.startsWith('[Audio')) {\n      if (mediaUrl) {\n        return (\n          <div className=\"space-y-2\">\n            <audio \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              controls\n              className=\"max-w-[280px]\"\n              onError={(e) => {\n                (e.target as HTMLAudioElement).style.display = 'none';\n                (e.target as HTMLAudioElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\"> Audio expired or unavailable</span>\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'sticker' || content.startsWith('[Sticker')) {\n      if (mediaUrl) {\n        return (\n          <div>\n            <img \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              alt=\"Sticker\" \n              className=\"max-w-[150px] max-h-[150px]\"\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n                (e.target as HTMLImageElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\"> Sticker expired or unavailable</span>\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'document' || content.startsWith('[Document')) {\n      if (mediaUrl) {\n        const filename = content.match(/\\[Document: ([^\\]]+)\\]/)?.[1] || 'document';\n        return (\n          <div className=\"flex items-center gap-2\">\n            <button \n              onClick={() => downloadMediaWithAuth(mediaUrl, filename, true)}\n              className=\"flex items-center gap-2 p-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer\"\n            >\n              <span className=\"text-lg\"></span>\n              <span className=\"text-sm underline\">{filename}</span>\n            </button>\n            <button\n              onClick={() => downloadMediaWithAuth(mediaUrl, filename, false)}\n              className=\"p-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors\"\n              title=\"Download\"\n            >\n              <Download className=\"h-4 w-4\" />\n            </button>\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Location')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Contact')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Reaction')) {\n      return <span className=\"flex items-center gap-1\">{content}</span>;\n    } else if (content.startsWith('[Unsupported')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    }\n    \n    return <span>{content}</span>;\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"h-[calc(100vh-80px)] md:h-[calc(100vh-100px)] p-1 flex flex-col gap-2 md:gap-4 animate-in fade-in duration-500 overflow-hidden\">\n        <div className={`flex flex-col md:flex-row md:items-center justify-between gap-2 flex-shrink-0 ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n          <div>\n            <h2 className=\"text-lg md:text-2xl font-bold tracking-tight\">Inbox</h2>\n            <p className=\"text-xs md:text-sm text-muted-foreground hidden md:block\">\n              All conversations. Contacts outside 24-hour window require templates.\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" className=\"md:size-default\" onClick={handleExportList}>\n              <Download className=\"h-4 w-4 md:mr-2\" />\n              <span className=\"hidden md:inline\">Export List ({windowLeads.length})</span>\n            </Button>\n            {selectedContacts.length > 0 && (\n              <>\n              <Button size=\"sm\" className=\"md:size-default\" variant=\"outline\" onClick={() => setBulkAssignDialogOpen(true)}>\n                <Users className=\"h-4 w-4 md:mr-2\" />\n                <span className=\"hidden md:inline\">Assign</span> {selectedContacts.length}\n              </Button>\n              <Button size=\"sm\" className=\"md:size-default\" onClick={() => setIsBulkSendOpen(true)}>\n                <Send className=\"h-4 w-4 md:mr-2\" />\n                <span className=\"hidden md:inline\">Send to</span> {selectedContacts.length}\n              </Button>\n              </>\n            )}\n          </div>\n        </div>\n\n        <div className={`flex items-center gap-2 md:gap-4 p-2 md:p-3 bg-muted/50 rounded-lg flex-shrink-0 ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n          <Checkbox \n            checked={selectedContacts.length === filteredChats.length && filteredChats.length > 0}\n            onCheckedChange={handleSelectAll}\n          />\n          <span className=\"text-xs md:text-sm font-medium\">Select All ({filteredChats.length} chats)</span>\n          {selectedContacts.length > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">{selectedContacts.length} selected</Badge>\n          )}\n        </div>\n\n      <div className=\"flex-1 min-h-0 flex flex-col md:flex-row bg-card border border-border rounded-lg overflow-hidden shadow-sm\">\n        <div className={`w-full md:w-80 lg:w-96 md:border-r border-border flex flex-col bg-background min-h-0 h-full ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n          <div className=\"p-3 md:p-4 border-b border-border\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input \n                placeholder=\"Search chats...\" \n                className=\"pl-9 bg-secondary/50\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n              />\n            </div>\n            <div className=\"flex gap-2 mt-4\">\n              <Badge \n                variant={filter === \"all\" ? \"default\" : \"outline\"} \n                className=\"cursor-pointer\"\n                onClick={() => setFilter(\"all\")}\n              >\n                All\n              </Badge>\n              <Badge \n                variant={filter === \"unread\" ? \"default\" : \"outline\"} \n                className=\"cursor-pointer hover:bg-secondary\"\n                onClick={() => setFilter(\"unread\")}\n              >\n                Unread\n              </Badge>\n            </div>\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            {chatsLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n              </div>\n            ) : filteredChats.length === 0 ? (\n              <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                No chats found\n              </div>\n            ) : (\n              <div className=\"divide-y divide-border\">\n                {filteredChats.map((chat) => (\n                  <div \n                    key={chat.id} \n                    className={`p-3 flex items-start gap-2 hover:bg-muted/50 cursor-pointer transition-colors ${chat.id === selectedChatId ? 'bg-muted/50' : ''}`}\n                    onClick={() => handleSelectChat(chat.id)}\n                  >\n                    <Checkbox \n                      checked={selectedContacts.includes(chat.contactId)}\n                      onCheckedChange={() => {}}\n                      onClick={(e) => handleSelectContact(chat.contactId, e)}\n                      className=\"mt-1\"\n                    />\n                    <Avatar className=\"h-9 w-9\">\n                      <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                        {getInitials(chat.contact)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-1.5\">\n                          <span className={`text-sm font-medium truncate ${chat.unreadCount > 0 ? 'font-bold' : ''}`}>\n                            {getContactName(chat.contact)}\n                          </span>\n                          {isWithin24Hours(chat) && (\n                            <Badge variant=\"outline\" className=\"text-[10px] bg-green-50 text-green-700 border-green-200 px-1 py-0\">\n                              <Clock className=\"h-2.5 w-2.5\" />\n                            </Badge>\n                          )}\n                          {chat.assignment && (\n                            <Badge variant=\"outline\" className=\"text-[10px] bg-blue-50 text-blue-700 border-blue-200 px-1 py-0\">\n                              <UserPlus className=\"h-2.5 w-2.5 mr-0.5\" />\n                              {chat.assignment.assignedToUserName?.split(' ')[0] || 'Assigned'}\n                            </Badge>\n                          )}\n                          {chat.unreadCount > 0 && (\n                            <span className=\"h-4 w-4 rounded-full bg-primary text-primary-foreground text-[9px] flex items-center justify-center font-medium\">\n                              {chat.unreadCount}\n                            </span>\n                          )}\n                        </div>\n                        <span className=\"text-[11px] text-muted-foreground whitespace-nowrap\">\n                          {chat.lastMessageTime ? formatTime(chat.lastMessageTime) : \"\"}\n                        </span>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                        {chat.lastMessage || \"No messages yet\"}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </ScrollArea>\n        </div>\n\n        <div className={`flex-1 flex flex-col bg-[#efeae2] dark:bg-zinc-900 bg-opacity-50 min-h-0 h-full ${mobileView === \"list\" ? \"hidden md:flex\" : \"flex\"}`}>\n          {selectedChat ? (\n            <>\n              <div className=\"h-14 md:h-16 bg-background border-b border-border flex items-center justify-between px-2 md:px-6 flex-shrink-0\">\n                <div className=\"flex items-center gap-2 md:gap-3\">\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\" \n                    className=\"flex md:hidden h-9 w-9 shrink-0\"\n                    onClick={handleBackToList}\n                  >\n                    <ArrowLeft className=\"h-5 w-5\" />\n                  </Button>\n                  <Avatar className=\"h-8 w-8 md:h-10 md:w-10\">\n                    <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                      {getInitials(selectedChat.contact)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"min-w-0\">\n                    <h3 className=\"font-medium text-sm md:text-base truncate\">{getContactName(selectedChat.contact)}</h3>\n                    <div className=\"flex items-center gap-1 md:gap-2 flex-wrap\">\n                      <span className=\"text-[10px] md:text-xs text-muted-foreground truncate\">{selectedChat.contact.phone}</span>\n                      {isWithin24Hours(selectedChat) && (\n                        <Badge variant=\"outline\" className=\"text-[9px] md:text-xs bg-green-50 text-green-700 border-green-200 py-0\">\n                          <Clock className=\"h-2.5 w-2.5 md:h-3 md:w-3 mr-0.5 md:mr-1\" />\n                          24hr\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-1 md:gap-2\">\n                  <Button variant=\"ghost\" size=\"icon\" className=\"hidden md:flex\"><Phone className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"hidden md:flex\"><Video className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\"><MoreVertical className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem onClick={() => markAsUnreadMutation.mutate(selectedChat.contactId)}>\n                        <MailOpen className=\"mr-2 h-4 w-4\" />\n                        Mark as Unread\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setAssignDialogOpen(true)} className=\"text-blue-600\">\n                        <UserPlus className=\"mr-2 h-4 w-4\" />\n                        Assign Lead\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setBlockDialogOpen(true)} className=\"text-orange-600\">\n                        <Ban className=\"mr-2 h-4 w-4\" />\n                        Block Contact\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => setDeleteDialogOpen(true)} className=\"text-red-600\">\n                        <Trash2 className=\"mr-2 h-4 w-4\" />\n                        Delete Contact\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </div>\n\n              <div className=\"flex-1 min-h-0 overflow-y-auto p-3 md:p-6\">\n                {messagesLoading ? (\n                  <div className=\"flex items-center justify-center h-full\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                  </div>\n                ) : messages.length === 0 ? (\n                  <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\n                    No messages yet. Start the conversation!\n                  </div>\n                ) : (\n                  <div className=\"space-y-3 md:space-y-4\">\n                    {messages.map((msg) => (\n                      <div \n                        key={msg.id} \n                        className={`flex ${msg.direction === 'inbound' ? 'justify-start' : 'justify-end'} group`}\n                      >\n                        <div className={`flex items-start gap-1 ${msg.direction === 'inbound' ? 'flex-row' : 'flex-row-reverse'}`}>\n                          {msg.direction === 'inbound' && (\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\" \n                              className=\"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex\"\n                              onClick={() => setReplyingTo(msg)}\n                            >\n                              <Reply className=\"h-3 w-3\" />\n                            </Button>\n                          )}\n                          <div \n                            className={`max-w-[85%] md:max-w-[70%] rounded-lg px-3 md:px-4 py-2 shadow-sm relative break-words\n                              ${msg.direction === 'inbound' \n                                ? 'bg-white dark:bg-card text-card-foreground rounded-tl-none' \n                                : 'bg-[#d9fdd3] dark:bg-primary/20 text-foreground rounded-tr-none'\n                              }\n                            `}\n                          >\n                            {msg.replyToContent && (\n                              <div className=\"mb-2 p-2 bg-black/5 dark:bg-white/10 rounded border-l-2 border-primary/50 text-xs text-muted-foreground\">\n                                <Reply className=\"h-3 w-3 inline mr-1\" />\n                                {msg.replyToContent.substring(0, 60)}\n                                {msg.replyToContent.length > 60 && '...'}\n                              </div>\n                            )}\n                            <div className=\"text-sm leading-relaxed\">{renderMessageContent(msg)}</div>\n                            <span className=\"text-[10px] text-muted-foreground/80 block text-right mt-1\">\n                              {formatTime(msg.timestamp)}\n                              {msg.direction === 'outbound' && (\n                                <span className={`ml-1 ${msg.status === 'read' ? 'text-blue-500' : msg.status === 'failed' ? 'text-red-500' : ''}`}>\n                                  {msg.status === 'read' ? '' : msg.status === 'delivered' ? '' : msg.status === 'failed' ? '' : ''}\n                                </span>\n                              )}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                    <div ref={messagesEndRef} />\n                  </div>\n                )}\n              </div>\n\n              <div className=\"p-2 md:p-4 bg-background border-t border-border flex-shrink-0\">\n                {replyingTo && (\n                  <div className=\"mb-2 p-2 bg-muted rounded-lg flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2 text-xs md:text-sm min-w-0\">\n                      <Reply className=\"h-3 w-3 md:h-4 md:w-4 text-muted-foreground shrink-0\" />\n                      <span className=\"text-muted-foreground hidden md:inline\">Replying to:</span>\n                      <span className=\"truncate max-w-[150px] md:max-w-[300px]\">{replyingTo.content}</span>\n                    </div>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 shrink-0\" onClick={() => setReplyingTo(null)}>\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                )}\n                <div className=\"flex items-center gap-1 md:gap-2\">\n                  <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground hidden md:flex\">\n                    <Smile className=\"h-6 w-6\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground h-8 w-8 md:h-10 md:w-10\">\n                    <Paperclip className=\"h-5 w-5 md:h-6 md:w-6\" />\n                  </Button>\n                  <Input \n                    placeholder=\"Type a message...\" \n                    className=\"flex-1 bg-secondary/50 border-none focus-visible:ring-1 text-sm h-9 md:h-10\"\n                    value={messageInput}\n                    onChange={(e) => setMessageInput(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                  />\n                  <Button \n                    size=\"icon\" \n                    className=\"rounded-full h-9 w-9 md:h-10 md:w-10 shrink-0\"\n                    onClick={handleSendMessage}\n                    disabled={!messageInput.trim() || sendMessageMutation.isPending}\n                  >\n                    {sendMessageMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 md:h-5 md:w-5 animate-spin\" />\n                    ) : (\n                      <Send className=\"h-4 w-4 md:h-5 md:w-5\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n              Select a chat to start messaging\n            </div>\n          )}\n        </div>\n      </div>\n      </div>\n\n      <Dialog open={isBulkSendOpen} onOpenChange={setIsBulkSendOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Send className=\"h-5 w-5\" />\n              Send Message to {selectedContacts.length} Contacts\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"p-3 bg-amber-50 dark:bg-amber-950/30 rounded-lg text-sm text-amber-700 dark:text-amber-400\">\n              <Clock className=\"h-4 w-4 inline mr-2\" />\n              Note: Contacts outside the 24-hour window will only receive template messages. Custom messages work only for those within the window.\n            </div>\n\n            <Tabs value={messageType} onValueChange={(v) => setMessageType(v as any)}>\n              <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"template\" className=\"flex items-center gap-2\">\n                  <FileText className=\"h-4 w-4\" />\n                  Template\n                </TabsTrigger>\n                <TabsTrigger value=\"custom\" className=\"flex items-center gap-2\">\n                  <MessageSquare className=\"h-4 w-4\" />\n                  Custom\n                </TabsTrigger>\n                <TabsTrigger value=\"ai\" className=\"flex items-center gap-2\">\n                  <Bot className=\"h-4 w-4\" />\n                  AI Agent\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"template\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select Template</Label>\n                  <Select value={selectedTemplate} onValueChange={setSelectedTemplate}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose a template\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {approvedTemplates.map(template => (\n                        <SelectItem key={template.id} value={template.id}>\n                          {template.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedTemplate && (\n                  <div className=\"p-3 bg-muted rounded-lg\">\n                    <p className=\"text-sm\">\n                      {templates.find(t => t.id === selectedTemplate)?.content}\n                    </p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"custom\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Custom Message</Label>\n                  <Textarea \n                    placeholder=\"Type your message here...\"\n                    value={customMessage}\n                    onChange={(e) => setCustomMessage(e.target.value)}\n                    rows={5}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Custom messages work only within the 24-hour window after customer contact.\n                  </p>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"ai\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select AI Agent</Label>\n                  <Select value={selectedAgent} onValueChange={setSelectedAgent}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose an AI Agent\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {agents.filter(a => a.isActive).map(agent => (\n                        <SelectItem key={agent.id} value={agent.id}>\n                          {agent.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedAgent && (\n                  <div className=\"p-3 bg-muted rounded-lg\">\n                    <p className=\"text-sm\">\n                      {agents.find(a => a.id === selectedAgent)?.description || \"AI Agent will generate personalized responses.\"}\n                    </p>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsBulkSendOpen(false)}>Cancel</Button>\n            <Button onClick={handleBulkSend} disabled={sendBulkMessageMutation.isPending}>\n              {sendBulkMessageMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Send to {selectedContacts.length} Contact{selectedContacts.length > 1 ? 's' : ''}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Block Contact</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to block {selectedChat ? getContactName(selectedChat.contact) : \"this contact\"}? \n              You will no longer receive messages from them.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"py-4\">\n            <Label htmlFor=\"blockReason\">Reason (optional)</Label>\n            <Textarea \n              id=\"blockReason\"\n              placeholder=\"Enter reason for blocking...\"\n              value={blockReason}\n              onChange={(e) => setBlockReason(e.target.value)}\n              className=\"mt-2\"\n            />\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              className=\"bg-orange-600 hover:bg-orange-700\"\n              onClick={() => {\n                if (selectedChat) {\n                  blockContactMutation.mutate({\n                    phone: selectedChat.contact.phone,\n                    name: getContactName(selectedChat.contact),\n                    reason: blockReason,\n                  });\n                }\n              }}\n            >\n              Block Contact\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Contact</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete {selectedChat ? getContactName(selectedChat.contact) : \"this contact\"}? \n              This will permanently remove all chat history with this contact.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              className=\"bg-red-600 hover:bg-red-700\"\n              onClick={() => {\n                if (selectedChat) {\n                  deleteContactMutation.mutate(selectedChat.contactId);\n                }\n              }}\n            >\n              Delete Contact\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <Dialog open={assignDialogOpen} onOpenChange={setAssignDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Assign Lead</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Assign {selectedChat ? getContactName(selectedChat.contact) : \"this contact\"} to a team member\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Assign To</Label>\n              <Select value={selectedUserToAssign} onValueChange={setSelectedUserToAssign}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select team member\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {assignableUsers.map(user => (\n                    <SelectItem key={user.id} value={user.id}>\n                      {user.name} ({user.role})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Priority</Label>\n              <Select value={assignPriority} onValueChange={setAssignPriority}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"low\">Low</SelectItem>\n                  <SelectItem value=\"medium\">Medium</SelectItem>\n                  <SelectItem value=\"high\">High</SelectItem>\n                  <SelectItem value=\"urgent\">Urgent</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAssignDialogOpen(false)}>Cancel</Button>\n            <Button \n              onClick={() => {\n                if (selectedChat && selectedUserToAssign) {\n                  assignLeadMutation.mutate({\n                    contactId: selectedChat.contact.id,\n                    phone: selectedChat.contact.phone,\n                    contactName: getContactName(selectedChat.contact),\n                    assignedToUserId: selectedUserToAssign,\n                    priority: assignPriority,\n                  });\n                }\n              }}\n              disabled={!selectedUserToAssign || assignLeadMutation.isPending}\n            >\n              {assignLeadMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Assign Lead\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={bulkAssignDialogOpen} onOpenChange={setBulkAssignDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Bulk Assign Leads</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Assign {selectedContacts.length} selected contact{selectedContacts.length > 1 ? 's' : ''} to a team member\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Assign To</Label>\n              <Select value={selectedUserToAssign} onValueChange={setSelectedUserToAssign}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select team member\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {assignableUsers.map(user => (\n                    <SelectItem key={user.id} value={user.id}>\n                      {user.name} ({user.role})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Priority</Label>\n              <Select value={assignPriority} onValueChange={setAssignPriority}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"low\">Low</SelectItem>\n                  <SelectItem value=\"medium\">Medium</SelectItem>\n                  <SelectItem value=\"high\">High</SelectItem>\n                  <SelectItem value=\"urgent\">Urgent</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setBulkAssignDialogOpen(false)}>Cancel</Button>\n            <Button \n              onClick={() => {\n                if (selectedContacts.length > 0 && selectedUserToAssign) {\n                  bulkAssignMutation.mutate({\n                    contactIds: selectedContacts,\n                    assignedToUserId: selectedUserToAssign,\n                    priority: assignPriority,\n                  });\n                }\n              }}\n              disabled={!selectedUserToAssign || bulkAssignMutation.isPending}\n            >\n              {bulkAssignMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Assign {selectedContacts.length} Lead{selectedContacts.length > 1 ? 's' : ''}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":57299,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"server/modules/facebook/fb.controller.ts":{"content":"import { Request, Response } from 'express';\nimport * as fbService from './fb.service';\n\nexport async function syncForms(req: Request, res: Response) {\n  try {\n    const forms = await fbService.syncLeadForms();\n    res.json({ success: true, forms, count: forms.length });\n  } catch (error: any) {\n    console.error('Error syncing forms:', error);\n    res.status(500).json({ error: error.message || 'Failed to sync forms' });\n  }\n}\n\nexport async function listForms(req: Request, res: Response) {\n  try {\n    const forms = await fbService.getAllForms();\n    res.json(forms);\n  } catch (error) {\n    console.error('Error listing forms:', error);\n    res.status(500).json({ error: 'Failed to list forms' });\n  }\n}\n\nexport async function getForm(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const form = await fbService.getFormById(id);\n    if (!form) {\n      return res.status(404).json({ error: 'Form not found' });\n    }\n    res.json(form);\n  } catch (error) {\n    console.error('Error getting form:', error);\n    res.status(500).json({ error: 'Failed to get form' });\n  }\n}\n\nexport async function syncLeads(req: Request, res: Response) {\n  try {\n    const { formId } = req.params;\n    const leads = await fbService.syncLeadsForForm(formId);\n    res.json({ success: true, leads, count: leads.length });\n  } catch (error: any) {\n    console.error('Error syncing leads:', error);\n    res.status(500).json({ error: error.message || 'Failed to sync leads' });\n  }\n}\n\nexport async function listLeads(req: Request, res: Response) {\n  try {\n    const { formId } = req.query;\n    const leads = formId \n      ? await fbService.getLeadsByFormId(formId as string)\n      : await fbService.getAllLeads();\n    res.json(leads);\n  } catch (error) {\n    console.error('Error listing leads:', error);\n    res.status(500).json({ error: 'Failed to list leads' });\n  }\n}\n\nexport async function getLead(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const lead = await fbService.getLeadById(id);\n    if (!lead) {\n      return res.status(404).json({ error: 'Lead not found' });\n    }\n    res.json(lead);\n  } catch (error) {\n    console.error('Error getting lead:', error);\n    res.status(500).json({ error: 'Failed to get lead' });\n  }\n}\n","path":null,"size_bytes":2269,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/ProfileDetails.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nexport default function ProfileDetails() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Profile Details</h2>\n          <p className=\"text-muted-foreground\">Update your business and personal information.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Business Profile</CardTitle>\n              <CardDescription>Organization details visible on invoices.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-20 w-20 rounded-lg bg-muted flex items-center justify-center border border-dashed\">\n                  <span className=\"text-xs text-muted-foreground\">Logo</span>\n                </div>\n                <Button variant=\"outline\" size=\"sm\">Upload Logo</Button>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Business Name</Label>\n                <Input defaultValue=\"Acme Corp\" />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Timezone</Label>\n                <Select defaultValue=\"utc\">\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"utc\">UTC (GMT+0)</SelectItem>\n                    <SelectItem value=\"est\">EST (GMT-5)</SelectItem>\n                    <SelectItem value=\"pst\">PST (GMT-8)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button>Save Business Details</Button>\n            </CardFooter>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>User Profile</CardTitle>\n              <CardDescription>Your personal account settings.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-16 w-16\">\n                   <AvatarImage src=\"https://github.com/shadcn.png\" />\n                   <AvatarFallback>CN</AvatarFallback>\n                </Avatar>\n                <Button variant=\"outline\" size=\"sm\">Change Avatar</Button>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Full Name</Label>\n                <Input defaultValue=\"John Doe\" />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Email Address</Label>\n                <Input defaultValue=\"john@acme.com\" />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Phone</Label>\n                <Input defaultValue=\"+1 555 123 4567\" />\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button>Update Profile</Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3699,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5743,"size_tokens":null},"client/src/pages/settings/TeamMembers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Plus, Trash2, Shield, User, Loader2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface TeamMember {\n  id: string;\n  userId: string;\n  name: string;\n  email: string;\n  role: \"admin\" | \"agent\";\n  permissions: string[];\n  isActive: boolean;\n  createdAt: string;\n}\n\nexport default function TeamMembers() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [formData, setFormData] = useState({ name: \"\", email: \"\", role: \"agent\" as \"admin\" | \"agent\" });\n  const queryClient = useQueryClient();\n\n  const { data: members = [], isLoading } = useQuery<TeamMember[]>({\n    queryKey: [\"/api/team-members\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/team-members\");\n      if (!res.ok) throw new Error(\"Failed to fetch team members\");\n      return res.json();\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/team-members\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          userId: `user-${Date.now()}`,\n          ...data,\n          permissions: data.role === \"admin\" ? [\"all\"] : [\"inbox\", \"contacts\"],\n          isActive: true,\n        }),\n      });\n      if (!res.ok) throw new Error(\"Failed to add team member\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      setIsDialogOpen(false);\n      setFormData({ name: \"\", email: \"\", role: \"agent\" });\n      toast.success(\"Team member added successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to add team member\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/team-members/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete team member\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast.success(\"Team member removed successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to remove team member\");\n    },\n  });\n\n  const handleAddMember = () => {\n    if (!formData.name || !formData.email) {\n      toast.error(\"Please fill in all fields\");\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Team Members</h2>\n            <p className=\"text-muted-foreground\">Manage your team and their roles.</p>\n          </div>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Member\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Add Team Member</DialogTitle>\n                <DialogDescription>Invite a new user to your organization.</DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"name\">Name</Label>\n                  <Input \n                    id=\"name\" \n                    placeholder=\"John Doe\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input \n                    id=\"email\" \n                    type=\"email\"\n                    placeholder=\"john@example.com\"\n                    value={formData.email}\n                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"role\">Role</Label>\n                  <Select value={formData.role} onValueChange={(v) => setFormData({ ...formData, role: v as \"admin\" | \"agent\" })}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select role\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"admin\">Admin</SelectItem>\n                      <SelectItem value=\"agent\">Agent</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>Cancel</Button>\n                <Button onClick={handleAddMember} disabled={createMutation.isPending}>\n                  {createMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Add Member\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Members</CardTitle>\n            <CardDescription>A list of all users with access to this account.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {members.map((member) => (\n                    <TableRow key={member.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar>\n                            <AvatarFallback className=\"bg-primary/10 text-primary\">\n                              {member.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <div className=\"font-medium\">{member.name}</div>\n                            <div className=\"text-xs text-muted-foreground\">{member.email}</div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          {member.role === 'admin' ? <Shield className=\"h-3 w-3 text-primary\" /> : <User className=\"h-3 w-3 text-muted-foreground\" />}\n                          <span className=\"capitalize\">{member.role}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={member.isActive ? 'default' : 'secondary'}>\n                          {member.isActive ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          className=\"text-destructive hover:text-destructive\"\n                          onClick={() => deleteMutation.mutate(member.id)}\n                          disabled={deleteMutation.isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9091,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/facebook/Leads.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RefreshCw, Users, Search, Mail, Phone, User, Download, Send, MessageSquare, CheckCircle, Clock, FileSpreadsheet } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\ninterface Lead {\n  id: string;\n  fbLeadId: string;\n  formId: string;\n  formName: string;\n  fieldData: Record<string, string>;\n  createdTime: string;\n  syncedAt: string;\n  phone?: string;\n  email?: string;\n  name?: string;\n  autoReplySent?: boolean;\n  autoReplyMessage?: string;\n  autoReplySentAt?: string;\n}\n\ninterface LeadForm {\n  id: string;\n  fbFormId: string;\n  name: string;\n}\n\nexport default function Leads() {\n  const { toast } = useToast();\n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [forms, setForms] = useState<LeadForm[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedForm, setSelectedForm] = useState<string>(\"all\");\n  const [selectedLeads, setSelectedLeads] = useState<Set<string>>(new Set());\n  const [sendingMessage, setSendingMessage] = useState(false);\n  const [messageDialogOpen, setMessageDialogOpen] = useState(false);\n  const [messageText, setMessageText] = useState(\"\");\n  const [targetLead, setTargetLead] = useState<Lead | null>(null);\n  const [processingAutoReply, setProcessingAutoReply] = useState(false);\n\n  const fetchLeads = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(\"/api/facebook/leads\");\n      if (response.ok) {\n        const data = await response.json();\n        setLeads(data);\n      }\n    } catch (error) {\n      console.error(\"Error fetching leads:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchForms = async () => {\n    try {\n      const response = await fetch(\"/api/facebook/forms\");\n      if (response.ok) {\n        const data = await response.json();\n        setForms(data);\n      }\n    } catch (error) {\n      console.error(\"Error fetching forms:\", error);\n    }\n  };\n\n  useEffect(() => {\n    fetchForms();\n    fetchLeads();\n  }, []);\n\n  const filteredLeads = leads.filter((lead) => {\n    const searchLower = searchTerm.toLowerCase();\n    const matchesSearch = \n      (lead.name?.toLowerCase().includes(searchLower) || false) ||\n      (lead.email?.toLowerCase().includes(searchLower) || false) ||\n      (lead.phone?.includes(searchTerm) || false) ||\n      lead.formName.toLowerCase().includes(searchLower);\n    \n    const matchesForm = selectedForm === \"all\" || lead.formId === selectedForm;\n    \n    return matchesSearch && matchesForm;\n  });\n\n  const toggleLeadSelection = (leadId: string) => {\n    const newSelected = new Set(selectedLeads);\n    if (newSelected.has(leadId)) {\n      newSelected.delete(leadId);\n    } else {\n      newSelected.add(leadId);\n    }\n    setSelectedLeads(newSelected);\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedLeads.size === filteredLeads.length) {\n      setSelectedLeads(new Set());\n    } else {\n      setSelectedLeads(new Set(filteredLeads.map(l => l.id)));\n    }\n  };\n\n  const exportToCSV = () => {\n    const leadsToExport = selectedLeads.size > 0 \n      ? filteredLeads.filter(l => selectedLeads.has(l.id))\n      : filteredLeads;\n\n    if (leadsToExport.length === 0) {\n      toast({\n        title: \"No Leads to Export\",\n        description: \"Please select leads or ensure there are leads to export.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const headers = [\"Name\", \"Email\", \"Phone\", \"Form Name\", \"Created Date\", \"Auto Reply Sent\", \"Auto Reply Message\"];\n    const rows = leadsToExport.map(lead => [\n      lead.name || \"\",\n      lead.email || \"\",\n      lead.phone || \"\",\n      lead.formName,\n      new Date(lead.createdTime).toLocaleString(),\n      lead.autoReplySent ? \"Yes\" : \"No\",\n      lead.autoReplyMessage || \"\"\n    ]);\n\n    const csvContent = [\n      headers.join(\",\"),\n      ...rows.map(row => row.map(cell => `\"${String(cell).replace(/\"/g, '\"\"')}\"`).join(\",\"))\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = `leads_export_${new Date().toISOString().split('T')[0]}.csv`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Export Successful\",\n      description: `Exported ${leadsToExport.length} leads to CSV.`,\n    });\n  };\n\n  const openSendMessageDialog = (lead: Lead) => {\n    if (!lead.phone) {\n      toast({\n        title: \"No Phone Number\",\n        description: \"This lead does not have a phone number.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setTargetLead(lead);\n    setMessageText(`Hi ${lead.name || \"there\"}! Thank you for your interest. How can we help you today?`);\n    setMessageDialogOpen(true);\n  };\n\n  const sendIndividualMessage = async () => {\n    if (!targetLead || !messageText.trim()) return;\n\n    setSendingMessage(true);\n    try {\n      const response = await fetch(`/api/leads/auto-reply/send/${targetLead.id}`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: messageText }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Message Sent\",\n          description: `Message sent to ${targetLead.name || targetLead.phone}`,\n        });\n        setMessageDialogOpen(false);\n        fetchLeads();\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Failed to Send\",\n          description: error.error || \"Could not send message\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setSendingMessage(false);\n    }\n  };\n\n  const processAllAutoReply = async () => {\n    setProcessingAutoReply(true);\n    try {\n      const response = await fetch(\"/api/leads/auto-reply/process-all\", {\n        method: \"POST\",\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Auto-Reply Processing Complete\",\n          description: `Processed ${result.processed} leads. Successful: ${result.successful}, Failed: ${result.failed}`,\n        });\n        fetchLeads();\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Processing Failed\",\n          description: error.error || \"Could not process leads\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to process leads. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setProcessingAutoReply(false);\n    }\n  };\n\n  const pendingLeadsCount = leads.filter(l => l.phone && !l.autoReplySent).length;\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Lead Management</h2>\n            <p className=\"text-muted-foreground\">View, export, and send messages to leads from Facebook forms</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={exportToCSV}>\n              <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n              Export {selectedLeads.size > 0 ? `(${selectedLeads.size})` : \"All\"}\n            </Button>\n            <Button \n              variant=\"outline\" \n              onClick={processAllAutoReply}\n              disabled={processingAutoReply || pendingLeadsCount === 0}\n            >\n              <Send className={`h-4 w-4 mr-2 ${processingAutoReply ? \"animate-pulse\" : \"\"}`} />\n              Auto-Reply ({pendingLeadsCount})\n            </Button>\n            <Button onClick={fetchLeads} disabled={loading}>\n              <RefreshCw className={`h-4 w-4 mr-2 ${loading ? \"animate-spin\" : \"\"}`} />\n              Refresh\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Leads</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{leads.length}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">With Phone</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{leads.filter(l => l.phone).length}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Auto-Reply Sent</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">{leads.filter(l => l.autoReplySent).length}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Reply</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-orange-500\">{pendingLeadsCount}</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"flex gap-4\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search by name, email, or phone...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n          <Select value={selectedForm} onValueChange={setSelectedForm}>\n            <SelectTrigger className=\"w-[280px]\">\n              <SelectValue placeholder=\"Filter by form\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Forms</SelectItem>\n              {forms.map((form) => (\n                <SelectItem key={form.id} value={form.fbFormId}>\n                  {form.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Leads ({filteredLeads.length})\n            </CardTitle>\n            <CardDescription>\n              All leads collected from your Facebook lead forms. Select leads to export or send messages.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <RefreshCw className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredLeads.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No leads found. Sync your lead forms to fetch new leads.</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-12\">\n                      <Checkbox \n                        checked={selectedLeads.size === filteredLeads.length && filteredLeads.length > 0}\n                        onCheckedChange={toggleSelectAll}\n                      />\n                    </TableHead>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Phone</TableHead>\n                    <TableHead>Form</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredLeads.map((lead) => (\n                    <TableRow key={lead.id}>\n                      <TableCell>\n                        <Checkbox \n                          checked={selectedLeads.has(lead.id)}\n                          onCheckedChange={() => toggleLeadSelection(lead.id)}\n                        />\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          {lead.name || \"N/A\"}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"text-sm truncate max-w-[150px]\">{lead.email || \"N/A\"}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                          {lead.phone || \"N/A\"}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"text-xs truncate max-w-[120px]\">\n                          {lead.formName.replace(\"Life Changing Networks's form - \", \"\")}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {lead.autoReplySent ? (\n                          <Badge className=\"bg-green-100 text-green-700 border-green-200\">\n                            <CheckCircle className=\"h-3 w-3 mr-1\" />\n                            Sent\n                          </Badge>\n                        ) : lead.phone ? (\n                          <Badge variant=\"outline\" className=\"text-orange-600 border-orange-200\">\n                            <Clock className=\"h-3 w-3 mr-1\" />\n                            Pending\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"secondary\">No Phone</Badge>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-sm text-muted-foreground\">\n                        {new Date(lead.createdTime).toLocaleDateString()}\n                      </TableCell>\n                      <TableCell>\n                        <Button \n                          size=\"sm\" \n                          variant=\"ghost\"\n                          onClick={() => openSendMessageDialog(lead)}\n                          disabled={!lead.phone}\n                        >\n                          <MessageSquare className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={messageDialogOpen} onOpenChange={setMessageDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Send WhatsApp Message</DialogTitle>\n              <DialogDescription>\n                Send a message to {targetLead?.name || targetLead?.phone}\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground mb-2\">Phone: {targetLead?.phone}</p>\n              </div>\n              <Textarea\n                placeholder=\"Enter your message...\"\n                value={messageText}\n                onChange={(e) => setMessageText(e.target.value)}\n                rows={4}\n              />\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setMessageDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={sendIndividualMessage} disabled={sendingMessage || !messageText.trim()}>\n                {sendingMessage ? (\n                  <>\n                    <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Sending...\n                  </>\n                ) : (\n                  <>\n                    <Send className=\"h-4 w-4 mr-2\" />\n                    Send Message\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":17809,"size_tokens":null},"client/src/pages/templates.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Image, FileText, Video, MapPin } from \"lucide-react\";\n\nconst templates = [\n  {\n    id: 1,\n    name: \"welcome_message\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Marketing\",\n    type: \"text\",\n    preview: \"Hi {{1}}, welcome to our store! We're excited to have you here. Check out our latest collection here: {{2}}\",\n  },\n  {\n    id: 2,\n    name: \"order_confirmation\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Hello {{1}}, your order #{{2}} has been confirmed and will be shipped soon.\",\n  },\n  {\n    id: 3,\n    name: \"promo_image_header\",\n    language: \"es_ES\",\n    status: \"Pending\",\n    category: \"Marketing\",\n    type: \"image\",\n    preview: \"Hola {{1}}, tenemos una oferta especial para ti! 20% de descuento en tu prxima compra.\",\n  },\n  {\n    id: 4,\n    name: \"shipping_update\",\n    language: \"en_US\",\n    status: \"Rejected\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Your package is on the way! Track it here: {{1}}\",\n  },\n  {\n    id: 5,\n    name: \"appointment_reminder\",\n    language: \"en_US\",\n    status: \"Approved\",\n    category: \"Utility\",\n    type: \"text\",\n    preview: \"Hi {{1}}, just a reminder for your appointment tomorrow at {{2}}.\",\n  }\n];\n\nexport default function Templates() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Message Templates</h2>\n            <p className=\"text-muted-foreground\">Create and manage WhatsApp message templates.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Template\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {templates.map((template) => (\n            <Card key={template.id} className=\"flex flex-col\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                   <div className=\"flex items-center gap-2\">\n                      {template.type === 'image' ? <Image className=\"h-4 w-4 text-muted-foreground\" /> : \n                       template.type === 'video' ? <Video className=\"h-4 w-4 text-muted-foreground\" /> :\n                       template.type === 'location' ? <MapPin className=\"h-4 w-4 text-muted-foreground\" /> :\n                       <FileText className=\"h-4 w-4 text-muted-foreground\" />}\n                      <CardTitle className=\"text-base font-medium truncate\">{template.name}</CardTitle>\n                   </div>\n                   <Badge variant={\n                     template.status === 'Approved' ? 'default' : \n                     template.status === 'Pending' ? 'secondary' : 'destructive'\n                   } className={template.status === 'Approved' ? 'bg-green-500 hover:bg-green-600' : ''}>\n                     {template.status}\n                   </Badge>\n                </div>\n                <div className=\"flex gap-2 mt-2\">\n                  <Badge variant=\"outline\" className=\"text-xs font-normal\">{template.language}</Badge>\n                  <Badge variant=\"outline\" className=\"text-xs font-normal\">{template.category}</Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"flex-1\">\n                <div className=\"bg-muted/30 p-3 rounded-md text-sm text-muted-foreground border border-border h-full\">\n                  {template.preview}\n                </div>\n              </CardContent>\n              <CardFooter className=\"border-t pt-4\">\n                 <Button variant=\"ghost\" size=\"sm\" className=\"w-full\">Edit Template</Button>\n              </CardFooter>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4156,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"replit.md":{"content":"# WhatsApp Business API Dashboard\n\n## Overview\nA comprehensive WhatsApp Business API Dashboard designed to streamline WhatsApp Business communications. It offers over 16 functional modules, including advanced AI-powered auto-reply capabilities and seamless integration with Facebook Lead Forms. The project aims to provide businesses with a powerful tool for managing customer interactions, automating responses, and leveraging AI for lead qualification and engagement, ultimately enhancing market potential through efficient communication.\n\n## User Preferences\nI prefer clear and concise explanations. When proposing changes, please outline the impact on existing functionalities and the overall architecture. I appreciate iterative development and prefer to review changes in smaller, manageable increments. Ensure all new features are thoroughly tested and documented. Do not make changes to the folder `shared`.\n\n## System Architecture\nThe application is built with a modern tech stack, featuring a React + TypeScript frontend utilizing Vite, TailwindCSS, and Shadcn/UI for a robust and responsive user interface. The backend is powered by Node.js and Express, written in TypeScript, providing a scalable API layer. Data persistence for new modular features is managed using MongoDB Atlas with Mongoose ODM. State management on the frontend is handled by React Query (TanStack Query), and UI components are built with Radix UI primitives. A visual flow builder for automation is implemented using React Flow. AI capabilities are integrated via the OpenAI GPT-4o API and Google Gemini API.\n\nThe system incorporates a modular backend structure, allowing for independent development and deployment of features such as AI Agents, Broadcast messaging, Facebook integration, and lead auto-reply systems. Key architectural decisions include:\n- **UI/UX**: Emphasis on a clean, modern interface using Shadcn/UI and TailwindCSS.\n- **Technical Implementations**:\n    - AI Agents for automated chat responses and lead qualification, with support for OpenAI and Gemini models.\n    - Integration with Facebook Lead Forms for lead ingestion and automated follow-up.\n    - Visual flow builder for creating complex automation workflows.\n    - Comprehensive broadcast messaging with support for various message types and scheduling.\n    - Robust template management with Meta sync and approval workflows.\n    - Real-time reporting and analytics for messaging, campaigns, and AI agent performance.\n    - Multi-tenant SaaS architecture with secure credential isolation per user, including AES-256-GCM encryption for API keys.\n    - Contact blocking system with webhook filtering.\n    - Automated AI agent assignment based on pre-filled text mappings and conversation history persistence.\n    - **User Management with RBAC**: Role-based access control system with four roles (Super Admin, Sub Admin, Manager, User). Admins can create users with auto-generated credentials, assign roles, and control page-level access. System users authenticate through the same login with PBKDF2 password hashing. Protected API endpoints use requireAuth and requireAdmin middleware. Email notifications are sent via Zoho SMTP when users are created or passwords are reset.\n- **System Design**: The system is designed to connect to the official WhatsApp Business API, supporting webhooks for incoming messages and API calls for sending messages. An auto-reply system orchestrates the process of syncing leads, creating AI agents, mapping agents to forms, and sending personalized WhatsApp messages to leads.\n\n## External Dependencies\n- **MongoDB Atlas**: Cloud-hosted NoSQL database for data persistence.\n- **OpenAI API**: For AI agent functionalities, specifically GPT-4o and other OpenAI models.\n- **Google Gemini API**: For AI agent functionalities, supporting various Gemini models.\n- **Facebook Graph API**: For syncing Facebook Lead Forms, managing leads, and fetching template status.\n- **WhatsApp Business API**: For sending and receiving WhatsApp messages.\n- **Meta Business Suite**: For syncing and approving message templates.\n\n## Recent Changes (December 2025)\n- **Role-Based Inbox Filtering**: System users now only see contacts/chats that are assigned to them in both the Inbox and 24-Hour Window views. Admins and Sub-admins see all chats, managers see their own and team members' assignments, and regular users only see their assigned contacts.\n- **Lead Assignment Reports Fix**: Fixed priority and status aggregation in reports. Backend now properly calculates priority distribution and uses correct status values.\n- **Auth Headers Enhancement**: getAuthHeaders() now includes x-user-role and x-user-name for proper role-based filtering across all authenticated API calls.\n- **Gemini AI Migration**: AI agents now primarily use Google Gemini (gemini-2.5-flash) with GOOGLE_API_KEY environment variable.\n- **AI Analytics Bug Fixes**: Added null safety guards to prevent crashes when phone numbers are undefined or malformed.\n- **Prefilled Text Mapping Fix**: Aligned MongoDB schema field from `text` to `prefilledText` to match service layer.\n- **WhatsApp Type Safety**: Fixed type errors in controller/service for userId handling with proper null checks.\n- **Contact Analytics**: System tracks 112+ contacts with interest level classification (interested/neutral/not interested).","path":null,"size_bytes":5361,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/layout/DashboardLayout.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { \n  LayoutDashboard, \n  MessageSquare, \n  Megaphone, \n  GitBranch, \n  Users, \n  Settings, \n  LogOut,\n  Menu,\n  Bell,\n  Search,\n  FileText,\n  LayoutGrid,\n  Bot,\n  BarChart3,\n  ChevronDown,\n  ChevronRight\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { \n  DropdownMenu, \n  DropdownMenuContent, \n  DropdownMenuItem, \n  DropdownMenuLabel, \n  DropdownMenuSeparator, \n  DropdownMenuTrigger \n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\n\nexport default function DashboardLayout({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n\n  // Define navigation structure\n  const navStructure = [\n    {\n      icon: LayoutDashboard,\n      label: \"Dashboard\",\n      href: \"/\",\n    },\n    {\n      icon: MessageSquare,\n      label: \"Inbox\",\n      href: \"/inbox\",\n    },\n    {\n      icon: Megaphone,\n      label: \"Campaigns\",\n      href: \"/campaigns\", // Kept for active state checking\n      subItems: [\n        { label: \"Broadcasts\", href: \"/campaigns/broadcast\" },\n        { label: \"Selected Contacts\", href: \"/campaigns/selected-contacts\" },\n        { label: \"Schedule Messages\", href: \"/campaigns/schedule\" },\n        { label: \"Single Message\", href: \"/campaigns/single\" },\n        { label: \"Reports\", href: \"/campaigns/report\" },\n      ]\n    },\n    {\n      icon: GitBranch,\n      label: \"Automation\",\n      href: \"/automation\",\n      subItems: [\n        { label: \"Builder\", href: \"/automation\" },\n        { label: \"Auto Leads\", href: \"/automation/leads\" },\n        { label: \"Keyword Reply\", href: \"/automation/keywords\" },\n        { label: \"Follow-up\", href: \"/automation/follow-up\" },\n        { label: \"Drip Campaign\", href: \"/automation/drip\" },\n        { label: \"New Lead Alert\", href: \"/automation/new-leads\" },\n      ]\n    },\n    {\n      icon: LayoutGrid,\n      label: \"Connect Apps\",\n      href: \"/apps/connect\",\n    },\n    {\n      icon: FileText,\n      label: \"Templates\",\n      href: \"/templates\",\n      subItems: [\n        { label: \"Add Template\", href: \"/templates/add\" },\n        { label: \"Template Status\", href: \"/templates/status\" },\n        { label: \"Manage Templates\", href: \"/templates/manage\" },\n      ]\n    },\n    {\n      icon: Bot,\n      label: \"AI Agent\",\n      href: \"/ai\",\n      subItems: [\n        { label: \"New Agent\", href: \"/ai/new\" },\n        { label: \"Manage Agents\", href: \"/ai/manage\" },\n      ]\n    },\n    {\n      icon: BarChart3,\n      label: \"Reports\",\n      href: \"/reports\",\n      subItems: [\n        { label: \"Delivery Report\", href: \"/reports/delivery\" },\n        { label: \"Campaign Perf.\", href: \"/reports/campaigns\" },\n        { label: \"Replies\", href: \"/reports/replies\" },\n        { label: \"Agent Perf.\", href: \"/reports/agents\" },\n        { label: \"Spending\", href: \"/reports/spending\" },\n        { label: \"Credits\", href: \"/reports/credits\" },\n      ]\n    },\n    {\n      icon: Users,\n      label: \"Contacts\",\n      href: \"/contacts\",\n    },\n    {\n      icon: Settings,\n      label: \"Settings\",\n      href: \"/settings\",\n      subItems: [\n        { label: \"Team Members\", href: \"/settings/team\" },\n        { label: \"Permissions\", href: \"/settings/permissions\" },\n        { label: \"WhatsApp Number\", href: \"/settings/whatsapp\" },\n        { label: \"Profile Details\", href: \"/settings/profile\" },\n        { label: \"Webhook & API\", href: \"/settings/api\" },\n        { label: \"Billing & Credits\", href: \"/settings/billing\" },\n      ]\n    },\n  ];\n\n  const NavItem = ({ item }: { item: any }) => {\n    const isActive = location === item.href || (item.subItems && item.subItems.some((sub: any) => location === sub.href));\n    const [isOpen, setIsOpen] = useState(isActive);\n\n    if (item.subItems) {\n      return (\n        <Collapsible open={isOpen} onOpenChange={setIsOpen} className=\"space-y-1\">\n          <CollapsibleTrigger asChild>\n            <div \n              className={`\n                flex items-center justify-between px-3 py-2.5 rounded-md text-sm font-medium transition-colors cursor-pointer select-none\n                ${isActive \n                  ? \"bg-sidebar-accent/50 text-sidebar-accent-foreground\" \n                  : \"text-sidebar-foreground/70 hover:bg-sidebar-accent/30 hover:text-sidebar-foreground\"\n                }\n              `}\n            >\n              <div className=\"flex items-center gap-3\">\n                <item.icon className=\"h-4 w-4\" />\n                {item.label}\n              </div>\n              {isOpen ? <ChevronDown className=\"h-3 w-3 opacity-50\" /> : <ChevronRight className=\"h-3 w-3 opacity-50\" />}\n            </div>\n          </CollapsibleTrigger>\n          <CollapsibleContent className=\"pl-9 space-y-1 animate-in slide-in-from-top-2 duration-200\">\n            {item.subItems.map((sub: any) => (\n              <Link key={sub.href} href={sub.href}>\n                <div \n                  className={`\n                    block px-3 py-2 rounded-md text-xs font-medium transition-colors cursor-pointer\n                    ${location === sub.href \n                      ? \"bg-sidebar-accent text-sidebar-accent-foreground\" \n                      : \"text-sidebar-foreground/60 hover:bg-sidebar-accent/30 hover:text-sidebar-foreground\"\n                    }\n                  `}\n                >\n                  {sub.label}\n                </div>\n              </Link>\n            ))}\n          </CollapsibleContent>\n        </Collapsible>\n      );\n    }\n\n    return (\n      <Link href={item.href}>\n        <div \n          className={`\n            flex items-center gap-3 px-3 py-2.5 rounded-md text-sm font-medium transition-colors cursor-pointer\n            ${isActive \n              ? \"bg-sidebar-accent text-sidebar-accent-foreground\" \n              : \"text-sidebar-foreground/70 hover:bg-sidebar-accent/50 hover:text-sidebar-foreground\"\n            }\n          `}\n        >\n          <item.icon className=\"h-4 w-4\" />\n          {item.label}\n        </div>\n      </Link>\n    );\n  };\n\n  const NavContent = () => (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"p-6 flex items-center gap-3\">\n        <div className=\"h-10 w-10 rounded-lg bg-primary flex items-center justify-center\">\n          <MessageSquare className=\"h-6 w-6 text-primary-foreground\" />\n        </div>\n        <div>\n          <h1 className=\"font-heading font-bold text-lg leading-none tracking-tight\">WhatsApp</h1>\n          <span className=\"text-xs text-sidebar-foreground/60\">Business API</span>\n        </div>\n      </div>\n\n      <div className=\"flex-1 px-3 py-4 space-y-1 overflow-y-auto\">\n        {navStructure.map((item, idx) => (\n          <NavItem key={idx} item={item} />\n        ))}\n      </div>\n\n      <div className=\"p-4 border-t border-sidebar-border shrink-0\">\n        <div className=\"p-4 rounded-lg bg-sidebar-accent/50\">\n          <h4 className=\"text-sm font-medium text-sidebar-foreground mb-1\">Need Help?</h4>\n          <p className=\"text-xs text-sidebar-foreground/60 mb-3\">Check our documentation for guides.</p>\n          <Button size=\"sm\" variant=\"secondary\" className=\"w-full text-xs\">Documentation</Button>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gray-50/50 flex\">\n      {/* Desktop Sidebar */}\n      <div className=\"hidden md:block w-64 bg-sidebar border-r border-sidebar-border text-sidebar-foreground shrink-0\">\n        <NavContent />\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col min-w-0 h-screen overflow-hidden\">\n        {/* Header */}\n        <header className=\"h-16 border-b border-border bg-background px-6 flex items-center justify-between shrink-0 sticky top-0 z-10\">\n          <div className=\"flex items-center gap-4\">\n            <Sheet open={isSidebarOpen} onOpenChange={setIsSidebarOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"md:hidden\">\n                  <Menu className=\"h-5 w-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"p-0 w-64 bg-sidebar border-r border-sidebar-border text-sidebar-foreground\">\n                <NavContent />\n              </SheetContent>\n            </Sheet>\n            \n            <div className=\"relative hidden sm:block w-96\">\n              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input \n                placeholder=\"Search messages, contacts, campaigns...\" \n                className=\"pl-9 bg-secondary/50 border-none focus-visible:ring-1\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" className=\"relative\">\n              <Bell className=\"h-5 w-5 text-muted-foreground\" />\n              <span className=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-destructive border-2 border-background\"></span>\n            </Button>\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" className=\"relative h-9 w-9 rounded-full\">\n                  <Avatar className=\"h-9 w-9 border border-border\">\n                    <AvatarImage src=\"https://github.com/shadcn.png\" alt=\"@user\" />\n                    <AvatarFallback>CN</AvatarFallback>\n                  </Avatar>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n                <DropdownMenuLabel className=\"font-normal\">\n                  <div className=\"flex flex-col space-y-1\">\n                    <p className=\"text-sm font-medium leading-none\">Acme Inc</p>\n                    <p className=\"text-xs leading-none text-muted-foreground\">\n                      admin@acme.com\n                    </p>\n                  </div>\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <Users className=\"mr-2 h-4 w-4\" />\n                  <span>Team Members</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <Settings className=\"mr-2 h-4 w-4\" />\n                  <span>Settings</span>\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem className=\"text-destructive focus:text-destructive\">\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  <span>Log out</span>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <main className=\"flex-1 overflow-auto p-6\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11162,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/TeamMembers.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Plus, MoreHorizontal, Trash2, Shield, User } from \"lucide-react\";\n\nconst members = [\n  { id: 1, name: \"John Doe\", email: \"john@acme.com\", role: \"Admin\", status: \"Active\", avatar: \"JD\" },\n  { id: 2, name: \"Jane Smith\", email: \"jane@acme.com\", role: \"Agent\", status: \"Active\", avatar: \"JS\" },\n  { id: 3, name: \"Mike Johnson\", email: \"mike@acme.com\", role: \"Agent\", status: \"Inactive\", avatar: \"MJ\" },\n];\n\nexport default function TeamMembers() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Team Members</h2>\n            <p className=\"text-muted-foreground\">Manage your team and their roles.</p>\n          </div>\n          <Dialog>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Member\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Add Team Member</DialogTitle>\n                <DialogDescription>Invite a new user to your organization.</DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"name\">Name</Label>\n                  <Input id=\"name\" placeholder=\"John Doe\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input id=\"email\" placeholder=\"john@example.com\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"role\">Role</Label>\n                  <Select>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select role\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"admin\">Admin</SelectItem>\n                      <SelectItem value=\"agent\">Agent</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button>Send Invitation</Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Members</CardTitle>\n            <CardDescription>A list of all users with access to this account.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>User</TableHead>\n                  <TableHead>Role</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {members.map((member) => (\n                  <TableRow key={member.id}>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar>\n                          <AvatarFallback>{member.avatar}</AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <div className=\"font-medium\">{member.name}</div>\n                          <div className=\"text-xs text-muted-foreground\">{member.email}</div>\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        {member.role === 'Admin' ? <Shield className=\"h-3 w-3 text-primary\" /> : <User className=\"h-3 w-3 text-muted-foreground\" />}\n                        {member.role}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={member.status === 'Active' ? 'default' : 'secondary'}>\n                        {member.status}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\">\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":5459,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns/Schedule.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Calendar, Clock, MoreHorizontal, Plus, PauseCircle, PlayCircle, Trash2 } from \"lucide-react\";\n\nconst schedules = [\n  { id: 1, name: \"Weekly Newsletter\", template: \"newsletter_v1\", time: \"Every Mon, 9:00 AM\", recipients: 2500, status: \"Active\", nextRun: \"Nov 30, 2025\" },\n  { id: 2, name: \"Holiday Promo\", template: \"holiday_sale\", time: \"Dec 20, 2025, 10:00 AM\", recipients: 5000, status: \"Scheduled\", nextRun: \"Dec 20, 2025\" },\n  { id: 3, name: \"Feedback Request\", template: \"feedback_survey\", time: \"After 2 days\", recipients: \"Trigger based\", status: \"Paused\", nextRun: \"-\" },\n];\n\nexport default function Schedule() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Schedule Messages</h2>\n            <p className=\"text-muted-foreground\">Manage your upcoming scheduled campaigns.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Schedule\n          </Button>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Upcoming Schedules</CardTitle>\n             <CardDescription>View and manage your automated dispatch queue.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Campaign Name</TableHead>\n                  <TableHead>Template</TableHead>\n                  <TableHead>Schedule Rule</TableHead>\n                  <TableHead>Recipients</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Next Run</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {schedules.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell className=\"font-medium\">{item.name}</TableCell>\n                    <TableCell className=\"text-muted-foreground\">{item.template}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                        {item.time}\n                      </div>\n                    </TableCell>\n                    <TableCell>{item.recipients}</TableCell>\n                    <TableCell>\n                      <Badge \n                        variant={item.status === 'Active' ? 'default' : item.status === 'Scheduled' ? 'secondary' : 'outline'}\n                        className={item.status === 'Active' ? 'bg-green-500' : ''}\n                      >\n                        {item.status}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{item.nextRun}</TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex justify-end gap-2\">\n                        {item.status === 'Paused' ? (\n                          <Button variant=\"ghost\" size=\"icon\" title=\"Resume\"><PlayCircle className=\"h-4 w-4\" /></Button>\n                        ) : (\n                          <Button variant=\"ghost\" size=\"icon\" title=\"Pause\"><PauseCircle className=\"h-4 w-4\" /></Button>\n                        )}\n                        <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive\" title=\"Delete\"><Trash2 className=\"h-4 w-4\" /></Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4195,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/pages/reports/UserEngagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Star, Download, Search, TrendingUp, Eye, MessageSquare, ArrowUp, ArrowDown, Users, Trophy, Loader2 } from \"lucide-react\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  Cell\n} from \"recharts\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface EngagedUser {\n  id: string;\n  name: string;\n  phone: string;\n  messagesReceived: number;\n  messagesRead: number;\n  replies: number;\n  readRate: number;\n  replyRate: number;\n  engagement: number;\n}\n\ninterface DistributionItem {\n  range: string;\n  count: number;\n  color: string;\n}\n\ninterface UserEngagementData {\n  users: EngagedUser[];\n  distribution: DistributionItem[];\n  summary: {\n    totalUsers: number;\n    avgReadRate: number;\n    avgReplyRate: number;\n    totalReplies: number;\n    totalMessages: number;\n  };\n  period: string;\n}\n\nexport default function UserEngagement() {\n  const [period, setPeriod] = useState(\"week\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortBy, setSortBy] = useState<\"engagement\" | \"readRate\" | \"replyRate\">(\"engagement\");\n  const [sortOrder, setSortOrder] = useState<\"desc\" | \"asc\">(\"desc\");\n\n  const { data, isLoading, error } = useQuery<UserEngagementData>({\n    queryKey: [\"/api/reports/user-engagement\", period],\n    queryFn: async () => {\n      const res = await fetchWithAuth(`/api/reports/user-engagement?period=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch user engagement\");\n      return res.json();\n    },\n  });\n\n  const filteredUsers = (data?.users || [])\n    .filter(user => \n      user.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      user.phone.includes(searchQuery)\n    )\n    .sort((a, b) => {\n      const aValue = a[sortBy];\n      const bValue = b[sortBy];\n      return sortOrder === \"desc\" ? bValue - aValue : aValue - bValue;\n    });\n\n  const getEngagementColor = (engagement: number) => {\n    if (engagement >= 90) return \"text-green-600\";\n    if (engagement >= 75) return \"text-lime-600\";\n    if (engagement >= 60) return \"text-yellow-600\";\n    if (engagement >= 45) return \"text-orange-600\";\n    return \"text-red-600\";\n  };\n\n  const getEngagementBadge = (engagement: number) => {\n    if (engagement >= 90) return <Badge className=\"bg-green-500\">Excellent</Badge>;\n    if (engagement >= 75) return <Badge className=\"bg-lime-500\">Good</Badge>;\n    if (engagement >= 60) return <Badge className=\"bg-yellow-500\">Average</Badge>;\n    if (engagement >= 45) return <Badge className=\"bg-orange-500\">Low</Badge>;\n    return <Badge variant=\"destructive\">Very Low</Badge>;\n  };\n\n  const getRankIcon = (index: number) => {\n    if (index === 0) return <Trophy className=\"h-5 w-5 text-yellow-500\" />;\n    if (index === 1) return <Trophy className=\"h-5 w-5 text-gray-400\" />;\n    if (index === 2) return <Trophy className=\"h-5 w-5 text-amber-700\" />;\n    return <span className=\"w-5 text-center text-muted-foreground\">{index + 1}</span>;\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n              <Star className=\"h-8 w-8 text-yellow-500\" />\n              User Engagement Report\n            </h2>\n            <p className=\"text-muted-foreground\">See which users engage most with your messages.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Select value={period} onValueChange={setPeriod}>\n              <SelectTrigger className=\"w-[150px]\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"today\">Today</SelectItem>\n                <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n                <SelectItem value=\"week\">Last 7 Days</SelectItem>\n                <SelectItem value=\"month\">Last 30 Days</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\">\n              <Download className=\"mr-2 h-4 w-4\" />\n              Export\n            </Button>\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : error ? (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground\">Failed to load engagement data</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <Users className=\"h-4 w-4 text-muted-foreground\" />\n                    Total Users\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{data?.summary.totalUsers || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">Active recipients</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <Eye className=\"h-4 w-4 text-blue-600\" />\n                    Avg Read Rate\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-blue-600\">{data?.summary.avgReadRate || 0}%</div>\n                  <p className=\"text-xs text-muted-foreground\">Across all users</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <MessageSquare className=\"h-4 w-4 text-purple-600\" />\n                    Avg Reply Rate\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-purple-600\">{data?.summary.avgReplyRate || 0}%</div>\n                  <p className=\"text-xs text-muted-foreground\">Across all users</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <TrendingUp className=\"h-4 w-4 text-green-600\" />\n                    Total Replies\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-green-600\">{data?.summary.totalReplies || 0}</div>\n                  <p className=\"text-xs text-muted-foreground\">From {data?.summary.totalMessages || 0} messages</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <div className=\"grid gap-6 md:grid-cols-3\">\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <CardTitle>Top Engaged Users</CardTitle>\n                      <CardDescription>Users ranked by engagement score</CardDescription>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <div className=\"relative w-64\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Search users...\"\n                          className=\"pl-9\"\n                          value={searchQuery}\n                          onChange={(e) => setSearchQuery(e.target.value)}\n                        />\n                      </div>\n                      <Select value={sortBy} onValueChange={(v) => setSortBy(v as any)}>\n                        <SelectTrigger className=\"w-[150px]\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"engagement\">Engagement %</SelectItem>\n                          <SelectItem value=\"readRate\">Read Rate %</SelectItem>\n                          <SelectItem value=\"replyRate\">Reply Rate %</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Button \n                        variant=\"outline\" \n                        size=\"icon\"\n                        onClick={() => setSortOrder(prev => prev === \"desc\" ? \"asc\" : \"desc\")}\n                      >\n                        {sortOrder === \"desc\" ? <ArrowDown className=\"h-4 w-4\" /> : <ArrowUp className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  {filteredUsers.length > 0 ? (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead className=\"w-12\">Rank</TableHead>\n                          <TableHead>User</TableHead>\n                          <TableHead className=\"text-right\">Messages</TableHead>\n                          <TableHead className=\"text-right\">Read %</TableHead>\n                          <TableHead className=\"text-right\">Reply %</TableHead>\n                          <TableHead className=\"text-right\">Engagement</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {filteredUsers.slice(0, 10).map((user, index) => (\n                          <TableRow key={user.id}>\n                            <TableCell className=\"font-medium\">\n                              <div className=\"flex items-center justify-center\">\n                                {getRankIcon(index)}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-3\">\n                                <Avatar className=\"h-8 w-8\">\n                                  <AvatarFallback className=\"text-xs bg-primary/10 text-primary\">\n                                    {user.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase()}\n                                  </AvatarFallback>\n                                </Avatar>\n                                <div>\n                                  <div className=\"font-medium\">{user.name}</div>\n                                  <div className=\"text-xs text-muted-foreground\">{user.phone}</div>\n                                </div>\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"text-sm\">{user.messagesReceived}</div>\n                              <div className=\"text-xs text-muted-foreground\">{user.replies} replies</div>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex items-center justify-end gap-2\">\n                                <Progress value={user.readRate} className=\"w-16 h-2\" />\n                                <span className=\"text-sm font-medium text-blue-600\">{user.readRate}%</span>\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex items-center justify-end gap-2\">\n                                <Progress value={user.replyRate} className=\"w-16 h-2\" />\n                                <span className=\"text-sm font-medium text-purple-600\">{user.replyRate}%</span>\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex items-center justify-end gap-2\">\n                                <span className={`text-lg font-bold ${getEngagementColor(user.engagement)}`}>\n                                  {user.engagement}%\n                                </span>\n                                {getEngagementBadge(user.engagement)}\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p>No engagement data found for this period.</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Engagement Distribution</CardTitle>\n                  <CardDescription>How users are distributed across engagement levels</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {data?.distribution && data.distribution.length > 0 ? (\n                    <>\n                      <div className=\"h-[300px]\">\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                          <BarChart data={data.distribution} layout=\"vertical\">\n                            <CartesianGrid strokeDasharray=\"3 3\" horizontal={true} vertical={false} stroke=\"hsl(var(--border))\" />\n                            <XAxis type=\"number\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                            <YAxis type=\"category\" dataKey=\"range\" stroke=\"hsl(var(--muted-foreground))\" fontSize={11} tickLine={false} axisLine={false} width={70} />\n                            <Tooltip \n                              contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                              formatter={(value: number) => [`${value} users`, 'Count']}\n                            />\n                            <Bar dataKey=\"count\" radius={[0, 4, 4, 0]}>\n                              {data.distribution.map((entry, index) => (\n                                <Cell key={`cell-${index}`} fill={entry.color} />\n                              ))}\n                            </Bar>\n                          </BarChart>\n                        </ResponsiveContainer>\n                      </div>\n\n                      <div className=\"mt-4 space-y-2\">\n                        <h4 className=\"font-medium text-sm\">Legend</h4>\n                        <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 rounded-full bg-green-500\" />\n                            <span>Excellent (90%+)</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 rounded-full bg-lime-500\" />\n                            <span>Good (80-89%)</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />\n                            <span>Average (70-79%)</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 rounded-full bg-orange-500\" />\n                            <span>Low (60-69%)</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 rounded-full bg-red-500\" />\n                            <span>Very Low (&lt;60%)</span>\n                          </div>\n                        </div>\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <p>No distribution data available.</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":17439,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Megaphone, \n  Plus, \n  MoreHorizontal, \n  Calendar, \n  CheckCircle2, \n  Clock,\n  PlayCircle\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nconst campaigns = [\n  { id: 1, name: \"Summer Sale Blast\", status: \"Completed\", sent: 5000, delivered: 4950, read: 3200, date: \"Jun 15, 2025\" },\n  { id: 2, name: \"New Collection Alert\", status: \"Scheduled\", sent: 0, delivered: 0, read: 0, date: \"Jun 20, 2025\" },\n  { id: 3, name: \"Abandoned Cart Recovery\", status: \"Active\", sent: 120, delivered: 118, read: 85, date: \"Automated\" },\n  { id: 4, name: \"VIP Exclusive Offer\", status: \"Draft\", sent: 0, delivered: 0, read: 0, date: \"Not scheduled\" },\n  { id: 5, name: \"Weekend Promo\", status: \"Completed\", sent: 2500, delivered: 2480, read: 1900, date: \"Jun 10, 2025\" },\n];\n\nexport default function Campaigns() {\n  return (\n    <DashboardLayout>\n       <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Campaigns</h2>\n            <p className=\"text-muted-foreground\">Manage your broadcast lists and scheduled messages.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Campaign\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Active Campaigns\n              </CardTitle>\n              <PlayCircle className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">3</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Running right now\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Scheduled\n              </CardTitle>\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">12</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Upcoming this week\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Messages Sent\n              </CardTitle>\n              <Megaphone className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">45.2k</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                +20.1% from last month\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Campaigns</CardTitle>\n            <CardDescription>\n              A list of all your recent broadcasts and automated sequences.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Campaign Name</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Sent</TableHead>\n                  <TableHead>Delivered</TableHead>\n                  <TableHead>Read</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {campaigns.map((campaign) => (\n                  <TableRow key={campaign.id}>\n                    <TableCell className=\"font-medium\">{campaign.name}</TableCell>\n                    <TableCell>\n                      <Badge \n                        variant={\n                          campaign.status === 'Completed' ? 'secondary' : \n                          campaign.status === 'Active' ? 'default' : \n                          campaign.status === 'Scheduled' ? 'outline' : 'outline'\n                        }\n                        className={\n                          campaign.status === 'Active' ? 'bg-green-500 hover:bg-green-600' : ''\n                        }\n                      >\n                        {campaign.status}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{campaign.sent.toLocaleString()}</TableCell>\n                    <TableCell>{campaign.delivered.toLocaleString()}</TableCell>\n                    <TableCell>{campaign.read.toLocaleString()}</TableCell>\n                    <TableCell className=\"text-muted-foreground flex items-center gap-2\">\n                      <Calendar className=\"h-3 w-3\" />\n                      {campaign.date}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n       </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":5960,"size_tokens":null},"client/src/pages/automation/FollowUp.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Clock, Plus, Trash2 } from \"lucide-react\";\n\nexport default function FollowUp() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Follow-up Messages</h2>\n             <p className=\"text-muted-foreground\">Re-engage leads who haven't responded.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Follow-up\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4\">\n           {/* Follow up item 1 */}\n           <Card>\n             <CardContent className=\"p-6 flex items-start gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0\">\n                   <Clock className=\"h-6 w-6\" />\n                </div>\n                <div className=\"flex-1 grid gap-4 md:grid-cols-3 items-start\">\n                   <div className=\"space-y-2\">\n                     <Label className=\"text-muted-foreground\">Trigger</Label>\n                     <div className=\"font-medium\">After 24 Hours of Inactivity</div>\n                   </div>\n                   <div className=\"space-y-2 md:col-span-2\">\n                     <Label className=\"text-muted-foreground\">Message</Label>\n                     <div className=\"p-3 bg-muted rounded-md text-sm\">\n                       Hi there! Just wanted to check if you had any further questions? We are here to help!\n                     </div>\n                   </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                   <Button variant=\"outline\" size=\"sm\">Edit</Button>\n                   <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive\">Delete</Button>\n                </div>\n             </CardContent>\n           </Card>\n           \n           {/* Follow up item 2 */}\n           <Card>\n             <CardContent className=\"p-6 flex items-start gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0\">\n                   <Clock className=\"h-6 w-6\" />\n                </div>\n                <div className=\"flex-1 grid gap-4 md:grid-cols-3 items-start\">\n                   <div className=\"space-y-2\">\n                     <Label className=\"text-muted-foreground\">Trigger</Label>\n                     <div className=\"font-medium\">After 48 Hours of No Reply</div>\n                   </div>\n                   <div className=\"space-y-2 md:col-span-2\">\n                     <Label className=\"text-muted-foreground\">Message</Label>\n                     <div className=\"p-3 bg-muted rounded-md text-sm\">\n                       Hey! We noticed you haven't completed your profile. Need any assistance?\n                     </div>\n                   </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                   <Button variant=\"outline\" size=\"sm\">Edit</Button>\n                   <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive\">Delete</Button>\n                </div>\n             </CardContent>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3815,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/templates/TemplateStatus.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { RefreshCw, Loader2, CheckCircle2, XCircle, Clock, AlertTriangle, FileText, Globe } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface MetaTemplate {\n  id: string;\n  name: string;\n  status: string;\n  category: string;\n  language: string;\n  content: string;\n  header: string;\n  footer: string;\n  buttons: any[];\n  qualityScore?: string;\n  rejectedReason?: string;\n}\n\ninterface TemplatesResponse {\n  templates: MetaTemplate[];\n  summary: {\n    total: number;\n    approved: number;\n    pending: number;\n    rejected: number;\n  };\n}\n\nexport default function TemplateStatus() {\n  const { data, isLoading, refetch, isRefetching, error } = useQuery<TemplatesResponse>({\n    queryKey: [\"/api/templates/meta\"],\n    queryFn: async () => {\n      const res = await fetchWithAuth(\"/api/templates/meta\");\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.message || \"Failed to fetch templates from Meta\");\n      }\n      return res.json();\n    },\n    refetchOnWindowFocus: false,\n  });\n\n  const handleRefresh = () => {\n    refetch();\n    toast.info(\"Refreshing templates from Facebook...\");\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status.toLowerCase()) {\n      case \"approved\":\n        return (\n          <Badge className=\"bg-green-500 hover:bg-green-600\">\n            <CheckCircle2 className=\"mr-1 h-3 w-3\" />\n            Approved\n          </Badge>\n        );\n      case \"rejected\":\n        return (\n          <Badge variant=\"destructive\">\n            <XCircle className=\"mr-1 h-3 w-3\" />\n            Rejected\n          </Badge>\n        );\n      case \"pending\":\n        return (\n          <Badge variant=\"secondary\">\n            <Clock className=\"mr-1 h-3 w-3\" />\n            Pending\n          </Badge>\n        );\n      case \"in_appeal\":\n        return (\n          <Badge className=\"bg-yellow-500 hover:bg-yellow-600\">\n            <AlertTriangle className=\"mr-1 h-3 w-3\" />\n            In Appeal\n          </Badge>\n        );\n      default:\n        return (\n          <Badge variant=\"outline\">\n            {status}\n          </Badge>\n        );\n    }\n  };\n\n  const getCategoryBadge = (category: string) => {\n    const colors: Record<string, string> = {\n      marketing: \"bg-purple-100 text-purple-700 border-purple-200\",\n      utility: \"bg-blue-100 text-blue-700 border-blue-200\",\n      authentication: \"bg-orange-100 text-orange-700 border-orange-200\",\n    };\n    return (\n      <Badge variant=\"outline\" className={colors[category.toLowerCase()] || \"\"}>\n        {category}\n      </Badge>\n    );\n  };\n\n  const templates = data?.templates || [];\n  const summary = data?.summary || { total: 0, approved: 0, pending: 0, rejected: 0 };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n              <Globe className=\"h-8 w-8 text-blue-600\" />\n              Template Status (Live from Facebook)\n            </h2>\n            <p className=\"text-muted-foreground\">View real-time approval status directly from Meta/Facebook</p>\n          </div>\n          <Button \n            variant=\"outline\" \n            onClick={handleRefresh}\n            disabled={isRefetching}\n          >\n            {isRefetching ? (\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            ) : (\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n            )}\n            Refresh from Facebook\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Templates</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                <span className=\"text-2xl font-bold\">{summary.total}</span>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Approved</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n                <span className=\"text-2xl font-bold text-green-600\">{summary.approved}</span>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Pending Review</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5 text-yellow-500\" />\n                <span className=\"text-2xl font-bold text-yellow-600\">{summary.pending}</span>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Rejected</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <XCircle className=\"h-5 w-5 text-red-500\" />\n                <span className=\"text-2xl font-bold text-red-600\">{summary.rejected}</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Templates from Meta</CardTitle>\n            <CardDescription>\n              Live data fetched directly from your WhatsApp Business Account on Facebook\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : error ? (\n              <div className=\"text-center py-12\">\n                <AlertTriangle className=\"h-12 w-12 mx-auto mb-4 text-orange-500\" />\n                <h3 className=\"font-medium text-lg mb-2\">Unable to fetch templates</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {(error as Error).message || \"Please configure your WhatsApp credentials in Settings.\"}\n                </p>\n                <Button variant=\"outline\" onClick={() => refetch()}>\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\n                  Try Again\n                </Button>\n              </div>\n            ) : templates.length === 0 ? (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p className=\"font-medium\">No templates found</p>\n                <p className=\"text-sm\">Create templates in the Meta Business Suite to see them here.</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Template Name</TableHead>\n                    <TableHead>Category</TableHead>\n                    <TableHead>Language</TableHead>\n                    <TableHead>Content Preview</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {templates.map((template) => (\n                    <TableRow key={template.id}>\n                      <TableCell className=\"font-medium\">{template.name}</TableCell>\n                      <TableCell>{getCategoryBadge(template.category)}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{template.language}</Badge>\n                      </TableCell>\n                      <TableCell className=\"max-w-[300px] truncate text-muted-foreground\">\n                        {template.content || template.header || \"(No content)\"}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col gap-1\">\n                          {getStatusBadge(template.status)}\n                          {template.rejectedReason && (\n                            <span className=\"text-xs text-red-500 mt-1\">\n                              Reason: {template.rejectedReason}\n                            </span>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9410,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/pages/reports/DeliveryReport.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { \n  AreaChart, \n  Area, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  Legend,\n  BarChart,\n  Bar\n} from \"recharts\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, Loader2, MessageSquare, BarChart3 } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface DeliveryReportData {\n  totalSent: number;\n  delivered: number;\n  read: number;\n  failed: number;\n  pending: number;\n  deliveryRate: number;\n  readRate: number;\n  failureRate: number;\n  dailyData: Array<{ date: string; fullDate: string; sent: number; delivered: number; read: number; failed: number }>;\n  hourlyData: Array<{ hour: string; sent: number; delivered: number }>;\n}\n\nexport default function DeliveryReport() {\n  const [period, setPeriod] = useState(\"7\");\n\n  const { data: reportData, isLoading } = useQuery<DeliveryReportData>({\n    queryKey: [\"/api/reports/delivery\", period],\n    queryFn: async () => {\n      const res = await fetch(`/api/reports/delivery?days=${period}`);\n      if (!res.ok) throw new Error(\"Failed to fetch report\");\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  const handleExportCSV = () => {\n    if (!reportData) return;\n    \n    const headers = ['Date', 'Sent', 'Delivered', 'Read', 'Failed'];\n    const rows = reportData.dailyData.map(d => [\n      d.fullDate,\n      d.sent.toString(),\n      d.delivered.toString(),\n      d.read.toString(),\n      d.failed.toString(),\n    ]);\n    \n    const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `delivery-report-${format(new Date(), 'yyyyMMdd')}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  if (isLoading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-[calc(100vh-8rem)]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  const totalSent = reportData?.totalSent || 0;\n  const delivered = reportData?.delivered || 0;\n  const read = reportData?.read || 0;\n  const failed = reportData?.failed || 0;\n  const deliveryRate = reportData?.deliveryRate || 0;\n  const readRate = reportData?.readRate || 0;\n  const failureRate = reportData?.failureRate || 0;\n  const dailyData = reportData?.dailyData || [];\n  const hourlyData = reportData?.hourlyData || [];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Message Delivery Report</h2>\n            <p className=\"text-muted-foreground\">Detailed analysis of message delivery rates over time.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n             <Select value={period} onValueChange={setPeriod}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Period\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"1\">Last 24 Hours</SelectItem>\n                  <SelectItem value=\"7\">Last 7 Days</SelectItem>\n                  <SelectItem value=\"30\">Last 30 Days</SelectItem>\n                </SelectContent>\n             </Select>\n             <Button variant=\"outline\" onClick={handleExportCSV}>\n               <Download className=\"mr-2 h-4 w-4\" />\n               Export CSV\n             </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-4\">\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Sent</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold\">{totalSent.toLocaleString()}</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Delivered</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-green-600\">{delivered.toLocaleString()}</div>\n               <div className=\"text-xs text-muted-foreground\">{deliveryRate}% Delivery Rate</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Read</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-blue-600\">{read.toLocaleString()}</div>\n               <div className=\"text-xs text-muted-foreground\">{readRate}% Read Rate</div>\n             </CardContent>\n           </Card>\n           <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-sm font-medium text-muted-foreground\">Failed</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-2xl font-bold text-destructive\">{failed.toLocaleString()}</div>\n               <div className=\"text-xs text-muted-foreground\">{failureRate}% Failure Rate</div>\n             </CardContent>\n           </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Delivery Timeline</CardTitle>\n             <CardDescription>Message status trends over the selected period.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[400px] w-full\">\n              {dailyData.length > 0 && dailyData.some(d => d.sent > 0) ? (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={dailyData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\n                    <defs>\n                      <linearGradient id=\"colorSent\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#8884d8\" stopOpacity={0.1}/>\n                        <stop offset=\"95%\" stopColor=\"#8884d8\" stopOpacity={0}/>\n                      </linearGradient>\n                      <linearGradient id=\"colorDelivered\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#22c55e\" stopOpacity={0.1}/>\n                        <stop offset=\"95%\" stopColor=\"#22c55e\" stopOpacity={0}/>\n                      </linearGradient>\n                      <linearGradient id=\"colorRead\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.1}/>\n                        <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n                      </linearGradient>\n                    </defs>\n                    <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                    <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                    />\n                    <Legend />\n                    <Area type=\"monotone\" dataKey=\"sent\" stroke=\"#8884d8\" fillOpacity={1} fill=\"url(#colorSent)\" name=\"Sent\" />\n                    <Area type=\"monotone\" dataKey=\"delivered\" stroke=\"#22c55e\" fillOpacity={1} fill=\"url(#colorDelivered)\" name=\"Delivered\" />\n                    <Area type=\"monotone\" dataKey=\"read\" stroke=\"#3b82f6\" fillOpacity={1} fill=\"url(#colorRead)\" name=\"Read\" />\n                  </AreaChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                  <div className=\"text-center\">\n                    <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No message data available for this period</p>\n                    <p className=\"text-sm\">Send messages to see delivery trends here.</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n             <CardTitle>Hourly Distribution</CardTitle>\n             <CardDescription>Message volume by hour of day.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[300px] w-full\">\n              {hourlyData.length > 0 && hourlyData.some(d => d.sent > 0) ? (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={hourlyData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                    <XAxis dataKey=\"hour\" stroke=\"hsl(var(--muted-foreground))\" fontSize={10} tickLine={false} axisLine={false} />\n                    <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                    />\n                    <Legend />\n                    <Bar dataKey=\"sent\" name=\"Sent\" fill=\"#8884d8\" radius={[4, 4, 0, 0]} />\n                    <Bar dataKey=\"delivered\" name=\"Delivered\" fill=\"#22c55e\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                  <div className=\"text-center\">\n                    <BarChart3 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No hourly data available</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":10696,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/pages/apps/ConnectApps.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Search, Facebook, Instagram, Globe, Webhook, MessageSquare, FileSpreadsheet } from \"lucide-react\";\n\nexport default function ConnectApps() {\n  const apps = [\n    { name: \"Facebook Leads\", description: \"Sync leads from Facebook Ads\", icon: Facebook, color: \"bg-blue-600\" },\n    { name: \"Instagram\", description: \"Connect Instagram Direct Messages\", icon: Instagram, color: \"bg-pink-600\" },\n    { name: \"Webhooks\", description: \"Receive real-time data via webhooks\", icon: Webhook, color: \"bg-purple-600\" },\n    { name: \"Google Sheets\", description: \"Sync contacts and messages\", icon: FileSpreadsheet, color: \"bg-green-600\" },\n    { name: \"Zapier\", description: \"Connect with 5000+ apps\", icon: Globe, color: \"bg-orange-600\" },\n    { name: \"Shopify\", description: \"Send order updates automatically\", icon: MessageSquare, color: \"bg-green-500\" },\n  ];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Connect Apps</h2>\n          <p className=\"text-muted-foreground\">Integrate with your favorite tools and services.</p>\n        </div>\n\n        <div className=\"relative w-full max-w-md\">\n          <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search for apps...\" className=\"pl-9\" />\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {apps.map((app) => (\n            <Card key={app.name} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader className=\"flex flex-row items-center gap-4\">\n                <div className={`h-12 w-12 rounded-lg flex items-center justify-center text-white ${app.color}`}>\n                  <app.icon className=\"h-6 w-6\" />\n                </div>\n                <div>\n                  <CardTitle className=\"text-base\">{app.name}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <CardDescription className=\"mb-4 h-10\">{app.description}</CardDescription>\n                <Button variant=\"outline\" className=\"w-full\">Connect</Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2579,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/modules/broadcast/broadcast.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport multer from 'multer';\nimport * as XLSX from 'xlsx';\nimport * as broadcastService from './broadcast.service';\n\nconst router = Router();\nconst upload = multer({ storage: multer.memoryStorage() });\n\nrouter.get('/lists', async (req: Request, res: Response) => {\n  try {\n    const lists = await broadcastService.getBroadcastLists();\n    res.json(lists);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get broadcast lists' });\n  }\n});\n\nrouter.get('/lists/:id', async (req: Request, res: Response) => {\n  try {\n    const list = await broadcastService.getBroadcastListById(req.params.id);\n    if (!list) {\n      return res.status(404).json({ error: 'List not found' });\n    }\n    res.json(list);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get broadcast list' });\n  }\n});\n\nrouter.post('/lists', async (req: Request, res: Response) => {\n  try {\n    const { name, contacts } = req.body;\n    if (!name) {\n      return res.status(400).json({ error: 'List name is required' });\n    }\n    const list = await broadcastService.createBroadcastList(name, contacts || []);\n    res.status(201).json(list);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to create broadcast list' });\n  }\n});\n\nrouter.put('/lists/:id', async (req: Request, res: Response) => {\n  try {\n    const { name, contacts } = req.body;\n    const list = await broadcastService.updateBroadcastList(req.params.id, name, contacts);\n    if (!list) {\n      return res.status(404).json({ error: 'List not found' });\n    }\n    res.json(list);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to update broadcast list' });\n  }\n});\n\nrouter.delete('/lists/:id', async (req: Request, res: Response) => {\n  try {\n    const success = await broadcastService.deleteBroadcastList(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: 'List not found' });\n    }\n    res.status(204).send();\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to delete broadcast list' });\n  }\n});\n\nrouter.post('/import-excel', upload.single('file'), async (req: Request, res: Response) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({ error: 'No file uploaded' });\n    }\n\n    console.log(`[ImportExcel] Processing file: ${req.file.originalname}, size: ${req.file.size} bytes`);\n    \n    const workbook = XLSX.read(req.file.buffer, { type: 'buffer' });\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    const data = XLSX.utils.sheet_to_json(worksheet);\n\n    console.log(`[ImportExcel] Raw rows from Excel: ${data.length}`);\n    \n    const result = broadcastService.parseExcelContacts(data);\n    \n    if (result.validContacts === 0 && data.length > 0) {\n      const columnNames = data[0] ? Object.keys(data[0] as object).join(', ') : 'none found';\n      return res.status(400).json({ \n        error: `No valid contacts found. Detected columns: ${columnNames}. Make sure your file has 'Name' and 'Mobile' (or 'Phone') columns.`,\n        errors: result.errors,\n        totalRows: result.totalRows,\n      });\n    }\n    \n    const saveResult = await broadcastService.saveImportedContacts(result.contacts, 'excel');\n    \n    res.json({\n      success: true,\n      contacts: result.contacts,\n      totalRows: result.totalRows,\n      validContacts: result.validContacts,\n      savedContacts: saveResult.saved,\n      duplicates: saveResult.duplicates,\n      errors: result.errors,\n    });\n  } catch (error) {\n    console.error('Excel import error:', error);\n    res.status(500).json({ error: 'Failed to parse Excel file. Make sure it is a valid .xlsx, .xls, or .csv file.' });\n  }\n});\n\nrouter.post('/import-csv', upload.single('file'), async (req: Request, res: Response) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({ error: 'No file uploaded' });\n    }\n\n    console.log(`[ImportCSV] Processing file: ${req.file.originalname}, size: ${req.file.size} bytes`);\n    \n    const workbook = XLSX.read(req.file.buffer, { type: 'buffer' });\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    const data = XLSX.utils.sheet_to_json(worksheet);\n\n    console.log(`[ImportCSV] Raw rows from CSV: ${data.length}`);\n    \n    const result = broadcastService.parseExcelContacts(data);\n    \n    if (result.validContacts === 0 && data.length > 0) {\n      const columnNames = data[0] ? Object.keys(data[0] as object).join(', ') : 'none found';\n      return res.status(400).json({ \n        error: `No valid contacts found. Detected columns: ${columnNames}. Make sure your file has 'Name' and 'Mobile' (or 'Phone') columns.`,\n        errors: result.errors,\n        totalRows: result.totalRows,\n      });\n    }\n    \n    const saveResult = await broadcastService.saveImportedContacts(result.contacts, 'csv');\n    \n    res.json({\n      success: true,\n      contacts: result.contacts,\n      totalRows: result.totalRows,\n      validContacts: result.validContacts,\n      savedContacts: saveResult.saved,\n      duplicates: saveResult.duplicates,\n      errors: result.errors,\n    });\n  } catch (error) {\n    console.error('CSV import error:', error);\n    res.status(500).json({ error: 'Failed to parse CSV file. Make sure it is a valid .csv file.' });\n  }\n});\n\nrouter.get('/export-contacts', async (req: Request, res: Response) => {\n  try {\n    const { listId } = req.query;\n    let contacts: broadcastService.BroadcastContact[] = [];\n\n    if (listId && typeof listId === 'string') {\n      const list = await broadcastService.getBroadcastListById(listId);\n      if (list) {\n        contacts = list.contacts;\n      }\n    } else {\n      const lists = await broadcastService.getBroadcastLists();\n      contacts = lists.flatMap(l => l.contacts);\n    }\n\n    const exportData = broadcastService.exportContactsToJSON(contacts);\n    const worksheet = XLSX.utils.json_to_sheet(exportData);\n    const workbook = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Contacts');\n    \n    const buffer = XLSX.write(workbook, { type: 'buffer', bookType: 'xlsx' });\n    \n    res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n    res.setHeader('Content-Disposition', 'attachment; filename=contacts.xlsx');\n    res.send(buffer);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to export contacts' });\n  }\n});\n\nrouter.get('/schedules', async (req: Request, res: Response) => {\n  try {\n    const schedules = await broadcastService.getScheduledMessages();\n    res.json(schedules);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to get scheduled messages' });\n  }\n});\n\nrouter.post('/schedules', async (req: Request, res: Response) => {\n  try {\n    const { name, messageType, templateName, customMessage, agentId, contactIds, listId, scheduledAt, recipientCount } = req.body;\n    \n    if (!name || !messageType || !scheduledAt) {\n      return res.status(400).json({ error: 'Name, message type, and scheduled time are required' });\n    }\n\n    const schedule = await broadcastService.createScheduledMessage({\n      name,\n      messageType,\n      templateName,\n      customMessage,\n      agentId,\n      contactIds,\n      listId,\n      scheduledAt,\n      status: 'scheduled',\n      recipientCount: recipientCount || 0,\n    });\n    \n    res.status(201).json(schedule);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to create scheduled message' });\n  }\n});\n\nrouter.put('/schedules/:id', async (req: Request, res: Response) => {\n  try {\n    const schedule = await broadcastService.updateScheduledMessage(req.params.id, req.body);\n    if (!schedule) {\n      return res.status(404).json({ error: 'Schedule not found' });\n    }\n    res.json(schedule);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to update schedule' });\n  }\n});\n\nrouter.delete('/schedules/:id', async (req: Request, res: Response) => {\n  try {\n    const success = await broadcastService.deleteScheduledMessage(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: 'Schedule not found' });\n    }\n    res.status(204).send();\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to delete schedule' });\n  }\n});\n\nrouter.post('/send', async (req: Request, res: Response) => {\n  try {\n    const {\n      contacts,\n      messageType,\n      templateName,\n      customMessage,\n      agentId,\n      campaignName,\n      isScheduled = false,\n      scheduledTime\n    } = req.body;\n\n    console.log('[Broadcast API] Received request:', { \n      contacts: contacts?.length, \n      messageType, \n      templateName, \n      campaignName,\n      isScheduled,\n      scheduledTime\n    });\n\n    if (!contacts || !Array.isArray(contacts) || contacts.length === 0) {\n      return res.status(400).json({ error: 'Contacts are required' });\n    }\n\n    if (!messageType) {\n      return res.status(400).json({ error: 'Message type is required' });\n    }\n\n    // Validate scheduling\n    if (isScheduled) {\n      if (!scheduledTime) {\n        return res.status(400).json({ error: 'scheduledTime is required when scheduling' });\n      }\n      const scheduledDate = new Date(scheduledTime);\n      if (isNaN(scheduledDate.getTime())) {\n        return res.status(400).json({ error: 'Invalid scheduledTime format' });\n      }\n      if (scheduledDate <= new Date()) {\n        return res.status(400).json({ error: 'Scheduled time must be in the future' });\n      }\n    }\n\n    const result = await broadcastService.sendBroadcast(contacts, messageType, {\n      templateName,\n      customMessage,\n      agentId,\n      campaignName,\n      isScheduled,\n      scheduledTime,\n    });\n\n    console.log('[Broadcast API] Result:', result);\n\n    if (result.credentialError) {\n      return res.status(400).json({ \n        error: result.credentialError,\n        ...result,\n      });\n    }\n\n    res.json(result);\n  } catch (error) {\n    console.error('Broadcast send error:', error);\n    res.status(500).json({ error: 'Failed to send broadcast' });\n  }\n});\n\nrouter.post('/send-single', async (req: Request, res: Response) => {\n  try {\n    const { phone, name, messageType, templateName, customMessage, agentId } = req.body;\n    \n    if (!phone) {\n      return res.status(400).json({ error: 'Phone number is required' });\n    }\n    \n    if (!messageType) {\n      return res.status(400).json({ error: 'Message type is required' });\n    }\n\n    const result = await broadcastService.sendSingleMessage(phone, name || '', messageType, {\n      templateName,\n      customMessage,\n      agentId,\n    });\n    \n    res.json(result);\n  } catch (error) {\n    console.error('Single message send error:', error);\n    res.status(500).json({ error: 'Failed to send message' });\n  }\n});\n\nrouter.post('/send-to-list/:listId', async (req: Request, res: Response) => {\n  try {\n    const { messageType, templateName, customMessage, agentId, campaignName } = req.body;\n    const list = await broadcastService.getBroadcastListById(req.params.listId);\n    \n    if (!list) {\n      return res.status(404).json({ error: 'List not found' });\n    }\n    \n    if (!messageType) {\n      return res.status(400).json({ error: 'Message type is required' });\n    }\n\n    const result = await broadcastService.sendBroadcast(list.contacts, messageType, {\n      templateName,\n      customMessage,\n      agentId,\n      campaignName,\n    });\n    \n    res.json(result);\n  } catch (error) {\n    console.error('List broadcast send error:', error);\n    res.status(500).json({ error: 'Failed to send broadcast to list' });\n  }\n});\n\nrouter.get('/scheduled-broadcasts', async (req: Request, res: Response) => {\n  try {\n    const broadcasts = await broadcastService.getScheduledBroadcasts();\n    console.log(`[ScheduledBroadcasts API] Fetched ${broadcasts.length} scheduled broadcasts`);\n    res.json(broadcasts);\n  } catch (error) {\n    console.error('[ScheduledBroadcasts API] Error:', error);\n    res.status(500).json({ error: 'Failed to get scheduled broadcasts' });\n  }\n});\n\nrouter.post('/scheduled-broadcasts/:id/cancel', async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n    const success = await broadcastService.cancelScheduledBroadcast(id);\n    if (success) {\n      res.json({ message: 'Broadcast cancelled successfully' });\n    } else {\n      res.status(400).json({ error: 'Failed to cancel broadcast' });\n    }\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to cancel broadcast' });\n  }\n});\n\nrouter.delete('/scheduled-broadcasts/:id', async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n    const success = await broadcastService.deleteScheduledBroadcast(id);\n    if (success) {\n      res.json({ message: 'Broadcast deleted successfully' });\n    } else {\n      res.status(404).json({ error: 'Broadcast not found' });\n    }\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to delete broadcast' });\n  }\n});\n\nrouter.get('/logs', async (req: Request, res: Response) => {\n  try {\n    const { campaignName, status, phone, limit, offset } = req.query;\n    const logs = await broadcastService.getBroadcastLogs({\n      campaignName: campaignName as string | undefined,\n      status: status as string | undefined,\n      phone: phone as string | undefined,\n      limit: limit ? parseInt(limit as string, 10) : 100,\n      offset: offset ? parseInt(offset as string, 10) : 0,\n    });\n    res.json(logs);\n  } catch (error) {\n    console.error('Failed to get broadcast logs:', error);\n    res.status(500).json({ error: 'Failed to get broadcast logs' });\n  }\n});\n\nrouter.get('/imported-contacts', async (req: Request, res: Response) => {\n  try {\n    const contacts = await broadcastService.getImportedContacts();\n    res.json(contacts);\n  } catch (error) {\n    console.error('Failed to get imported contacts:', error);\n    res.status(500).json({ error: 'Failed to get imported contacts' });\n  }\n});\n\nrouter.delete('/imported-contacts/:id', async (req: Request, res: Response) => {\n  try {\n    const success = await broadcastService.deleteImportedContact(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: 'Contact not found' });\n    }\n    res.status(204).send();\n  } catch (error) {\n    console.error('Failed to delete imported contact:', error);\n    res.status(500).json({ error: 'Failed to delete imported contact' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":14446,"size_tokens":null},"server/modules/leadAutoReply/leadAutoReply.routes.ts":{"content":"import { Router } from 'express';\nimport * as controller from './leadAutoReply.controller';\n\nconst router = Router();\n\nrouter.post('/process-all', controller.processAllLeads);\nrouter.post('/process', controller.processLead);\nrouter.post('/send/:leadId', controller.sendReply);\n\nexport default router;\n","path":null,"size_bytes":301,"size_tokens":null},"client/src/pages/ai/NewAgent.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Bot, Play, RefreshCw, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\n\nexport default function NewAgent() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [testing, setTesting] = useState(false);\n  const [testMessage, setTestMessage] = useState(\"\");\n  const [testResponse, setTestResponse] = useState(\"\");\n  const [createdAgentId, setCreatedAgentId] = useState<string | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    systemPrompt: \"\",\n    model: \"gpt-4o\",\n    temperature: 0.7,\n  });\n\n  const handleCreateAgent = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: \"Missing Name\",\n        description: \"Please enter an agent name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.systemPrompt.trim()) {\n      toast({\n        title: \"Missing Instructions\",\n        description: \"Please enter system instructions for your agent.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch(\"/api/agents\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          ...formData,\n          isActive: true,\n        }),\n      });\n\n      if (response.ok) {\n        const agent = await response.json();\n        setCreatedAgentId(agent.id);\n        toast({\n          title: \"Agent Created!\",\n          description: `${agent.name} has been created successfully. You can now test it.`,\n        });\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Failed to Create Agent\",\n          description: error.error || \"Something went wrong. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to connect to server. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleTestAgent = async () => {\n    if (!createdAgentId) {\n      toast({\n        title: \"No Agent Created\",\n        description: \"Please create an agent first before testing.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!testMessage.trim()) {\n      toast({\n        title: \"Empty Message\",\n        description: \"Please enter a test message.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setTesting(true);\n    setTestResponse(\"\");\n    try {\n      const response = await fetch(`/api/agents/${createdAgentId}/test`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: testMessage }),\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setTestResponse(data.response);\n      } else {\n        const error = await response.json();\n        setTestResponse(`Error: ${error.error || \"Failed to get response\"}`);\n      }\n    } catch (error) {\n      setTestResponse(\"Error: Failed to connect to server.\");\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-3xl font-bold tracking-tight\">New AI Agent</h2>\n          <Button variant=\"outline\" onClick={() => navigate(\"/ai/agents\")}>\n            View All Agents\n          </Button>\n        </div>\n        \n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card className=\"h-full\">\n            <CardHeader>\n              <CardTitle>Agent Configuration</CardTitle>\n              <CardDescription>Define how your AI agent should behave.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-2\">\n                <Label>Agent Name *</Label>\n                <Input \n                  placeholder=\"e.g., Support Bot Level 1\" \n                  value={formData.name}\n                  onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                  disabled={!!createdAgentId}\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Description</Label>\n                <Input \n                  placeholder=\"Brief description of this agent\" \n                  value={formData.description}\n                  onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n                  disabled={!!createdAgentId}\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>AI Model</Label>\n                <Select\n                  value={formData.model}\n                  onValueChange={(value) => setFormData(prev => ({ ...prev, model: value }))}\n                  disabled={!!createdAgentId}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"gpt-4o\" className=\"flex items-center\">\n                      <span className=\"font-medium\">OpenAI GPT-4o</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Most Intelligent)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gpt-4o-mini\">\n                      <span className=\"font-medium\">OpenAI GPT-4o Mini</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Smart & Fast)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gpt-4-turbo\">\n                      <span className=\"font-medium\">OpenAI GPT-4 Turbo</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Premium)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gpt-3.5-turbo\">\n                      <span className=\"font-medium\">OpenAI GPT-3.5</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Economy)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gemini-2.5-flash\">\n                      <span className=\"font-medium\">Gemini 2.5 Flash</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Fast & Efficient)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gemini-2.5-pro\">\n                      <span className=\"font-medium\">Gemini 2.5 Pro</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Advanced Reasoning)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gemini-1.5-flash\">\n                      <span className=\"font-medium\">Gemini 1.5 Flash</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Budget Friendly)</span>\n                    </SelectItem>\n                    <SelectItem value=\"gemini-1.5-pro\">\n                      <span className=\"font-medium\">Gemini 1.5 Pro</span>\n                      <span className=\"ml-2 text-xs text-muted-foreground\">(Multimodal)</span>\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  OpenAI models require OpenAI API key | Gemini models require Gemini API key\n                </p>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Temperature: {formData.temperature}</Label>\n                <Slider\n                  value={[formData.temperature]}\n                  min={0}\n                  max={1}\n                  step={0.1}\n                  onValueChange={([value]) => setFormData(prev => ({ ...prev, temperature: value }))}\n                  disabled={!!createdAgentId}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Lower = more focused, Higher = more creative\n                </p>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>System Instructions *</Label>\n                <Textarea \n                  className=\"min-h-[200px] font-mono text-sm\"\n                  placeholder=\"You are a helpful support assistant for Acme Corp. You answer questions about our widgets. If you don't know the answer, politely transfer the chat to a human agent.\"\n                  value={formData.systemPrompt}\n                  onChange={(e) => setFormData(prev => ({ ...prev, systemPrompt: e.target.value }))}\n                  disabled={!!createdAgentId}\n                />\n              </div>\n              {createdAgentId ? (\n                <div className=\"space-y-2\">\n                  <div className=\"p-3 bg-green-50 text-green-700 rounded-md text-sm\">\n                    Agent created successfully! You can now test it on the right.\n                  </div>\n                  <Button \n                    className=\"w-full\" \n                    variant=\"outline\"\n                    onClick={() => {\n                      setCreatedAgentId(null);\n                      setFormData({\n                        name: \"\",\n                        description: \"\",\n                        systemPrompt: \"\",\n                        model: \"gpt-4o\",\n                        temperature: 0.7,\n                      });\n                      setTestMessage(\"\");\n                      setTestResponse(\"\");\n                    }}\n                  >\n                    Create Another Agent\n                  </Button>\n                </div>\n              ) : (\n                <Button className=\"w-full\" onClick={handleCreateAgent} disabled={loading}>\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Creating...\n                    </>\n                  ) : (\n                    \"Create Agent\"\n                  )}\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"h-full flex flex-col\">\n            <CardHeader>\n              <CardTitle>Test Playground</CardTitle>\n              <CardDescription>\n                {createdAgentId \n                  ? \"Interact with your agent to test the instructions.\" \n                  : \"Create an agent first to test it here.\"}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"flex-1 flex flex-col\">\n              <div className=\"flex-1 bg-muted/50 rounded-md border p-4 mb-4 min-h-[300px] max-h-[400px] overflow-auto\">\n                {!createdAgentId ? (\n                  <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                    <p>Create an agent to start testing</p>\n                  </div>\n                ) : testResponse ? (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex gap-2 justify-end\">\n                      <div className=\"bg-primary text-primary-foreground p-3 rounded-lg rounded-tr-none max-w-[80%] text-sm\">\n                        {testMessage}\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <div className=\"h-8 w-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground shrink-0\">\n                        <Bot className=\"h-5 w-5\" />\n                      </div>\n                      <div className=\"bg-white p-3 rounded-lg rounded-tl-none shadow-sm max-w-[80%] text-sm whitespace-pre-wrap\">\n                        {testResponse}\n                      </div>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"flex gap-2 mb-4\">\n                    <div className=\"h-8 w-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground\">\n                      <Bot className=\"h-5 w-5\" />\n                    </div>\n                    <div className=\"bg-white p-3 rounded-lg rounded-tl-none shadow-sm max-w-[80%] text-sm\">\n                      Hello! I am your AI assistant. How can I help you today?\n                    </div>\n                  </div>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                <Input \n                  placeholder=\"Type a message...\" \n                  value={testMessage}\n                  onChange={(e) => setTestMessage(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleTestAgent()}\n                  disabled={!createdAgentId || testing}\n                />\n                <Button \n                  size=\"icon\" \n                  onClick={handleTestAgent}\n                  disabled={!createdAgentId || testing || !testMessage.trim()}\n                >\n                  {testing ? (\n                    <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Play className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":13965,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"server/modules/mapping/mapping.routes.ts":{"content":"import { Router } from 'express';\nimport * as controller from './mapping.controller';\n\nconst router = Router();\n\nrouter.get('/', controller.listMappings);\nrouter.get('/form/:formId', controller.getMappingByForm);\nrouter.get('/:id', controller.getMapping);\nrouter.post('/', controller.createMapping);\nrouter.put('/:id', controller.updateMapping);\nrouter.delete('/:id', controller.deleteMapping);\n\nexport default router;\n","path":null,"size_bytes":419,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/stats-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  description?: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    label: string;\n  };\n  className?: string;\n}\n\nexport function StatsCard({ title, value, description, icon: Icon, trend, className }: StatsCardProps) {\n  return (\n    <Card className={className}>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-2xl font-bold\">{value}</div>\n        {(description || trend) && (\n          <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n            {trend && (\n              <span className={trend.value > 0 ? \"text-emerald-600 font-medium\" : \"text-destructive font-medium\"}>\n                {trend.value > 0 ? \"+\" : \"\"}{trend.value}%\n              </span>\n            )}\n            {trend && <span className=\"text-muted-foreground/60\">{trend.label}</span>}\n            {!trend && description}\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1364,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/pages/templates/ManageTemplates.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { MoreHorizontal, Edit, Trash2, Loader2, Plus, Copy, RefreshCw, Send, AlertTriangle, CheckCircle2, Info, ExternalLink } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Template {\n  id: string;\n  name: string;\n  category: \"marketing\" | \"utility\" | \"authentication\";\n  content: string;\n  variables: string[];\n  status: \"pending\" | \"approved\" | \"rejected\";\n  language?: string;\n  metaTemplateId?: string;\n  metaStatus?: string;\n  rejectionReason?: string;\n  lastSyncedAt?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function ManageTemplates() {\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    category: \"utility\" as \"marketing\" | \"utility\" | \"authentication\",\n    content: \"\",\n    variables: \"\",\n  });\n  const queryClient = useQueryClient();\n\n  const { data: templates = [], isLoading } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const syncMetaTemplatesMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(\"/api/templates/sync-meta\", {\n        method: \"POST\",\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || data.message || \"Failed to sync templates\");\n      }\n      return data;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      const approvedList = data.approvedTemplates?.length > 0 \n        ? `Approved: ${data.approvedTemplates.join(\", \")}`\n        : \"No approved templates found\";\n      toast.success(data.message || `Synced ${data.synced || 0} templates from Meta`, {\n        description: approvedList,\n        duration: 5000,\n      });\n    },\n    onError: (error: Error) => {\n      toast.error(\"Failed to sync META templates\", {\n        description: error.message,\n        duration: 5000,\n      });\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/templates\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create template\");\n      return res.json();\n    },\n    onSuccess: (template) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      setIsAddDialogOpen(false);\n      resetForm();\n      toast.success(\"Template created successfully!\", {\n        description: \"Click 'Submit' button to send it to Meta for approval.\",\n        duration: 4000,\n      });\n    },\n    onError: () => {\n      toast.error(\"Failed to create template\");\n    },\n  });\n\n  const submitForApprovalMutation = useMutation({\n    mutationFn: async (templateId: string) => {\n      const res = await fetch(`/api/templates/${templateId}/submit-approval`, {\n        method: \"POST\",\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || data.message || \"Failed to submit for approval\");\n      }\n      return data;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      toast.success(data.message || \"Template submitted to Meta for approval!\", {\n        description: data.metaTemplateName ? `Template name in Meta: ${data.metaTemplateName}` : undefined,\n        duration: 5000,\n      });\n    },\n    onError: (error: Error) => {\n      toast.error(\"Failed to submit template\", {\n        description: error.message,\n        duration: 5000,\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const res = await fetch(`/api/templates/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to update template\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      setIsEditDialogOpen(false);\n      setSelectedTemplate(null);\n      toast.success(\"Template updated successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to update template\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/templates/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete template\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      toast.success(\"Template deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete template\");\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({ name: \"\", category: \"utility\", content: \"\", variables: \"\" });\n  };\n\n  const openEditDialog = (template: Template) => {\n    setSelectedTemplate(template);\n    setFormData({\n      name: template.name,\n      category: template.category,\n      content: template.content,\n      variables: template.variables.join(\", \"),\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleCreate = () => {\n    createMutation.mutate({\n      name: formData.name,\n      category: formData.category,\n      content: formData.content,\n      variables: formData.variables.split(\",\").map(v => v.trim()).filter(Boolean),\n    });\n  };\n\n  const handleUpdate = () => {\n    if (!selectedTemplate) return;\n    updateMutation.mutate({\n      id: selectedTemplate.id,\n      data: {\n        name: formData.name,\n        category: formData.category,\n        content: formData.content,\n        variables: formData.variables.split(\",\").map(v => v.trim()).filter(Boolean),\n        status: \"pending\",\n      },\n    });\n  };\n\n  const copyToClipboard = (content: string) => {\n    navigator.clipboard.writeText(content);\n    toast.success(\"Template content copied to clipboard\");\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"approved\": return \"default\";\n      case \"pending\": return \"secondary\";\n      case \"rejected\": return \"destructive\";\n      default: return \"secondary\";\n    }\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Manage Templates</h2>\n            <p className=\"text-muted-foreground\">Create and manage your WhatsApp message templates.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => syncMetaTemplatesMutation.mutate()}\n              disabled={syncMetaTemplatesMutation.isPending}\n            >\n              {syncMetaTemplatesMutation.isPending ? (\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              ) : (\n                <RefreshCw className=\"mr-2 h-4 w-4\" />\n              )}\n              Sync META Templates\n            </Button>\n            <Button onClick={() => { resetForm(); setIsAddDialogOpen(true); }}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create Template\n            </Button>\n          </div>\n        </div>\n\n        <Card className=\"border-blue-200 bg-blue-50/50 dark:bg-blue-950/20 dark:border-blue-900\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Info className=\"h-5 w-5 text-blue-600\" />\n              WhatsApp Template Rules & Guidelines\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                  Allowed Content\n                </h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1 pl-6 list-disc\">\n                  <li>Transaction confirmations (orders, bookings)</li>\n                  <li>Account updates and notifications</li>\n                  <li>Customer service responses</li>\n                  <li>One-time passwords (OTP)</li>\n                  <li>Appointment reminders</li>\n                </ul>\n              </div>\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n                  <AlertTriangle className=\"h-4 w-4 text-red-600\" />\n                  Not Allowed\n                </h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1 pl-6 list-disc\">\n                  <li>Promotional content without opt-in</li>\n                  <li>Adult or gambling content</li>\n                  <li>Misleading or spam messages</li>\n                  <li>Political content</li>\n                  <li>Cryptocurrency promotions</li>\n                </ul>\n              </div>\n            </div>\n            <Alert>\n              <Info className=\"h-4 w-4\" />\n              <AlertTitle>Approval Process</AlertTitle>\n              <AlertDescription>\n                Templates must be approved by Meta before use. Marketing templates may take 24-48 hours. \n                Utility and authentication templates are usually approved faster.\n                <a \n                  href=\"https://developers.facebook.com/docs/whatsapp/message-templates/guidelines\" \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"inline-flex items-center gap-1 ml-2 text-blue-600 hover:underline\"\n                >\n                  View Full Guidelines <ExternalLink className=\"h-3 w-3\" />\n                </a>\n              </AlertDescription>\n            </Alert>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Templates</CardTitle>\n            <CardDescription>\n              {templates.length} template{templates.length !== 1 ? 's' : ''} in your library. \n              Note that editing an approved template will require re-approval.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : templates.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No templates yet. Create your first template or sync from Meta to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Category</TableHead>\n                    <TableHead>Language</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Variables</TableHead>\n                    <TableHead>Last Updated</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {templates.map((template) => (\n                    <TableRow key={template.id}>\n                      <TableCell className=\"font-medium\">{template.name}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"capitalize\">\n                          {template.category}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>{template.language || 'en'}</TableCell>\n                      <TableCell>\n                        <Badge variant={getStatusColor(template.metaStatus?.toLowerCase() || template.status)} className=\"capitalize\">\n                          {template.metaStatus?.toLowerCase() || template.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {template.variables.slice(0, 3).map((v) => (\n                            <Badge key={v} variant=\"secondary\" className=\"text-xs\">\n                              {`{{${v}}}`}\n                            </Badge>\n                          ))}\n                          {template.variables.length > 3 && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              +{template.variables.length - 3}\n                            </Badge>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        {formatDate(template.updatedAt)}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          {(template.metaStatus?.toLowerCase() || template.status) === \"pending\" && !template.metaTemplateId && (\n                            <Button \n                              size=\"sm\" \n                              variant=\"outline\"\n                              onClick={() => submitForApprovalMutation.mutate(template.id)}\n                              disabled={submitForApprovalMutation.isPending}\n                            >\n                              <Send className=\"mr-1 h-3 w-3\" />\n                              Submit\n                            </Button>\n                          )}\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"icon\">\n                                <MoreHorizontal className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem onClick={() => copyToClipboard(template.content)}>\n                                <Copy className=\"mr-2 h-4 w-4\" />\n                                Copy Content\n                              </DropdownMenuItem>\n                              <DropdownMenuItem onClick={() => openEditDialog(template)}>\n                                <Edit className=\"mr-2 h-4 w-4\" />\n                                Edit\n                              </DropdownMenuItem>\n                              <DropdownMenuItem \n                                className=\"text-destructive\"\n                                onClick={() => deleteMutation.mutate(template.id)}\n                              >\n                                <Trash2 className=\"mr-2 h-4 w-4\" />\n                                Delete\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Create Template</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <Alert className=\"bg-yellow-50 border-yellow-200 dark:bg-yellow-950/20\">\n              <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\n              <AlertDescription className=\"text-sm\">\n                This template will be submitted to Meta for approval. Approval may take up to 24-48 hours for marketing templates.\n              </AlertDescription>\n            </Alert>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Template Name *</Label>\n                <Input\n                  placeholder=\"welcome_message\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value.toLowerCase().replace(/\\s+/g, '_') })}\n                />\n                <p className=\"text-xs text-muted-foreground\">Use lowercase with underscores (no spaces)</p>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Category *</Label>\n                <Select value={formData.category} onValueChange={(v) => setFormData({ ...formData, category: v as any })}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"marketing\">Marketing (Promotional)</SelectItem>\n                    <SelectItem value=\"utility\">Utility (Transactional)</SelectItem>\n                    <SelectItem value=\"authentication\">Authentication (OTP)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Message Content *</Label>\n              <Textarea\n                placeholder=\"Hello {{name}}, welcome to our service!\"\n                value={formData.content}\n                onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n                rows={5}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Use {\"{{variable}}\"} syntax for dynamic content. Max 1024 characters.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Variables (comma-separated)</Label>\n              <Input\n                placeholder=\"name, order_id, delivery_date\"\n                value={formData.variables}\n                onChange={(e) => setFormData({ ...formData, variables: e.target.value })}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsAddDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleCreate} disabled={createMutation.isPending || !formData.name || !formData.content}>\n              {createMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Create & Submit for Approval\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Edit Template</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            {selectedTemplate?.status === \"approved\" && (\n              <Alert className=\"bg-yellow-50 border-yellow-200 dark:bg-yellow-950/20\">\n                <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\n                <AlertDescription className=\"text-sm\">\n                  Editing this approved template will require re-approval from Meta.\n                </AlertDescription>\n              </Alert>\n            )}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Template Name</Label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value.toLowerCase().replace(/\\s+/g, '_') })}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Category</Label>\n                <Select value={formData.category} onValueChange={(v) => setFormData({ ...formData, category: v as any })}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"marketing\">Marketing</SelectItem>\n                    <SelectItem value=\"utility\">Utility</SelectItem>\n                    <SelectItem value=\"authentication\">Authentication</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Message Content</Label>\n              <Textarea\n                value={formData.content}\n                onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n                rows={5}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Variables (comma-separated)</Label>\n              <Input\n                value={formData.variables}\n                onChange={(e) => setFormData({ ...formData, variables: e.target.value })}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleUpdate} disabled={updateMutation.isPending || !formData.name || !formData.content}>\n              {updateMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save & Resubmit\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":22915,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nconst AUTH_STORAGE_KEY = \"whatsapp_auth_user\";\n\nfunction getAuthHeaders(): Record<string, string> {\n  try {\n    const stored = localStorage.getItem(AUTH_STORAGE_KEY);\n    if (!stored) return {};\n    const user = JSON.parse(stored);\n    return {\n      \"x-user-id\": user.id || '',\n      \"x-user-role\": user.role || 'user',\n      \"x-user-name\": user.name || '',\n      \"x-user\": JSON.stringify(user),\n    };\n  } catch {\n    return {};\n  }\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const authHeaders = getAuthHeaders();\n  const res = await fetch(url, {\n    method,\n    headers: {\n      ...authHeaders,\n      ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n    },\n    body: data ? JSON.stringify(data) : undefined,\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const authHeaders = getAuthHeaders();\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      headers: authHeaders,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1915,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"server/modules/leadAutoReply/templateMessages.service.ts":{"content":"export interface TemplateConfig {\n  name: string;\n  languageCode: string;\n  components?: TemplateComponent[];\n}\n\nexport interface TemplateComponent {\n  type: 'header' | 'body' | 'button';\n  parameters?: TemplateParameter[];\n  sub_type?: string;\n  index?: string;\n}\n\nexport interface TemplateParameter {\n  type: 'text' | 'currency' | 'date_time' | 'image' | 'video' | 'document';\n  text?: string;\n  parameter_name?: string;  // For named parameters like {{name}}\n  currency?: { fallback_value: string; code: string; amount_1000: number };\n  date_time?: { fallback_value: string };\n  image?: { link: string };\n  video?: { link: string };\n  document?: { link: string; filename: string };\n}\n\nfunction getWhatsAppCredentials(): { token: string; phoneNumberId: string } | null {\n  const token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN;\n  const phoneNumberId = process.env.PHONE_NUMBER_ID;\n  \n  if (!token || !phoneNumberId) {\n    return null;\n  }\n  \n  return { token, phoneNumberId };\n}\n\nexport async function sendTemplateMessage(\n  to: string,\n  template: TemplateConfig\n): Promise<{ success: boolean; error?: string; messageId?: string }> {\n  const credentials = getWhatsAppCredentials();\n  \n  if (!credentials) {\n    console.error('[TemplateMessage] WhatsApp credentials not configured');\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n\n  // Convert template name to Meta format: lowercase with underscores\n  const metaTemplateName = template.name.toLowerCase().replace(/\\s+/g, '_');\n  console.log(`[TemplateMessage] Sending template: \"${metaTemplateName}\" with language: \"${template.languageCode}\" to ${to}`);\n\n  // Try different language codes - Meta uses various formats\n  const languageCodesToTry = [template.languageCode, 'en', 'en_US', 'en_GB'];\n  const uniqueLanguages = Array.from(new Set(languageCodesToTry));\n\n  for (const langCode of uniqueLanguages) {\n    const messagePayload: Record<string, unknown> = {\n      messaging_product: 'whatsapp',\n      recipient_type: 'individual',\n      to: to,\n      type: 'template',\n      template: {\n        name: metaTemplateName,\n        language: {\n          code: langCode\n        }\n      }\n    };\n\n    if (template.components && template.components.length > 0) {\n      (messagePayload.template as Record<string, unknown>).components = template.components;\n    }\n\n    try {\n      const response = await fetch(\n        `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${credentials.token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(messagePayload),\n        }\n      );\n\n      const data = await response.json();\n      \n      if (response.ok && data.messages?.[0]?.id) {\n        console.log(`[TemplateMessage] Successfully sent template \"${metaTemplateName}\" (lang: ${langCode}) to ${to}`);\n        return { success: true, messageId: data.messages[0].id };\n      } else {\n        const errorMsg = data.error?.message || 'Failed to send template message';\n        const errorCode = data.error?.code;\n        \n        // If template doesn't exist in this language, try next language\n        if (errorCode === 132001 || errorMsg.includes('does not exist')) {\n          console.log(`[TemplateMessage] Template \"${metaTemplateName}\" not found with lang \"${langCode}\", trying next...`);\n          continue;\n        }\n        \n        // For other errors, return immediately\n        console.error(`[TemplateMessage] Failed: ${errorMsg}`);\n        return { success: false, error: errorMsg };\n      }\n    } catch (error) {\n      console.error('[TemplateMessage] Error:', error);\n      return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n    }\n  }\n\n  // If all language attempts failed\n  console.error(`[TemplateMessage] Template \"${metaTemplateName}\" not found in any language. Please sync templates from Meta to see which are actually approved.`);\n  return { success: false, error: `Template \"${metaTemplateName}\" not found in Meta. Please go to Templates page and click \"Sync Meta Templates\" to see your approved templates.` };\n}\n\nexport async function sendHelloWorldTemplate(to: string): Promise<{ success: boolean; error?: string; messageId?: string }> {\n  return sendTemplateMessage(to, {\n    name: 'hello_world',\n    languageCode: 'en_US'\n  });\n}\n\nexport async function getAvailableTemplates(): Promise<{ templates: unknown[]; error?: string }> {\n  const credentials = getWhatsAppCredentials();\n  \n  if (!credentials) {\n    return { templates: [], error: 'WhatsApp credentials not configured' };\n  }\n\n  try {\n    const phoneInfoResponse = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}?fields=account_mode`,\n      {\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n        },\n      }\n    );\n    \n    const phoneInfo = await phoneInfoResponse.json();\n    console.log('[TemplateMessage] Phone info:', phoneInfo);\n\n    return { templates: [], error: 'Template listing requires WABA ID' };\n  } catch (error) {\n    return { templates: [], error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n","path":null,"size_bytes":5277,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/pages/campaigns.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { \n  Megaphone, \n  Plus, \n  MoreHorizontal, \n  Calendar, \n  Clock,\n  PlayCircle,\n  Loader2,\n  Play,\n  Trash2,\n  Eye\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { toast } from \"sonner\";\n\ninterface Campaign {\n  id: string;\n  name: string;\n  message: string;\n  contactIds: string[];\n  status: \"draft\" | \"scheduled\" | \"running\" | \"completed\" | \"paused\";\n  scheduledAt?: string;\n  sentCount: number;\n  deliveredCount: number;\n  readCount: number;\n  repliedCount: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function Campaigns() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n\n  const { data: campaigns = [], isLoading } = useQuery<Campaign[]>({\n    queryKey: [\"/api/campaigns\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/campaigns\");\n      if (!res.ok) throw new Error(\"Failed to fetch campaigns\");\n      return res.json();\n    },\n  });\n\n  const sendMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/campaigns/${id}/send`, { method: \"POST\" });\n      if (!res.ok) throw new Error(\"Failed to send campaign\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/campaigns\"] });\n      toast.success(\"Campaign sent successfully!\");\n    },\n    onError: () => {\n      toast.error(\"Failed to send campaign\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/campaigns/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete campaign\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/campaigns\"] });\n      toast.success(\"Campaign deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete campaign\");\n    },\n  });\n\n  const activeCampaigns = campaigns.filter(c => c.status === \"running\").length;\n  const scheduledCampaigns = campaigns.filter(c => c.status === \"scheduled\").length;\n  const totalSent = campaigns.reduce((sum, c) => sum + c.sentCount, 0);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\": return \"secondary\";\n      case \"running\": return \"default\";\n      case \"scheduled\": return \"outline\";\n      case \"draft\": return \"outline\";\n      default: return \"secondary\";\n    }\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  return (\n    <DashboardLayout>\n       <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Campaigns</h2>\n            <p className=\"text-muted-foreground\">Manage your broadcast lists and scheduled messages.</p>\n          </div>\n          <Button onClick={() => setLocation(\"/campaigns/broadcast\")}>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Campaign\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Active Campaigns\n              </CardTitle>\n              <PlayCircle className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{activeCampaigns}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Running right now\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Scheduled\n              </CardTitle>\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{scheduledCampaigns}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Upcoming\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">\n                Messages Sent\n              </CardTitle>\n              <Megaphone className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{totalSent.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Total across all campaigns\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Campaigns</CardTitle>\n            <CardDescription>\n              A list of all your recent broadcasts and automated sequences.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : campaigns.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No campaigns yet. Create your first campaign to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Campaign Name</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Sent</TableHead>\n                    <TableHead>Delivered</TableHead>\n                    <TableHead>Read</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {campaigns.map((campaign) => (\n                    <TableRow key={campaign.id}>\n                      <TableCell className=\"font-medium\">{campaign.name}</TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={getStatusColor(campaign.status)}\n                          className={campaign.status === 'running' ? 'bg-green-500 hover:bg-green-600' : ''}\n                        >\n                          {campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>{campaign.sentCount.toLocaleString()}</TableCell>\n                      <TableCell>{campaign.deliveredCount.toLocaleString()}</TableCell>\n                      <TableCell>{campaign.readCount.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-3 w-3\" />\n                          {campaign.scheduledAt ? formatDate(campaign.scheduledAt) : formatDate(campaign.createdAt)}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\">\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => setLocation(`/campaigns/report`)}>\n                              <Eye className=\"mr-2 h-4 w-4\" />\n                              View Report\n                            </DropdownMenuItem>\n                            {(campaign.status === \"draft\" || campaign.status === \"scheduled\") && (\n                              <DropdownMenuItem onClick={() => sendMutation.mutate(campaign.id)}>\n                                <Play className=\"mr-2 h-4 w-4\" />\n                                Send Now\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => deleteMutation.mutate(campaign.id)}\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n       </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9841,"size_tokens":null},"client/src/pages/automation/AutoLeads.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Facebook, Instagram, Globe, MessageSquare } from \"lucide-react\";\n\nexport default function AutoLeads() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Auto-messages to Leads</h2>\n          <p className=\"text-muted-foreground\">Configure automatic welcome messages for new leads from different sources.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-blue-600 flex items-center justify-center text-white\">\n                     <Facebook className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Facebook Leads</CardTitle>\n                     <CardDescription>Leads from FB Lead Forms</CardDescription>\n                   </div>\n                 </div>\n                 <Switch defaultChecked />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Hi {{name}}, thanks for your interest in our product! We have received your inquiry and will get back to you shortly.\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n\n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-pink-600 flex items-center justify-center text-white\">\n                     <Instagram className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Instagram Leads</CardTitle>\n                     <CardDescription>Leads from IG Direct</CardDescription>\n                   </div>\n                 </div>\n                 <Switch />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Hello {{name}}! Thanks for reaching out on Instagram.\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n          \n          <Card>\n            <CardHeader>\n               <div className=\"flex items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                   <div className=\"h-10 w-10 rounded-lg bg-green-600 flex items-center justify-center text-white\">\n                     <Globe className=\"h-6 w-6\" />\n                   </div>\n                   <div>\n                     <CardTitle>Website Form</CardTitle>\n                     <CardDescription>Leads from your website</CardDescription>\n                   </div>\n                 </div>\n                 <Switch defaultChecked />\n               </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Welcome Message</Label>\n                 <Textarea \n                   defaultValue=\"Thanks for signing up on our website, {{name}}!\"\n                   className=\"min-h-[100px]\"\n                 />\n               </div>\n            </CardContent>\n            <CardFooter>\n               <Button>Save Settings</Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4471,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/settings/Billing.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CreditCard, Download, Coins, ArrowUpRight } from \"lucide-react\";\n\nexport default function Billing() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Billing & Credits</h2>\n          <p className=\"text-muted-foreground\">Manage your subscription and conversation credits.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-3\">\n          <Card className=\"bg-primary text-primary-foreground border-none\">\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium opacity-90\">Available Credits</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-4xl font-bold\">$24.50</div>\n               <Button variant=\"secondary\" className=\"w-full mt-4 text-primary\">\n                 <Plus className=\"mr-2 h-4 w-4\" /> Recharge\n               </Button>\n             </CardContent>\n          </Card>\n\n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium\">Monthly Usage</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-4xl font-bold\">$12.30</div>\n               <p className=\"text-xs text-muted-foreground mt-1\">Since Nov 1, 2025</p>\n               <div className=\"mt-4 h-2 bg-secondary rounded-full overflow-hidden\">\n                 <div className=\"h-full bg-blue-500 w-[45%]\"></div>\n               </div>\n             </CardContent>\n          </Card>\n          \n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium\">Payment Method</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"flex items-center gap-2 mb-4\">\n                 <CreditCard className=\"h-5 w-5 text-muted-foreground\" />\n                 <span className=\"font-medium\"> 4242</span>\n               </div>\n               <Button variant=\"outline\" className=\"w-full\">Manage Cards</Button>\n             </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Transaction History</CardTitle>\n            <CardDescription>Recent purchases and usage charges.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead className=\"text-right\">Invoice</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell>Nov 27, 2025</TableCell>\n                  <TableCell>Credit Recharge</TableCell>\n                  <TableCell><Badge className=\"bg-green-500\">Success</Badge></TableCell>\n                  <TableCell className=\"text-right\">+$50.00</TableCell>\n                  <TableCell className=\"text-right\"><Button variant=\"ghost\" size=\"icon\"><Download className=\"h-4 w-4\" /></Button></TableCell>\n                </TableRow>\n                <TableRow>\n                  <TableCell>Nov 01, 2025</TableCell>\n                  <TableCell>Monthly Subscription (Pro)</TableCell>\n                  <TableCell><Badge className=\"bg-green-500\">Success</Badge></TableCell>\n                  <TableCell className=\"text-right\">-$29.00</TableCell>\n                  <TableCell className=\"text-right\"><Button variant=\"ghost\" size=\"icon\"><Download className=\"h-4 w-4\" /></Button></TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n\nimport { Plus } from \"lucide-react\";\n","path":null,"size_bytes":4357,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"WhatsappBusinessDashboard/client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/pages/contacts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter, DialogDescription } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Users, \n  Search, \n  Filter, \n  Upload, \n  Download,\n  MoreHorizontal,\n  Trash2,\n  Edit,\n  Loader2,\n  Plus\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags: string[];\n  notes?: string;\n  source?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function Contacts() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isImportDialogOpen, setIsImportDialogOpen] = useState(false);\n  const [selectedContact, setSelectedContact] = useState<Contact | null>(null);\n  const [formData, setFormData] = useState({ name: \"\", phone: \"\", email: \"\", tags: \"\", notes: \"\" });\n  const [importData, setImportData] = useState(\"\");\n\n  const queryClient = useQueryClient();\n\n  const { data: regularContacts = [], isLoading: isLoadingRegular } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch contacts\");\n      return res.json();\n    },\n  });\n\n  const { data: importedContacts = [], isLoading: isLoadingImported } = useQuery<Contact[]>({\n    queryKey: [\"/api/broadcast/imported-contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/imported-contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch imported contacts\");\n      return res.json();\n    },\n  });\n\n  const contacts = [...regularContacts, ...importedContacts.map(c => ({\n    ...c,\n    tags: c.tags || [],\n    source: c.source || 'import',\n  }))];\n  \n  const isLoading = isLoadingRegular || isLoadingImported;\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/contacts\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      setIsAddDialogOpen(false);\n      setFormData({ name: \"\", phone: \"\", email: \"\", tags: \"\", notes: \"\" });\n      toast.success(\"Contact created successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to create contact\");\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const res = await fetch(`/api/contacts/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to update contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      setIsEditDialogOpen(false);\n      setSelectedContact(null);\n      toast.success(\"Contact updated successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to update contact\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (contact: Contact) => {\n      const isImported = contact.source === 'import' || contact.source === 'excel' || contact.source === 'csv';\n      const url = isImported \n        ? `/api/broadcast/imported-contacts/${contact.id}`\n        : `/api/contacts/${contact.id}`;\n      const res = await fetch(url, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete contact\");\n      return isImported;\n    },\n    onSuccess: (isImported) => {\n      if (isImported) {\n        queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/imported-contacts\"] });\n      } else {\n        queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      }\n      toast.success(\"Contact deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete contact\");\n    },\n  });\n\n  const importMutation = useMutation({\n    mutationFn: async (contacts: any[]) => {\n      const res = await fetch(\"/api/contacts/import\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ contacts }),\n      });\n      if (!res.ok) throw new Error(\"Failed to import contacts\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts\"] });\n      setIsImportDialogOpen(false);\n      setImportData(\"\");\n      toast.success(`Imported ${data.imported} contacts successfully`);\n    },\n    onError: () => {\n      toast.error(\"Failed to import contacts\");\n    },\n  });\n\n  const handleAddContact = () => {\n    createMutation.mutate({\n      name: formData.name,\n      phone: formData.phone,\n      email: formData.email || undefined,\n      tags: formData.tags.split(\",\").map(t => t.trim()).filter(Boolean),\n      notes: formData.notes || undefined,\n    });\n  };\n\n  const handleEditContact = () => {\n    if (!selectedContact) return;\n    updateMutation.mutate({\n      id: selectedContact.id,\n      data: {\n        name: formData.name,\n        phone: formData.phone,\n        email: formData.email || undefined,\n        tags: formData.tags.split(\",\").map(t => t.trim()).filter(Boolean),\n        notes: formData.notes || undefined,\n      },\n    });\n  };\n\n  const handleImport = () => {\n    try {\n      const lines = importData.trim().split(\"\\n\");\n      const contacts = lines.map(line => {\n        const [name, phone, email, tags] = line.split(\",\").map(s => s.trim());\n        return {\n          name: name || \"Unknown\",\n          phone: phone || \"\",\n          email: email || undefined,\n          tags: tags ? tags.split(\";\").map(t => t.trim()) : [],\n        };\n      }).filter(c => c.phone);\n      importMutation.mutate(contacts);\n    } catch (error) {\n      toast.error(\"Invalid import format\");\n    }\n  };\n\n  const handleExport = () => {\n    const csv = contacts.map(c => \n      `${c.name},${c.phone},${c.email || \"\"},${c.tags.join(\";\")}`\n    ).join(\"\\n\");\n    const blob = new Blob([`Name,Phone,Email,Tags\\n${csv}`], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"contacts.csv\";\n    a.click();\n    toast.success(\"Contacts exported successfully\");\n  };\n\n  const openEditDialog = (contact: Contact) => {\n    setSelectedContact(contact);\n    setFormData({\n      name: contact.name,\n      phone: contact.phone,\n      email: contact.email || \"\",\n      tags: contact.tags.join(\", \"),\n      notes: contact.notes || \"\",\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const filteredContacts = contacts.filter(c =>\n    c.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    c.phone.includes(searchQuery) ||\n    c.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  const getTimeAgo = (date: string) => {\n    const diff = Date.now() - new Date(date).getTime();\n    const minutes = Math.floor(diff / 60000);\n    const hours = Math.floor(diff / 3600000);\n    const days = Math.floor(diff / 86400000);\n    if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;\n    if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    if (minutes > 0) return `${minutes} min${minutes > 1 ? 's' : ''} ago`;\n    return \"Just now\";\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Contacts</h2>\n            <p className=\"text-muted-foreground\">Manage your customer database and segments.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Dialog open={isImportDialogOpen} onOpenChange={setIsImportDialogOpen}>\n              <DialogTrigger asChild>\n                <Button variant=\"outline\">\n                  <Upload className=\"mr-2 h-4 w-4\" />\n                  Import\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Import Contacts</DialogTitle>\n                  <DialogDescription>\n                    Paste CSV data (Name,Phone,Email,Tags). Tags separated by semicolons.\n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4\">\n                  <Textarea\n                    placeholder=\"John Doe,+1234567890,john@email.com,VIP;Customer\"\n                    value={importData}\n                    onChange={(e) => setImportData(e.target.value)}\n                    rows={6}\n                  />\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsImportDialogOpen(false)}>Cancel</Button>\n                  <Button onClick={handleImport} disabled={importMutation.isPending}>\n                    {importMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                    Import\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Button variant=\"outline\" onClick={handleExport}>\n              <Download className=\"mr-2 h-4 w-4\" />\n              Export\n            </Button>\n\n            <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n              <DialogTrigger asChild>\n                <Button>\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add Contact\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New Contact</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Name *</Label>\n                    <Input\n                      placeholder=\"John Doe\"\n                      value={formData.name}\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Phone Number *</Label>\n                    <Input\n                      placeholder=\"+1234567890\"\n                      value={formData.phone}\n                      onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Email</Label>\n                    <Input\n                      type=\"email\"\n                      placeholder=\"john@example.com\"\n                      value={formData.email}\n                      onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Tags (comma-separated)</Label>\n                    <Input\n                      placeholder=\"VIP, Customer, Lead\"\n                      value={formData.tags}\n                      onChange={(e) => setFormData({ ...formData, tags: e.target.value })}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Notes</Label>\n                    <Textarea\n                      placeholder=\"Additional notes...\"\n                      value={formData.notes}\n                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n                    />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsAddDialogOpen(false)}>Cancel</Button>\n                  <Button onClick={handleAddContact} disabled={createMutation.isPending || !formData.name || !formData.phone}>\n                    {createMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                    Add Contact\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle>All Contacts</CardTitle>\n                <CardDescription>Total {contacts.length} contacts in your database.</CardDescription>\n              </div>\n              <div className=\"flex items-center gap-2 w-full md:w-auto\">\n                <div className=\"relative w-64\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input \n                    placeholder=\"Search contacts...\" \n                    className=\"pl-9\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                  />\n                </div>\n                <Button variant=\"outline\" size=\"icon\">\n                  <Filter className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-[250px]\">Name</TableHead>\n                    <TableHead>Phone Number</TableHead>\n                    <TableHead>Tags</TableHead>\n                    <TableHead>Last Updated</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredContacts.map((contact) => (\n                    <TableRow key={contact.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarFallback className=\"text-xs bg-primary/10 text-primary\">\n                              {contact.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <div>{contact.name}</div>\n                            {contact.email && <div className=\"text-xs text-muted-foreground\">{contact.email}</div>}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{contact.phone}</TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {contact.tags.map(tag => (\n                            <Badge key={tag} variant=\"secondary\" className=\"text-xs font-normal\">\n                              {tag}\n                            </Badge>\n                          ))}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">{getTimeAgo(contact.updatedAt)}</TableCell>\n                      <TableCell className=\"text-right\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\">\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => openEditDialog(contact)}>\n                              <Edit className=\"mr-2 h-4 w-4\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => deleteMutation.mutate(contact)}\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Contact</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Name *</Label>\n              <Input\n                placeholder=\"John Doe\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Phone Number *</Label>\n              <Input\n                placeholder=\"+1234567890\"\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Email</Label>\n              <Input\n                type=\"email\"\n                placeholder=\"john@example.com\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Tags (comma-separated)</Label>\n              <Input\n                placeholder=\"VIP, Customer, Lead\"\n                value={formData.tags}\n                onChange={(e) => setFormData({ ...formData, tags: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Notes</Label>\n              <Textarea\n                placeholder=\"Additional notes...\"\n                value={formData.notes}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>Cancel</Button>\n            <Button onClick={handleEditContact} disabled={updateMutation.isPending || !formData.name || !formData.phone}>\n              {updateMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save Changes\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":20024,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/pages/inbox/WindowInbox.tsx":{"content":"import { useState, useEffect, useRef, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\nimport { getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Search,\n  Paperclip,\n  Send,\n  Smile,\n  MoreVertical,\n  Phone,\n  Video,\n  Loader2,\n  Download,\n  Clock,\n  CheckSquare,\n  Bot,\n  FileText,\n  MessageSquare,\n  Reply,\n  X,\n  MailOpen,\n  Ban,\n  ArrowLeft,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags: string[];\n}\n\ninterface Message {\n  id: string;\n  contactId: string;\n  content: string;\n  type: string;\n  direction: \"inbound\" | \"outbound\";\n  status: string;\n  timestamp: string;\n  replyToMessageId?: string;\n  replyToContent?: string;\n  mediaUrl?: string;\n}\n\ninterface Chat {\n  id: string;\n  contactId: string;\n  contact: Contact;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  lastInboundMessageTime?: string;\n  lastInboundMessage?: string;\n  unreadCount: number;\n  status: string;\n  windowExpiresAt?: string;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  variables: string[];\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\ninterface ImportedContact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n}\n\n// Normalize phone number for comparison (strip all non-digits)\nasync function downloadMediaWithAuth(mediaUrl: string, filename: string, openInNewTab: boolean = false) {\n  try {\n    const response = await fetch(`/api/webhook/whatsapp/media/${mediaUrl}`, {\n      headers: getAuthHeaders()\n    });\n    \n    if (!response.ok) {\n      throw new Error('Failed to download media');\n    }\n    \n    const blob = await response.blob();\n    const url = URL.createObjectURL(blob);\n    \n    if (openInNewTab) {\n      window.open(url, '_blank');\n    } else {\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    }\n    \n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  } catch (error) {\n    console.error('Media download error:', error);\n    toast.error('Failed to download file. Please try again.');\n  }\n}\n\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, \"\");\n}\n\nexport default function WindowInbox() {\n  const [selectedChatId, setSelectedChatId] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [selectedContacts, setSelectedContacts] = useState<string[]>([]);\n  const [isBulkSendOpen, setIsBulkSendOpen] = useState(false);\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai\">(\n    \"custom\",\n  );\n  const [selectedTemplate, setSelectedTemplate] = useState(\"\");\n  const [selectedAgent, setSelectedAgent] = useState(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [mobileView, setMobileView] = useState<\"list\" | \"chat\">(\"list\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const queryClient = useQueryClient();\n\n  // Notification sound\n  const notificationAudioRef = useRef<HTMLAudioElement | null>(null);\n  const lastUnreadCountRef = useRef<number>(0);\n  const audioUnlockedRef = useRef<boolean>(false);\n\n  // Initialize notification audio\n  useEffect(() => {\n    // Create audio element with a simple beep sound (base64 encoded short beep)\n    const beepSound =\n      \"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2telehs/hMGyjnYsT2fJ0sJxIBw4d7O5s4VYQXzQ182bhlltndzV0JqJe3aap7KopZmRjI+TmJ6cmZePhoJ+fHx8fH2AgYSGiYyPkZOVlZaWlpWUkpCNioaDgX9+fX19fn+BhIiMkJOXmpyenp6dnJqXlJGOioaDgYB/f4CBg4aJjZCTlpmbnZ2dnJqYlZKPjImGhIKBgICAgIGChYiLjpGUl5manJ2dnJuZl5WSkI2KiIaEg4KCgoKDhIaIi42QkpWXmZqbnJybmpiWlJKQjoqJh4aFhISEhISFhoiKjI6QkpSWmJmam5uamZeWlJKQjoyKiIeGhoWFhYWGh4iKjI6QkpSVl5iZmZmYl5aUkpCOjIqIh4aFhYWFhYaHiImLjI6QkpOVlpeYmJiXlpWUkpCOjIqIh4aFhYWFhYaHiImLjY+QkpOVlpeXl5eWlZSSkI+NjIqIh4aFhYWFhoaHiImLjI6PkZKUlZaWlpaVlJOSkI+NjIqJh4aGhYaGhoaHiImKjI2PkJGTlJWVlZWVlJOSkI+OjIuJiIeGhoaGhoaHiImKi42OkJGSk5SUlJSUk5KRkI+OjIuKiYiHh4aGh4eHiImKi4yNj5CRkpOTk5OTkpGQj46NjIuKiYiHh4eHh4eIiImKi4yNjpCQkZGSEpKSkZCPj46NjIuKiYiIh4eHh4iIiImKi4yNjo+QkZGRkZGRkI+Pjo2MjIuKiYmIiIeIiIiIiYmKi4yNjo+PkJCQkJCQj4+OjY2MjIuKiomIiIiIiIiJiYqKi4yNjY6Pj4+Pj4+Pjo6NjYyMi4uKiomJiIiIiIiJiYqKi4yMjY2Ojo6Ojo6OjY2NjIyMi4uKiomJiYiJiYmJiYqKi4uMjI2NjY2NjY2NjY2MjIyMi4uLioqJiYmJiYmJioqKi4uMjIyMjY2NjY2NjI2MjIyMi4uLioqKiomJiYmJiYqKiouLi4yMjI2NjY2MjIyMjIyMi4yLi4uKioqJiYmJiYqKioqLi4uMjIyMjIyMjIyMjIyMi4uLi4uKi4qKioqKioqKioqLi4uLjIyMjIyMjIyMjIyLi4uLi4uLioqKioqKioqKioqLi4uLi4yMjIyMjIyMjIuLi4uLi4uLioqKioqKioqKioqKi4uLi4yMjIyMjIyLi4uLi4uLi4uKioqKioqKioqKi4uLi4uLi4yMjIyMi4uLi4uLi4uLioqKioqKioqKioqLi4uLi4uMjIyMi4uLi4uLi4uLi4qKioqKioqKioqLi4uLi4uLjIyLi4uLi4uLi4uLi4qKioqKioqKioqLi4uLi4uLi4uLi4uLi4uLi4uLioqKioqKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqKioqLi4uLi4uLi4uLi4uLi4uLi4uLioqKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4uKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4uKioqLi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqLi4uLi4uLi4uLi4uLi4uLi4uLi4qKi4uLi4uLi4uLi4uLi4uLi4uLi4uLioqLi4uLi4uLi4uLi4uLi4uLi4uLi4uKi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4qLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLg==\";\n    notificationAudioRef.current = new Audio(beepSound);\n    notificationAudioRef.current.volume = 0.5;\n\n    // Unlock audio on user interaction - mark as unlocked immediately\n    const unlockAudio = () => {\n      // Mark as unlocked after first user interaction\n      audioUnlockedRef.current = true;\n\n      if (notificationAudioRef.current) {\n        // Try to play silently to fully unlock autoplay restrictions\n        notificationAudioRef.current\n          .play()\n          .then(() => {\n            notificationAudioRef.current?.pause();\n            notificationAudioRef.current!.currentTime = 0;\n          })\n          .catch(() => {\n            // Ignore errors - audio is still marked as unlocked\n          });\n      }\n    };\n\n    // Add listeners for common user interactions\n    const events = [\"click\", \"keydown\", \"touchstart\"];\n    events.forEach((event) => {\n      document.addEventListener(event, unlockAudio, { once: true });\n    });\n\n    return () => {\n      events.forEach((event) => {\n        document.removeEventListener(event, unlockAudio);\n      });\n    };\n  }, []);\n\n  const { data: chats = [], isLoading: chatsLoading } = useQuery<Chat[]>({\n    queryKey: [\"/api/chats/window\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/chats\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch chats\");\n      const allChats = await res.json();\n      const now = new Date();\n      return allChats\n        .filter((chat: Chat) => {\n          if (chat.lastInboundMessageTime) {\n            const lastInbound = new Date(chat.lastInboundMessageTime);\n            const hoursDiff =\n              (now.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n            return hoursDiff <= 24;\n          }\n          return false;\n        })\n        .map((chat: Chat) => ({\n          ...chat,\n          windowExpiresAt: chat.lastInboundMessageTime\n            ? new Date(\n                new Date(chat.lastInboundMessageTime).getTime() +\n                  24 * 60 * 60 * 1000,\n              ).toISOString()\n            : undefined,\n        }));\n    },\n    refetchInterval: 3000, // Auto-refresh every 3 seconds\n  });\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  // Fetch contacts for name lookup\n  const { data: importedContacts = [] } = useQuery<ImportedContact[]>({\n    queryKey: [\"/api/contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch contacts\");\n      return res.json();\n    },\n  });\n\n  // Create phone-to-name lookup maps for flexible matching (memoized)\n  // Only include contacts with real names (not auto-generated \"WhatsApp XXX\" names)\n  const { phoneToNameMap, last10ToNameMap } = useMemo(() => {\n    const phoneMap = new Map<string, string>();\n    const last10Map = new Map<string, string>();\n\n    // Helper to check if name is a real name (not auto-generated)\n    const isRealName = (name: string): boolean => {\n      if (!name || !name.trim()) return false;\n      if (name.startsWith(\"WhatsApp\")) return false;\n      if (name.startsWith(\"+\")) return false;\n      // Check if it's just digits (possibly with spaces)\n      if (/^\\d[\\d\\s]*$/.test(name)) return false;\n      return true;\n    };\n\n    importedContacts.forEach((contact) => {\n      const normalizedPhone = normalizePhone(contact.phone);\n      if (isRealName(contact.name)) {\n        // Store with full number\n        phoneMap.set(normalizedPhone, contact.name);\n        // Store with last 10 digits for matching with/without country code\n        if (normalizedPhone.length >= 10) {\n          last10Map.set(normalizedPhone.slice(-10), contact.name);\n        }\n      }\n    });\n\n    return { phoneToNameMap: phoneMap, last10ToNameMap: last10Map };\n  }, [importedContacts]);\n\n  // Function to get contact name from phone\n  const getContactName = useMemo(() => {\n    return (chatContact: Contact): string => {\n      const normalizedPhone = normalizePhone(chatContact.phone);\n\n      // First check if the chat contact already has a real name (not phone-based)\n      if (\n        chatContact.name &&\n        !chatContact.name.startsWith(\"WhatsApp\") &&\n        !chatContact.name.startsWith(\"+\") &&\n        !/^\\d+$/.test(chatContact.name.replace(/\\s/g, \"\"))\n      ) {\n        return chatContact.name;\n      }\n\n      // Look up name from imported contacts - try exact match first\n      let name = phoneToNameMap.get(normalizedPhone);\n      if (name) return name;\n\n      // Try matching with last 10 digits (handles country code differences)\n      if (normalizedPhone.length >= 10) {\n        const last10 = normalizedPhone.slice(-10);\n        name = last10ToNameMap.get(last10);\n        if (name) return name;\n      }\n\n      // Fallback to formatted phone number\n      return chatContact.phone.startsWith(\"+\")\n        ? chatContact.phone\n        : `+${chatContact.phone}`;\n    };\n  }, [phoneToNameMap, last10ToNameMap]);\n\n  const renderMessageContent = (msg: Message) => {\n    const content = msg.content;\n    const mediaUrl = msg.mediaUrl;\n\n    if (msg.type === \"image\" || content.startsWith(\"[Image\")) {\n      if (mediaUrl) {\n        const caption = content\n          .replace(/^\\[Image\\]\\s*/, \"\")\n          .replace(/^\\[Image message\\]$/, \"\");\n        return (\n          <div className=\"space-y-2\">\n            <img\n              src={`/api/webhook/whatsapp/media/${mediaUrl}`}\n              alt=\"Shared image\"\n              className=\"max-w-[280px] max-h-[300px] rounded-lg object-cover cursor-pointer hover:opacity-90 transition-opacity\"\n              onClick={() => downloadMediaWithAuth(mediaUrl, 'image.jpg', true)}\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = \"none\";\n                (\n                  e.target as HTMLImageElement\n                ).nextElementSibling?.classList.remove(\"hidden\");\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">\n              Image expired or unavailable\n            </span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (msg.type === \"video\" || content.startsWith(\"[Video\")) {\n      if (mediaUrl) {\n        const caption = content\n          .replace(/^\\[Video\\]\\s*/, \"\")\n          .replace(/^\\[Video message\\]$/, \"\");\n        return (\n          <div className=\"space-y-2\">\n            <video\n              src={`/api/webhook/whatsapp/media/${mediaUrl}`}\n              controls\n              className=\"max-w-[280px] max-h-[300px] rounded-lg\"\n              onError={(e) => {\n                (e.target as HTMLVideoElement).style.display = \"none\";\n                (\n                  e.target as HTMLVideoElement\n                ).nextElementSibling?.classList.remove(\"hidden\");\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">\n              Video expired or unavailable\n            </span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (msg.type === \"audio\" || content.startsWith(\"[Audio\")) {\n      if (mediaUrl) {\n        return (\n          <div className=\"space-y-2\">\n            <audio\n              src={`/api/webhook/whatsapp/media/${mediaUrl}`}\n              controls\n              className=\"max-w-[280px]\"\n              onError={(e) => {\n                (e.target as HTMLAudioElement).style.display = \"none\";\n                (\n                  e.target as HTMLAudioElement\n                ).nextElementSibling?.classList.remove(\"hidden\");\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">\n              Audio expired or unavailable\n            </span>\n          </div>\n        );\n      }\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (msg.type === \"sticker\" || content.startsWith(\"[Sticker\")) {\n      if (mediaUrl) {\n        return (\n          <div>\n            <img\n              src={`/api/webhook/whatsapp/media/${mediaUrl}`}\n              alt=\"Sticker\"\n              className=\"max-w-[150px] max-h-[150px]\"\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = \"none\";\n                (\n                  e.target as HTMLImageElement\n                ).nextElementSibling?.classList.remove(\"hidden\");\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">\n              Sticker expired or unavailable\n            </span>\n          </div>\n        );\n      }\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (msg.type === \"document\" || content.startsWith(\"[Document\")) {\n      if (mediaUrl) {\n        const filename =\n          content.match(/\\[Document: ([^\\]]+)\\]/)?.[1] || \"document\";\n        return (\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => downloadMediaWithAuth(mediaUrl, filename, true)}\n              className=\"flex items-center gap-2 p-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer\"\n            >\n              <span className=\"text-lg\"></span>\n              <span className=\"text-sm underline\">{filename}</span>\n            </button>\n            <button\n              onClick={() => downloadMediaWithAuth(mediaUrl, filename, false)}\n              className=\"p-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors\"\n              title=\"Download\"\n            >\n              <Download className=\"h-4 w-4\" />\n            </button>\n          </div>\n        );\n      }\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (content.startsWith(\"[Location\")) {\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (content.startsWith(\"[Contact\")) {\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    } else if (content.startsWith(\"[Reaction\")) {\n      return <span className=\"flex items-center gap-1\">{content}</span>;\n    } else if (content.startsWith(\"[Unsupported\")) {\n      return (\n        <span className=\"flex items-center gap-1 text-muted-foreground italic\">\n           {content}\n        </span>\n      );\n    }\n\n    return <span>{content}</span>;\n  };\n\n  const selectedChat = chats.find((c) => c.id === selectedChatId);\n  const selectedContactId = selectedChat?.contactId;\n\n  // Play notification sound when new messages arrive\n  const isInitialMount = useRef<boolean>(true);\n\n  useEffect(() => {\n    const totalUnread = chats.reduce(\n      (sum, chat) => sum + (chat.unreadCount || 0),\n      0,\n    );\n\n    // Skip initial mount to avoid playing sound on page load\n    if (isInitialMount.current) {\n      isInitialMount.current = false;\n      lastUnreadCountRef.current = totalUnread;\n      return;\n    }\n\n    // Play sound if unread count increased (new message received)\n    if (totalUnread > lastUnreadCountRef.current) {\n      if (notificationAudioRef.current && audioUnlockedRef.current) {\n        notificationAudioRef.current.currentTime = 0;\n        notificationAudioRef.current.play().catch(() => {});\n      }\n    }\n\n    lastUnreadCountRef.current = totalUnread;\n  }, [chats]);\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<\n    Message[]\n  >({\n    queryKey: [\"/api/messages\", selectedContactId],\n    queryFn: async () => {\n      if (!selectedContactId) return [];\n      const res = await fetch(`/api/messages?contactId=${selectedContactId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      return res.json();\n    },\n    enabled: !!selectedContactId,\n    refetchInterval: 2000, // Auto-refresh messages every 2 seconds\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({\n      content,\n      phone,\n      contactId,\n      replyToMessageId,\n      replyToContent,\n    }: {\n      content: string;\n      phone: string;\n      contactId: string;\n      replyToMessageId?: string;\n      replyToContent?: string;\n    }) => {\n      // Send via WhatsApp API\n      const waRes = await fetchWithAuth(\"/api/webhook/whatsapp/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          to: phone,\n          message: content,\n        }),\n      });\n\n      if (!waRes.ok) {\n        const error = await waRes.json();\n        throw new Error(error.error || \"Failed to send WhatsApp message\");\n      }\n\n      // Also save to local storage for inbox display\n      const res = await fetchWithAuth(\"/api/messages\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          contactId,\n          content,\n          type: \"text\",\n          direction: \"outbound\",\n          status: \"sent\",\n          replyToMessageId,\n          replyToContent,\n        }),\n      });\n\n      if (!res.ok) {\n        console.error(\"Failed to save message locally, but WhatsApp sent\");\n      }\n\n      return { waResult: await waRes.json(), contactId };\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/messages\", data.contactId],\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/window\"] });\n      setMessageInput(\"\");\n      setReplyingTo(null);\n      toast.success(\"Message sent via WhatsApp\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"Failed to send message\");\n    },\n  });\n\n  const sendBulkMessageMutation = useMutation({\n    mutationFn: async (data: {\n      contacts: string[];\n      messageType: string;\n      content: string;\n    }) => {\n      const results: { success: number; failed: number } = {\n        success: 0,\n        failed: 0,\n      };\n\n      for (const contactId of data.contacts) {\n        const chat = chats.find((c) => c.contactId === contactId);\n        if (!chat) continue;\n\n        const phone = chat.contact.phone.replace(/\\D/g, \"\");\n        const name = chat.contact.name;\n        const templateObj = templates.find((t) => t.id === selectedTemplate);\n\n        try {\n          const res = await fetchWithAuth(\"/api/inbox/send\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              contactId,\n              phone,\n              name,\n              messageType: data.messageType,\n              templateName: templateObj?.name,\n              customMessage:\n                data.messageType === \"custom\" ? data.content : undefined,\n              agentId: data.messageType === \"ai\" ? selectedAgent : undefined,\n            }),\n          });\n\n          if (res.ok) {\n            results.success++;\n          } else {\n            results.failed++;\n          }\n        } catch {\n          results.failed++;\n        }\n      }\n\n      return results;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/window\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setSelectedContacts([]);\n      setIsBulkSendOpen(false);\n      setCustomMessage(\"\");\n      setSelectedTemplate(\"\");\n      setSelectedAgent(\"\");\n      if (data.failed > 0) {\n        toast.success(\n          `Sent to ${data.success} contacts, ${data.failed} failed`,\n        );\n      } else {\n        toast.success(\n          `Message sent to ${data.success} contact${data.success > 1 ? \"s\" : \"\"}`,\n        );\n      }\n    },\n    onError: () => {\n      toast.error(\"Failed to send messages\");\n    },\n  });\n\n  useEffect(() => {\n    if (chats.length > 0 && !selectedChatId) {\n      setSelectedChatId(chats[0].id);\n    }\n  }, [chats, selectedChatId]);\n\n  // Mark messages as read when selecting a chat\n  const markAsReadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetchWithAuth(`/api/chats/${contactId}/mark-read`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as read\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/window\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n    },\n  });\n\n  const markAsUnreadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetchWithAuth(`/api/chats/${contactId}/mark-unread`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as unread\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/window\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      toast.success(\"Marked as unread\");\n    },\n  });\n\n  const [blockDialogOpen, setBlockDialogOpen] = useState(false);\n  const [contactToBlock, setContactToBlock] = useState<{ phone: string; name: string } | null>(null);\n\n  const blockContactMutation = useMutation({\n    mutationFn: async ({ phone, name }: { phone: string; name: string }) => {\n      const res = await fetchWithAuth(\"/api/contacts/block\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phone, name, reason: \"Blocked from 24-hour window\" }),\n      });\n      if (!res.ok) throw new Error(\"Failed to block contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/window\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setBlockDialogOpen(false);\n      setContactToBlock(null);\n      setSelectedChatId(null);\n      toast.success(\"Contact blocked successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to block contact\");\n    },\n  });\n\n  const handleSelectChat = (chatId: string) => {\n    setSelectedChatId(chatId);\n    setMobileView(\"chat\");\n    const chat = chats.find((c) => c.id === chatId);\n    if (chat && chat.unreadCount > 0) {\n      markAsReadMutation.mutate(chat.contactId);\n    }\n  };\n\n  const handleBackToList = () => {\n    setMobileView(\"list\");\n  };\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedChat || !selectedContactId) return;\n    const phone = selectedChat.contact.phone.replace(/\\D/g, \"\");\n\n    sendMessageMutation.mutate({\n      content: messageInput,\n      phone,\n      contactId: selectedContactId,\n      replyToMessageId: replyingTo?.id,\n      replyToContent: replyingTo?.content,\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleSelectAll = () => {\n    if (selectedContacts.length === chats.length) {\n      setSelectedContacts([]);\n    } else {\n      setSelectedContacts(chats.map((c) => c.contactId));\n    }\n  };\n\n  const handleSelectContact = (contactId: string) => {\n    setSelectedContacts((prev) =>\n      prev.includes(contactId)\n        ? prev.filter((id) => id !== contactId)\n        : [...prev, contactId],\n    );\n  };\n\n  const handleBulkSend = () => {\n    if (selectedContacts.length === 0) {\n      toast.error(\"Please select at least one contact\");\n      return;\n    }\n\n    let content = \"\";\n    if (messageType === \"template\") {\n      const template = templates.find((t) => t.id === selectedTemplate);\n      content = template?.content || \"\";\n    } else if (messageType === \"custom\") {\n      content = customMessage;\n    } else if (messageType === \"ai\") {\n      content = `[AI Agent: ${agents.find((a) => a.id === selectedAgent)?.name || \"Unknown\"}]`;\n    }\n\n    if (!content && messageType !== \"ai\") {\n      toast.error(\"Please enter a message or select a template\");\n      return;\n    }\n\n    sendBulkMessageMutation.mutate({\n      contacts: selectedContacts,\n      messageType,\n      content,\n    });\n  };\n\n  const handleDownload = () => {\n    const data = chats.map((chat) => ({\n      name: chat.contact.name,\n      phone: chat.contact.phone,\n      email: chat.contact.email || \"\",\n      lastMessage: chat.lastMessage || \"\",\n      windowExpires: chat.windowExpiresAt || \"\",\n    }));\n\n    const headers = [\n      \"Name\",\n      \"Phone\",\n      \"Email\",\n      \"Last Message\",\n      \"Window Expires\",\n    ];\n    const csv = [\n      headers.join(\",\"),\n      ...data.map((row) =>\n        [\n          row.name,\n          row.phone,\n          row.email,\n          `\"${row.lastMessage}\"`,\n          row.windowExpires,\n        ].join(\",\"),\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"24hour_window_contacts.csv\";\n    a.click();\n    URL.revokeObjectURL(url);\n    toast.success(\"List downloaded successfully\");\n  };\n\n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n\n    if (hours === 0) {\n      return `${minutes} min ago`;\n    } else if (hours < 24) {\n      return `${hours} hr ${minutes} min ago`;\n    } else {\n      return date.toLocaleDateString(\"en-US\", {\n        month: \"short\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n        hour12: true,\n      });\n    }\n  };\n\n  const getTimeRemaining = (expiresAt?: string) => {\n    if (!expiresAt) return \"Unknown\";\n    const expires = new Date(expiresAt);\n    const now = new Date();\n    const diff = expires.getTime() - now.getTime();\n    if (diff <= 0) return \"Expired\";\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    return `${hours} hr ${minutes} min left`;\n  };\n\n  const getInitials = (contact: Contact) => {\n    const displayName = getContactName(contact);\n    if (displayName.startsWith(\"+\")) {\n      return displayName.slice(-2);\n    }\n    return displayName\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .slice(0, 2)\n      .toUpperCase();\n  };\n\n  const filteredChats = chats\n    .filter(\n      (chat) =>\n        chat.contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        chat.contact.phone.includes(searchQuery),\n    )\n    .sort((a, b) => {\n      const aTime =\n        a.lastMessageTime ||\n        a.lastInboundMessageTime ||\n        a.windowExpiresAt ||\n        \"\";\n      const bTime =\n        b.lastMessageTime ||\n        b.lastInboundMessageTime ||\n        b.windowExpiresAt ||\n        \"\";\n      return new Date(bTime).getTime() - new Date(aTime).getTime();\n    });\n\n  const approvedTemplates = templates.filter((t) => t.status === \"approved\");\n\n  return (\n    <DashboardLayout>\n      <div className=\"h-[calc(100vh-80px)] md:h-[calc(100vh-100px)] flex flex-col gap-2 md:gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500 overflow-hidden\">\n        <div className={`flex flex-col md:flex-row md:items-center justify-between gap-2 flex-shrink-0 ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n          <div>\n            <h2 className=\"text-lg md:text-2xl font-bold tracking-tight flex items-center gap-2\">\n              <Clock className=\"h-5 w-5 md:h-7 md:w-7 text-primary\" />\n              24-Hour Window Inbox\n            </h2>\n            <p className=\"text-xs md:text-sm text-muted-foreground hidden md:block\">\n              Customers who messaged in the last 24 hours. Send free-form\n              messages without templates.\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" className=\"md:size-default\" onClick={handleDownload}>\n              <Download className=\"h-4 w-4 md:mr-2\" />\n              <span className=\"hidden md:inline\">Download List</span>\n            </Button>\n            {selectedContacts.length > 0 && (\n              <Button size=\"sm\" className=\"md:size-default\" onClick={() => setIsBulkSendOpen(true)}>\n                <Send className=\"h-4 w-4 md:mr-2\" />\n                <span className=\"hidden md:inline\">Send to</span> {selectedContacts.length}\n              </Button>\n            )}\n          </div>\n        </div>\n\n        <div className={`flex items-center gap-2 md:gap-4 p-2 md:p-3 bg-muted/50 rounded-lg flex-shrink-0 ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n          <Checkbox\n            checked={\n              selectedContacts.length === chats.length && chats.length > 0\n            }\n            onCheckedChange={handleSelectAll}\n          />\n          <span className=\"text-xs md:text-sm font-medium\">\n            Select All ({chats.length} contacts)\n          </span>\n          {selectedContacts.length > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {selectedContacts.length} selected\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex-1 min-h-0 flex flex-col md:flex-row bg-card border border-border rounded-lg overflow-hidden shadow-sm\">\n          <div className={`w-full md:w-80 lg:w-96 md:border-r border-border flex flex-col bg-background min-h-0 h-full ${mobileView === \"chat\" ? \"hidden md:flex\" : \"flex\"}`}>\n            <div className=\"p-3 md:p-4 border-b border-border\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search contacts...\"\n                  className=\"pl-9 bg-secondary/50\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n              </div>\n            </div>\n\n            <ScrollArea className=\"flex-1\">\n              {chatsLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                </div>\n              ) : filteredChats.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground text-center px-4\">\n                  <Clock className=\"h-12 w-12 mb-4 opacity-50\" />\n                  <p>No contacts in 24-hour window</p>\n                  <p className=\"text-xs mt-1\">\n                    Contacts appear here when they message you\n                  </p>\n                </div>\n              ) : (\n                <div className=\"divide-y divide-border\">\n                  {filteredChats.map((chat) => (\n                    <div\n                      key={chat.id}\n                      className={`p-3 flex items-start gap-2 hover:bg-muted/50 cursor-pointer transition-colors ${chat.id === selectedChatId ? \"bg-muted/50\" : \"\"}`}\n                    >\n                      <Checkbox\n                        checked={selectedContacts.includes(chat.contactId)}\n                        onCheckedChange={() =>\n                          handleSelectContact(chat.contactId)\n                        }\n                        onClick={(e) => e.stopPropagation()}\n                        className=\"mt-1\"\n                      />\n                      <div\n                        className=\"flex-1 flex items-start gap-2\"\n                        onClick={() => handleSelectChat(chat.id)}\n                      >\n                        <Avatar className=\"h-9 w-9\">\n                          <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                            {getInitials(chat.contact)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-1.5\">\n                              <span\n                                className={`text-sm font-medium truncate ${chat.unreadCount > 0 ? \"font-bold\" : \"\"}`}\n                              >\n                                {getContactName(chat.contact)}\n                              </span>\n                              {chat.unreadCount > 0 && (\n                                <span className=\"h-4 w-4 rounded-full bg-primary text-primary-foreground text-[9px] flex items-center justify-center font-medium\">\n                                  {chat.unreadCount}\n                                </span>\n                              )}\n                            </div>\n                            <span className=\"text-[11px] text-muted-foreground whitespace-nowrap\">\n                              {chat.lastInboundMessageTime\n                                ? formatTime(chat.lastInboundMessageTime)\n                                : \"\"}\n                            </span>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                            {chat.lastInboundMessage || \"No customer message\"}\n                          </p>\n                          <Badge\n                            variant=\"outline\"\n                            className=\"text-[10px] bg-green-50 text-green-700 border-green-200 mt-1 py-0\"\n                          >\n                            <Clock className=\"h-2.5 w-2.5 mr-0.5\" />\n                            {getTimeRemaining(chat.windowExpiresAt)}\n                          </Badge>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n\n          <div className={`flex-1 flex flex-col bg-[#efeae2] dark:bg-zinc-900 bg-opacity-50 min-h-0 h-full ${mobileView === \"list\" ? \"hidden md:flex\" : \"flex\"}`}>\n            {selectedChat ? (\n              <>\n                <div className=\"h-14 md:h-16 bg-background border-b border-border flex items-center justify-between px-2 md:px-6 flex-shrink-0\">\n                  <div className=\"flex items-center gap-2 md:gap-3\">\n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"flex md:hidden h-9 w-9 shrink-0\"\n                      onClick={handleBackToList}\n                    >\n                      <ArrowLeft className=\"h-5 w-5\" />\n                    </Button>\n                    <Avatar className=\"h-8 w-8 md:h-10 md:w-10\">\n                      <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                        {getInitials(selectedChat.contact)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"min-w-0\">\n                      <h3 className=\"font-medium text-sm md:text-base truncate\">\n                        {getContactName(selectedChat.contact)}\n                      </h3>\n                      <div className=\"flex items-center gap-1 md:gap-2 flex-wrap\">\n                        <span className=\"text-[10px] md:text-xs text-muted-foreground truncate\">\n                          {selectedChat.contact.phone}\n                        </span>\n                        <Badge\n                          variant=\"outline\"\n                          className=\"text-[9px] md:text-xs bg-green-50 text-green-700 border-green-200 py-0\"\n                        >\n                          <Clock className=\"h-2.5 w-2.5 md:h-3 md:w-3 mr-0.5 md:mr-1\" />\n                          {getTimeRemaining(selectedChat.windowExpiresAt)}\n                        </Badge>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-1 md:gap-2\">\n                    <Button variant=\"ghost\" size=\"icon\" className=\"hidden md:flex\">\n                      <Phone className=\"h-5 w-5 text-muted-foreground\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"hidden md:flex\">\n                      <Video className=\"h-5 w-5 text-muted-foreground\" />\n                    </Button>\n                    <DropdownMenu>\n                      <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\">\n                          <MoreVertical className=\"h-5 w-5 text-muted-foreground\" />\n                        </Button>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent align=\"end\">\n                        <DropdownMenuItem\n                          onClick={() =>\n                            markAsUnreadMutation.mutate(selectedChat.contactId)\n                          }\n                        >\n                          <MailOpen className=\"mr-2 h-4 w-4\" />\n                          Mark as Unread\n                        </DropdownMenuItem>\n                        <DropdownMenuItem\n                          className=\"text-destructive\"\n                          onClick={() => {\n                            setContactToBlock({\n                              phone: selectedChat.contact.phone,\n                              name: selectedChat.contact.name,\n                            });\n                            setBlockDialogOpen(true);\n                          }}\n                        >\n                          <Ban className=\"mr-2 h-4 w-4\" />\n                          Block Contact\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </div>\n                </div>\n\n                <div className=\"flex-1 min-h-0 overflow-y-auto p-3 md:p-6\">\n                  {messagesLoading ? (\n                    <div className=\"flex items-center justify-center h-full\">\n                      <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                    </div>\n                  ) : messages.length === 0 ? (\n                    <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\n                      No messages yet. Start the conversation!\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3 md:space-y-4\">\n                      {messages.map((msg) => (\n                        <div\n                          key={msg.id}\n                          className={`flex ${msg.direction === \"inbound\" ? \"justify-start\" : \"justify-end\"} group`}\n                        >\n                          <div\n                            className={`flex items-start gap-1 ${msg.direction === \"inbound\" ? \"flex-row\" : \"flex-row-reverse\"}`}\n                          >\n                            {msg.direction === \"inbound\" && (\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex\"\n                                onClick={() => setReplyingTo(msg)}\n                              >\n                                <Reply className=\"h-3 w-3\" />\n                              </Button>\n                            )}\n                            <div\n                              className={`\n                                max-w-[85%] md:max-w-[70%] rounded-lg px-3 md:px-4 py-2 shadow-sm relative break-words\n                                ${\n                                  msg.direction === \"inbound\"\n                                    ? \"bg-white dark:bg-card text-card-foreground rounded-tl-none\"\n                                    : \"bg-[#d9fdd3] dark:bg-primary/20 text-foreground rounded-tr-none\"\n                                }\n                              `}\n                            >\n                              {msg.replyToContent && (\n                                <div className=\"mb-2 p-2 bg-black/5 dark:bg-white/10 rounded border-l-2 border-primary/50 text-xs text-muted-foreground\">\n                                  <Reply className=\"h-3 w-3 inline mr-1\" />\n                                  {msg.replyToContent.substring(0, 60)}\n                                  {msg.replyToContent.length > 60 && \"...\"}\n                                </div>\n                              )}\n                              <div className=\"text-sm leading-relaxed\">\n                                {renderMessageContent(msg)}\n                              </div>\n                              <span className=\"text-[10px] text-muted-foreground/80 block text-right mt-1\">\n                                {formatTime(msg.timestamp)}\n                                {msg.direction === \"outbound\" && (\n                                  <span\n                                    className={`ml-1 ${msg.status === \"read\" ? \"text-blue-500\" : msg.status === \"failed\" ? \"text-red-500\" : \"\"}`}\n                                  >\n                                    {msg.status === \"read\"\n                                      ? \"\"\n                                      : msg.status === \"delivered\"\n                                        ? \"\"\n                                        : msg.status === \"failed\"\n                                          ? \"\"\n                                          : \"\"}\n                                  </span>\n                                )}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                      <div ref={messagesEndRef} />\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"p-2 md:p-4 bg-background border-t border-border flex-shrink-0\">\n                  {replyingTo && (\n                    <div className=\"mb-2 p-2 bg-muted rounded-lg flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2 text-xs md:text-sm min-w-0\">\n                        <Reply className=\"h-3 w-3 md:h-4 md:w-4 text-muted-foreground shrink-0\" />\n                        <span className=\"text-muted-foreground hidden md:inline\">\n                          Replying to:\n                        </span>\n                        <span className=\"truncate max-w-[150px] md:max-w-[300px]\">\n                          {replyingTo.content}\n                        </span>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-6 w-6 shrink-0\"\n                        onClick={() => setReplyingTo(null)}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-1 md:gap-2\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-muted-foreground hover:text-foreground hidden md:flex\"\n                    >\n                      <Smile className=\"h-6 w-6\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-muted-foreground hover:text-foreground h-8 w-8 md:h-10 md:w-10\"\n                    >\n                      <Paperclip className=\"h-5 w-5 md:h-6 md:w-6\" />\n                    </Button>\n                    <Input\n                      placeholder=\"Type a message...\"\n                      className=\"flex-1 bg-secondary/50 border-none focus-visible:ring-1 text-sm h-9 md:h-10\"\n                      value={messageInput}\n                      onChange={(e) => setMessageInput(e.target.value)}\n                      onKeyPress={handleKeyPress}\n                    />\n                    <Button\n                      size=\"icon\"\n                      className=\"rounded-full h-9 w-9 md:h-10 md:w-10 shrink-0\"\n                      onClick={handleSendMessage}\n                      disabled={\n                        !messageInput.trim() || sendMessageMutation.isPending\n                      }\n                    >\n                      {sendMessageMutation.isPending ? (\n                        <Loader2 className=\"h-4 w-4 md:h-5 md:w-5 animate-spin\" />\n                      ) : (\n                        <Send className=\"h-4 w-4 md:h-5 md:w-5\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <div className=\"flex-1 flex flex-col items-center justify-center text-muted-foreground p-4\">\n                <Clock className=\"h-12 w-12 md:h-16 md:w-16 mb-4 opacity-50\" />\n                <p className=\"text-base md:text-lg font-medium text-center\">Select a contact to chat</p>\n                <p className=\"text-xs md:text-sm text-center\">\n                  Send messages without templates within the 24-hour window\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <Dialog open={isBulkSendOpen} onOpenChange={setIsBulkSendOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Send className=\"h-5 w-5\" />\n              Send Message to {selectedContacts.length} Contacts\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"p-3 bg-green-50 dark:bg-green-950/30 rounded-lg text-sm text-green-700 dark:text-green-400\">\n              <Clock className=\"h-4 w-4 inline mr-2\" />\n              All selected contacts are within the 24-hour window. You can send\n              custom messages without templates.\n            </div>\n\n            <Tabs\n              value={messageType}\n              onValueChange={(v) => setMessageType(v as any)}\n            >\n              <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger\n                  value=\"template\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  Template\n                </TabsTrigger>\n                <TabsTrigger value=\"custom\" className=\"flex items-center gap-2\">\n                  <MessageSquare className=\"h-4 w-4\" />\n                  Custom\n                </TabsTrigger>\n                <TabsTrigger value=\"ai\" className=\"flex items-center gap-2\">\n                  <Bot className=\"h-4 w-4\" />\n                  AI Agent\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"template\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select Template</Label>\n                  <Select\n                    value={selectedTemplate}\n                    onValueChange={setSelectedTemplate}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose a template\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {approvedTemplates.map((template) => (\n                        <SelectItem key={template.id} value={template.id}>\n                          {template.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedTemplate && (\n                  <div className=\"p-3 bg-muted rounded-lg\">\n                    <p className=\"text-sm\">\n                      {\n                        templates.find((t) => t.id === selectedTemplate)\n                          ?.content\n                      }\n                    </p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"custom\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Custom Message</Label>\n                  <Textarea\n                    placeholder=\"Type your message here...\"\n                    value={customMessage}\n                    onChange={(e) => setCustomMessage(e.target.value)}\n                    rows={5}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Custom messages work only within the 24-hour window after\n                    customer contact.\n                  </p>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"ai\" className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select AI Agent</Label>\n                  <Select\n                    value={selectedAgent}\n                    onValueChange={setSelectedAgent}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose an AI Agent\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {agents\n                        .filter((a) => a.isActive)\n                        .map((agent) => (\n                          <SelectItem key={agent.id} value={agent.id}>\n                            {agent.name}\n                          </SelectItem>\n                        ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedAgent && (\n                  <div className=\"p-3 bg-muted rounded-lg\">\n                    <p className=\"text-sm\">\n                      {agents.find((a) => a.id === selectedAgent)\n                        ?.description ||\n                        \"AI Agent will generate personalized responses.\"}\n                    </p>\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsBulkSendOpen(false)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleBulkSend}\n              disabled={sendBulkMessageMutation.isPending}\n            >\n              {sendBulkMessageMutation.isPending && (\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              )}\n              Send to {selectedContacts.length} Contact\n              {selectedContacts.length > 1 ? \"s\" : \"\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Block Contact</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to block {contactToBlock?.name || contactToBlock?.phone}? \n              They will no longer be able to send you messages.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              onClick={() => contactToBlock && blockContactMutation.mutate(contactToBlock)}\n            >\n              Block\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":55936,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/pages/campaigns/Broadcast.tsx":{"content":"import { useState, useRef, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Upload,\n  Send,\n  Users,\n  Loader2,\n  Check,\n  Calendar,\n  FileSpreadsheet,\n  Bot,\n  MessageSquare,\n  Plus,\n  Search,\n  AlertCircle,\n} from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { toast } from \"sonner\";\nimport { useLocation } from \"wouter\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  tags: string[];\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\ninterface BroadcastList {\n  id: string;\n  name: string;\n  contacts: Array<{ name: string; phone: string; email?: string }>;\n  createdAt: string;\n}\n\ninterface ImportedContact {\n  name: string;\n  phone: string;\n  email?: string;\n}\n\ninterface SavedContact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n  source?: string;\n}\n\nexport default function Broadcast() {\n  const [, setLocation] = useLocation();\n  const [selectedContactIds, setSelectedContactIds] = useState<string[]>([]);\n  const [importedContacts, setImportedContacts] = useState<ImportedContact[]>([]);\n  const [message, setMessage] = useState(\"\");\n  const [campaignName, setCampaignName] = useState(\"\");\n  const [selectedTemplateId, setSelectedTemplateId] = useState(\"\");\n  const [selectedTemplateName, setSelectedTemplateName] = useState(\"\");\n  const [selectedAgentId, setSelectedAgentId] = useState(\"\");\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai_agent\">(\"template\");\n  const [scheduledTime, setScheduledTime] = useState(\"\");\n  const [isScheduled, setIsScheduled] = useState(false);\n  const [selectedListId, setSelectedListId] = useState(\"\");\n  const [newListName, setNewListName] = useState(\"\");\n  const [showCreateList, setShowCreateList] = useState(false);\n  const [isSending, setIsSending] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const queryClient = useQueryClient();\n\n  const { data: regularContacts = [] } = useQuery<Contact[]>({\n    queryKey: [\"/api/contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch contacts\");\n      return res.json();\n    },\n  });\n\n  const { data: savedImportedContacts = [] } = useQuery<SavedContact[]>({\n    queryKey: [\"/api/broadcast/imported-contacts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/imported-contact\");\n      if (!res.ok) throw new Error(\"Failed to fetch imported contacts\");\n      return res.json();\n    },\n  });\n\n  const contacts: Contact[] = useMemo(\n    () => [\n      ...regularContacts,\n      ...savedImportedContacts.map((c) => ({\n        id: c.id,\n        name: c.name,\n        phone: c.phone,\n        tags: c.tags || [],\n      })),\n    ],\n    [regularContacts, savedImportedContacts]\n  );\n\n  const filteredContacts = useMemo(() => {\n    if (!searchQuery.trim()) return contacts;\n    const q = searchQuery.toLowerCase();\n    return contacts.filter(\n      (contact) =>\n        contact.name.toLowerCase().includes(q) || contact.phone.includes(searchQuery)\n    );\n  }, [contacts, searchQuery]);\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/templates\");\n      if (!res.ok) throw new Error(\"Failed to fetch templates\");\n      return res.json();\n    },\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/agents\");\n      if (!res.ok) throw new Error(\"Failed to fetch agents\");\n      return res.json();\n    },\n  });\n\n  const { data: broadcastLists = [] } = useQuery<BroadcastList[]>({\n    queryKey: [\"/api/broadcast/lists\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/lists\");\n      if (!res.ok) throw new Error(\"Failed to fetch broadcast lists\");\n      return res.json();\n    },\n  });\n\n  const approvedTemplates = templates.filter((t) => t.status === \"approved\");\n  const activeAgents = agents.filter((a) => a.isActive);\n\n  const importExcelMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      const res = await fetch(\"/api/broadcast/import-excel\", {\n        method: \"POST\",\n        body: formData,\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || \"Failed to import file\");\n      }\n      return data;\n    },\n    onSuccess: (data) => {\n      setImportedContacts(data.contacts);\n      if (data.errors && data.errors.length > 0) {\n        toast.warning(\n          `Imported ${data.validContacts} of ${data.totalRows} rows. ${data.errors.length} rows had issues.`\n        );\n      } else {\n        toast.success(`Successfully imported ${data.validContacts} contacts from ${data.totalRows} rows`);\n      }\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"Failed to import file. Check that your file has 'Name' and 'Mobile' columns.\");\n    },\n  });\n\n  const createListMutation = useMutation({\n    mutationFn: async (data: { name: string; contacts: ImportedContact[] }) => {\n      const res = await fetch(\"/api/broadcast/lists\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create list\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/broadcast/lists\"] });\n      toast.success(\"Broadcast list created successfully\");\n      setShowCreateList(false);\n      setNewListName(\"\");\n    },\n    onError: () => {\n      toast.error(\"Failed to create broadcast list\");\n    },\n  });\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      importExcelMutation.mutate(file);\n    }\n  };\n\n  const handleTemplateSelect = (templateId: string) => {\n    setSelectedTemplateId(templateId);\n    if (templateId === \"hello_world\") {\n      setSelectedTemplateName(\"hello_world\");\n      setMessage(\n        \"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta.\"\n      );\n    } else {\n      const template = templates.find((t) => t.id === templateId);\n      if (template) {\n        setSelectedTemplateName(template.name);\n        setMessage(template.content);\n      }\n    }\n  };\n\n  const toggleContact = (contactId: string, checked: boolean | \"indeterminate\") => {\n    const isChecked = checked === true;\n    if (isChecked) {\n      setSelectedContactIds((prev) => [...prev, contactId]);\n    } else {\n      setSelectedContactIds((prev) => prev.filter((id) => id !== contactId));\n    }\n  };\n\n  const selectAllContacts = () => {\n    if (selectedContactIds.length === filteredContacts.length) {\n      setSelectedContactIds([]);\n    } else {\n      setSelectedContactIds(filteredContacts.map((c) => c.id));\n    }\n  };\n\n  const handleSendBroadcast = async () => {\n    // VALIDATION: Campaign name is now REQUIRED\n    if (!campaignName.trim()) {\n      toast.error(\"Campaign name is required! Please enter a campaign name.\");\n      return;\n    }\n\n    let targetContacts: Array<{ name: string; phone: string }> = [];\n\n    if (selectedListId) {\n      const list = broadcastLists.find((l) => l.id === selectedListId);\n      if (list) {\n        targetContacts = list.contacts;\n      }\n    } else if (importedContacts.length > 0) {\n      targetContacts = importedContacts;\n    } else if (selectedContactIds.length > 0) {\n      targetContacts = contacts\n        .filter((c) => selectedContactIds.includes(c.id))\n        .map((c) => ({ name: c.name, phone: c.phone }));\n    }\n\n    if (targetContacts.length === 0) {\n      toast.error(\"Please select contacts or import from Excel\");\n      return;\n    }\n\n    if (messageType === \"template\" && !selectedTemplateId) {\n      toast.error(\"Please select a template\");\n      return;\n    }\n\n    if (messageType === \"custom\" && !message.trim()) {\n      toast.error(\"Please enter a message\");\n      return;\n    }\n\n    if (messageType === \"ai_agent\" && !selectedAgentId) {\n      toast.error(\"Please select an AI agent\");\n      return;\n    }\n\n    // Handle scheduling validation\n    if (isScheduled) {\n      if (!scheduledTime) {\n        toast.error(\"Please select a schedule time\");\n        return;\n      }\n      const scheduledDate = new Date(scheduledTime);\n      const now = new Date();\n      if (scheduledDate <= now) {\n        toast.error(\"Scheduled time must be in the future\");\n        return;\n      }\n    }\n\n    setIsSending(true);\n\n    try {\n      const payload = {\n        contacts: targetContacts,\n        messageType,\n        templateName: messageType === \"template\" ? selectedTemplateName || \"hello_world\" : undefined,\n        customMessage: messageType === \"custom\" ? message : undefined,\n        agentId: messageType === \"ai_agent\" ? selectedAgentId : undefined,\n        campaignName: campaignName.trim(),\n        isScheduled,\n        scheduledTime: isScheduled ? new Date(scheduledTime).toISOString() : undefined,\n      };\n\n      console.log(\" Sending broadcast payload:\", payload);\n\n      const res = await fetch(\"/api/broadcast/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n      });\n\n      const result = await res.json();\n      console.log(\" Broadcast response:\", result);\n\n      if (!res.ok) {\n        toast.error(result.error || `Failed to send broadcast (${res.status})`);\n        setIsSending(false);\n        return;\n      }\n\n      if (isScheduled) {\n        toast.success(`Broadcast scheduled successfully for ${new Date(scheduledTime).toLocaleString()}`);\n      } else if (result.failed > 0) {\n        toast.warning(`Broadcast partially sent: ${result.successful} successful, ${result.failed} failed`);\n      } else {\n        toast.success(`Broadcast sent successfully to ${result.successful} contacts`);\n      }\n\n      // Reset form\n      setSelectedContactIds([]);\n      setImportedContacts([]);\n      setCampaignName(\"\");\n      setSelectedTemplateId(\"\");\n      setSelectedTemplateName(\"\");\n      setMessage(\"\");\n      setIsScheduled(false);\n      setScheduledTime(\"\");\n      setIsSending(false);\n    } catch (error: any) {\n      console.error(\" Broadcast error:\", error);\n      toast.error(error.message || \"Failed to send broadcast\");\n      setIsSending(false);\n    }\n  };\n\n  const handleCreateList = () => {\n    if (!newListName.trim()) {\n      toast.error(\"Please enter a list name\");\n      return;\n    }\n\n    let listContacts: ImportedContact[] = [];\n    if (importedContacts.length > 0) {\n      listContacts = importedContacts;\n    } else if (selectedContactIds.length > 0) {\n      listContacts = contacts\n        .filter((c) => selectedContactIds.includes(c.id))\n        .map((c) => ({ name: c.name, phone: c.phone }));\n    }\n\n    if (listContacts.length === 0) {\n      toast.error(\"No contacts to add to the list\");\n      return;\n    }\n\n    createListMutation.mutate({ name: newListName, contacts: listContacts });\n  };\n\n  const totalSelected = selectedListId\n    ? broadcastLists.find((l) => l.id === selectedListId)?.contacts.length || 0\n    : importedContacts.length > 0\n      ? importedContacts.length\n      : selectedContactIds.length;\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Send Broadcast</h2>\n          <p className=\"text-muted-foreground\">Send bulk messages to your contact lists.</p>\n        </div>\n\n        {/* CAMPAIGN NAME - NOW REQUIRED */}\n        <Alert>\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            <strong>Campaign name is required</strong> to track and analyze your broadcasts.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"space-y-2\">\n          <Label>\n            Campaign Name <span className=\"text-red-500\">*</span>\n          </Label>\n          <Input\n            placeholder=\"e.g., Black Friday Sale, Product Launch 2024\"\n            value={campaignName}\n            onChange={(e) => setCampaignName(e.target.value)}\n            className={!campaignName.trim() ? \"border-red-300 focus-visible:ring-red-500\" : \"\"}\n          />\n          {!campaignName.trim() && (\n            <p className=\"text-sm text-red-500\">Campaign name is required to send broadcasts</p>\n          )}\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                1. Select Audience\n              </CardTitle>\n              <CardDescription>\n                Choose who will receive this message. Selected: {totalSelected} contacts\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex gap-2 flex-wrap\">\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  onChange={handleFileUpload}\n                  accept=\".xlsx,.xls,.csv\"\n                  className=\"hidden\"\n                />\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={importExcelMutation.isPending}\n                >\n                  {importExcelMutation.isPending ? (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  ) : (\n                    <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Import Excel/CSV\n                </Button>\n                <Dialog open={showCreateList} onOpenChange={setShowCreateList}>\n                  <DialogTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" type=\"button\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Save as List\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Create Broadcast List</DialogTitle>\n                      <DialogDescription>Save selected contacts as a reusable list</DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                      <div className=\"space-y-2\">\n                        <Label>List Name</Label>\n                        <Input\n                          placeholder=\"e.g., VIP Customers\"\n                          value={newListName}\n                          onChange={(e) => setNewListName(e.target.value)}\n                        />\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        This will save{\" \"}\n                        {importedContacts.length > 0 ? importedContacts.length : selectedContactIds.length}{\" \"}\n                        contacts to the list.\n                      </p>\n                    </div>\n                    <DialogFooter>\n                      <Button type=\"button\" onClick={handleCreateList} disabled={createListMutation.isPending}>\n                        {createListMutation.isPending && (\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        )}\n                        Create List\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n              </div>\n\n              {broadcastLists.length > 0 && (\n                <div className=\"space-y-2\">\n                  <Label>Or Select Existing List</Label>\n                  <Select\n                    value={selectedListId}\n                    onValueChange={(value) => {\n                      setSelectedListId(value);\n                      if (value) {\n                        setSelectedContactIds([]);\n                        setImportedContacts([]);\n                      }\n                    }}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose a broadcast list...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"\">None (Select manually)</SelectItem>\n                      {broadcastLists.map((list) => (\n                        <SelectItem key={list.id} value={list.id}>\n                          {list.name} ({list.contacts.length} contacts)\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              )}\n\n              {importedContacts.length > 0 && (\n                <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                  <p className=\"text-sm font-medium text-green-800 dark:text-green-200\">\n                    {importedContacts.length} contacts imported from Excel\n                  </p>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    type=\"button\"\n                    className=\"mt-2 text-xs\"\n                    onClick={() => setImportedContacts([])}\n                  >\n                    Clear imported\n                  </Button>\n                </div>\n              )}\n\n              {!selectedListId && importedContacts.length === 0 && (\n                <>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search contacts by name or phone...\"\n                      className=\"pl-10\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <Button variant=\"outline\" size=\"sm\" type=\"button\" onClick={selectAllContacts}>\n                      {selectedContactIds.length === filteredContacts.length\n                        ? \"Deselect All\"\n                        : \"Select All\"}\n                    </Button>\n                    <span className=\"text-sm text-muted-foreground\">\n                      {filteredContacts.length} contacts found\n                    </span>\n                  </div>\n\n                  <div className=\"border rounded-lg max-h-[300px] overflow-y-auto\">\n                    {filteredContacts.length > 0 ? (\n                      filteredContacts.map((contact) => (\n                        <div\n                          key={contact.id}\n                          className=\"flex items-center gap-3 p-3 border-b last:border-b-0 hover:bg-muted/50 cursor-pointer\"\n                          onClick={() =>\n                            toggleContact(contact.id, !selectedContactIds.includes(contact.id))\n                          }\n                        >\n                          <Checkbox\n                            checked={selectedContactIds.includes(contact.id)}\n                            onCheckedChange={(checked) =>\n                              toggleContact(contact.id, checked === true)\n                            }\n                          />\n                          <div className=\"flex-1\">\n                            <div className=\"font-medium\">{contact.name}</div>\n                            <div className=\"text-sm text-muted-foreground\">{contact.phone}</div>\n                          </div>\n                          {selectedContactIds.includes(contact.id) && (\n                            <Check className=\"h-4 w-4 text-primary\" />\n                          )}\n                        </div>\n                      ))\n                    ) : (\n                      <p className=\"p-4 text-center text-sm text-muted-foreground\">\n                        No contacts match your search.\n                      </p>\n                    )}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-5 w-5\" />\n                2. Compose Message\n              </CardTitle>\n              <CardDescription>\n                Select a template, write custom message, or use AI Agent.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Tabs value={messageType} onValueChange={(v) => setMessageType(v as any)}>\n                <TabsList className=\"w-full\">\n                  <TabsTrigger value=\"template\" className=\"flex-1\">\n                    Template\n                  </TabsTrigger>\n                  <TabsTrigger value=\"custom\" className=\"flex-1\">\n                    Custom\n                  </TabsTrigger>\n                  <TabsTrigger value=\"ai_agent\" className=\"flex-1\">\n                    <Bot className=\"mr-1 h-4 w-4\" />\n                    AI Agent\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"template\" className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Select Template</Label>\n                    <Select value={selectedTemplateId} onValueChange={handleTemplateSelect}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select a template...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"hello_world\">hello_world (Default)</SelectItem>\n                        {approvedTemplates.map((template) => (\n                          <SelectItem key={template.id} value={template.id}>\n                            {template.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  {selectedTemplateId && (\n                    <div className=\"p-3 bg-muted rounded-lg\">\n                      <p className=\"text-sm font-medium mb-1\">Template: {selectedTemplateName}</p>\n                      <p className=\"text-sm text-muted-foreground\">{message}</p>\n                    </div>\n                  )}\n                </TabsContent>\n\n                <TabsContent value=\"custom\" className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Message Text</Label>\n                    <Textarea\n                      placeholder=\"Type your message here... Use {{name}} for personalization\"\n                      className=\"min-h-[150px]\"\n                      value={message}\n                      onChange={(e) => setMessage(e.target.value)}\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Note: Custom messages require the recipient to have messaged you first (24-hour window rule).\n                    </p>\n                  </div>\n                </TabsContent>\n\n                <TabsContent value=\"ai_agent\" className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Select AI Agent</Label>\n                    <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select an AI agent...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {activeAgents.length === 0 ? (\n                          <SelectItem value=\"none\" disabled>\n                            No active agents. Create one first.\n                          </SelectItem>\n                        ) : (\n                          activeAgents.map((agent) => (\n                            <SelectItem key={agent.id} value={agent.id}>\n                              {agent.name}\n                            </SelectItem>\n                          ))\n                        )}\n                      </SelectContent>\n                    </Select>\n                    {selectedAgentId && (\n                      <p className=\"text-sm text-muted-foreground\">\n                        The AI agent will generate personalized messages for each recipient using the hello_world\n                        template.\n                      </p>\n                    )}\n                  </div>\n                </TabsContent>\n              </Tabs>\n\n              <div className=\"flex items-center gap-2 pt-4 border-t\">\n                <Checkbox\n                  id=\"schedule\"\n                  checked={isScheduled}\n                  onCheckedChange={(checked) => setIsScheduled(checked === true)}\n                />\n                <Label htmlFor=\"schedule\" className=\"cursor-pointer\">\n                  Schedule for later\n                </Label>\n              </div>\n\n              {isScheduled && (\n                <div className=\"space-y-2\">\n                  <Label>Schedule Time</Label>\n                  <Input\n                    type=\"datetime-local\"\n                    value={scheduledTime}\n                    onChange={(e) => setScheduledTime(e.target.value)}\n                    min={new Date().toISOString().slice(0, 16)}\n                  />\n                  {scheduledTime && new Date(scheduledTime) <= new Date() && (\n                    <p className=\"text-xs text-red-500\">Time must be in the future</p>\n                  )}\n                </div>\n              )}\n\n              <Button \n                className=\"w-full\" \n                type=\"button\" \n                onClick={handleSendBroadcast} \n                disabled={isSending || !campaignName.trim()}\n              >\n                {isSending ? (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                ) : isScheduled ? (\n                  <Calendar className=\"mr-2 h-4 w-4\" />\n                ) : (\n                  <Send className=\"mr-2 h-4 w-4\" />\n                )}\n                {isSending\n                  ? \"Processing...\"\n                  : isScheduled\n                    ? \"Schedule Broadcast\"\n                    : `Send to ${totalSelected} Contacts`}\n              </Button>\n              {!campaignName.trim() && (\n                <p className=\"text-xs text-red-500 text-center\">\n                  Please enter a campaign name to send\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":28050,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/layout/DashboardLayout.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { \n  LayoutDashboard, \n  MessageSquare, \n  Megaphone, \n  GitBranch, \n  Users, \n  Settings, \n  LogOut,\n  Menu,\n  Bell,\n  Search,\n  FileText,\n  LayoutGrid,\n  Bot,\n  BarChart3,\n  ChevronDown,\n  ChevronRight,\n  Facebook,\n  Clock,\n  UserPlus,\n  UserCog\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  DropdownMenu, \n  DropdownMenuContent, \n  DropdownMenuItem, \n  DropdownMenuLabel, \n  DropdownMenuSeparator, \n  DropdownMenuTrigger \n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\n\ninterface Chat {\n  id: string;\n  lastInboundMessageTime?: string;\n  unreadCount: number;\n}\n\nexport default function DashboardLayout({ children }: { children: React.ReactNode }) {\n  const [location, setLocation] = useLocation();\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const { user, logout } = useAuth();\n\n  const handleLogout = () => {\n    logout();\n    setLocation(\"/login\");\n  };\n\n  const { data: windowUnreadCount = 0 } = useQuery<number>({\n    queryKey: [\"/api/chats\", \"window-unread-count\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/chats\");\n      if (!res.ok) return 0;\n      const allChats: Chat[] = await res.json();\n      const now = new Date();\n      let totalUnread = 0;\n      for (const chat of allChats) {\n        if (chat.unreadCount <= 0) continue;\n        if (chat.lastInboundMessageTime) {\n          const lastInbound = new Date(chat.lastInboundMessageTime);\n          const hoursDiff = (now.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n          if (hoursDiff <= 24) {\n            totalUnread += chat.unreadCount;\n          }\n        }\n      }\n      return totalUnread;\n    },\n    refetchInterval: 10000,\n  });\n\n  const navStructure = [\n    {\n      icon: LayoutDashboard,\n      label: \"Dashboard\",\n      href: \"/\",\n      pageId: \"dashboard\",\n    },\n    {\n      icon: Clock,\n      label: \"24-Hour Window\",\n      href: \"/inbox/window\",\n      pageId: \"window-inbox\",\n      badge: windowUnreadCount > 0 ? windowUnreadCount : undefined,\n    },\n\n    {\n      icon: MessageSquare,\n      label: \"Inbox\",\n      href: \"/inbox\",\n      pageId: \"inbox\",\n    },\n    {\n      icon: Megaphone,\n      label: \"Campaigns\",\n      href: \"/campaigns\",\n      pageId: \"broadcast\",\n      subItems: [\n        { label: \"Broadcasts\", href: \"/campaigns/broadcast\" },\n        { label: \"Selected Contacts\", href: \"/campaigns/selected-contacts\" },\n        { label: \"Schedule Messages\", href: \"/campaigns/schedule\" },\n        { label: \"Single Message\", href: \"/campaigns/single\" },\n        { label: \"Reports\", href: \"/campaigns/report\" },\n      ]\n    },\n    {\n      icon: GitBranch,\n      label: \"Automation\",\n      href: \"/automation\",\n      pageId: \"auto-reply\",\n      subItems: [\n        { label: \"Builder\", href: \"/automation\" },\n        { label: \"Auto Leads\", href: \"/automation/leads\" },\n        // { label: \"Keyword Reply\", href: \"/automation/keywords\" },\n        { label: \"Follow-up\", href: \"/automation/follow-up\" },\n        { label: \"Drip Campaign\", href: \"/automation/drip\" },\n        { label: \"New Lead Alert\", href: \"/automation/new-leads\" },\n      ]\n    },\n    {\n      icon: LayoutGrid,\n      label: \"Connect Apps\",\n      href: \"/apps/connect\",\n      pageId: \"flow-builder\",\n    },\n    {\n      icon: FileText,\n      label: \"Templates\",\n      href: \"/templates\",\n      pageId: \"templates\",\n      subItems: [\n        { label: \"Add Template\", href: \"/templates/add\" },\n        { label: \"Template Status\", href: \"/templates/status\" },\n        { label: \"Manage Templates\", href: \"/templates/manage\" },\n      ]\n    },\n    {\n      icon: Bot,\n      label: \"AI Agent\",\n      href: \"/ai\",\n      pageId: \"ai-agents\",\n      subItems: [\n        { label: \"All Agents\", href: \"/ai/agents\" },\n        { label: \"New Agent\", href: \"/ai/new\" },\n        // { label: \"Agent Mapping\", href: \"/ai/map\" },\n        { label: \"Pre-filled Text\", href: \"/ai/prefilled\" },\n        { label: \"AI Reports\", href: \"/ai/reports\" },\n      ]\n    },\n    {\n      icon: Facebook,\n      label: \"Facebook\",\n      href: \"/facebook\",\n      pageId: \"facebook-leads\",\n      subItems: [\n        { label: \"Lead Forms\", href: \"/facebook/forms\" },\n        { label: \"Leads\", href: \"/facebook/leads\" },\n      ]\n    },\n    {\n      icon: BarChart3,\n      label: \"Reports\",\n      href: \"/reports\",\n      pageId: \"reports-campaign\",\n      subItems: [\n        { label: \"Delivery Report\", href: \"/reports/delivery\" },\n        { label: \"Broadcast Report\", href: \"/reports/broadcast\" },\n        { label: \"Campaign Perf.\", href: \"/reports/campaigns\" },\n        { label: \"Replies\", href: \"/reports/replies\" },\n        { label: \"Agent Perf.\", href: \"/reports/agents\" },\n        { label: \"Contact Analytics\", href: \"/reports/contacts\" },\n        { label: \"Lead Assignments\", href: \"/reports/lead-assignments\" },\n        { label: \"User Activity\", href: \"/reports/user-activity\" },\n        { label: \"Blocked Contacts\", href: \"/reports/blocked\" },\n        { label: \"Spending\", href: \"/reports/spending\" },\n        { label: \"User Engagement\", href: \"/reports/user-engagement\" },\n        { label: \"Credits\", href: \"/reports/credits\" },\n      ]\n    },\n    {\n      icon: Users,\n      label: \"Contacts\",\n      href: \"/contacts\",\n      pageId: \"contacts\",\n    },\n    {\n      icon: Settings,\n      label: \"Settings\",\n      href: \"/settings\",\n      pageId: \"settings\",\n      subItems: [\n        { label: \"Team Members\", href: \"/settings/team\" },\n        { label: \"Permissions\", href: \"/settings/permissions\" },\n        { label: \"WhatsApp Number\", href: \"/settings/whatsapp\" },\n        { label: \"Profile Details\", href: \"/settings/profile\" },\n        { label: \"Webhook & API\", href: \"/settings/api\" },\n        { label: \"Billing & Credits\", href: \"/settings/billing\" },\n      ]\n    },\n    {\n      icon: UserCog,\n      label: \"User Management\",\n      href: \"/user-management\",\n      pageId: \"user-management\",\n      adminOnly: true,\n    },\n  ];\n\n  const isSystemUser = user?.pageAccess && user.pageAccess.length > 0;\n  const isAdmin = user?.role === 'super_admin' || user?.role === 'sub_admin';\n  \n  const filteredNavStructure = navStructure.filter(item => {\n    if (!isSystemUser) {\n      return true;\n    }\n    if (item.adminOnly && !isAdmin) {\n      return false;\n    }\n    if (!item.pageId) {\n      return true;\n    }\n    return user?.pageAccess?.includes(item.pageId) ?? false;\n  });\n\n  const NavItem = ({ item }: { item: any }) => {\n    const isActive = location === item.href || (item.subItems && item.subItems.some((sub: any) => location === sub.href));\n    const [isOpen, setIsOpen] = useState(isActive);\n\n    if (item.subItems) {\n      return (\n        <Collapsible open={isOpen} onOpenChange={setIsOpen} className=\"space-y-1\">\n          <CollapsibleTrigger asChild>\n            <div \n              className={`\n                flex items-center justify-between px-3 py-2.5 rounded-md text-sm font-medium transition-colors cursor-pointer select-none\n                ${isActive \n                  ? \"bg-sidebar-accent/50 text-sidebar-accent-foreground\" \n                  : \"text-sidebar-foreground/70 hover:bg-sidebar-accent/30 hover:text-sidebar-foreground\"\n                }\n              `}\n            >\n              <div className=\"flex items-center gap-3\">\n                <item.icon className=\"h-4 w-4\" />\n                {item.label}\n              </div>\n              {isOpen ? <ChevronDown className=\"h-3 w-3 opacity-50\" /> : <ChevronRight className=\"h-3 w-3 opacity-50\" />}\n            </div>\n          </CollapsibleTrigger>\n          <CollapsibleContent className=\"pl-9 space-y-1 animate-in slide-in-from-top-2 duration-200\">\n            {item.subItems.map((sub: any) => (\n              <Link key={sub.href} href={sub.href}>\n                <div \n                  className={`\n                    block px-3 py-2 rounded-md text-xs font-medium transition-colors cursor-pointer\n                    ${location === sub.href \n                      ? \"bg-sidebar-accent text-sidebar-accent-foreground\" \n                      : \"text-sidebar-foreground/60 hover:bg-sidebar-accent/30 hover:text-sidebar-foreground\"\n                    }\n                  `}\n                >\n                  {sub.label}\n                </div>\n              </Link>\n            ))}\n          </CollapsibleContent>\n        </Collapsible>\n      );\n    }\n\n    return (\n      <Link href={item.href}>\n        <div \n          className={`\n            flex items-center justify-between px-3 py-2.5 rounded-md text-sm font-medium transition-colors cursor-pointer\n            ${isActive \n              ? \"bg-sidebar-accent text-sidebar-accent-foreground\" \n              : \"text-sidebar-foreground/70 hover:bg-sidebar-accent/50 hover:text-sidebar-foreground\"\n            }\n          `}\n        >\n          <div className=\"flex items-center gap-3\">\n            <item.icon className=\"h-4 w-4\" />\n            {item.label}\n          </div>\n          {item.badge && (\n            <Badge className=\"bg-red-500 hover:bg-red-600 text-white text-xs px-1.5 py-0.5 min-w-[20px] text-center\">\n              {item.badge > 99 ? \"99+\" : item.badge}\n            </Badge>\n          )}\n        </div>\n      </Link>\n    );\n  };\n\n  const NavContent = () => (\n    <div className=\"flex flex-col h-screen\">\n      <div className=\"p-6 flex items-center gap-3\">\n        <div className=\"h-10 w-10 rounded-lg bg-primary flex items-center justify-center\">\n          <MessageSquare className=\"h-6 w-6 text-primary-foreground\" />\n        </div>\n        <div>\n          <h1 className=\"font-heading font-bold text-lg leading-none tracking-tight\">WhatsApp</h1>\n          <span className=\"text-xs text-sidebar-foreground/60\">Business API</span>\n        </div>\n      </div>\n\n      <div className=\"flex-1 px-3 py-4 space-y-1 overflow-y-auto\">\n        {filteredNavStructure.map((item, idx) => (\n          <NavItem key={idx} item={item} />\n        ))}\n      </div>\n\n      <div className=\"p-4 border-t border-sidebar-border shrink-0\">\n        <div className=\"p-4 rounded-lg bg-sidebar-accent/50\">\n          <h4 className=\"text-sm font-medium text-sidebar-foreground mb-1\">Need Help?</h4>\n          <p className=\"text-xs text-sidebar-foreground/60 mb-3\">Check our documentation for guides.</p>\n          <Button size=\"sm\" variant=\"secondary\" className=\"w-full text-xs\">Documentation</Button>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gray-50/50 flex\">\n      {/* Desktop Sidebar */}\n      <div className=\"hidden md:block w-64 bg-sidebar border-r border-sidebar-border text-sidebar-foreground shrink-0\">\n        <NavContent />\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col min-w-0 h-screen overflow-hidden\">\n        {/* Header */}\n        <header className=\"h-16 border-b border-border bg-background px-6 flex items-center justify-between shrink-0 sticky top-0 z-10\">\n          <div className=\"flex items-center gap-4\">\n            <Sheet open={isSidebarOpen} onOpenChange={setIsSidebarOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"md:hidden\">\n                  <Menu className=\"h-5 w-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"p-0 w-64 bg-sidebar border-r border-sidebar-border text-sidebar-foreground\">\n                <NavContent />\n              </SheetContent>\n            </Sheet>\n            \n            <div className=\"relative hidden sm:block w-96\">\n              <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n              <Input \n                placeholder=\"Search messages, contacts, campaigns...\" \n                className=\"pl-9 bg-secondary/50 border-none focus-visible:ring-1\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" className=\"relative\">\n              <Bell className=\"h-5 w-5 text-muted-foreground\" />\n              <span className=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-destructive border-2 border-background\"></span>\n            </Button>\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" className=\"relative h-9 w-9 rounded-full\">\n                  <Avatar className=\"h-9 w-9 border border-border\">\n                    <AvatarImage src=\"https://github.com/shadcn.png\" alt=\"@user\" />\n                    <AvatarFallback>CN</AvatarFallback>\n                  </Avatar>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent className=\"w-56 bg-white\" align=\"end\" forceMount>\n                <DropdownMenuLabel className=\"font-normal bg-white\">\n                  <div className=\"flex flex-col space-y-1\">\n                    <p className=\"text-sm font-medium leading-none\">WhatsApp Admin</p>\n                    <p className=\"text-xs leading-none text-muted-foreground\">\n                      {user?.email || \"admin@whatsapp.com\"}\n                    </p>\n                  </div>\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>\n                  <Users className=\"mr-2 h-4 w-4\" />\n                  <span>Team Members</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem>\n                  <Settings className=\"mr-2 h-4 w-4\" />\n                  <span>Settings</span>\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem onClick={handleLogout} className=\"text-destructive focus:text-destructive cursor-pointer\">\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  <span>Log out</span>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <main className=\"flex-1 overflow-auto p-6\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14598,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/pages/templates/AddTemplate.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Loader2, Info, CheckCircle2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\nexport default function AddTemplate() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  \n  const [name, setName] = useState(\"\");\n  const [category, setCategory] = useState(\"\");\n  const [language, setLanguage] = useState(\"en_US\");\n  const [headerType, setHeaderType] = useState(\"none\");\n  const [headerText, setHeaderText] = useState(\"\");\n  const [body, setBody] = useState(\"\");\n  const [footer, setFooter] = useState(\"\");\n\n  const createTemplateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/templates\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to create template\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/templates\"] });\n      toast.success(\"Template created successfully!\");\n      setLocation(\"/templates/manage\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message);\n    },\n  });\n\n  const handleSubmit = () => {\n    if (!name.trim()) {\n      toast.error(\"Please enter a template name\");\n      return;\n    }\n    if (!category) {\n      toast.error(\"Please select a category\");\n      return;\n    }\n    if (!body.trim()) {\n      toast.error(\"Please enter body text\");\n      return;\n    }\n\n    const templateName = name.toLowerCase().replace(/[^a-z0-9_]/g, \"_\");\n    \n    createTemplateMutation.mutate({\n      name: templateName,\n      category,\n      language,\n      headerType: headerType === \"none\" ? null : headerType,\n      headerText: headerType === \"text\" ? headerText : null,\n      content: body,\n      footer: footer || null,\n      status: \"pending\",\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Add New Template</h2>\n          <p className=\"text-muted-foreground\">Create a WhatsApp message template for approval</p>\n        </div>\n\n        <div className=\"grid gap-6 lg:grid-cols-3\">\n          <div className=\"lg:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Template Details</CardTitle>\n                <CardDescription>Fill in the details for your new template</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"name\">Template Name *</Label>\n                  <Input \n                    id=\"name\"\n                    placeholder=\"e.g., welcome_message_v2\" \n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Use lowercase letters, numbers, and underscores only\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>Category *</Label>\n                    <Select value={category} onValueChange={setCategory}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"marketing\">Marketing</SelectItem>\n                        <SelectItem value=\"utility\">Utility</SelectItem>\n                        <SelectItem value=\"authentication\">Authentication</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>Language</Label>\n                    <Select value={language} onValueChange={setLanguage}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select language\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"en_US\">English (US)</SelectItem>\n                        <SelectItem value=\"en_GB\">English (UK)</SelectItem>\n                        <SelectItem value=\"es_ES\">Spanish</SelectItem>\n                        <SelectItem value=\"hi\">Hindi</SelectItem>\n                        <SelectItem value=\"pt_BR\">Portuguese (Brazil)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"grid gap-2\">\n                  <Label>Header (Optional)</Label>\n                  <Select value={headerType} onValueChange={setHeaderType}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"None\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"none\">None</SelectItem>\n                      <SelectItem value=\"text\">Text</SelectItem>\n                      <SelectItem value=\"image\">Image</SelectItem>\n                      <SelectItem value=\"video\">Video</SelectItem>\n                      <SelectItem value=\"document\">Document</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {headerType === \"text\" && (\n                  <div className=\"grid gap-2\">\n                    <Label>Header Text</Label>\n                    <Input \n                      placeholder=\"Enter header text\"\n                      value={headerText}\n                      onChange={(e) => setHeaderText(e.target.value)}\n                    />\n                  </div>\n                )}\n\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"body\">Body Text *</Label>\n                  <Textarea \n                    id=\"body\"\n                    placeholder=\"Enter your message here. Use {{1}}, {{2}} for variables.\" \n                    className=\"min-h-[120px]\"\n                    value={body}\n                    onChange={(e) => setBody(e.target.value)}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Use {\"{{1}}\"}, {\"{{2}}\"} etc. for dynamic variables\n                  </p>\n                </div>\n\n                <div className=\"grid gap-2\">\n                  <Label>Footer (Optional)</Label>\n                  <Input \n                    placeholder=\"e.g., Reply STOP to unsubscribe\"\n                    value={footer}\n                    onChange={(e) => setFooter(e.target.value)}\n                  />\n                </div>\n\n                <Button \n                  className=\"w-full\" \n                  onClick={handleSubmit}\n                  disabled={createTemplateMutation.isPending}\n                >\n                  {createTemplateMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Creating Template...\n                    </>\n                  ) : (\n                    \"Create Template\"\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <Info className=\"h-4 w-4\" />\n                  Template Guidelines\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-sm space-y-3 text-muted-foreground\">\n                <div className=\"flex items-start gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 mt-0.5 text-green-500 shrink-0\" />\n                  <span>Template names must be lowercase with underscores</span>\n                </div>\n                <div className=\"flex items-start gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 mt-0.5 text-green-500 shrink-0\" />\n                  <span>Marketing templates need clear opt-out option</span>\n                </div>\n                <div className=\"flex items-start gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 mt-0.5 text-green-500 shrink-0\" />\n                  <span>Avoid promotional language in Utility templates</span>\n                </div>\n                <div className=\"flex items-start gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 mt-0.5 text-green-500 shrink-0\" />\n                  <span>Use variables for personalization</span>\n                </div>\n              </CardContent>\n            </Card>\n\n            {body && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Preview</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"bg-green-50 rounded-lg p-3 text-sm border border-green-200\">\n                    {headerType === \"text\" && headerText && (\n                      <p className=\"font-semibold mb-2\">{headerText}</p>\n                    )}\n                    <p className=\"whitespace-pre-wrap\">{body}</p>\n                    {footer && (\n                      <p className=\"text-xs text-muted-foreground mt-2 pt-2 border-t\">{footer}</p>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":10341,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"server/modules/aiAgents/agent.service.ts":{"content":"import { readCollection, addItem, updateItem, deleteItem, findById, updateManyItems } from '../storage';\n\nexport interface Agent {\n  id: string;\n  name: string;\n  description: string;\n  systemPrompt: string;\n  instructions?: string;\n  model: string;\n  temperature: number;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst COLLECTION = 'agents';\n\nfunction generateId(): string {\n  return `agent-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport async function getAllAgents(): Promise<Agent[]> {\n  return readCollection<Agent>(COLLECTION);\n}\n\nexport async function getAgentById(id: string): Promise<Agent | null> {\n  return findById<Agent>(COLLECTION, id);\n}\n\nexport async function createAgent(data: Omit<Agent, 'id' | 'createdAt' | 'updatedAt'>): Promise<Agent> {\n  const now = new Date().toISOString();\n  const agent: Agent = {\n    id: generateId(),\n    ...data,\n    createdAt: now,\n    updatedAt: now,\n  };\n  return addItem<Agent>(COLLECTION, agent);\n}\n\nexport async function updateAgent(id: string, data: Partial<Omit<Agent, 'id' | 'createdAt'>>): Promise<Agent | null> {\n  return updateItem<Agent>(COLLECTION, id, {\n    ...data,\n    updatedAt: new Date().toISOString(),\n  });\n}\n\nexport async function deleteAgent(id: string): Promise<boolean> {\n  return deleteItem<Agent>(COLLECTION, id);\n}\n\nexport async function updateAllAgentsToGemini(): Promise<{ updated: number; agents: Agent[] }> {\n  const updated = await updateManyItems(COLLECTION, {}, { \n    model: 'gemini-2.0-flash',\n    updatedAt: new Date().toISOString()\n  });\n  const agents = await getAllAgents();\n  console.log(`[Agent Service] Updated ${updated} agents to use gemini-2.0-flash`);\n  return { updated, agents };\n}\n","path":null,"size_bytes":1725,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --font-sans: \"Inter\", sans-serif;\n  --font-heading: \"Plus Jakarta Sans\", sans-serif;\n\n  --color-background: hsl(0 0% 100%);\n  --color-foreground: hsl(222 47% 11%);\n\n  --color-primary: hsl(142 76% 36%); /* WhatsApp Green-ish but professional */\n  --color-primary-foreground: hsl(0 0% 100%);\n\n  --color-secondary: hsl(210 40% 96%);\n  --color-secondary-foreground: hsl(222 47% 11%);\n\n  --color-muted: hsl(210 40% 96%);\n  --color-muted-foreground: hsl(215 16% 47%);\n\n  --color-accent: hsl(210 40% 96%);\n  --color-accent-foreground: hsl(222 47% 11%);\n\n  --color-destructive: hsl(0 84% 60%);\n  --color-destructive-foreground: hsl(0 0% 98%);\n\n  --color-border: hsl(214 32% 91%);\n  --color-input: hsl(214 32% 91%);\n  --color-ring: hsl(142 76% 36%);\n\n  --color-card: hsl(0 0% 100%);\n  --color-card-foreground: hsl(222 47% 11%);\n\n  --color-sidebar: hsl(222 47% 11%);\n  --color-sidebar-foreground: hsl(210 40% 98%);\n  --color-sidebar-primary: hsl(142 76% 36%);\n  --color-sidebar-primary-foreground: hsl(0 0% 100%);\n  --color-sidebar-accent: hsl(217 33% 17%);\n  --color-sidebar-accent-foreground: hsl(210 40% 98%);\n  --color-sidebar-border: hsl(217 33% 17%);\n  --color-sidebar-ring: hsl(142 76% 36%);\n\n  --radius-sm: 0.375rem;\n  --radius-md: 0.5rem;\n  --radius-lg: 0.75rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-gray-50 text-foreground;\n  }\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-heading font-semibold;\n  }\n}\n\n/* Hide scrollbar for WebKit browsers (Chrome, Safari, Edge) */\n.hide-scrollbar::-webkit-scrollbar {\n  display: none;\n}\n\n/* Hide scrollbar for Firefox */\n.hide-scrollbar {\n  scrollbar-width: none;\n}\n\n.hide-scrollbar {\n  scrollbar-width: none; /* Firefox */\n  -ms-overflow-style: none; /* IE and Edge */\n}\n\n.hide-scrollbar::-webkit-scrollbar {\n  display: none; /* Chrome, Safari, Opera */\n}\n\n/* Add this at the end of your index.css */\n* {\n  scrollbar-width: none;\n  -ms-overflow-style: none;\n}\n\n*::-webkit-scrollbar {\n  display: none;\n}\n\n/* If you want to target only the sidebar specifically */\n[data-sidebar] {\n  scrollbar-width: none !important;\n  -ms-overflow-style: none !important;\n}\n\n[data-sidebar]::-webkit-scrollbar {\n  display: none !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n/* Target the sidebar content specifically */\n[data-sidebar=\"content\"] {\n  overflow-y: auto !important;\n  scrollbar-width: none !important;\n  -ms-overflow-style: none !important;\n}\n\n[data-sidebar=\"content\"]::-webkit-scrollbar {\n  display: none !important;\n  width: 0 !important;\n}","path":null,"size_bytes":2654,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/automation/Drip.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Calendar, ArrowRight, MessageSquare } from \"lucide-react\";\n\nexport default function Drip() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n             <h2 className=\"text-3xl font-bold tracking-tight\">Drip Campaigns</h2>\n             <p className=\"text-muted-foreground\">Create multi-day sequences for onboarding or nurturing.</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Campaign\n          </Button>\n        </div>\n\n        <Card className=\"bg-muted/20 border-dashed border-2\">\n           <CardContent className=\"p-10 flex flex-col items-center justify-center text-center space-y-4\">\n              <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                <Calendar className=\"h-6 w-6\" />\n              </div>\n              <h3 className=\"text-xl font-semibold\">New Customer Onboarding Sequence</h3>\n              <p className=\"text-muted-foreground max-w-md\">\n                This sequence triggers when a new tag \"Customer\" is added to a contact.\n              </p>\n              \n              <div className=\"w-full max-w-3xl mt-8 relative\">\n                 {/* Timeline Line */}\n                 <div className=\"absolute left-[20px] top-8 bottom-8 w-0.5 bg-border\"></div>\n\n                 {/* Day 1 */}\n                 <div className=\"relative flex gap-6 mb-8 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      1\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 1: Welcome Message</span>\n                             <Badge>Active</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"Welcome to the family! Here is your getting started guide...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n\n                 {/* Day 3 */}\n                 <div className=\"relative flex gap-6 mb-8 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      3\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 3: Product Tips</span>\n                             <Badge>Active</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"Did you know you can do X with our product? Check this out...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n                 \n                 {/* Day 7 */}\n                 <div className=\"relative flex gap-6 text-left\">\n                    <div className=\"h-10 w-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold z-10 shrink-0\">\n                      7\n                    </div>\n                    <Card className=\"flex-1\">\n                       <CardHeader className=\"py-3\">\n                          <CardTitle className=\"text-base flex items-center justify-between\">\n                             <span>Day 7: Review Request</span>\n                             <Badge variant=\"secondary\">Draft</Badge>\n                          </CardTitle>\n                       </CardHeader>\n                       <CardContent className=\"py-3 text-sm text-muted-foreground\">\n                          \"How are you liking it so far? We would love your feedback...\"\n                       </CardContent>\n                    </Card>\n                 </div>\n              </div>\n              \n              <Button variant=\"outline\" className=\"mt-4\">\n                 <Plus className=\"mr-2 h-4 w-4\" /> Add Step\n              </Button>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4877,"size_tokens":null},"WhatsappBusinessDashboard/server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/settings/WhatsAppNumber.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { CheckCircle2, AlertCircle, Phone } from \"lucide-react\";\n\nexport default function WhatsAppNumber() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">WhatsApp Number Settings</h2>\n          <p className=\"text-muted-foreground\">Manage your connected phone numbers.</p>\n        </div>\n\n        <Card className=\"border-l-4 border-l-green-500\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Phone className=\"h-5 w-5\" />\n                  +1 (555) 123-4567\n                </CardTitle>\n                <CardDescription>Default Sending Number</CardDescription>\n              </div>\n              <Badge className=\"bg-green-500 hover:bg-green-600\">Active</Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-2\">\n               <div className=\"flex justify-between text-sm\">\n                 <span className=\"text-muted-foreground\">Quality Rating</span>\n                 <span className=\"font-medium text-green-600\">High</span>\n               </div>\n               <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\n                 <div className=\"h-full bg-green-500 w-full\"></div>\n               </div>\n            </div>\n            <div className=\"grid gap-2\">\n               <div className=\"flex justify-between text-sm\">\n                 <span className=\"text-muted-foreground\">Messaging Limit</span>\n                 <span className=\"font-medium\">1,000 conversations / 24h</span>\n               </div>\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" size=\"sm\">Verify</Button>\n            <Button variant=\"destructive\" size=\"sm\">Disconnect</Button>\n          </CardFooter>\n        </Card>\n\n        <Card>\n           <CardHeader>\n             <CardTitle>Add New Number</CardTitle>\n             <CardDescription>Connect another WhatsApp Business number.</CardDescription>\n           </CardHeader>\n           <CardContent className=\"space-y-4\">\n             <div className=\"grid gap-2\">\n               <Label>Phone Number</Label>\n               <Input placeholder=\"+1 (555) 000-0000\" />\n             </div>\n             <Button>Send Verification Code</Button>\n           </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3092,"size_tokens":null},"client/src/pages/settings/Billing.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { CreditCard, Download, Plus, Loader2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Transaction {\n  id: string;\n  type: \"purchase\" | \"usage\";\n  amount: number;\n  description: string;\n  createdAt: string;\n}\n\ninterface Billing {\n  id: string;\n  credits: number;\n  transactions: Transaction[];\n}\n\nexport default function BillingPage() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [purchaseAmount, setPurchaseAmount] = useState(\"\");\n  const queryClient = useQueryClient();\n\n  const { data: billing, isLoading } = useQuery<Billing>({\n    queryKey: [\"/api/billing\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/billing\");\n      if (!res.ok) throw new Error(\"Failed to fetch billing\");\n      return res.json();\n    },\n  });\n\n  const purchaseMutation = useMutation({\n    mutationFn: async (amount: number) => {\n      const res = await fetch(\"/api/billing/purchase\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ amount }),\n      });\n      if (!res.ok) throw new Error(\"Failed to purchase credits\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/billing\"] });\n      setIsDialogOpen(false);\n      setPurchaseAmount(\"\");\n      toast.success(\"Credits purchased successfully!\");\n    },\n    onError: () => {\n      toast.error(\"Failed to purchase credits\");\n    },\n  });\n\n  const handlePurchase = () => {\n    const amount = parseInt(purchaseAmount);\n    if (!amount || amount <= 0) {\n      toast.error(\"Please enter a valid amount\");\n      return;\n    }\n    purchaseMutation.mutate(amount);\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  const getUsedCredits = () => {\n    if (!billing) return 0;\n    return billing.transactions\n      .filter(t => t.type === \"usage\")\n      .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n  };\n\n  if (isLoading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-[calc(100vh-8rem)]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Billing & Credits</h2>\n          <p className=\"text-muted-foreground\">Manage your subscription and conversation credits.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-3\">\n          <Card className=\"bg-primary text-primary-foreground border-none\">\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium opacity-90\">Available Credits</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-4xl font-bold\">{billing?.credits?.toLocaleString() || 0}</div>\n               <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n                 <DialogTrigger asChild>\n                   <Button variant=\"secondary\" className=\"w-full mt-4 text-primary\">\n                     <Plus className=\"mr-2 h-4 w-4\" /> Recharge\n                   </Button>\n                 </DialogTrigger>\n                 <DialogContent>\n                   <DialogHeader>\n                     <DialogTitle>Purchase Credits</DialogTitle>\n                   </DialogHeader>\n                   <div className=\"space-y-4 py-4\">\n                     <div className=\"space-y-2\">\n                       <Label>Amount</Label>\n                       <Input\n                         type=\"number\"\n                         placeholder=\"Enter amount (e.g., 1000)\"\n                         value={purchaseAmount}\n                         onChange={(e) => setPurchaseAmount(e.target.value)}\n                       />\n                     </div>\n                     <div className=\"grid grid-cols-3 gap-2\">\n                       {[500, 1000, 2000].map((amount) => (\n                         <Button\n                           key={amount}\n                           variant=\"outline\"\n                           onClick={() => setPurchaseAmount(amount.toString())}\n                         >\n                           {amount}\n                         </Button>\n                       ))}\n                     </div>\n                   </div>\n                   <DialogFooter>\n                     <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>Cancel</Button>\n                     <Button onClick={handlePurchase} disabled={purchaseMutation.isPending}>\n                       {purchaseMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                       Purchase\n                     </Button>\n                   </DialogFooter>\n                 </DialogContent>\n               </Dialog>\n             </CardContent>\n          </Card>\n\n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium\">Credits Used</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"text-4xl font-bold\">{getUsedCredits().toLocaleString()}</div>\n               <p className=\"text-xs text-muted-foreground mt-1\">Total usage</p>\n               <div className=\"mt-4 h-2 bg-secondary rounded-full overflow-hidden\">\n                 <div \n                   className=\"h-full bg-blue-500 transition-all\"\n                   style={{ \n                     width: `${billing?.credits ? Math.min((getUsedCredits() / (billing.credits + getUsedCredits())) * 100, 100) : 0}%` \n                   }}\n                 />\n               </div>\n             </CardContent>\n          </Card>\n          \n          <Card>\n             <CardHeader className=\"pb-2\">\n               <CardTitle className=\"text-lg font-medium\">Payment Method</CardTitle>\n             </CardHeader>\n             <CardContent>\n               <div className=\"flex items-center gap-2 mb-4\">\n                 <CreditCard className=\"h-5 w-5 text-muted-foreground\" />\n                 <span className=\"font-medium\">Demo Mode</span>\n               </div>\n               <Button variant=\"outline\" className=\"w-full\" onClick={() => toast.info(\"Payment methods will be available in production\")}>\n                 Manage Cards\n               </Button>\n             </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Transaction History</CardTitle>\n            <CardDescription>Recent purchases and usage charges.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {billing?.transactions && billing.transactions.length > 0 ? (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead className=\"text-right\">Invoice</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {billing.transactions.slice().reverse().map((transaction) => (\n                    <TableRow key={transaction.id}>\n                      <TableCell>{formatDate(transaction.createdAt)}</TableCell>\n                      <TableCell>{transaction.description}</TableCell>\n                      <TableCell>\n                        <Badge variant={transaction.type === \"purchase\" ? \"default\" : \"secondary\"}>\n                          {transaction.type === \"purchase\" ? \"Purchase\" : \"Usage\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className={`text-right font-medium ${transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                        {transaction.amount > 0 ? '+' : ''}{transaction.amount.toLocaleString()}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => toast.success(\"Invoice downloaded\")}>\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No transactions yet.\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9512,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/automation.tsx":{"content":"import { useCallback } from 'react';\nimport { \n  ReactFlow, \n  MiniMap, \n  Controls, \n  Background, \n  useNodesState, \n  useEdgesState, \n  addEdge,\n  BackgroundVariant,\n  Position,\n  Handle\n} from '@xyflow/react';\nimport '@xyflow/react/dist/style.css';\n\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Save, Play, Plus } from \"lucide-react\";\n\n// Custom Node Components\nconst TriggerNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border-2 border-primary min-w-[150px]\">\n      <div className=\"font-bold text-sm text-primary mb-1\">Trigger</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      <Handle type=\"source\" position={Position.Bottom} className=\"w-3 h-3 bg-primary\" />\n    </div>\n  );\n};\n\nconst MessageNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border border-gray-200 min-w-[150px]\">\n      <Handle type=\"target\" position={Position.Top} className=\"w-3 h-3 bg-gray-400\" />\n      <div className=\"font-bold text-sm text-gray-700 mb-1\">Send Message</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      <Handle type=\"source\" position={Position.Bottom} className=\"w-3 h-3 bg-gray-400\" />\n    </div>\n  );\n};\n\nconst ConditionNode = ({ data }: { data: { label: string } }) => {\n  return (\n    <div className=\"px-4 py-2 shadow-md rounded-md bg-white border border-orange-300 min-w-[150px] relative\">\n      <Handle type=\"target\" position={Position.Top} className=\"w-3 h-3 bg-gray-400\" />\n      <div className=\"font-bold text-sm text-orange-600 mb-1\">Condition</div>\n      <div className=\"text-xs text-gray-500\">{data.label}</div>\n      \n      <div className=\"absolute -bottom-6 left-1/4 text-[10px] text-gray-500\">Yes</div>\n      <Handle type=\"source\" position={Position.Bottom} id=\"a\" className=\"w-3 h-3 bg-green-500 left-1/4\" />\n      \n      <div className=\"absolute -bottom-6 right-1/4 text-[10px] text-gray-500\">No</div>\n      <Handle type=\"source\" position={Position.Bottom} id=\"b\" className=\"w-3 h-3 bg-red-500 left-3/4\" />\n    </div>\n  );\n};\n\nconst nodeTypes = {\n  trigger: TriggerNode,\n  message: MessageNode,\n  condition: ConditionNode,\n};\n\nconst initialNodes = [\n  { id: '1', type: 'trigger', position: { x: 250, y: 0 }, data: { label: 'Incoming Message: \"Hello\"' } },\n  { id: '2', type: 'message', position: { x: 250, y: 100 }, data: { label: 'Reply: Welcome to our service!' } },\n  { id: '3', type: 'condition', position: { x: 250, y: 200 }, data: { label: 'Is Business Hours?' } },\n  { id: '4', type: 'message', position: { x: 100, y: 300 }, data: { label: 'Reply: How can we help?' } },\n  { id: '5', type: 'message', position: { x: 400, y: 300 }, data: { label: 'Reply: We are closed.' } },\n];\n\nconst initialEdges = [\n  { id: 'e1-2', source: '1', target: '2' },\n  { id: 'e2-3', source: '2', target: '3' },\n  { id: 'e3-4', source: '3', target: '4', sourceHandle: 'a', label: 'Yes' },\n  { id: 'e3-5', source: '3', target: '5', sourceHandle: 'b', label: 'No' },\n];\n\nexport default function Automation() {\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\n  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\n\n  const onConnect = useCallback(\n    (params: any) => setEdges((eds) => addEdge(params, eds)),\n    [setEdges],\n  );\n\n  return (\n    <DashboardLayout>\n      <div className=\"flex flex-col h-[calc(100vh-8rem)] space-y-4 animate-in fade-in duration-500\">\n        <div className=\"flex items-center justify-between shrink-0\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Automation Builder</h2>\n            <p className=\"text-muted-foreground\">Design your chatbot flows visually.</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n             <Button variant=\"outline\">\n               <Play className=\"mr-2 h-4 w-4\" />\n               Test Flow\n             </Button>\n             <Button>\n               <Save className=\"mr-2 h-4 w-4\" />\n               Save Flow\n             </Button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 flex gap-4 min-h-0\">\n           {/* Sidebar for Nodes */}\n           <Card className=\"w-60 shrink-0 p-4 flex flex-col gap-3 overflow-y-auto\">\n             <h3 className=\"font-medium text-sm mb-2\">Elements</h3>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm border-l-4 border-l-primary\">\n               <span className=\"font-medium text-sm\">Trigger</span>\n               <p className=\"text-xs text-muted-foreground\">Start flow</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Send Message</span>\n               <p className=\"text-xs text-muted-foreground\">Text, Image, Video</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm border-l-4 border-l-orange-400\">\n               <span className=\"font-medium text-sm\">Condition</span>\n               <p className=\"text-xs text-muted-foreground\">Branch logic</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Wait</span>\n               <p className=\"text-xs text-muted-foreground\">Delay execution</p>\n             </div>\n             <div className=\"p-3 border rounded cursor-grab hover:bg-secondary transition-colors bg-white shadow-sm\">\n               <span className=\"font-medium text-sm\">Assign to Agent</span>\n               <p className=\"text-xs text-muted-foreground\">Handover</p>\n             </div>\n           </Card>\n\n           {/* Canvas */}\n           <Card className=\"flex-1 overflow-hidden border-2 border-muted\">\n             <ReactFlow\n               nodes={nodes}\n               edges={edges}\n               onNodesChange={onNodesChange}\n               onEdgesChange={onEdgesChange}\n               onConnect={onConnect}\n               nodeTypes={nodeTypes}\n               fitView\n             >\n               <Controls />\n               <MiniMap />\n               <Background variant={BackgroundVariant.Dots} gap={12} size={1} />\n             </ReactFlow>\n           </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":6619,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/pages/campaigns/Report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { StatsCard } from \"@/components/ui/stats-card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { CheckCircle2, Eye, MessageSquare, AlertCircle, DollarSign, TrendingUp, Users, Star, Download, BarChart3, FileText, Loader2 } from \"lucide-react\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  Legend,\n  LineChart,\n  Line\n} from \"recharts\";\nimport { useLocation } from \"wouter\";\nimport { format } from \"date-fns\";\n\ninterface CampaignReportData {\n  totalSent: number;\n  totalDelivered: number;\n  totalRead: number;\n  totalReplied: number;\n  totalFailed: number;\n  totalCost: number;\n  deliveryRate: number;\n  readRate: number;\n  replyRate: number;\n  deliveryData: Array<{ name: string; value: number; color: string }>;\n  dailyStats: Array<{ name: string; date: string; sent: number; read: number; replied: number }>;\n  campaignStats: Array<{ name: string; type: string; sent: number; delivered: number; read: number; replied: number; cost: number; date: string }>;\n  templatePerformance: Array<{ name: string; sent: number; delivered: number; read: number; replied: number; readRate: number; replyRate: number; cost: number }>;\n  costTrend: Array<{ date: string; cost: number; messages: number }>;\n}\n\nexport default function Report() {\n  const [, setLocation] = useLocation();\n  const [dateRange, setDateRange] = useState(\"7\");\n\n  const { data: reportData, isLoading } = useQuery<CampaignReportData>({\n    queryKey: [\"/api/reports/campaign\", dateRange],\n    queryFn: async () => {\n      const res = await fetch(`/api/reports/campaign?days=${dateRange}`);\n      if (!res.ok) throw new Error(\"Failed to fetch report\");\n      return res.json();\n    },\n    refetchInterval: 30000,\n  });\n\n  if (isLoading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-[calc(100vh-8rem)]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  const totalSent = reportData?.totalSent || 0;\n  const totalDelivered = reportData?.totalDelivered || 0;\n  const totalRead = reportData?.totalRead || 0;\n  const totalReplied = reportData?.totalReplied || 0;\n  const totalCost = reportData?.totalCost || 0;\n  const deliveryRate = reportData?.deliveryRate || 0;\n  const readRate = reportData?.readRate || 0;\n  const replyRate = reportData?.replyRate || 0;\n\n  const deliveryData = reportData?.deliveryData || [];\n  const dailyStats = reportData?.dailyStats || [];\n  const campaignStats = reportData?.campaignStats || [];\n  const templatePerformance = reportData?.templatePerformance || [];\n  const costTrend = reportData?.costTrend || [];\n\n  const handleExportCSV = () => {\n    const headers = ['Metric', 'Value'];\n    const rows = [\n      ['Total Sent', totalSent.toString()],\n      ['Total Delivered', totalDelivered.toString()],\n      ['Total Read', totalRead.toString()],\n      ['Total Replied', totalReplied.toString()],\n      ['Delivery Rate', `${deliveryRate}%`],\n      ['Read Rate', `${readRate}%`],\n      ['Reply Rate', `${replyRate}%`],\n      ['Total Cost', `${totalCost.toFixed(2)}`],\n    ];\n    \n    const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `campaign-report-${format(new Date(), 'yyyyMMdd')}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Campaign Reports</h2>\n            <p className=\"text-muted-foreground\">Detailed insights into message delivery, engagement, and costs.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Select value={dateRange} onValueChange={setDateRange}>\n              <SelectTrigger className=\"w-[150px]\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"7\">Last 7 Days</SelectItem>\n                <SelectItem value=\"30\">Last 30 Days</SelectItem>\n                <SelectItem value=\"90\">Last 90 Days</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" onClick={() => setLocation(\"/reports/user-engagement\")}>\n              <Star className=\"mr-2 h-4 w-4\" />\n              User Engagement Report\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportCSV}>\n              <Download className=\"mr-2 h-4 w-4\" />\n              Export\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-5\">\n          <StatsCard \n             title=\"Total Sent\" \n             value={totalSent.toLocaleString()} \n             icon={CheckCircle2}\n          />\n          <StatsCard \n             title=\"Delivered\" \n             value={`${deliveryRate}%`} \n             icon={CheckCircle2}\n             className=\"text-green-600\"\n          />\n          <StatsCard \n             title=\"Read Rate\" \n             value={`${readRate}%`} \n             icon={Eye}\n             className=\"text-blue-600\"\n          />\n          <StatsCard \n             title=\"Reply Rate\" \n             value={`${replyRate}%`} \n             icon={MessageSquare}\n             className=\"text-purple-600\"\n          />\n          <StatsCard \n             title=\"Total Cost\" \n             value={`${totalCost.toFixed(2)}`} \n             icon={DollarSign}\n          />\n        </div>\n\n        <Tabs defaultValue=\"overview\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"campaigns\">Campaign Wise</TabsTrigger>\n            <TabsTrigger value=\"templates\">Template Performance</TabsTrigger>\n            <TabsTrigger value=\"costs\">Cost Analysis</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-4\">\n            <div className=\"grid gap-6 md:grid-cols-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Delivery Status</CardTitle>\n                  <CardDescription>Overall breakdown of message statuses.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[300px] flex items-center justify-center\">\n                    {deliveryData.length > 0 && deliveryData.some(d => d.value > 0) ? (\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <PieChart>\n                          <Pie\n                            data={deliveryData.filter(d => d.value > 0)}\n                            cx=\"50%\"\n                            cy=\"50%\"\n                            innerRadius={60}\n                            outerRadius={80}\n                            paddingAngle={5}\n                            dataKey=\"value\"\n                            label={({ name, value }) => `${name}: ${value.toLocaleString()}`}\n                          >\n                            {deliveryData.filter(d => d.value > 0).map((entry, index) => (\n                              <Cell key={`cell-${index}`} fill={entry.color} />\n                            ))}\n                          </Pie>\n                          <Tooltip formatter={(value: number) => value.toLocaleString()} />\n                          <Legend />\n                        </PieChart>\n                      </ResponsiveContainer>\n                    ) : (\n                      <div className=\"text-center text-muted-foreground\">\n                        <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                        <p>No message data available for this period</p>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Daily Engagement</CardTitle>\n                  <CardDescription>Messages sent, read, and replied over the selected period.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[300px]\">\n                    {dailyStats.length > 0 && dailyStats.some(d => d.sent > 0) ? (\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <BarChart data={dailyStats}>\n                          <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                          <XAxis dataKey=\"name\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                          <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                          <Tooltip \n                            contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                          />\n                          <Legend />\n                          <Bar dataKey=\"sent\" name=\"Sent\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\n                          <Bar dataKey=\"read\" name=\"Read\" fill=\"#22c55e\" radius={[4, 4, 0, 0]} />\n                          <Bar dataKey=\"replied\" name=\"Replied\" fill=\"#8b5cf6\" radius={[4, 4, 0, 0]} />\n                        </BarChart>\n                      </ResponsiveContainer>\n                    ) : (\n                      <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                        <div className=\"text-center\">\n                          <BarChart3 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>No activity data for this period</p>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"campaigns\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Campaign Performance</CardTitle>\n                <CardDescription>Detailed breakdown of each campaign's performance.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {campaignStats.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Campaign</TableHead>\n                        <TableHead>Type</TableHead>\n                        <TableHead className=\"text-right\">Sent</TableHead>\n                        <TableHead className=\"text-right\">Delivered</TableHead>\n                        <TableHead className=\"text-right\">Read</TableHead>\n                        <TableHead className=\"text-right\">Replied</TableHead>\n                        <TableHead className=\"text-right\">Cost ()</TableHead>\n                        <TableHead>Date</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {campaignStats.map((campaign, index) => (\n                        <TableRow key={index}>\n                          <TableCell className=\"font-medium\">{campaign.name}</TableCell>\n                          <TableCell>\n                            <Badge variant={campaign.type === 'Marketing' ? 'default' : 'secondary'}>\n                              {campaign.type}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right\">{campaign.sent.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right text-green-600\">{campaign.delivered.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right text-blue-600\">{campaign.read.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right text-purple-600\">{campaign.replied.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right\">{campaign.cost.toFixed(2)}</TableCell>\n                          <TableCell className=\"text-muted-foreground\">\n                            {campaign.date ? format(new Date(campaign.date), 'MMM d, yyyy') : 'N/A'}\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No campaign data available</p>\n                    <p className=\"text-sm\">Create and run campaigns to see performance data here.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"templates\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5\" />\n                  Template Performance\n                </CardTitle>\n                <CardDescription>How each template is performing in terms of engagement.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {templatePerformance.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Template Name</TableHead>\n                        <TableHead className=\"text-right\">Sent</TableHead>\n                        <TableHead className=\"text-right\">Delivered</TableHead>\n                        <TableHead className=\"text-right\">Read</TableHead>\n                        <TableHead className=\"text-right\">Replied</TableHead>\n                        <TableHead className=\"text-right\">Read Rate</TableHead>\n                        <TableHead className=\"text-right\">Reply Rate</TableHead>\n                        <TableHead className=\"text-right\">Cost ()</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {templatePerformance.map((template, index) => (\n                        <TableRow key={index}>\n                          <TableCell className=\"font-medium font-mono text-sm\">{template.name}</TableCell>\n                          <TableCell className=\"text-right\">{template.sent.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right\">{template.delivered.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right text-blue-600\">{template.read.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right text-purple-600\">{template.replied.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-right\">\n                            <Badge variant={template.readRate >= 70 ? 'default' : template.readRate >= 50 ? 'secondary' : 'outline'}>\n                              {template.readRate}%\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Badge variant={template.replyRate >= 25 ? 'default' : template.replyRate >= 15 ? 'secondary' : 'outline'}>\n                              {template.replyRate}%\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right\">{template.cost.toFixed(2)}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No template usage data available</p>\n                    <p className=\"text-sm\">Send messages using templates to see performance data here.</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"costs\" className=\"space-y-4\">\n            <div className=\"grid gap-6 md:grid-cols-3\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Total Spend</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{totalCost.toFixed(2)}</div>\n                  <p className=\"text-xs text-muted-foreground\">This period</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Cost per Message</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{totalSent > 0 ? (totalCost / totalSent).toFixed(4) : '0.00'}</div>\n                  <p className=\"text-xs text-muted-foreground\">Average</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Cost per Reply</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{totalReplied > 0 ? (totalCost / totalReplied).toFixed(2) : '0.00'}</div>\n                  <p className=\"text-xs text-muted-foreground\">Average</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Cost Trend</CardTitle>\n                <CardDescription>Daily spending over the selected period.</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-[300px]\">\n                  {costTrend.length > 0 && costTrend.some(d => d.cost > 0) ? (\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <LineChart data={costTrend}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                        <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `${value}`} />\n                        <Tooltip \n                          contentStyle={{ backgroundColor: \"hsl(var(--card))\", borderColor: \"hsl(var(--border))\", borderRadius: \"var(--radius)\" }}\n                          formatter={(value: number, name: string) => [name === 'cost' ? `${value.toFixed(2)}` : value.toLocaleString(), name === 'cost' ? 'Cost' : 'Messages']}\n                        />\n                        <Legend />\n                        <Line type=\"monotone\" dataKey=\"cost\" name=\"Cost ()\" stroke=\"#f59e0b\" strokeWidth={2} dot={{ fill: '#f59e0b' }} />\n                      </LineChart>\n                    </ResponsiveContainer>\n                  ) : (\n                    <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                      <div className=\"text-center\">\n                        <DollarSign className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                        <p>No cost data available for this period</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":20665,"size_tokens":null},"server/modules/facebook/fb.routes.ts":{"content":"import { Router } from 'express';\nimport * as controller from './fb.controller';\n\nconst router = Router();\n\nrouter.post('/forms/sync', controller.syncForms);\nrouter.get('/forms', controller.listForms);\nrouter.get('/forms/:id', controller.getForm);\nrouter.post('/forms/:formId/sync-leads', controller.syncLeads);\nrouter.get('/leads', controller.listLeads);\nrouter.get('/leads/:id', controller.getLead);\n\nexport default router;\n","path":null,"size_bytes":426,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns/Single.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Send, Phone, User } from \"lucide-react\";\n\nexport default function Single() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"mb-6\">\n            <h2 className=\"text-3xl font-bold tracking-tight\">Single Message</h2>\n            <p className=\"text-muted-foreground\">Quickly send a message to a specific number.</p>\n          </div>\n\n          <Card>\n            <CardHeader>\n               <CardTitle>Compose Message</CardTitle>\n               <CardDescription>Send a one-off message without creating a campaign.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n               <div className=\"grid gap-2\">\n                 <Label>Phone Number</Label>\n                 <div className=\"relative\">\n                   <Phone className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                   <Input placeholder=\"+1 555 000 0000\" className=\"pl-9\" />\n                 </div>\n               </div>\n               \n               <div className=\"grid gap-2\">\n                 <Label>Recipient Name (Optional)</Label>\n                 <div className=\"relative\">\n                   <User className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                   <Input placeholder=\"John Doe\" className=\"pl-9\" />\n                 </div>\n               </div>\n\n               <div className=\"grid gap-2\">\n                 <Label>Template (Optional)</Label>\n                 <Select>\n                   <SelectTrigger>\n                     <SelectValue placeholder=\"Select a template\" />\n                   </SelectTrigger>\n                   <SelectContent>\n                     <SelectItem value=\"none\">None - Write Custom Message</SelectItem>\n                     <SelectItem value=\"hello\">hello_world</SelectItem>\n                     <SelectItem value=\"shipping\">shipping_update</SelectItem>\n                   </SelectContent>\n                 </Select>\n               </div>\n\n               <div className=\"grid gap-2\">\n                 <Label>Message Text</Label>\n                 <Textarea placeholder=\"Type your message here...\" className=\"min-h-[150px]\" />\n               </div>\n            </CardContent>\n            <CardFooter className=\"flex justify-between border-t pt-6\">\n              <Button variant=\"outline\">Clear Form</Button>\n              <Button>\n                <Send className=\"mr-2 h-4 w-4\" />\n                Send Now\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3169,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"server/modules/storage/json.adapter.ts":{"content":"import * as fs from 'fs';\nimport * as path from 'path';\n\nconst DATA_DIR = path.join(process.cwd(), 'data');\n\nfunction ensureDataDir() {\n  if (!fs.existsSync(DATA_DIR)) {\n    fs.mkdirSync(DATA_DIR, { recursive: true });\n  }\n}\n\nfunction getFilePath(collection: string): string {\n  return path.join(DATA_DIR, `${collection}.json`);\n}\n\nexport function readCollection<T>(collection: string): T[] {\n  ensureDataDir();\n  const filePath = getFilePath(collection);\n  if (!fs.existsSync(filePath)) {\n    fs.writeFileSync(filePath, '[]');\n    return [];\n  }\n  try {\n    const data = fs.readFileSync(filePath, 'utf-8');\n    return JSON.parse(data);\n  } catch {\n    return [];\n  }\n}\n\nexport function writeCollection<T>(collection: string, data: T[]): void {\n  ensureDataDir();\n  const filePath = getFilePath(collection);\n  fs.writeFileSync(filePath, JSON.stringify(data, null, 2));\n}\n\nexport function addItem<T extends { id: string }>(collection: string, item: T): T {\n  const items = readCollection<T>(collection);\n  items.push(item);\n  writeCollection(collection, items);\n  return item;\n}\n\nexport function updateItem<T extends { id: string }>(collection: string, id: string, updates: Partial<T>): T | null {\n  const items = readCollection<T>(collection);\n  const index = items.findIndex(item => item.id === id);\n  if (index === -1) return null;\n  items[index] = { ...items[index], ...updates };\n  writeCollection(collection, items);\n  return items[index];\n}\n\nexport function deleteItem<T extends { id: string }>(collection: string, id: string): boolean {\n  const items = readCollection<T>(collection);\n  const filtered = items.filter(item => item.id !== id);\n  if (filtered.length === items.length) return false;\n  writeCollection(collection, filtered);\n  return true;\n}\n\nexport function findById<T extends { id: string }>(collection: string, id: string): T | null {\n  const items = readCollection<T>(collection);\n  return items.find(item => item.id === id) || null;\n}\n\nexport function findByField<T>(collection: string, field: keyof T, value: any): T | null {\n  const items = readCollection<T>(collection);\n  return items.find(item => item[field] === value) || null;\n}\n","path":null,"size_bytes":2159,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/apps/ConnectApps.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Search, Facebook, Instagram, Globe, Webhook, MessageSquare, FileSpreadsheet } from \"lucide-react\";\n\nexport default function ConnectApps() {\n  const apps = [\n    { name: \"Facebook Leads\", description: \"Sync leads from Facebook Ads\", icon: Facebook, color: \"bg-blue-600\" },\n    { name: \"Instagram\", description: \"Connect Instagram Direct Messages\", icon: Instagram, color: \"bg-pink-600\" },\n    { name: \"Webhooks\", description: \"Receive real-time data via webhooks\", icon: Webhook, color: \"bg-purple-600\" },\n    { name: \"Google Sheets\", description: \"Sync contacts and messages\", icon: FileSpreadsheet, color: \"bg-green-600\" },\n    { name: \"Zapier\", description: \"Connect with 5000+ apps\", icon: Globe, color: \"bg-orange-600\" },\n    { name: \"Shopify\", description: \"Send order updates automatically\", icon: MessageSquare, color: \"bg-green-500\" },\n  ];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Connect Apps</h2>\n          <p className=\"text-muted-foreground\">Integrate with your favorite tools and services.</p>\n        </div>\n\n        <div className=\"relative w-full max-w-md\">\n          <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input placeholder=\"Search for apps...\" className=\"pl-9\" />\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {apps.map((app) => (\n            <Card key={app.name} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader className=\"flex flex-row items-center gap-4\">\n                <div className={`h-12 w-12 rounded-lg flex items-center justify-center text-white ${app.color}`}>\n                  <app.icon className=\"h-6 w-6\" />\n                </div>\n                <div>\n                  <CardTitle className=\"text-base\">{app.name}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <CardDescription className=\"mb-4 h-10\">{app.description}</CardDescription>\n                <Button variant=\"outline\" className=\"w-full\">Connect</Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2579,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Bell, Lock, User, Smartphone, Globe, CreditCard, Facebook } from \"lucide-react\";\n\nexport default function Settings() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Settings</h2>\n          <p className=\"text-muted-foreground\">Manage your account settings and preferences.</p>\n        </div>\n\n        <Tabs defaultValue=\"general\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"general\">General</TabsTrigger>\n            <TabsTrigger value=\"business\">Business Profile</TabsTrigger>\n            <TabsTrigger value=\"api\">API & Webhooks</TabsTrigger>\n            <TabsTrigger value=\"notifications\">Notifications</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"general\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Profile Information</CardTitle>\n                <CardDescription>Update your account profile details.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center gap-4\">\n                  <Avatar className=\"h-20 w-20\">\n                    <AvatarImage src=\"https://github.com/shadcn.png\" />\n                    <AvatarFallback>CN</AvatarFallback>\n                  </Avatar>\n                  <Button variant=\"outline\">Change Avatar</Button>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"name\">Display Name</Label>\n                  <Input id=\"name\" defaultValue=\"Acme Inc Admin\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input id=\"email\" defaultValue=\"admin@acme.com\" />\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button>Save Changes</Button>\n              </CardFooter>\n            </Card>\n            \n            <Card>\n              <CardHeader>\n                <CardTitle>Appearance</CardTitle>\n                <CardDescription>Customize how the dashboard looks on your device.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Dark Mode</Label>\n                    <p className=\"text-sm text-muted-foreground\">Enable dark mode for the dashboard.</p>\n                  </div>\n                  <Switch />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"business\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>WhatsApp Business Profile</CardTitle>\n                <CardDescription>This information will be visible to your customers on WhatsApp.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Business Name</Label>\n                  <Input defaultValue=\"Acme Corporation\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Description</Label>\n                  <Input defaultValue=\"We provide the best widgets in the world.\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Address</Label>\n                  <Input defaultValue=\"123 Widget St, Tech City\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Email</Label>\n                  <Input defaultValue=\"support@acme.com\" />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Website</Label>\n                  <Input defaultValue=\"https://acme.com\" />\n                </div>\n              </CardContent>\n              <CardFooter>\n                <Button>Update Profile</Button>\n              </CardFooter>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"api\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>API Credentials</CardTitle>\n                <CardDescription>Manage your API keys and authentication tokens.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label>Phone Number ID</Label>\n                  <div className=\"flex gap-2\">\n                    <Input value=\"10928374655\" readOnly className=\"font-mono bg-muted\" />\n                    <Button variant=\"outline\" size=\"icon\"><Lock className=\"h-4 w-4\" /></Button>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>WhatsApp Business Account ID</Label>\n                  <div className=\"flex gap-2\">\n                     <Input value=\"19283746556\" readOnly className=\"font-mono bg-muted\" />\n                     <Button variant=\"outline\" size=\"icon\"><Lock className=\"h-4 w-4\" /></Button>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Permanent Access Token</Label>\n                  <div className=\"flex gap-2\">\n                     <Input value=\"EAABw...\" type=\"password\" readOnly className=\"font-mono bg-muted\" />\n                     <Button variant=\"outline\">Regenerate</Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                 <CardTitle>Integrations</CardTitle>\n                 <CardDescription>Connect with other platforms.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                 <div className=\"flex items-center justify-between border p-4 rounded-lg\">\n                    <div className=\"flex items-center gap-4\">\n                       <div className=\"h-10 w-10 bg-blue-600 rounded-full flex items-center justify-center text-white\">\n                          <Facebook className=\"h-6 w-6\" />\n                       </div>\n                       <div>\n                          <h4 className=\"font-medium\">Facebook Leads</h4>\n                          <p className=\"text-sm text-muted-foreground\">Sync leads from Facebook & Instagram Ads.</p>\n                       </div>\n                    </div>\n                    <Button variant=\"outline\">Connect</Button>\n                 </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n               <CardHeader>\n                 <CardTitle>Webhooks</CardTitle>\n                 <CardDescription>Configure where we send real-time events.</CardDescription>\n               </CardHeader>\n               <CardContent>\n                 <div className=\"grid gap-2\">\n                   <Label>Callback URL</Label>\n                   <Input placeholder=\"https://your-domain.com/webhook\" />\n                 </div>\n                 <div className=\"grid gap-2 mt-4\">\n                   <Label>Verify Token</Label>\n                   <Input placeholder=\"random_string\" />\n                 </div>\n               </CardContent>\n               <CardFooter>\n                 <Button>Save Webhook</Button>\n               </CardFooter>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"notifications\" className=\"space-y-4\">\n             <Card>\n               <CardHeader>\n                 <CardTitle>Email Notifications</CardTitle>\n               </CardHeader>\n               <CardContent className=\"space-y-4\">\n                 <div className=\"flex items-center justify-between\">\n                   <div className=\"space-y-0.5\">\n                     <Label>Weekly Reports</Label>\n                     <p className=\"text-sm text-muted-foreground\">Receive a summary of your activity every Monday.</p>\n                   </div>\n                   <Switch defaultChecked />\n                 </div>\n                 <div className=\"flex items-center justify-between\">\n                   <div className=\"space-y-0.5\">\n                     <Label>System Alerts</Label>\n                     <p className=\"text-sm text-muted-foreground\">Get notified about API errors or downtime.</p>\n                   </div>\n                   <Switch defaultChecked />\n                 </div>\n               </CardContent>\n             </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9299,"size_tokens":null},"server/modules/whatsapp/whatsapp.routes.ts":{"content":"import { Router, Request, Response, NextFunction } from 'express';\nimport * as controller from './whatsapp.controller';\nimport { requireAuth } from '../auth/auth.routes';\n\nconst router = Router();\n\nrouter.get('/', controller.verifyWebhook);\nrouter.post('/', controller.handleWebhook);\nrouter.post('/send', requireAuth, controller.sendMessage);\nrouter.post('/send-template', requireAuth, controller.sendTemplateMessageEndpoint);\nrouter.get('/conversations', controller.getConversations);\nrouter.get('/conversations/:phone', controller.getConversation);\nrouter.get('/media/:mediaId', requireAuth, controller.getMediaUrl);\n\nexport default router;\n","path":null,"size_bytes":644,"size_tokens":null},"server/modules/broadcast/broadcast.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\nimport * as templateService from '../leadAutoReply/templateMessages.service';\nimport * as openaiService from '../openai/openai.service';\nimport * as aiService from '../ai/ai.service';\nimport * as agentService from '../aiAgents/agent.service';\n\nexport interface BroadcastList {\n  id: string;\n  name: string;\n  contacts: BroadcastContact[];\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface BroadcastContact {\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n}\n\nexport interface ScheduledMessage {\n  id: string;\n  name: string;\n  messageType: 'template' | 'custom' | 'ai_agent';\n  templateName?: string;\n  customMessage?: string;\n  agentId?: string;\n  contactIds?: string[];\n  listId?: string;\n  scheduledAt: string;\n  status: 'scheduled' | 'sent' | 'failed' | 'cancelled';\n  recipientCount: number;\n  sentCount: number;\n  failedCount: number;\n  createdAt: string;\n}\n\nexport interface ScheduledBroadcast {\n  id: string;\n  contacts: BroadcastContact[];\n  messageType: 'template' | 'custom' | 'ai_agent';\n  templateName?: string;\n  customMessage?: string;\n  agentId?: string;\n  campaignName: string;\n  scheduledAt: string;\n  status: 'scheduled' | 'sending' | 'sent' | 'failed' | 'cancelled';\n  createdAt: string;\n  sentCount?: number;\n  failedCount?: number;\n}\n\nexport interface SendMessageResult {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\nfunction getWhatsAppCredentials(): { token: string; phoneNumberId: string } | null {\n  const token = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN;\n  const phoneNumberId = process.env.PHONE_NUMBER_ID;\n  \n  if (!token || !phoneNumberId) {\n    return null;\n  }\n  \n  return { token, phoneNumberId };\n}\n\nfunction formatPhoneNumber(phone: string): string {\n  let cleaned = phone.replace(/\\D/g, '');\n  \n  if (phone.trim().startsWith('+')) {\n    return cleaned;\n  }\n  \n  if (cleaned.startsWith('00')) {\n    cleaned = cleaned.substring(2);\n    return cleaned;\n  }\n  \n  const commonCountryCodes = ['1', '44', '91', '92', '93', '94', '971', '966', '965', '974', '20', '27', '61', '64', '81', '86', '62'];\n  for (const code of commonCountryCodes) {\n    if (cleaned.startsWith(code) && cleaned.length >= 10) {\n      return cleaned;\n    }\n  }\n  \n  if (cleaned.startsWith('0')) {\n    cleaned = '91' + cleaned.substring(1);\n  }\n\n  return cleaned;\n}\n\nexport async function getBroadcastLists(): Promise<BroadcastList[]> {\n  return mongodb.readCollection<BroadcastList>('broadcast_lists');\n}\n\nexport async function getBroadcastListById(id: string): Promise<BroadcastList | undefined> {\n  const result = await mongodb.findOne<BroadcastList>('broadcast_lists', { id });\n  return result || undefined;\n}\n\nexport async function createBroadcastList(name: string, contacts: BroadcastContact[]): Promise<BroadcastList> {\n  const newList: BroadcastList = {\n    id: `list-${Date.now()}`,\n    name,\n    contacts,\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  };\n  await mongodb.insertOne('broadcast_lists', newList);\n  return newList;\n}\n\nexport async function updateBroadcastList(id: string, name: string, contacts: BroadcastContact[]): Promise<BroadcastList | null> {\n  const existing = await getBroadcastListById(id);\n  if (!existing) return null;\n  \n  const updated: BroadcastList = {\n    ...existing,\n    name,\n    contacts,\n    updatedAt: new Date().toISOString(),\n  };\n  await mongodb.updateOne('broadcast_lists', { id }, updated);\n  return updated;\n}\n\nexport async function deleteBroadcastList(id: string): Promise<boolean> {\n  return mongodb.deleteOne('broadcast_lists', { id });\n}\n\nexport async function getScheduledMessages(): Promise<ScheduledMessage[]> {\n  return mongodb.readCollection<ScheduledMessage>('scheduled_messages');\n}\n\nexport async function createScheduledMessage(data: Omit<ScheduledMessage, 'id' | 'createdAt' | 'sentCount' | 'failedCount'>): Promise<ScheduledMessage> {\n  const newMessage: ScheduledMessage = {\n    ...data,\n    id: `schedule-${Date.now()}`,\n    createdAt: new Date().toISOString(),\n    sentCount: 0,\n    failedCount: 0,\n  };\n  await mongodb.insertOne('scheduled_messages', newMessage);\n  return newMessage;\n}\n\nexport async function updateScheduledMessage(id: string, updates: Partial<ScheduledMessage>): Promise<ScheduledMessage | null> {\n  const existing = await mongodb.findOne<ScheduledMessage>('scheduled_messages', { id });\n  if (!existing) return null;\n  \n  const updated = { ...existing, ...updates };\n  await mongodb.updateOne('scheduled_messages', { id }, updated);\n  return updated;\n}\n\nexport async function deleteScheduledMessage(id: string): Promise<boolean> {\n  return mongodb.deleteOne('scheduled_messages', { id });\n}\n\nexport async function sendTemplateMessage(phone: string, templateName: string, contactName?: string): Promise<SendMessageResult> {\n  const components: templateService.TemplateComponent[] = [];\n  \n  if (templateName.includes('awards') || templateName.includes('marketing')) {\n    components.push({\n      type: 'body',\n      parameters: [\n        {\n          type: 'text',\n          text: contactName || 'Valued Customer',\n          parameter_name: 'name',\n        }\n      ]\n    });\n  }\n  \n  const result = await templateService.sendTemplateMessage(formatPhoneNumber(phone), {\n    name: templateName,\n    languageCode: 'en',\n    components: components.length > 0 ? components : undefined,\n  });\n  return result;\n}\n\nexport async function sendCustomMessage(phone: string, message: string): Promise<SendMessageResult> {\n  const credentials = getWhatsAppCredentials();\n  \n  if (!credentials) {\n    console.error('[CustomMessage] WhatsApp credentials not configured');\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n\n  const formattedPhone = formatPhoneNumber(phone);\n  console.log(`[CustomMessage] Sending to ${formattedPhone}: \"${message.substring(0, 50)}...\"`);\n\n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          recipient_type: 'individual',\n          to: formattedPhone,\n          type: 'text',\n          text: { body: message }\n        }),\n      }\n    );\n\n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      console.log(`[CustomMessage] Successfully sent to ${formattedPhone}`);\n      return { success: true, messageId: data.messages[0].id };\n    } else {\n      const errorMsg = data.error?.message || 'Failed to send message';\n      const errorCode = data.error?.code;\n      console.error(`[CustomMessage] Failed (code: ${errorCode}): ${errorMsg}`);\n      \n      if (errorCode === 131047 || errorMsg.includes('24 hour') || errorMsg.includes('Re-engagement')) {\n        return { \n          success: false, \n          error: 'Cannot send custom message - outside 24-hour window. Customer must message you first, or use a template message.' \n        };\n      }\n      \n      return { success: false, error: errorMsg };\n    }\n  } catch (error) {\n    console.error('[CustomMessage] Error:', error);\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\nexport async function sendAIAgentMessage(phone: string, agentId: string, context?: string): Promise<SendMessageResult> {\n  const agent = await agentService.getAgentById(agentId);\n  if (!agent) {\n    console.error(`[AIAgent] Agent not found: ${agentId}`);\n    return { success: false, error: 'Agent not found' };\n  }\n\n  console.log(`[AIAgent] Generating message with agent \"${agent.name}\" (model: ${agent.model || 'default'}) for ${phone}`);\n  \n  const prompt = context || 'Generate a friendly welcome message for a new contact. Keep it under 160 characters.';\n  const aiMessage = await aiService.generateAgentResponse(prompt, agent, []);\n  \n  if (!aiMessage) {\n    console.error('[AIAgent] Failed to generate AI message');\n    return { success: false, error: 'Failed to generate AI message. Check if API key is configured for the agent model.' };\n  }\n\n  console.log(`[AIAgent] AI generated: \"${aiMessage.substring(0, 100)}...\"`);\n\n  const customResult = await sendCustomMessage(phone, aiMessage);\n  \n  if (!customResult.success && (customResult.error?.includes('24') || customResult.error?.includes('window'))) {\n    console.log('[AIAgent] Custom message failed (outside 24-hour window), falling back to hello_world template');\n    return await templateService.sendHelloWorldTemplate(formatPhoneNumber(phone));\n  }\n  \n  return customResult;\n}\n\nexport interface BroadcastLog {\n  id: string;\n  campaignName: string;\n  contactName: string;\n  contactPhone: string;\n  messageType: 'template' | 'custom' | 'ai_agent';\n  templateName?: string;\n  message?: string;\n  status: 'sent' | 'delivered' | 'failed' | 'pending';\n  messageId?: string;\n  error?: string;\n  timestamp: string;\n  replied?: boolean;\n  repliedAt?: string;\n}\n\nexport async function logBroadcastMessage(log: Omit<BroadcastLog, 'id'>): Promise<BroadcastLog> {\n  const newLog: BroadcastLog = {\n    ...log,\n    id: `broadcast-log-${Date.now()}-${Math.random().toString(36).substring(7)}`,\n  };\n  try {\n    const result = await mongodb.insertOne('broadcast_logs', newLog);\n    console.log(`[BroadcastLog] Saved log for ${log.contactPhone}: ${log.status}`);\n    return result || newLog;\n  } catch (error) {\n    console.error('[BroadcastLog] Failed to save log:', error);\n    return newLog;\n  }\n}\n\nexport async function markBroadcastLogAsReplied(phone: string): Promise<number> {\n  try {\n    const normalizedPhone = phone.replace(/\\D/g, '');\n    console.log(`[BroadcastLog] Looking for broadcast logs to mark as replied for phone: ${normalizedPhone}`);\n    \n    const logs = await mongodb.readCollection<BroadcastLog>('broadcast_logs');\n    console.log(`[BroadcastLog] Found ${logs.length} total broadcast logs`);\n    \n    let updatedCount = 0;\n    const now = new Date().toISOString();\n    \n    for (const log of logs) {\n      const logPhone = log.contactPhone.replace(/\\D/g, '');\n      const last10Digits = normalizedPhone.slice(-10);\n      const logLast10Digits = logPhone.slice(-10);\n      \n      // Match if phones share the same last 10 digits (ignoring country code)\n      const phoneMatches = last10Digits === logLast10Digits || \n                          logPhone.includes(normalizedPhone) || \n                          normalizedPhone.includes(logPhone);\n      \n      if (phoneMatches && !log.replied) {\n        console.log(`[BroadcastLog] Phone match found! Log phone: ${logPhone}, Incoming: ${normalizedPhone}`);\n        \n        const updateResult = await mongodb.updateOne('broadcast_logs', { id: log.id }, { \n          replied: true, \n          repliedAt: now \n        });\n        \n        if (updateResult) {\n          updatedCount++;\n          console.log(`[BroadcastLog] Successfully marked as replied: ${log.id} (${log.contactPhone})`);\n        } else {\n          console.log(`[BroadcastLog] Failed to update log: ${log.id}`);\n        }\n      }\n    }\n    \n    console.log(`[BroadcastLog] Total logs marked as replied: ${updatedCount}`);\n    return updatedCount;\n  } catch (error) {\n    console.error('[BroadcastLog] Error marking as replied:', error);\n    return 0;\n  }\n}\n\nexport async function getBroadcastLogs(filters?: { \n  campaignName?: string; \n  status?: string; \n  phone?: string;\n  limit?: number;\n  offset?: number;\n}): Promise<BroadcastLog[]> {\n  try {\n    let logs = await mongodb.readCollection<BroadcastLog>('broadcast_logs');\n    console.log(`[BroadcastLogs] Fetched ${logs.length} logs from MongoDB`);\n    \n    if (filters) {\n      if (filters.campaignName) {\n        logs = logs.filter(l => l.campaignName.toLowerCase().includes(filters.campaignName!.toLowerCase()));\n      }\n      if (filters.status) {\n        logs = logs.filter(l => l.status === filters.status);\n      }\n      if (filters.phone) {\n        logs = logs.filter(l => l.contactPhone.includes(filters.phone!));\n      }\n    }\n    \n    logs = logs.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n    \n    const offset = filters?.offset || 0;\n    const limit = filters?.limit || 100;\n    return logs.slice(offset, offset + limit);\n  } catch (error) {\n    console.error('[BroadcastLogs] Failed to fetch logs:', error);\n    return [];\n  }\n}\n\nexport async function sendBroadcast(\n  contacts: BroadcastContact[],\n  messageType: 'template' | 'custom' | 'ai_agent',\n  options: {\n    templateName?: string;\n    customMessage?: string;\n    agentId?: string;\n    campaignName?: string;\n    isScheduled?: boolean;\n    scheduledTime?: string;\n  }\n): Promise<{ total: number; successful: number; failed: number; results: Array<{ phone: string; success: boolean; error?: string }>; credentialError?: string; scheduled?: boolean; scheduledAt?: string }> {\n  const campaignName = options.campaignName || `Broadcast ${new Date().toISOString()}`;\n\n  // Handle scheduled broadcasts\n  if (options.isScheduled && options.scheduledTime) {\n    const scheduledDate = new Date(options.scheduledTime);\n    console.log(`[Broadcast] Scheduling broadcast for ${scheduledDate.toISOString()}`);\n    console.log(`[Broadcast] Contacts: ${contacts.length}, MessageType: ${messageType}, CampaignName: ${campaignName}`);\n    \n    // Store the scheduled broadcast\n    const scheduleData: ScheduledBroadcast = {\n      id: `scheduled-${Date.now()}`,\n      contacts,\n      messageType,\n      templateName: options.templateName,\n      customMessage: options.customMessage,\n      agentId: options.agentId,\n      campaignName,\n      scheduledAt: scheduledDate.toISOString(),\n      status: 'scheduled',\n      createdAt: new Date().toISOString(),\n    };\n    \n    console.log(`[Broadcast] Saving scheduled broadcast:`, JSON.stringify(scheduleData, null, 2));\n    await mongodb.insertOne('scheduled_broadcasts', scheduleData);\n    console.log(`[Broadcast] Scheduled broadcast saved successfully with ID: ${scheduleData.id}`);\n    \n    return {\n      total: contacts.length,\n      successful: 0,\n      failed: 0,\n      results: [],\n      scheduled: true,\n      scheduledAt: scheduledDate.toISOString(),\n    };\n  }\n\n  const results: Array<{ phone: string; success: boolean; error?: string }> = [];\n  let successful = 0;\n  let failed = 0;\n\n  console.log(`[Broadcast] Starting broadcast to ${contacts.length} contacts`);\n  console.log(`[Broadcast] Campaign: ${campaignName}, Type: ${messageType}`);\n  \n  // Check WhatsApp credentials before starting\n  const credentials = getWhatsAppCredentials();\n  if (!credentials) {\n    console.error('[Broadcast] WhatsApp credentials not configured');\n    return {\n      total: contacts.length,\n      successful: 0,\n      failed: contacts.length,\n      results: contacts.map(c => ({ phone: c.phone, success: false, error: 'WhatsApp credentials not configured' })),\n      credentialError: 'WhatsApp API credentials (WHATSAPP_TOKEN and PHONE_NUMBER_ID) are not configured. Please add them in Settings > WhatsApp API.',\n    };\n  }\n\n  for (const contact of contacts) {\n    let result: SendMessageResult;\n    let messageContent = '';\n\n    switch (messageType) {\n      case 'template':\n        result = await sendTemplateMessage(contact.phone, options.templateName || 'hello_world', contact.name);\n        messageContent = `[Template: ${options.templateName || 'hello_world'}]`;\n        break;\n      case 'custom':\n        result = await sendCustomMessage(contact.phone, options.customMessage || '');\n        messageContent = options.customMessage || '';\n        break;\n      case 'ai_agent':\n        result = await sendAIAgentMessage(contact.phone, options.agentId || '', `Contact name: ${contact.name}`);\n        messageContent = '[AI Generated Message]';\n        break;\n      default:\n        result = { success: false, error: 'Invalid message type' };\n        messageContent = '';\n    }\n\n    await logBroadcastMessage({\n      campaignName,\n      contactName: contact.name,\n      contactPhone: contact.phone,\n      messageType,\n      templateName: options.templateName,\n      message: messageContent,\n      status: result.success ? 'sent' : 'failed',\n      messageId: result.messageId,\n      error: result.error,\n      timestamp: new Date().toISOString(),\n    });\n\n    results.push({\n      phone: contact.phone,\n      success: result.success,\n      error: result.error,\n    });\n\n    if (result.success) {\n      successful++;\n      console.log(`[Broadcast] Sent to ${contact.phone} (${contact.name})`);\n    } else {\n      failed++;\n      console.log(`[Broadcast] Failed for ${contact.phone}: ${result.error}`);\n    }\n\n    await new Promise(resolve => setTimeout(resolve, 500));\n  }\n\n  console.log(`[Broadcast] Complete: ${successful} successful, ${failed} failed`);\n\n  return {\n    total: contacts.length,\n    successful,\n    failed,\n    results,\n  };\n}\n\nexport async function sendSingleMessage(\n  phone: string,\n  name: string,\n  messageType: 'template' | 'custom' | 'ai_agent',\n  options: {\n    templateName?: string;\n    customMessage?: string;\n    agentId?: string;\n  }\n): Promise<SendMessageResult> {\n  switch (messageType) {\n    case 'template':\n      return await sendTemplateMessage(phone, options.templateName || 'hello_world', name);\n    case 'custom':\n      return await sendCustomMessage(phone, options.customMessage || '');\n    case 'ai_agent':\n      return await sendAIAgentMessage(phone, options.agentId || '', `Contact name: ${name}`);\n    default:\n      return { success: false, error: 'Invalid message type' };\n  }\n}\n\nexport interface ParseResult {\n  contacts: BroadcastContact[];\n  totalRows: number;\n  validContacts: number;\n  errors: string[];\n}\n\nexport function parseExcelContacts(data: unknown[]): ParseResult {\n  const contacts: BroadcastContact[] = [];\n  const errors: string[] = [];\n  let rowNum = 1;\n  \n  for (const row of data) {\n    rowNum++;\n    if (typeof row !== 'object' || row === null) continue;\n    \n    const record = row as Record<string, unknown>;\n    const keys = Object.keys(record);\n    \n    // Log column names for first row\n    if (rowNum === 2) {\n      console.log(`[ParseExcel] Detected columns: ${keys.join(', ')}`);\n    }\n    \n    // Check all possible name column variations (case insensitive)\n    let name = '';\n    for (const key of keys) {\n      const lowerKey = key.toLowerCase().trim();\n      if (lowerKey === 'name' || lowerKey === 'full_name' || lowerKey === 'fullname' || \n          lowerKey === 'contact_name' || lowerKey === 'customer_name' || lowerKey === 'customer') {\n        name = String(record[key] || '').trim();\n        break;\n      }\n    }\n    \n    // Check all possible phone column variations (case insensitive)\n    let phone = '';\n    for (const key of keys) {\n      const lowerKey = key.toLowerCase().trim();\n      if (lowerKey === 'phone' || lowerKey === 'mobile' || lowerKey === 'phone_number' || \n          lowerKey === 'mobile_number' || lowerKey === 'phonenumber' || lowerKey === 'mobilenumber' ||\n          lowerKey === 'contact' || lowerKey === 'whatsapp' || lowerKey === 'cell' || lowerKey === 'telephone') {\n        phone = String(record[key] || '').trim();\n        break;\n      }\n    }\n    \n    // Check for email column\n    let email = '';\n    for (const key of keys) {\n      const lowerKey = key.toLowerCase().trim();\n      if (lowerKey === 'email' || lowerKey === 'email_address' || lowerKey === 'emailaddress') {\n        email = String(record[key] || '').trim();\n        break;\n      }\n    }\n    \n    // Handle scientific notation from Excel (9.2E+11 format)\n    if (phone) {\n      // If it looks like scientific notation, convert it\n      if (phone.includes('E') || phone.includes('e')) {\n        try {\n          const numValue = parseFloat(phone);\n          if (!isNaN(numValue)) {\n            phone = Math.round(numValue).toString();\n          }\n        } catch (e) {\n          // Keep original if parsing fails\n        }\n      }\n      \n      // Remove any non-digit characters except leading +\n      phone = phone.replace(/[^\\d+]/g, '');\n      \n      // Clean up: remove + if not at start\n      if (phone.includes('+') && !phone.startsWith('+')) {\n        phone = phone.replace(/\\+/g, '');\n      }\n    }\n    \n    // Validation with specific error messages\n    if (!phone) {\n      errors.push(`Row ${rowNum}: Missing phone number`);\n      continue;\n    }\n    \n    if (phone.length < 8) {\n      errors.push(`Row ${rowNum}: Phone number too short (${phone})`);\n      continue;\n    }\n    \n    // If name is missing, use phone as name\n    if (!name) {\n      name = `Contact ${phone.slice(-4)}`;\n    }\n    \n    contacts.push({\n      name,\n      phone,\n      email: email || undefined,\n    });\n  }\n  \n  console.log(`[ParseExcel] Parsed ${contacts.length} valid contacts from ${data.length} rows`);\n  if (errors.length > 0) {\n    console.log(`[ParseExcel] Errors: ${errors.slice(0, 5).join('; ')}${errors.length > 5 ? '...' : ''}`);\n  }\n  \n  return {\n    contacts,\n    totalRows: data.length,\n    validContacts: contacts.length,\n    errors: errors.slice(0, 10), // Return first 10 errors\n  };\n}\n\nexport function exportContactsToJSON(contacts: BroadcastContact[]): object[] {\n  return contacts.map(c => ({\n    name: c.name,\n    phone: c.phone,\n    email: c.email || '',\n    tags: c.tags?.join(', ') || '',\n  }));\n}\n\nexport interface ImportedContact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags?: string[];\n  source: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport async function saveImportedContacts(contacts: BroadcastContact[], source: string = 'import'): Promise<{ saved: number; duplicates: number; errors: string[] }> {\n  const errors: string[] = [];\n  let saved = 0;\n  let duplicates = 0;\n  const now = new Date().toISOString();\n\n  try {\n    const existingContacts = await mongodb.readCollection<ImportedContact>('imported_contacts');\n    const existingPhones = new Set(existingContacts.map(c => c.phone.replace(/\\D/g, '')));\n    \n    const uniqueContacts: ImportedContact[] = [];\n    const seenPhones = new Set<string>();\n    \n    for (const contact of contacts) {\n      const normalizedPhone = contact.phone.replace(/\\D/g, '');\n      \n      if (existingPhones.has(normalizedPhone) || seenPhones.has(normalizedPhone)) {\n        duplicates++;\n        continue;\n      }\n      \n      seenPhones.add(normalizedPhone);\n      \n      uniqueContacts.push({\n        id: `contact-${Date.now()}-${Math.random().toString(36).substring(7)}`,\n        name: contact.name,\n        phone: contact.phone,\n        email: contact.email || '',\n        tags: contact.tags || [],\n        source,\n        createdAt: now,\n        updatedAt: now,\n      });\n    }\n    \n    if (uniqueContacts.length > 0) {\n      const BATCH_SIZE = 100;\n      for (let i = 0; i < uniqueContacts.length; i += BATCH_SIZE) {\n        const batch = uniqueContacts.slice(i, i + BATCH_SIZE);\n        await mongodb.insertMany('imported_contacts', batch);\n        saved += batch.length;\n      }\n    }\n    \n    console.log(`[ImportContacts] Saved ${saved} new contacts, ${duplicates} duplicates skipped (batch mode)`);\n  } catch (error) {\n    console.error('[ImportContacts] Bulk import failed:', error);\n    errors.push(`Bulk import failed: ${error}`);\n  }\n\n  return { saved, duplicates, errors };\n}\n\nexport async function getImportedContacts(): Promise<ImportedContact[]> {\n  try {\n    const contacts = await mongodb.readCollection<ImportedContact>('imported_contacts');\n    return contacts.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  } catch (error) {\n    console.error('[ImportContacts] Failed to get contacts:', error);\n    return [];\n  }\n}\n\nexport async function deleteImportedContact(id: string): Promise<boolean> {\n  try {\n    await mongodb.deleteOne('imported_contacts', { id });\n    return true;\n  } catch (error) {\n    console.error('[ImportContacts] Failed to delete contact:', error);\n    return false;\n  }\n}\n\n// Scheduled Broadcasts Functions\nexport async function getScheduledBroadcasts(): Promise<ScheduledBroadcast[]> {\n  try {\n    return await mongodb.readCollection<ScheduledBroadcast>('scheduled_broadcasts');\n  } catch (error) {\n    console.error('[ScheduledBroadcasts] Failed to get scheduled broadcasts:', error);\n    return [];\n  }\n}\n\nexport async function processScheduledBroadcasts(): Promise<void> {\n  const now = new Date();\n  console.log(`[Scheduler] Checking for due broadcasts at ${now.toISOString()}`);\n  \n  try {\n    const scheduled = await mongodb.readCollection<ScheduledBroadcast>('scheduled_broadcasts');\n    const duebroadcasts = scheduled.filter(s => \n      s.status === 'scheduled' && new Date(s.scheduledAt) <= now\n    );\n    \n    if (duebroadcasts.length === 0) {\n      return;\n    }\n    \n    console.log(`[Scheduler] Found ${duebroadcasts.length} due broadcasts`);\n    \n    for (const broadcast of duebroadcasts) {\n      console.log(`[Scheduler] Processing broadcast: ${broadcast.id} - ${broadcast.campaignName}`);\n      \n      // Update status to sending\n      await mongodb.updateOne('scheduled_broadcasts', { id: broadcast.id }, { \n        ...broadcast, \n        status: 'sending' \n      });\n      \n      let successful = 0;\n      let failed = 0;\n      \n      const credentials = getWhatsAppCredentials();\n      if (!credentials) {\n        console.error(`[Scheduler] WhatsApp credentials not configured for broadcast ${broadcast.id}`);\n        await mongodb.updateOne('scheduled_broadcasts', { id: broadcast.id }, {\n          ...broadcast,\n          status: 'failed',\n          sentCount: 0,\n          failedCount: broadcast.contacts.length,\n        });\n        continue;\n      }\n      \n      for (const contact of broadcast.contacts) {\n        let result: SendMessageResult;\n        let messageContent = '';\n        \n        switch (broadcast.messageType) {\n          case 'template':\n            result = await sendTemplateMessage(contact.phone, broadcast.templateName || 'hello_world', contact.name);\n            messageContent = `[Template: ${broadcast.templateName || 'hello_world'}]`;\n            break;\n          case 'custom':\n            result = await sendCustomMessage(contact.phone, broadcast.customMessage || '');\n            messageContent = broadcast.customMessage || '';\n            break;\n          case 'ai_agent':\n            result = await sendAIAgentMessage(contact.phone, broadcast.agentId || '', `Contact name: ${contact.name}`);\n            messageContent = '[AI Generated Message]';\n            break;\n          default:\n            result = { success: false, error: 'Invalid message type' };\n        }\n        \n        await logBroadcastMessage({\n          campaignName: broadcast.campaignName,\n          contactName: contact.name,\n          contactPhone: contact.phone,\n          messageType: broadcast.messageType,\n          templateName: broadcast.templateName,\n          message: messageContent,\n          status: result.success ? 'sent' : 'failed',\n          messageId: result.messageId,\n          error: result.error,\n          timestamp: new Date().toISOString(),\n        });\n        \n        if (result.success) {\n          successful++;\n        } else {\n          failed++;\n        }\n        \n        await new Promise(resolve => setTimeout(resolve, 500));\n      }\n      \n      // Update broadcast status\n      await mongodb.updateOne('scheduled_broadcasts', { id: broadcast.id }, {\n        ...broadcast,\n        status: 'sent',\n        sentCount: successful,\n        failedCount: failed,\n      });\n      \n      console.log(`[Scheduler] Broadcast ${broadcast.id} complete: ${successful} sent, ${failed} failed`);\n    }\n  } catch (error) {\n    console.error('[Scheduler] Error processing scheduled broadcasts:', error);\n  }\n}\n\n// Start the scheduler\nlet schedulerInterval: NodeJS.Timeout | null = null;\n\nexport function startScheduler(): void {\n  if (schedulerInterval) {\n    return;\n  }\n  console.log('[Scheduler] Starting broadcast scheduler (checking every 30 seconds)');\n  schedulerInterval = setInterval(processScheduledBroadcasts, 30000);\n  // Run immediately on start\n  processScheduledBroadcasts();\n}\n\nexport function stopScheduler(): void {\n  if (schedulerInterval) {\n    clearInterval(schedulerInterval);\n    schedulerInterval = null;\n    console.log('[Scheduler] Broadcast scheduler stopped');\n  }\n}\n\nexport async function cancelScheduledBroadcast(id: string): Promise<boolean> {\n  try {\n    const broadcast = await mongodb.findOne<ScheduledBroadcast>('scheduled_broadcasts', { id });\n    if (!broadcast) {\n      console.error(`[ScheduledBroadcast] Broadcast not found: ${id}`);\n      return false;\n    }\n    \n    if (broadcast.status !== 'scheduled') {\n      console.error(`[ScheduledBroadcast] Cannot cancel broadcast with status: ${broadcast.status}`);\n      return false;\n    }\n    \n    await mongodb.updateOne('scheduled_broadcasts', { id }, {\n      ...broadcast,\n      status: 'cancelled',\n    });\n    \n    console.log(`[ScheduledBroadcast] Cancelled broadcast: ${id}`);\n    return true;\n  } catch (error) {\n    console.error('[ScheduledBroadcast] Failed to cancel broadcast:', error);\n    return false;\n  }\n}\n\nexport async function deleteScheduledBroadcast(id: string): Promise<boolean> {\n  try {\n    const broadcast = await mongodb.findOne<ScheduledBroadcast>('scheduled_broadcasts', { id });\n    if (!broadcast) {\n      console.error(`[ScheduledBroadcast] Broadcast not found for deletion: ${id}`);\n      return false;\n    }\n    \n    await mongodb.deleteOne('scheduled_broadcasts', { id });\n    console.log(`[ScheduledBroadcast] Deleted broadcast: ${id}`);\n    return true;\n  } catch (error) {\n    console.error('[ScheduledBroadcast] Failed to delete broadcast:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":29925,"size_tokens":null},"WhatsappBusinessDashboard/server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // put application routes here\n  // prefix all routes with /api\n\n  // use storage to perform CRUD operations on the storage interface\n  // e.g. storage.insertUser(user) or storage.getUserByUsername(username)\n\n  return httpServer;\n}\n","path":null,"size_bytes":458,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"server/storage.ts":{"content":"import {\n  type User,\n  type Contact,\n  type Message,\n  type Campaign,\n  type Template,\n  type Automation,\n  type TeamMember,\n  type WhatsappSettings,\n  type Billing,\n  type Chat,\n  type InsertUser,\n  type InsertContact,\n  type InsertMessage,\n  type InsertCampaign,\n  type InsertTemplate,\n  type InsertAutomation,\n  type InsertTeamMember,\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport * as mongodb from \"./modules/storage/mongodb.adapter\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  getContacts(): Promise<Contact[]>;\n  getContact(id: string): Promise<Contact | undefined>;\n  getContactByPhone(phone: string): Promise<Contact | undefined>;\n  createContact(contact: InsertContact): Promise<Contact>;\n  updateContact(id: string, contact: Partial<InsertContact>): Promise<Contact | undefined>;\n  deleteContact(id: string): Promise<boolean>;\n  getMessages(contactId?: string): Promise<Message[]>;\n  getMessage(id: string): Promise<Message | undefined>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  updateMessage(id: string, message: Partial<Message>): Promise<Message | undefined>;\n  getCampaigns(): Promise<Campaign[]>;\n  getCampaign(id: string): Promise<Campaign | undefined>;\n  createCampaign(campaign: InsertCampaign): Promise<Campaign>;\n  updateCampaign(id: string, campaign: Partial<Campaign>): Promise<Campaign | undefined>;\n  deleteCampaign(id: string): Promise<boolean>;\n  getTemplates(): Promise<Template[]>;\n  getTemplate(id: string): Promise<Template | undefined>;\n  createTemplate(template: InsertTemplate): Promise<Template>;\n  updateTemplate(id: string, template: Partial<Template>): Promise<Template | undefined>;\n  deleteTemplate(id: string): Promise<boolean>;\n  getAutomations(): Promise<Automation[]>;\n  getAutomation(id: string): Promise<Automation | undefined>;\n  createAutomation(automation: InsertAutomation): Promise<Automation>;\n  updateAutomation(id: string, automation: Partial<Automation>): Promise<Automation | undefined>;\n  deleteAutomation(id: string): Promise<boolean>;\n  getTeamMembers(): Promise<TeamMember[]>;\n  getTeamMember(id: string): Promise<TeamMember | undefined>;\n  createTeamMember(member: InsertTeamMember): Promise<TeamMember>;\n  updateTeamMember(id: string, member: Partial<TeamMember>): Promise<TeamMember | undefined>;\n  deleteTeamMember(id: string): Promise<boolean>;\n  getWhatsappSettings(): Promise<WhatsappSettings | null>;\n  saveWhatsappSettings(settings: Omit<WhatsappSettings, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<WhatsappSettings>;\n  getBilling(): Promise<Billing>;\n  updateBilling(billing: Partial<Billing>): Promise<Billing>;\n  addTransaction(transaction: { type: \"purchase\" | \"usage\"; amount: number; description: string }): Promise<Billing>;\n  getDashboardStats(): Promise<any>;\n  getChats(): Promise<Chat[]>;\n  getChat(id: string): Promise<Chat | undefined>;\n  getChatByContactId(contactId: string): Promise<Chat | undefined>;\n  updateChat(id: string, chat: Partial<Chat>): Promise<Chat | undefined>;\n  updateChatInboundTime(contactId: string): Promise<void>;\n  markMessagesAsRead(contactId: string): Promise<void>;\n  markMessagesAsUnread(contactId: string): Promise<void>;\n  incrementUnreadCount(contactId: string): Promise<void>;\n}\n\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, '');\n}\n\nexport class MongoStorage implements IStorage {\n  \n  async getUser(id: string): Promise<User | undefined> {\n    const user = await mongodb.findOne<User>('users', { id });\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const user = await mongodb.findOne<User>('users', { username });\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const user: User = {\n      ...insertUser,\n      id: randomUUID(),\n      createdAt: new Date().toISOString(),\n    };\n    await mongodb.insertOne('users', user);\n    return user;\n  }\n\n  async getContacts(): Promise<Contact[]> {\n    return mongodb.findMany<Contact>('contacts', {});\n  }\n\n  async getContact(id: string): Promise<Contact | undefined> {\n    const contact = await mongodb.findOne<Contact>('contacts', { id });\n    return contact || undefined;\n  }\n\n  async getContactByPhone(phone: string): Promise<Contact | undefined> {\n    const normalizedPhone = normalizePhone(phone);\n    const contacts = await mongodb.findMany<Contact>('contacts', {});\n    return contacts.find(c => normalizePhone(c.phone).endsWith(normalizedPhone.slice(-10)) || \n                              normalizedPhone.endsWith(normalizePhone(c.phone).slice(-10)));\n  }\n\n  async createContact(contact: InsertContact): Promise<Contact> {\n    const now = new Date().toISOString();\n    const newContact: Contact = {\n      ...contact,\n      id: randomUUID(),\n      tags: contact.tags || [],\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('contacts', newContact);\n    \n    const chat: Chat = {\n      id: `chat-${newContact.id}`,\n      contactId: newContact.id,\n      contact: newContact,\n      unreadCount: 0,\n      status: 'open',\n      notes: [],\n    };\n    await mongodb.insertOne('chats', chat);\n    \n    return newContact;\n  }\n\n  async updateContact(id: string, contact: Partial<InsertContact>): Promise<Contact | undefined> {\n    const updated = await mongodb.updateOne<Contact>('contacts', { id }, {\n      ...contact,\n      updatedAt: new Date().toISOString(),\n    });\n    return updated || undefined;\n  }\n\n  async deleteContact(id: string): Promise<boolean> {\n    await mongodb.deleteOne('messages', { contactId: id });\n    await mongodb.deleteOne('chats', { contactId: id });\n    return mongodb.deleteOne('contacts', { id });\n  }\n\n  async getMessages(contactId?: string): Promise<Message[]> {\n    if (contactId) {\n      return mongodb.findMany<Message>('messages', { contactId });\n    }\n    return mongodb.findMany<Message>('messages', {});\n  }\n\n  async getMessage(id: string): Promise<Message | undefined> {\n    const message = await mongodb.findOne<Message>('messages', { id });\n    return message || undefined;\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const newMessage: Message = {\n      ...message,\n      id: randomUUID(),\n      timestamp: new Date().toISOString(),\n    };\n    await mongodb.insertOne('messages', newMessage);\n    \n    const chat = await this.getChatByContactId(message.contactId);\n    if (chat) {\n      const updateData: Partial<Chat> = {\n        lastMessage: newMessage.content,\n        lastMessageTime: newMessage.timestamp,\n      };\n      if (message.direction === 'inbound') {\n        updateData.lastInboundMessageTime = newMessage.timestamp;\n        updateData.lastInboundMessage = newMessage.content;\n      }\n      await mongodb.updateOne('chats', { id: chat.id }, updateData);\n    }\n    \n    return newMessage;\n  }\n\n  async updateMessage(id: string, message: Partial<Message>): Promise<Message | undefined> {\n    const updated = await mongodb.updateOne<Message>('messages', { id }, message);\n    return updated || undefined;\n  }\n\n  async getCampaigns(): Promise<Campaign[]> {\n    return mongodb.findMany<Campaign>('campaigns', {});\n  }\n\n  async getCampaign(id: string): Promise<Campaign | undefined> {\n    const campaign = await mongodb.findOne<Campaign>('campaigns', { id });\n    return campaign || undefined;\n  }\n\n  async createCampaign(campaign: InsertCampaign): Promise<Campaign> {\n    const now = new Date().toISOString();\n    const newCampaign: Campaign = {\n      ...campaign,\n      id: randomUUID(),\n      sentCount: 0,\n      deliveredCount: 0,\n      readCount: 0,\n      repliedCount: 0,\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('campaigns', newCampaign);\n    return newCampaign;\n  }\n\n  async updateCampaign(id: string, campaign: Partial<Campaign>): Promise<Campaign | undefined> {\n    const updated = await mongodb.updateOne<Campaign>('campaigns', { id }, {\n      ...campaign,\n      updatedAt: new Date().toISOString(),\n    });\n    return updated || undefined;\n  }\n\n  async deleteCampaign(id: string): Promise<boolean> {\n    return mongodb.deleteOne('campaigns', { id });\n  }\n\n  async getTemplates(): Promise<Template[]> {\n    return mongodb.findMany<Template>('templates', {});\n  }\n\n  async getTemplate(id: string): Promise<Template | undefined> {\n    const template = await mongodb.findOne<Template>('templates', { id });\n    return template || undefined;\n  }\n\n  async createTemplate(template: InsertTemplate): Promise<Template> {\n    const now = new Date().toISOString();\n    const newTemplate: Template = {\n      ...template,\n      id: randomUUID(),\n      status: \"pending\",\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('templates', newTemplate);\n    return newTemplate;\n  }\n\n  async updateTemplate(id: string, template: Partial<Template>): Promise<Template | undefined> {\n    const updated = await mongodb.updateOne<Template>('templates', { id }, {\n      ...template,\n      updatedAt: new Date().toISOString(),\n    });\n    return updated || undefined;\n  }\n\n  async deleteTemplate(id: string): Promise<boolean> {\n    return mongodb.deleteOne('templates', { id });\n  }\n\n  async getAutomations(): Promise<Automation[]> {\n    return mongodb.findMany<Automation>('automations', {});\n  }\n\n  async getAutomation(id: string): Promise<Automation | undefined> {\n    const automation = await mongodb.findOne<Automation>('automations', { id });\n    return automation || undefined;\n  }\n\n  async createAutomation(automation: InsertAutomation): Promise<Automation> {\n    const now = new Date().toISOString();\n    const newAutomation: Automation = {\n      ...automation,\n      id: randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('automations', newAutomation);\n    return newAutomation;\n  }\n\n  async updateAutomation(id: string, automation: Partial<Automation>): Promise<Automation | undefined> {\n    const updated = await mongodb.updateOne<Automation>('automations', { id }, {\n      ...automation,\n      updatedAt: new Date().toISOString(),\n    });\n    return updated || undefined;\n  }\n\n  async deleteAutomation(id: string): Promise<boolean> {\n    return mongodb.deleteOne('automations', { id });\n  }\n\n  async getTeamMembers(): Promise<TeamMember[]> {\n    return mongodb.findMany<TeamMember>('team_members', {});\n  }\n\n  async getTeamMember(id: string): Promise<TeamMember | undefined> {\n    const member = await mongodb.findOne<TeamMember>('team_members', { id });\n    return member || undefined;\n  }\n\n  async createTeamMember(member: InsertTeamMember): Promise<TeamMember> {\n    const newMember: TeamMember = {\n      ...member,\n      id: randomUUID(),\n      createdAt: new Date().toISOString(),\n    };\n    await mongodb.insertOne('team_members', newMember);\n    return newMember;\n  }\n\n  async updateTeamMember(id: string, member: Partial<TeamMember>): Promise<TeamMember | undefined> {\n    const updated = await mongodb.updateOne<TeamMember>('team_members', { id }, member);\n    return updated || undefined;\n  }\n\n  async deleteTeamMember(id: string): Promise<boolean> {\n    return mongodb.deleteOne('team_members', { id });\n  }\n\n  async getWhatsappSettings(): Promise<WhatsappSettings | null> {\n    const settings = await mongodb.findOne<WhatsappSettings>('whatsapp_settings', {});\n    return settings;\n  }\n\n  async saveWhatsappSettings(settings: Omit<WhatsappSettings, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<WhatsappSettings> {\n    const now = new Date().toISOString();\n    const existing = await this.getWhatsappSettings();\n    \n    if (existing) {\n      const updated = await mongodb.updateOne<WhatsappSettings>('whatsapp_settings', { id: existing.id }, {\n        ...settings,\n        updatedAt: now,\n      });\n      return updated!;\n    }\n    \n    const newSettings: WhatsappSettings = {\n      ...settings,\n      id: randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('whatsapp_settings', newSettings);\n    return newSettings;\n  }\n\n  async getBilling(): Promise<Billing> {\n    const billing = await mongodb.findOne<Billing>('billing', {});\n    if (!billing) {\n      const defaultBilling: Billing = {\n        id: 'billing-1',\n        credits: 1500,\n        transactions: [],\n      };\n      await mongodb.insertOne('billing', defaultBilling);\n      return defaultBilling;\n    }\n    return billing;\n  }\n\n  async updateBilling(billing: Partial<Billing>): Promise<Billing> {\n    const current = await this.getBilling();\n    const updated = await mongodb.updateOne<Billing>('billing', { id: current.id }, billing);\n    return updated || current;\n  }\n\n  async addTransaction(transaction: { type: \"purchase\" | \"usage\"; amount: number; description: string }): Promise<Billing> {\n    const billing = await this.getBilling();\n    const newTransaction = {\n      id: randomUUID(),\n      ...transaction,\n      createdAt: new Date().toISOString(),\n    };\n    billing.transactions.push(newTransaction);\n    billing.credits += transaction.amount;\n    await mongodb.updateOne('billing', { id: billing.id }, {\n      credits: billing.credits,\n      transactions: billing.transactions,\n    });\n    return billing;\n  }\n\n  async getDashboardStats(): Promise<any> {\n    const messages = await this.getMessages();\n    const campaigns = await this.getCampaigns();\n    \n    const outbound = messages.filter((m) => m.direction === \"outbound\");\n    const delivered = outbound.filter((m) => m.status === \"delivered\" || m.status === \"read\");\n    const read = outbound.filter((m) => m.status === \"read\");\n    const inbound = messages.filter((m) => m.direction === \"inbound\");\n\n    const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n    const thisWeekMessages = messages.filter((m) => new Date(m.timestamp) > weekAgo);\n    const lastWeekMessages = messages.filter((m) => {\n      const msgDate = new Date(m.timestamp);\n      return msgDate > new Date(weekAgo.getTime() - 7 * 24 * 60 * 60 * 1000) && msgDate <= weekAgo;\n    });\n\n    const thisWeekOutbound = thisWeekMessages.filter((m) => m.direction === \"outbound\").length;\n    const lastWeekOutbound = lastWeekMessages.filter((m) => m.direction === \"outbound\").length || 1;\n\n    const dailyActivity = [];\n    const days = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"];\n    for (let i = 6; i >= 0; i--) {\n      const date = new Date(Date.now() - i * 24 * 60 * 60 * 1000);\n      const dayMessages = messages.filter((m) => {\n        const msgDate = new Date(m.timestamp);\n        return msgDate.toDateString() === date.toDateString();\n      });\n      dailyActivity.push({\n        day: days[date.getDay() === 0 ? 6 : date.getDay() - 1],\n        sent: dayMessages.filter((m) => m.direction === \"outbound\").length,\n        delivered: dayMessages.filter((m) => m.direction === \"outbound\" && (m.status === \"delivered\" || m.status === \"read\")).length,\n        read: dayMessages.filter((m) => m.direction === \"outbound\" && m.status === \"read\").length,\n      });\n    }\n\n    const campaignPerformance = campaigns.slice(0, 5).map((c) => ({\n      name: c.name,\n      delivered: c.deliveredCount,\n      read: c.readCount,\n    }));\n\n    return {\n      totalMessages: outbound.length,\n      delivered: delivered.length,\n      readRate: outbound.length > 0 ? Math.round((read.length / outbound.length) * 100 * 10) / 10 : 0,\n      replied: inbound.length,\n      messagesChange: Math.round(((thisWeekOutbound - lastWeekOutbound) / lastWeekOutbound) * 100 * 10) / 10,\n      deliveredChange: 2.1,\n      readRateChange: 5.4,\n      repliedChange: -1.2,\n      dailyActivity,\n      campaignPerformance,\n    };\n  }\n\n  async getChats(): Promise<Chat[]> {\n    const chats = await mongodb.findMany<Chat>('chats', {});\n    const contacts = await this.getContacts();\n    \n    return chats.map(chat => {\n      const contact = contacts.find(c => c.id === chat.contactId);\n      return {\n        ...chat,\n        contact: contact || {\n          id: chat.contactId,\n          name: 'Unknown',\n          phone: '',\n          tags: [],\n          createdAt: new Date().toISOString(),\n          updatedAt: new Date().toISOString(),\n        },\n      };\n    });\n  }\n\n  async getChat(id: string): Promise<Chat | undefined> {\n    const chat = await mongodb.findOne<Chat>('chats', { id });\n    if (!chat) return undefined;\n    \n    const contact = await this.getContact(chat.contactId);\n    return {\n      ...chat,\n      contact: contact || {\n        id: chat.contactId,\n        name: 'Unknown',\n        phone: '',\n        tags: [],\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      },\n    };\n  }\n\n  async getChatByContactId(contactId: string): Promise<Chat | undefined> {\n    const chat = await mongodb.findOne<Chat>('chats', { contactId });\n    if (!chat) return undefined;\n    \n    const contact = await this.getContact(contactId);\n    return {\n      ...chat,\n      contact: contact || {\n        id: contactId,\n        name: 'Unknown',\n        phone: '',\n        tags: [],\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      },\n    };\n  }\n\n  async updateChat(id: string, chat: Partial<Chat>): Promise<Chat | undefined> {\n    const updated = await mongodb.updateOne<Chat>('chats', { id }, chat);\n    return updated || undefined;\n  }\n\n  async updateChatInboundTime(contactId: string): Promise<void> {\n    const now = new Date().toISOString();\n    const chat = await this.getChatByContactId(contactId);\n    \n    if (chat) {\n      await mongodb.updateOne('chats', { contactId }, {\n        lastInboundMessageTime: now,\n        unreadCount: (chat.unreadCount || 0) + 1,\n      });\n    } else {\n      const contact = await this.getContact(contactId);\n      if (contact) {\n        const newChat: Chat = {\n          id: `chat-${contactId}`,\n          contactId,\n          contact,\n          lastInboundMessageTime: now,\n          unreadCount: 1,\n          status: 'open',\n          notes: [],\n        };\n        await mongodb.insertOne('chats', newChat);\n      }\n    }\n  }\n\n  async markMessagesAsRead(contactId: string): Promise<void> {\n    const messages = await mongodb.findMany<Message>('messages', { contactId, direction: 'inbound' });\n    for (const msg of messages) {\n      if (msg.status !== 'read') {\n        await mongodb.updateOne('messages', { id: msg.id }, { status: 'read' });\n      }\n    }\n    \n    await mongodb.updateOne('chats', { contactId }, { unreadCount: 0 });\n  }\n\n  async markMessagesAsUnread(contactId: string): Promise<void> {\n    await mongodb.updateOne('chats', { contactId }, { unreadCount: 1 });\n  }\n\n  async incrementUnreadCount(contactId: string): Promise<void> {\n    const chat = await this.getChatByContactId(contactId);\n    if (chat) {\n      await mongodb.updateOne('chats', { contactId }, {\n        unreadCount: (chat.unreadCount || 0) + 1,\n      });\n    }\n  }\n}\n\nexport const storage = new MongoStorage();\n","path":null,"size_bytes":19076,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/templates/AddTemplate.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nexport default function AddTemplate() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">Add New Template</h2>\n        <Card className=\"max-w-2xl\">\n          <CardHeader>\n            <CardTitle>Template Details</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-2\">\n              <Label>Template Name</Label>\n              <Input placeholder=\"e.g., welcome_message_v2\" />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Category</Label>\n              <Select>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"marketing\">Marketing</SelectItem>\n                  <SelectItem value=\"utility\">Utility</SelectItem>\n                  <SelectItem value=\"auth\">Authentication</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Language</Label>\n              <Select>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select language\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"en_US\">English (US)</SelectItem>\n                  <SelectItem value=\"es_ES\">Spanish</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Header (Optional)</Label>\n              <Select>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"None\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">None</SelectItem>\n                  <SelectItem value=\"text\">Text</SelectItem>\n                  <SelectItem value=\"image\">Image</SelectItem>\n                  <SelectItem value=\"video\">Video</SelectItem>\n                  <SelectItem value=\"document\">Document</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label>Body Text</Label>\n              <Textarea placeholder=\"Enter your message here. Use {{1}}, {{2}} for variables.\" className=\"min-h-[100px]\" />\n              <p className=\"text-xs text-muted-foreground\">Example: Hello {'{{1}}'}, thanks for your order!</p>\n            </div>\n            <Button className=\"w-full\">Submit for Approval</Button>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":3202,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/ai/NewAgent.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Bot, Play } from \"lucide-react\";\n\nexport default function NewAgent() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">New AI Agent</h2>\n        \n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card className=\"h-full\">\n            <CardHeader>\n              <CardTitle>Agent Configuration</CardTitle>\n              <CardDescription>Define how your AI agent should behave.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-2\">\n                <Label>Agent Name</Label>\n                <Input placeholder=\"e.g., Support Bot Level 1\" />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>System Instructions</Label>\n                <Textarea \n                  className=\"min-h-[300px] font-mono text-sm\"\n                  placeholder=\"You are a helpful support assistant for Acme Corp. You answer questions about our widgets. If you don't know the answer, politely transfer the chat to a human agent.\"\n                />\n              </div>\n              <Button className=\"w-full\">\n                 Create Agent\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card className=\"h-full flex flex-col\">\n            <CardHeader>\n              <CardTitle>Test Playground</CardTitle>\n              <CardDescription>Interact with your agent to test the instructions.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"flex-1 flex flex-col\">\n              <div className=\"flex-1 bg-muted/50 rounded-md border p-4 mb-4\">\n                <div className=\"flex gap-2 mb-4\">\n                   <div className=\"h-8 w-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground\">\n                     <Bot className=\"h-5 w-5\" />\n                   </div>\n                   <div className=\"bg-white p-3 rounded-lg rounded-tl-none shadow-sm max-w-[80%] text-sm\">\n                     Hello! I am your AI assistant. How can I help you today?\n                   </div>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <Input placeholder=\"Type a message...\" />\n                <Button size=\"icon\">\n                  <Play className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2948,"size_tokens":null},"WhatsappBusinessDashboard/client/src/pages/campaigns/Broadcast.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Upload, FileSpreadsheet, Send, Users } from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\nexport default function Broadcast() {\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Send Broadcast</h2>\n          <p className=\"text-muted-foreground\">Send bulk messages to your contact lists.</p>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>1. Select Audience</CardTitle>\n              <CardDescription>Choose who will receive this message.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid w-full max-w-sm items-center gap-1.5\">\n                <Label htmlFor=\"upload\">Import Contacts (CSV/Excel)</Label>\n                <div className=\"flex items-center justify-center w-full\">\n                  <label htmlFor=\"dropzone-file\" className=\"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer hover:bg-muted/50\">\n                    <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\n                      <Upload className=\"w-8 h-8 mb-2 text-muted-foreground\" />\n                      <p className=\"text-sm text-muted-foreground\">\n                        <span className=\"font-semibold\">Click to upload</span> or drag and drop\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">CSV, XLS, XLSX (MAX. 10MB)</p>\n                    </div>\n                    <Input id=\"dropzone-file\" type=\"file\" className=\"hidden\" />\n                  </label>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-px flex-1 bg-border\"></div>\n                <span className=\"text-xs text-muted-foreground\">OR</span>\n                <div className=\"h-px flex-1 bg-border\"></div>\n              </div>\n\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <Users className=\"mr-2 h-4 w-4\" />\n                Select from Contacts\n              </Button>\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\n                Select from Lead Forms\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>2. Compose Message</CardTitle>\n              <CardDescription>Select a template or write your message.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Tabs defaultValue=\"template\">\n                <TabsList className=\"w-full\">\n                  <TabsTrigger value=\"template\" className=\"flex-1\">Template</TabsTrigger>\n                  <TabsTrigger value=\"custom\" className=\"flex-1\">Custom</TabsTrigger>\n                </TabsList>\n                <TabsContent value=\"template\" className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Select Template</Label>\n                    <select className=\"w-full flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\">\n                       <option>Select a template...</option>\n                       <option>marketing_promo_1</option>\n                       <option>welcome_message</option>\n                    </select>\n                  </div>\n                </TabsContent>\n                <TabsContent value=\"custom\" className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Message Text</Label>\n                    <Textarea placeholder=\"Type your message here...\" className=\"min-h-[150px]\" />\n                  </div>\n                </TabsContent>\n              </Tabs>\n              \n              <Button className=\"w-full\">\n                <Send className=\"mr-2 h-4 w-4\" />\n                Send Broadcast\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":4878,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/pages/ai/AgentsPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Bot, Trash2, Edit, Plus, Play, X, RefreshCw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  systemPrompt: string;\n  model: string;\n  temperature: number;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function AgentsPage() {\n  const [agents, setAgents] = useState<Agent[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editingAgent, setEditingAgent] = useState<Agent | null>(null);\n  const [testDialogOpen, setTestDialogOpen] = useState(false);\n  const [testingAgent, setTestingAgent] = useState<Agent | null>(null);\n  const [testMessage, setTestMessage] = useState(\"\");\n  const [testResponse, setTestResponse] = useState(\"\");\n  const [testing, setTesting] = useState(false);\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    systemPrompt: \"\",\n    model: \"gpt-4o\",\n    temperature: 0.7,\n    isActive: true,\n  });\n\n  const getModelDisplayName = (model: string): string => {\n    const modelNames: { [key: string]: string } = {\n      \"gpt-4o\": \"Bot 1\",\n      \"gpt-4o-mini\": \"Bot 2\",\n      \"gpt-4-turbo\": \"Bot 3\",\n      \"gpt-3.5-turbo\": \"Bot 4\",\n    };\n    return modelNames[model] || model;\n  };\n\n  const fetchAgents = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(\"/api/agents\");\n      if (response.ok) {\n        const data = await response.json();\n        setAgents(data);\n      }\n    } catch (error) {\n      console.error(\"Error fetching agents:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchAgents();\n  }, []);\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      description: \"\",\n      systemPrompt: \"\",\n      model: \"gpt-4o\",\n      temperature: 0.7,\n      isActive: true,\n    });\n    setEditingAgent(null);\n  };\n\n  const openEditDialog = (agent: Agent) => {\n    setEditingAgent(agent);\n    setFormData({\n      name: agent.name,\n      description: agent.description,\n      systemPrompt: agent.systemPrompt,\n      model: agent.model,\n      temperature: agent.temperature,\n      isActive: agent.isActive,\n    });\n    setDialogOpen(true);\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.name || !formData.systemPrompt) {\n      toast({\n        title: \"Missing Fields\",\n        description: \"Name and system prompt are required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const url = editingAgent ? `/api/agents/${editingAgent.id}` : \"/api/agents\";\n      const method = editingAgent ? \"PUT\" : \"POST\";\n\n      const response = await fetch(url, {\n        method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      if (response.ok) {\n        const agent = await response.json();\n        if (editingAgent) {\n          setAgents((prev) => prev.map((a) => (a.id === agent.id ? agent : a)));\n          toast({ title: \"Agent Updated\", description: `${agent.name} has been updated.` });\n        } else {\n          setAgents((prev) => [...prev, agent]);\n          toast({ title: \"Agent Created\", description: `${agent.name} has been created.` });\n        }\n        setDialogOpen(false);\n        resetForm();\n      } else {\n        const error = await response.json();\n        toast({ title: \"Error\", description: error.error, variant: \"destructive\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to save agent.\", variant: \"destructive\" });\n    }\n  };\n\n  const deleteAgent = async (id: string) => {\n    try {\n      const response = await fetch(`/api/agents/${id}`, { method: \"DELETE\" });\n      if (response.ok) {\n        setAgents((prev) => prev.filter((a) => a.id !== id));\n        toast({ title: \"Agent Deleted\", description: \"The agent has been removed.\" });\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to delete agent.\", variant: \"destructive\" });\n    }\n  };\n\n  const toggleAgent = async (agent: Agent) => {\n    try {\n      const response = await fetch(`/api/agents/${agent.id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ isActive: !agent.isActive }),\n      });\n\n      if (response.ok) {\n        const updated = await response.json();\n        setAgents((prev) => prev.map((a) => (a.id === agent.id ? updated : a)));\n      }\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to update agent.\", variant: \"destructive\" });\n    }\n  };\n\n  const testAgent = async () => {\n    if (!testingAgent || !testMessage) return;\n\n    setTesting(true);\n    setTestResponse(\"\");\n    try {\n      const response = await fetch(`/api/agents/${testingAgent.id}/test`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message: testMessage }),\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setTestResponse(data.response);\n      } else {\n        const error = await response.json();\n        setTestResponse(`Error: ${error.error}`);\n      }\n    } catch (error) {\n      setTestResponse(\"Error: Failed to test agent.\");\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">AI Agents</h2>\n            <p className=\"text-muted-foreground\">Create and manage AI agents for automated responses</p>\n          </div>\n          <Dialog open={dialogOpen} onOpenChange={(open) => { setDialogOpen(open); if (!open) resetForm(); }}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                New Agent\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>{editingAgent ? \"Edit Agent\" : \"Create New Agent\"}</DialogTitle>\n                <DialogDescription>\n                  Configure your AI agent's behavior and personality.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>Name</Label>\n                    <Input\n                      placeholder=\"e.g., Support Bot\"\n                      value={formData.name}\n                      onChange={(e) => setFormData((prev) => ({ ...prev, name: e.target.value }))}\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>AI Model</Label>\n                    <Select\n                      value={formData.model}\n                      onValueChange={(value) => setFormData((prev) => ({ ...prev, model: value }))}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"gpt-4o\">Bot 1 (Most Intelligent)</SelectItem>\n                        <SelectItem value=\"gpt-4o-mini\">Bot 2 (Smart & Fast)</SelectItem>\n                        <SelectItem value=\"gpt-4-turbo\">Bot 3 (Premium)</SelectItem>\n                        <SelectItem value=\"gpt-3.5-turbo\">Bot 4 (Economy)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Description</Label>\n                  <Input\n                    placeholder=\"Brief description of this agent\"\n                    value={formData.description}\n                    onChange={(e) => setFormData((prev) => ({ ...prev, description: e.target.value }))}\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>System Prompt</Label>\n                  <Textarea\n                    className=\"min-h-[150px] font-mono text-sm\"\n                    placeholder=\"You are a helpful assistant...\"\n                    value={formData.systemPrompt}\n                    onChange={(e) => setFormData((prev) => ({ ...prev, systemPrompt: e.target.value }))}\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Temperature: {formData.temperature}</Label>\n                  <Slider\n                    value={[formData.temperature]}\n                    min={0}\n                    max={1}\n                    step={0.1}\n                    onValueChange={([value]) => setFormData((prev) => ({ ...prev, temperature: value }))}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Lower values make responses more focused, higher values more creative.\n                  </p>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => { setDialogOpen(false); resetForm(); }}>\n                  Cancel\n                </Button>\n                <Button onClick={handleSubmit}>\n                  {editingAgent ? \"Update Agent\" : \"Create Agent\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Bot className=\"h-5 w-5\" />\n              Active Agents\n            </CardTitle>\n            <CardDescription>\n              Your AI agents that can respond to WhatsApp messages automatically\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <RefreshCw className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              </div>\n            ) : agents.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Bot className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No agents created yet. Click \"New Agent\" to get started.</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Model</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {agents.map((agent) => (\n                    <TableRow key={agent.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-2\">\n                          <Bot className=\"h-4 w-4 text-primary\" />\n                          {agent.name}\n                        </div>\n                      </TableCell>\n                      <TableCell>{getModelDisplayName(agent.model)}</TableCell>\n                      <TableCell className=\"max-w-[200px] truncate\">\n                        {agent.description || \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Switch\n                            checked={agent.isActive}\n                            onCheckedChange={() => toggleAgent(agent)}\n                          />\n                          <Badge variant={agent.isActive ? \"default\" : \"secondary\"}>\n                            {agent.isActive ? \"Active\" : \"Inactive\"}\n                          </Badge>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right space-x-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => {\n                            setTestingAgent(agent);\n                            setTestDialogOpen(true);\n                            setTestMessage(\"\");\n                            setTestResponse(\"\");\n                          }}\n                        >\n                          <Play className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => openEditDialog(agent)}>\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-destructive\"\n                          onClick={() => deleteAgent(agent.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={testDialogOpen} onOpenChange={setTestDialogOpen}>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Test Agent: {testingAgent?.name}</DialogTitle>\n              <DialogDescription>\n                Send a test message to see how this agent responds.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"bg-muted/50 rounded-lg p-4 min-h-[150px] max-h-[300px] overflow-auto\">\n                {testResponse ? (\n                  <div className=\"flex gap-2\">\n                    <div className=\"h-8 w-8 rounded-full bg-primary flex items-center justify-center text-primary-foreground shrink-0\">\n                      <Bot className=\"h-5 w-5\" />\n                    </div>\n                    <div className=\"bg-white p-3 rounded-lg rounded-tl-none shadow-sm text-sm whitespace-pre-wrap\">\n                      {testResponse}\n                    </div>\n                  </div>\n                ) : (\n                  <p className=\"text-muted-foreground text-center py-8\">\n                    Send a message to see the agent's response\n                  </p>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Type a test message...\"\n                  value={testMessage}\n                  onChange={(e) => setTestMessage(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && testAgent()}\n                />\n                <Button onClick={testAgent} disabled={testing || !testMessage}>\n                  {testing ? <RefreshCw className=\"h-4 w-4 animate-spin\" /> : <Play className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":16307,"size_tokens":null},"WhatsappBusinessDashboard/server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":993,"size_tokens":null},"WhatsappBusinessDashboard/client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"server/modules/mapping/mapping.controller.ts":{"content":"import { Request, Response } from 'express';\nimport * as mappingService from './mapping.service';\n\nexport async function listMappings(req: Request, res: Response) {\n  try {\n    const mappings = await mappingService.getAllMappings();\n    res.json(mappings);\n  } catch (error) {\n    console.error('Error listing mappings:', error);\n    res.status(500).json({ error: 'Failed to list mappings' });\n  }\n}\n\nexport async function getMapping(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const mapping = await mappingService.getMappingById(id);\n    if (!mapping) {\n      return res.status(404).json({ error: 'Mapping not found' });\n    }\n    res.json(mapping);\n  } catch (error) {\n    console.error('Error getting mapping:', error);\n    res.status(500).json({ error: 'Failed to get mapping' });\n  }\n}\n\nexport async function getMappingByForm(req: Request, res: Response) {\n  try {\n    const { formId } = req.params;\n    const mapping = await mappingService.getMappingByFormId(formId);\n    if (!mapping) {\n      return res.status(404).json({ error: 'No mapping found for this form' });\n    }\n    res.json(mapping);\n  } catch (error) {\n    console.error('Error getting mapping by form:', error);\n    res.status(500).json({ error: 'Failed to get mapping' });\n  }\n}\n\nexport async function createMapping(req: Request, res: Response) {\n  try {\n    const { formId, formName, agentId, agentName, isActive } = req.body;\n    \n    if (!formId || !agentId) {\n      return res.status(400).json({ error: 'Form ID and Agent ID are required' });\n    }\n\n    const mapping = await mappingService.createMapping({\n      formId,\n      formName: formName || 'Unknown Form',\n      agentId,\n      agentName: agentName || 'Unknown Agent',\n      isActive: isActive ?? true,\n    });\n\n    res.status(201).json(mapping);\n  } catch (error) {\n    console.error('Error creating mapping:', error);\n    res.status(500).json({ error: 'Failed to create mapping' });\n  }\n}\n\nexport async function updateMapping(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const updates = req.body;\n\n    const mapping = await mappingService.updateMapping(id, updates);\n    if (!mapping) {\n      return res.status(404).json({ error: 'Mapping not found' });\n    }\n\n    res.json(mapping);\n  } catch (error) {\n    console.error('Error updating mapping:', error);\n    res.status(500).json({ error: 'Failed to update mapping' });\n  }\n}\n\nexport async function deleteMapping(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    const deleted = await mappingService.deleteMapping(id);\n    \n    if (!deleted) {\n      return res.status(404).json({ error: 'Mapping not found' });\n    }\n\n    res.json({ success: true, message: 'Mapping deleted successfully' });\n  } catch (error) {\n    console.error('Error deleting mapping:', error);\n    res.status(500).json({ error: 'Failed to delete mapping' });\n  }\n}\n","path":null,"size_bytes":2907,"size_tokens":null},"client/src/pages/reports/BroadcastReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Search, \n  Download, \n  RefreshCw, \n  MessageSquare, \n  CheckCircle, \n  XCircle, \n  Clock, \n  Reply,\n  ChevronRight,\n  ChevronDown,\n  Users,\n  TrendingUp\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface BroadcastLog {\n  id: string;\n  campaignName: string;\n  contactName: string;\n  contactPhone: string;\n  messageType: 'template' | 'custom' | 'ai_agent';\n  templateName?: string;\n  message?: string;\n  status: 'sent' | 'delivered' | 'failed' | 'pending';\n  messageId?: string;\n  error?: string;\n  timestamp: string;\n  replied?: boolean;\n  repliedAt?: string;\n}\n\ninterface CampaignSummary {\n  campaignName: string;\n  totalContacts: number;\n  sent: number;\n  delivered: number;\n  failed: number;\n  pending: number;\n  replied: number;\n  replyRate: number;\n  deliveryRate: number;\n  lastSent: string;\n  logs: BroadcastLog[];\n}\n\nexport default function BroadcastReports() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [expandedCampaign, setExpandedCampaign] = useState<string | null>(null);\n\n  const { data: logs = [], isLoading, refetch } = useQuery<BroadcastLog[]>({\n    queryKey: [\"/api/broadcast/logs\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/broadcast/logs?limit=1000\");\n      if (!res.ok) throw new Error(\"Failed to fetch broadcast logs\");\n      return res.json();\n    },\n    refetchInterval: 60000,\n    staleTime: 30000,\n  });\n\n  // Group logs by campaign\n  const campaigns: CampaignSummary[] = Object.values(\n    logs.reduce((acc, log) => {\n      const key = log.campaignName;\n      if (!acc[key]) {\n        acc[key] = {\n          campaignName: log.campaignName,\n          totalContacts: 0,\n          sent: 0,\n          delivered: 0,\n          failed: 0,\n          pending: 0,\n          replied: 0,\n          replyRate: 0,\n          deliveryRate: 0,\n          lastSent: log.timestamp,\n          logs: [],\n        };\n      }\n\n      acc[key].totalContacts++;\n      acc[key].logs.push(log);\n\n      if (log.status === 'sent') acc[key].sent++;\n      if (log.status === 'delivered') acc[key].delivered++;\n      if (log.status === 'failed') acc[key].failed++;\n      if (log.status === 'pending') acc[key].pending++;\n      if (log.replied) acc[key].replied++;\n\n      // Update lastSent to most recent\n      if (new Date(log.timestamp) > new Date(acc[key].lastSent)) {\n        acc[key].lastSent = log.timestamp;\n      }\n\n      return acc;\n    }, {} as Record<string, CampaignSummary>)\n  ).map(campaign => ({\n    ...campaign,\n    replyRate: campaign.totalContacts > 0 \n      ? Math.round((campaign.replied / campaign.totalContacts) * 100) \n      : 0,\n    deliveryRate: campaign.totalContacts > 0\n      ? Math.round(((campaign.sent + campaign.delivered) / campaign.totalContacts) * 100)\n      : 0,\n  })).sort((a, b) => new Date(b.lastSent).getTime() - new Date(a.lastSent).getTime());\n\n  const filteredCampaigns = campaigns.filter(campaign => \n    searchQuery === \"\" || \n    campaign.campaignName.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const overallStats = {\n    totalCampaigns: campaigns.length,\n    totalMessages: logs.length,\n    totalSent: logs.filter(l => l.status === 'sent').length,\n    totalDelivered: logs.filter(l => l.status === 'delivered').length,\n    totalFailed: logs.filter(l => l.status === 'failed').length,\n    totalReplied: logs.filter(l => l.replied).length,\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'sent':\n        return <Badge variant=\"default\" className=\"bg-blue-500\"><CheckCircle className=\"h-3 w-3 mr-1\" />Sent</Badge>;\n      case 'delivered':\n        return <Badge variant=\"default\" className=\"bg-green-500\"><CheckCircle className=\"h-3 w-3 mr-1\" />Delivered</Badge>;\n      case 'failed':\n        return <Badge variant=\"destructive\"><XCircle className=\"h-3 w-3 mr-1\" />Failed</Badge>;\n      case 'pending':\n        return <Badge variant=\"secondary\"><Clock className=\"h-3 w-3 mr-1\" />Pending</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const handleExportCampaignCSV = (campaign: CampaignSummary) => {\n    const headers = ['Timestamp', 'Contact Name', 'Phone', 'Type', 'Template', 'Status', 'Replied', 'Replied At', 'Message ID', 'Error'];\n    const csvContent = [\n      headers.join(','),\n      ...campaign.logs.map(log => [\n        format(new Date(log.timestamp), 'yyyy-MM-dd HH:mm:ss'),\n        `\"${log.contactName}\"`,\n        log.contactPhone,\n        log.messageType,\n        log.templateName || '',\n        log.status,\n        log.replied ? 'Yes' : 'No',\n        log.repliedAt ? format(new Date(log.repliedAt), 'yyyy-MM-dd HH:mm:ss') : '',\n        log.messageId || '',\n        `\"${log.error || ''}\"`,\n      ].join(','))\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${campaign.campaignName.replace(/[^a-z0-9]/gi, '_')}-${format(new Date(), 'yyyyMMdd-HHmmss')}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const handleExportAllCSV = () => {\n    const headers = ['Campaign', 'Timestamp', 'Contact Name', 'Phone', 'Type', 'Template', 'Status', 'Replied', 'Replied At', 'Message ID', 'Error'];\n    const csvContent = [\n      headers.join(','),\n      ...logs.map(log => [\n        `\"${log.campaignName}\"`,\n        format(new Date(log.timestamp), 'yyyy-MM-dd HH:mm:ss'),\n        `\"${log.contactName}\"`,\n        log.contactPhone,\n        log.messageType,\n        log.templateName || '',\n        log.status,\n        log.replied ? 'Yes' : 'No',\n        log.repliedAt ? format(new Date(log.repliedAt), 'yyyy-MM-dd HH:mm:ss') : '',\n        log.messageId || '',\n        `\"${log.error || ''}\"`,\n      ].join(','))\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `all-broadcasts-${format(new Date(), 'yyyyMMdd-HHmmss')}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight\">Broadcast Reports</h2>\n            <p className=\"text-muted-foreground\">Campaign-wise analysis of your broadcast messages.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={() => refetch()}>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Refresh\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportAllCSV}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export All\n            </Button>\n          </div>\n        </div>\n\n        {/* Overall Stats */}\n        <div className=\"grid gap-4 md:grid-cols-6\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Campaigns</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{overallStats.totalCampaigns}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Messages</CardTitle>\n              <MessageSquare className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{overallStats.totalMessages}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Read</CardTitle>\n              <CheckCircle className=\"h-4 w-4 text-blue-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-blue-600\">{overallStats.totalSent}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Delivered</CardTitle>\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">{overallStats.totalDelivered}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Replied</CardTitle>\n              <Reply className=\"h-4 w-4 text-purple-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-purple-600\">{overallStats.totalReplied}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Failed</CardTitle>\n              <XCircle className=\"h-4 w-4 text-red-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-600\">{overallStats.totalFailed}</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Search className=\"h-5 w-5\" />\n              Search Campaigns\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by campaign name...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Campaign List */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Campaigns ({filteredCampaigns.length})</CardTitle>\n            <CardDescription>Click on a campaign to view detailed message logs</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex justify-center py-8\">\n                <RefreshCw className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredCampaigns.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No campaigns found.</p>\n                <p className=\"text-sm\">Send your first broadcast to see campaigns here.</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {filteredCampaigns.map((campaign) => (\n                  <div key={campaign.campaignName} className=\"border rounded-lg overflow-hidden\">\n                    {/* Campaign Header */}\n                    <div \n                      className=\"p-4 bg-muted/30 hover:bg-muted/50 cursor-pointer flex items-center justify-between\"\n                      onClick={() => setExpandedCampaign(\n                        expandedCampaign === campaign.campaignName ? null : campaign.campaignName\n                      )}\n                    >\n                      <div className=\"flex items-center gap-4 flex-1\">\n                        {expandedCampaign === campaign.campaignName ? (\n                          <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n                        ) : (\n                          <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n                        )}\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-semibold text-lg\">{campaign.campaignName}</h3>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Last sent: {format(new Date(campaign.lastSent), 'MMM d, yyyy HH:mm')}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-center gap-6\">\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-muted-foreground\">Contacts</div>\n                          <div className=\"text-xl font-bold flex items-center gap-1\">\n                            <Users className=\"h-4 w-4\" />\n                            {campaign.totalContacts}\n                          </div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-muted-foreground\">Delivered</div>\n                          <div className=\"text-xl font-bold text-green-600\">{campaign.deliveryRate}%</div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-muted-foreground\">Replied</div>\n                          <div className=\"text-xl font-bold text-purple-600 flex items-center gap-1\">\n                            <Reply className=\"h-4 w-4\" />\n                            {campaign.replied} ({campaign.replyRate}%)\n                          </div>\n                        </div>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleExportCampaignCSV(campaign);\n                          }}\n                        >\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Campaign Details (Expanded) */}\n                    {expandedCampaign === campaign.campaignName && (\n                      <div className=\"p-4 border-t\">\n                        {/* Stats Row */}\n                        <div className=\"grid grid-cols-5 gap-4 mb-4 p-3 bg-muted/20 rounded-lg\">\n                          <div className=\"text-center\">\n                            <div className=\"text-sm text-muted-foreground\">Read</div>\n                            <div className=\"text-lg font-bold text-blue-600\">{campaign.sent}</div>\n                          </div>\n                          <div className=\"text-center\">\n                            <div className=\"text-sm text-muted-foreground\">Delivered</div>\n                            <div className=\"text-lg font-bold text-green-600\">{campaign.delivered}</div>\n                          </div>\n                          <div className=\"text-center\">\n                            <div className=\"text-sm text-muted-foreground\">Failed</div>\n                            <div className=\"text-lg font-bold text-red-600\">{campaign.failed}</div>\n                          </div>\n                          <div className=\"text-center\">\n                            <div className=\"text-sm text-muted-foreground\">Pending</div>\n                            <div className=\"text-lg font-bold text-gray-600\">{campaign.pending}</div>\n                          </div>\n                          <div className=\"text-center\">\n                            <div className=\"text-sm text-muted-foreground\">Replied</div>\n                            <div className=\"text-lg font-bold text-purple-600\">{campaign.replied}</div>\n                          </div>\n                        </div>\n\n                        {/* Contact Details Table */}\n                        <div className=\"border rounded-lg overflow-hidden\">\n                          <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                              <thead className=\"bg-muted/50\">\n                                <tr>\n                                  <th className=\"px-4 py-2 text-left text-sm font-medium\">Contact</th>\n                                  <th className=\"px-4 py-2 text-left text-sm font-medium\">Phone</th>\n                                  <th className=\"px-4 py-2 text-left text-sm font-medium\">Status</th>\n                                  <th className=\"px-4 py-2 text-left text-sm font-medium\">Replied</th>\n                                  <th className=\"px-4 py-2 text-left text-sm font-medium\">Timestamp</th>\n                                </tr>\n                              </thead>\n                              <tbody className=\"divide-y\">\n                                {campaign.logs.map((log) => (\n                                  <tr key={log.id} className=\"hover:bg-muted/20\">\n                                    <td className=\"px-4 py-2 text-sm font-medium\">{log.contactName}</td>\n                                    <td className=\"px-4 py-2 text-sm text-muted-foreground\">{log.contactPhone}</td>\n                                    <td className=\"px-4 py-2\">{getStatusBadge(log.status)}</td>\n                                    <td className=\"px-4 py-2\">\n                                      {log.replied ? (\n                                        <div>\n                                          <Badge variant=\"default\" className=\"bg-purple-500\">\n                                            <Reply className=\"h-3 w-3 mr-1\" />\n                                            Yes\n                                          </Badge>\n                                          {log.repliedAt && (\n                                            <div className=\"text-xs text-muted-foreground mt-1\">\n                                              {format(new Date(log.repliedAt), 'MMM d, HH:mm')}\n                                            </div>\n                                          )}\n                                        </div>\n                                      ) : (\n                                        <Badge variant=\"outline\" className=\"text-muted-foreground\">No</Badge>\n                                      )}\n                                    </td>\n                                    <td className=\"px-4 py-2 text-sm text-muted-foreground\">\n                                      {format(new Date(log.timestamp), 'MMM d, HH:mm')}\n                                    </td>\n                                  </tr>\n                                ))}\n                              </tbody>\n                            </table>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","path":null,"size_bytes":19591,"size_tokens":null},"server/modules/storage/mongodb.adapter.ts":{"content":"import mongoose, { Schema, Document, Model } from 'mongoose';\n\nlet isConnected = false;\n\nexport async function connectToMongoDB(): Promise<void> {\n  if (isConnected) return;\n\n  const mongoUrl = process.env.MONGODB_URL;\n  if (!mongoUrl) {\n    console.error('[MongoDB] MONGODB_URL not configured');\n    return;\n  }\n\n  try {\n    await mongoose.connect(mongoUrl, {\n      dbName: 'whatsapp_dashboard',\n    });\n    isConnected = true;\n    console.log('[MongoDB] Connected successfully');\n  } catch (error) {\n    console.error('[MongoDB] Connection error:', error);\n  }\n}\n\nconst AgentSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  description: { type: String, default: '' },\n  systemPrompt: { type: String, default: '' },\n  instructions: { type: String, default: '' },\n  welcomeMessage: { type: String, default: '' },\n  model: { type: String, default: 'gpt-4o' },\n  temperature: { type: Number, default: 0.7 },\n  maxTokens: { type: Number, default: 500 },\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'agents' });\n\nconst FormSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  fbFormId: { type: String, required: true },\n  name: { type: String, required: true },\n  status: { type: String, default: 'active' },\n  pageId: { type: String },\n  pageName: { type: String },\n  leadCount: { type: Number, default: 0 },\n  createdTime: { type: String },\n  createdAt: { type: String },\n  syncedAt: { type: String, required: true },\n}, { collection: 'forms' });\n\nconst LeadSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  fbLeadId: { type: String },\n  formId: { type: String, required: true },\n  formName: { type: String },\n  name: { type: String, default: '' },\n  email: { type: String, default: '' },\n  phone: { type: String, default: '' },\n  fieldData: { type: Schema.Types.Mixed, default: {} },\n  createdTime: { type: String },\n  createdAt: { type: String },\n  syncedAt: { type: String },\n  autoReplySent: { type: Boolean, default: false },\n  autoReplyMessage: { type: String },\n  autoReplySentAt: { type: String },\n}, { collection: 'leads' });\n\nconst MappingSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  formId: { type: String, required: true },\n  formName: { type: String },\n  agentId: { type: String, required: true },\n  agentName: { type: String },\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'mappings' });\n\nconst QualificationSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true },\n  contactName: { type: String },\n  contactPhone: { type: String },\n  category: { type: String, enum: ['interested', 'not_interested', 'pending'], default: 'pending' },\n  source: { type: String, enum: ['ai_chat', 'campaign', 'ad', 'lead_form', 'manual'], default: 'ai_chat' },\n  campaignId: { type: String },\n  campaignName: { type: String },\n  agentId: { type: String },\n  agentName: { type: String },\n  messageCount: { type: Number, default: 0 },\n  lastMessage: { type: String },\n  keywords: { type: [String], default: [] },\n  notes: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'ai_qualifications' });\n\nconst BroadcastListSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  contacts: [{\n    name: { type: String },\n    phone: { type: String },\n    email: { type: String },\n    tags: { type: [String] },\n  }],\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'broadcast_lists' });\n\nconst ScheduledMessageSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  messageType: { type: String, enum: ['template', 'custom', 'ai_agent'], required: true },\n  templateName: { type: String },\n  customMessage: { type: String },\n  agentId: { type: String },\n  contactIds: { type: [String] },\n  listId: { type: String },\n  scheduledAt: { type: String, required: true },\n  status: { type: String, enum: ['scheduled', 'sent', 'failed', 'cancelled'], default: 'scheduled' },\n  recipientCount: { type: Number, default: 0 },\n  sentCount: { type: Number, default: 0 },\n  failedCount: { type: Number, default: 0 },\n  createdAt: { type: String, required: true },\n}, { collection: 'scheduled_messages' });\n\nconst BroadcastLogSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  campaignName: { type: String, required: true },\n  contactName: { type: String, required: true },\n  contactPhone: { type: String, required: true },\n  messageType: { type: String, enum: ['template', 'custom', 'ai_agent'], required: true },\n  templateName: { type: String },\n  message: { type: String },\n  status: { type: String, enum: ['sent', 'delivered', 'failed', 'pending'], default: 'pending' },\n  messageId: { type: String },\n  error: { type: String },\n  timestamp: { type: String, required: true },\n  replied: { type: Boolean, default: false },\n  repliedAt: { type: String },\n}, { collection: 'broadcast_logs' });\n\nconst ImportedContactSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  phone: { type: String, required: true },\n  email: { type: String, default: '' },\n  tags: { type: [String], default: [] },\n  source: { type: String, default: 'import' },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'imported_contacts' });\n\nconst ContactAgentSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true },\n  phone: { type: String, required: true, index: true },\n  agentId: { type: String, required: true },\n  agentName: { type: String },\n  conversationHistory: [{\n    role: { type: String, enum: ['user', 'assistant'] },\n    content: { type: String },\n    timestamp: { type: String }\n  }],\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'contact_agents' });\n\nconst ContactSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  phone: { type: String, required: true, index: true },\n  email: { type: String, default: '' },\n  tags: { type: [String], default: [] },\n  notes: { type: String, default: '' },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'contacts' });\n\nconst MessageSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true, index: true },\n  content: { type: String, required: true },\n  type: { type: String, default: 'text' },\n  direction: { type: String, enum: ['inbound', 'outbound'], required: true },\n  status: { type: String, default: 'sent' },\n  timestamp: { type: String, required: true },\n  agentId: { type: String },\n  replyToMessageId: { type: String },\n  replyToContent: { type: String },\n  mediaUrl: { type: String },\n  whatsappMessageId: { type: String, index: true },\n}, { collection: 'messages' });\n\nconst ChatSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true, unique: true, index: true },\n  lastMessage: { type: String },\n  lastMessageTime: { type: String },\n  lastInboundMessageTime: { type: String },\n  lastInboundMessage: { type: String },\n  unreadCount: { type: Number, default: 0 },\n  status: { type: String, enum: ['open', 'closed'], default: 'open' },\n  notes: { type: [String], default: [] },\n}, { collection: 'chats' });\n\nconst CampaignSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  message: { type: String },\n  contactIds: { type: [String], default: [] },\n  status: { type: String, default: 'draft' },\n  scheduledAt: { type: String },\n  sentCount: { type: Number, default: 0 },\n  deliveredCount: { type: Number, default: 0 },\n  readCount: { type: Number, default: 0 },\n  repliedCount: { type: Number, default: 0 },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'campaigns' });\n\nconst TemplateSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  category: { type: String, default: 'utility' },\n  content: { type: String, required: true },\n  variables: { type: [String], default: [] },\n  status: { type: String, default: 'pending' },\n  language: { type: String, default: 'en' },\n  metaTemplateId: { type: String },\n  metaStatus: { type: String },\n  rejectionReason: { type: String },\n  lastSyncedAt: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'templates' });\n\nconst AutomationSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  type: { type: String, required: true },\n  trigger: { type: String, required: true },\n  message: { type: String },\n  delay: { type: Number },\n  delayUnit: { type: String },\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'automations' });\n\nconst UserSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  username: { type: String, required: true, unique: true },\n  password: { type: String, required: true },\n  name: { type: String, required: true },\n  email: { type: String },\n  role: { type: String, default: 'user' },\n  createdAt: { type: String, required: true },\n}, { collection: 'users' });\n\nconst TeamMemberSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  userId: { type: String, required: true },\n  name: { type: String, required: true },\n  email: { type: String },\n  role: { type: String, default: 'agent' },\n  permissions: { type: [String], default: [] },\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n}, { collection: 'team_members' });\n\nconst WhatsappSettingsSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  phoneNumberId: { type: String },\n  businessAccountId: { type: String },\n  accessToken: { type: String },\n  webhookVerifyToken: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'whatsapp_settings' });\n\nconst BillingSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  credits: { type: Number, default: 0 },\n  transactions: [{\n    id: { type: String },\n    type: { type: String, enum: ['purchase', 'usage'] },\n    amount: { type: Number },\n    description: { type: String },\n    createdAt: { type: String },\n  }],\n}, { collection: 'billing' });\n\nconst PrefilledTextMappingSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  prefilledText: { type: String, required: true },\n  agentId: { type: String, required: true },\n  agentName: { type: String },\n  isActive: { type: Boolean, default: true },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'prefilled_text_mappings' });\n\nconst ScheduledBroadcastSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contacts: [{\n    name: { type: String },\n    phone: { type: String },\n    email: { type: String },\n    tags: { type: [String] },\n  }],\n  messageType: { type: String, enum: ['template', 'custom', 'ai_agent'], required: true },\n  templateName: { type: String },\n  customMessage: { type: String },\n  agentId: { type: String },\n  campaignName: { type: String, required: true },\n  scheduledAt: { type: String, required: true },\n  status: { type: String, enum: ['scheduled', 'sending', 'sent', 'failed', 'cancelled'], default: 'scheduled' },\n  createdAt: { type: String, required: true },\n  sentCount: { type: Number, default: 0 },\n  failedCount: { type: Number, default: 0 },\n}, { collection: 'scheduled_broadcasts' });\n\nconst BlockedContactSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  userId: { type: String, required: true, index: true },\n  phone: { type: String, required: true, index: true },\n  name: { type: String, default: '' },\n  reason: { type: String, default: '' },\n  blockedAt: { type: String, required: true },\n  isActive: { type: Boolean, default: true },\n}, { collection: 'blocked_contacts' });\n\nBlockedContactSchema.index({ userId: 1, phone: 1 }, { unique: true });\n\nconst UserCredentialsSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  userId: { type: String, required: true, unique: true, index: true },\n  whatsappToken: { type: String },\n  phoneNumberId: { type: String },\n  businessAccountId: { type: String },\n  webhookVerifyToken: { type: String },\n  appId: { type: String },\n  appSecret: { type: String },\n  openaiApiKey: { type: String },\n  geminiApiKey: { type: String },\n  facebookAccessToken: { type: String },\n  facebookPageId: { type: String },\n  isVerified: { type: Boolean, default: false },\n  lastVerifiedAt: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'user_credentials' });\n\nconst ContactAnalyticsSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true },\n  phone: { type: String, required: true, index: true },\n  contactName: { type: String, default: '' },\n  interestLevel: { type: String, enum: ['highly_interested', 'interested', 'neutral', 'not_interested', 'pending'], default: 'pending' },\n  interestScore: { type: Number, default: 0 },\n  interestReason: { type: String, default: '' },\n  totalMessages: { type: Number, default: 0 },\n  inboundMessages: { type: Number, default: 0 },\n  outboundMessages: { type: Number, default: 0 },\n  keyTopics: { type: [String], default: [] },\n  objections: { type: [String], default: [] },\n  positiveSignals: { type: [String], default: [] },\n  negativeSignals: { type: [String], default: [] },\n  firstContactTime: { type: String },\n  lastContactTime: { type: String },\n  conversationDuration: { type: Number, default: 0 },\n  aiAgentInteractions: [{\n    agentId: String,\n    agentName: String,\n    messagesCount: Number,\n    firstInteraction: String,\n    lastInteraction: String,\n    durationMinutes: Number,\n  }],\n  lastAnalyzedAt: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'contact_analytics' });\n\nconst LeadAssignmentSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  contactId: { type: String, required: true, index: true },\n  chatId: { type: String, index: true },\n  phone: { type: String, required: true, index: true },\n  contactName: { type: String, default: '' },\n  assignedToUserId: { type: String, required: true, index: true },\n  assignedToUserName: { type: String, default: '' },\n  assignedByUserId: { type: String, required: true },\n  assignedByUserName: { type: String, default: '' },\n  status: { type: String, enum: ['assigned', 'in_progress', 'completed', 'reassigned', 'unassigned'], default: 'assigned' },\n  priority: { type: String, enum: ['low', 'medium', 'high', 'urgent'], default: 'medium' },\n  notes: { type: String, default: '' },\n  previousAssignments: [{\n    userId: String,\n    userName: String,\n    assignedAt: String,\n    unassignedAt: String,\n    reason: String\n  }],\n  slaDeadline: { type: String },\n  firstResponseAt: { type: String },\n  resolvedAt: { type: String },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'lead_assignments' });\n\nLeadAssignmentSchema.index({ assignedToUserId: 1, status: 1 });\nLeadAssignmentSchema.index({ contactId: 1, assignedToUserId: 1 });\n\nconst TeamHierarchySchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  managerId: { type: String, required: true, unique: true, index: true },\n  managerName: { type: String, default: '' },\n  teamMembers: [{\n    userId: String,\n    userName: String,\n    addedAt: String\n  }],\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'team_hierarchy' });\n\nconst ActivityLogSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  userId: { type: String, required: true, index: true },\n  userName: { type: String, default: '' },\n  userRole: { type: String, default: '' },\n  actionType: { type: String, enum: ['message_sent', 'message_received', 'lead_assigned', 'lead_reassigned', 'lead_completed', 'lead_viewed', 'login', 'logout'], required: true },\n  contactId: { type: String, index: true },\n  contactPhone: { type: String },\n  contactName: { type: String },\n  leadAssignmentId: { type: String },\n  metadata: { type: Schema.Types.Mixed, default: {} },\n  timestamp: { type: String, required: true },\n}, { collection: 'activity_logs' });\n\nActivityLogSchema.index({ userId: 1, timestamp: -1 });\nActivityLogSchema.index({ actionType: 1, timestamp: -1 });\n\nconst UserActivityStatsSchema = new Schema({\n  id: { type: String, required: true, unique: true },\n  userId: { type: String, required: true, index: true },\n  userName: { type: String, default: '' },\n  date: { type: String, required: true, index: true },\n  messagesSent: { type: Number, default: 0 },\n  messagesReceived: { type: Number, default: 0 },\n  leadsAssigned: { type: Number, default: 0 },\n  leadsCompleted: { type: Number, default: 0 },\n  leadsInProgress: { type: Number, default: 0 },\n  avgResponseTimeMinutes: { type: Number, default: 0 },\n  totalResponseTimeMinutes: { type: Number, default: 0 },\n  responseCount: { type: Number, default: 0 },\n  activeHours: { type: [Number], default: [] },\n  createdAt: { type: String, required: true },\n  updatedAt: { type: String, required: true },\n}, { collection: 'user_activity_stats' });\n\nUserActivityStatsSchema.index({ userId: 1, date: -1 });\n\nexport const Agent = mongoose.models.Agent || mongoose.model('Agent', AgentSchema);\nexport const Form = mongoose.models.Form || mongoose.model('Form', FormSchema);\nexport const Lead = mongoose.models.Lead || mongoose.model('Lead', LeadSchema);\nexport const Mapping = mongoose.models.Mapping || mongoose.model('Mapping', MappingSchema);\nexport const Qualification = mongoose.models.Qualification || mongoose.model('Qualification', QualificationSchema);\nexport const BroadcastList = mongoose.models.BroadcastList || mongoose.model('BroadcastList', BroadcastListSchema);\nexport const ScheduledMessage = mongoose.models.ScheduledMessage || mongoose.model('ScheduledMessage', ScheduledMessageSchema);\nexport const BroadcastLog = mongoose.models.BroadcastLog || mongoose.model('BroadcastLog', BroadcastLogSchema);\nexport const ImportedContact = mongoose.models.ImportedContact || mongoose.model('ImportedContact', ImportedContactSchema);\nexport const ContactAgent = mongoose.models.ContactAgent || mongoose.model('ContactAgent', ContactAgentSchema);\nexport const Contact = mongoose.models.Contact || mongoose.model('Contact', ContactSchema);\nexport const Message = mongoose.models.Message || mongoose.model('Message', MessageSchema);\nexport const Chat = mongoose.models.Chat || mongoose.model('Chat', ChatSchema);\nexport const Campaign = mongoose.models.Campaign || mongoose.model('Campaign', CampaignSchema);\nexport const Template = mongoose.models.Template || mongoose.model('Template', TemplateSchema);\nexport const Automation = mongoose.models.Automation || mongoose.model('Automation', AutomationSchema);\nexport const User = mongoose.models.User || mongoose.model('User', UserSchema);\nexport const TeamMember = mongoose.models.TeamMember || mongoose.model('TeamMember', TeamMemberSchema);\nexport const WhatsappSettings = mongoose.models.WhatsappSettings || mongoose.model('WhatsappSettings', WhatsappSettingsSchema);\nexport const Billing = mongoose.models.Billing || mongoose.model('Billing', BillingSchema);\nexport const PrefilledTextMapping = mongoose.models.PrefilledTextMapping || mongoose.model('PrefilledTextMapping', PrefilledTextMappingSchema);\nexport const ScheduledBroadcast = mongoose.models.ScheduledBroadcast || mongoose.model('ScheduledBroadcast', ScheduledBroadcastSchema);\nexport const BlockedContact = mongoose.models.BlockedContact || mongoose.model('BlockedContact', BlockedContactSchema);\nexport const UserCredentials = mongoose.models.UserCredentials || mongoose.model('UserCredentials', UserCredentialsSchema);\nexport const ContactAnalytics = mongoose.models.ContactAnalytics || mongoose.model('ContactAnalytics', ContactAnalyticsSchema);\nexport const LeadAssignment = mongoose.models.LeadAssignment || mongoose.model('LeadAssignment', LeadAssignmentSchema);\nexport const TeamHierarchy = mongoose.models.TeamHierarchy || mongoose.model('TeamHierarchy', TeamHierarchySchema);\nexport const ActivityLog = mongoose.models.ActivityLog || mongoose.model('ActivityLog', ActivityLogSchema);\nexport const UserActivityStats = mongoose.models.UserActivityStats || mongoose.model('UserActivityStats', UserActivityStatsSchema);\n\nconst modelMap: Record<string, Model<any>> = {\n  agents: Agent,\n  forms: Form,\n  leads: Lead,\n  mapping: Mapping,\n  ai_qualifications: Qualification,\n  broadcast_lists: BroadcastList,\n  scheduled_messages: ScheduledMessage,\n  broadcast_logs: BroadcastLog,\n  imported_contacts: ImportedContact,\n  contact_agents: ContactAgent,\n  contacts: Contact,\n  messages: Message,\n  chats: Chat,\n  campaigns: Campaign,\n  templates: Template,\n  automations: Automation,\n  users: User,\n  team_members: TeamMember,\n  whatsapp_settings: WhatsappSettings,\n  billing: Billing,\n  prefilled_text_mappings: PrefilledTextMapping,\n  scheduled_broadcasts: ScheduledBroadcast,\n  blocked_contacts: BlockedContact,\n  user_credentials: UserCredentials,\n  contact_analytics: ContactAnalytics,\n  lead_assignments: LeadAssignment,\n  team_hierarchy: TeamHierarchy,\n  activity_logs: ActivityLog,\n  user_activity_stats: UserActivityStats,\n};\n\nexport async function readCollection<T>(collectionName: string): Promise<T[]> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return [];\n  }\n  try {\n    const docs = await model.find({}).lean();\n    return docs as T[];\n  } catch (error) {\n    console.error(`[MongoDB] Error reading ${collectionName}:`, error);\n    return [];\n  }\n}\n\nexport async function writeCollection<T>(collectionName: string, data: T[]): Promise<void> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return;\n  }\n  try {\n    await model.deleteMany({});\n    if (data.length > 0) {\n      await model.insertMany(data);\n    }\n  } catch (error) {\n    console.error(`[MongoDB] Error writing ${collectionName}:`, error);\n  }\n}\n\nexport async function findOne<T>(collectionName: string, query: Record<string, any>): Promise<T | null> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return null;\n  }\n  try {\n    const doc = await model.findOne(query).lean();\n    return doc as T | null;\n  } catch (error) {\n    console.error(`[MongoDB] Error finding in ${collectionName}:`, error);\n    return null;\n  }\n}\n\nexport async function findMany<T>(collectionName: string, query: Record<string, any>): Promise<T[]> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return [];\n  }\n  try {\n    const docs = await model.find(query).lean();\n    return docs as T[];\n  } catch (error) {\n    console.error(`[MongoDB] Error finding in ${collectionName}:`, error);\n    return [];\n  }\n}\n\nexport async function insertOne<T extends Record<string, any>>(collectionName: string, data: T): Promise<T | null> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return null;\n  }\n  try {\n    const doc = await model.create(data);\n    return doc.toObject() as T;\n  } catch (error) {\n    console.error(`[MongoDB] Error inserting into ${collectionName}:`, error);\n    return null;\n  }\n}\n\nexport async function updateOne<T>(collectionName: string, query: Record<string, any>, update: Partial<T>): Promise<T | null> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return null;\n  }\n  try {\n    const doc = await model.findOneAndUpdate(query, { $set: update }, { new: true }).lean();\n    return doc as T | null;\n  } catch (error) {\n    console.error(`[MongoDB] Error updating in ${collectionName}:`, error);\n    return null;\n  }\n}\n\nexport async function deleteOne(collectionName: string, query: Record<string, any>): Promise<boolean> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return false;\n  }\n  try {\n    const result = await model.deleteOne(query);\n    return result.deletedCount > 0;\n  } catch (error) {\n    console.error(`[MongoDB] Error deleting from ${collectionName}:`, error);\n    return false;\n  }\n}\n\nexport async function countDocuments(collectionName: string, query: Record<string, any> = {}): Promise<number> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return 0;\n  }\n  try {\n    return await model.countDocuments(query);\n  } catch (error) {\n    console.error(`[MongoDB] Error counting in ${collectionName}:`, error);\n    return 0;\n  }\n}\n\nexport async function insertMany<T extends Record<string, any>>(collectionName: string, data: T[]): Promise<T[]> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return [];\n  }\n  try {\n    const docs = await model.insertMany(data, { ordered: false });\n    return docs.map(doc => doc.toObject()) as T[];\n  } catch (error) {\n    console.error(`[MongoDB] Error bulk inserting into ${collectionName}:`, error);\n    return [];\n  }\n}\n\nexport async function updateMany(collectionName: string, query: Record<string, any>, update: Record<string, any>): Promise<number> {\n  await connectToMongoDB();\n  const model = modelMap[collectionName];\n  if (!model) {\n    console.error(`[MongoDB] Unknown collection: ${collectionName}`);\n    return 0;\n  }\n  try {\n    const result = await model.updateMany(query, { $set: update });\n    console.log(`[MongoDB] Updated ${result.modifiedCount} documents in ${collectionName}`);\n    return result.modifiedCount;\n  } catch (error) {\n    console.error(`[MongoDB] Error updating many in ${collectionName}:`, error);\n    return 0;\n  }\n}\n","path":null,"size_bytes":27630,"size_tokens":null},"server/modules/aiAnalytics/aiAnalytics.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\n\nexport interface AIChatQualification {\n  id: string;\n  contactId: string;\n  phone: string;\n  name: string;\n  source: 'ai_chat' | 'campaign' | 'ad' | 'lead_form' | 'manual';\n  campaignId?: string;\n  campaignName?: string;\n  agentId?: string;\n  agentName?: string;\n  category: 'interested' | 'not_interested' | 'pending';\n  score: number;\n  totalMessages: number;\n  lastMessageAt: string;\n  firstContactAt: string;\n  keywords: string[];\n  notes: string;\n  aiAnalysis?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface QualificationStats {\n  total: number;\n  interested: number;\n  notInterested: number;\n  pending: number;\n  interestedPercent: number;\n  notInterestedPercent: number;\n  pendingPercent: number;\n}\n\nconst INTEREST_KEYWORDS = [\n  'interested', 'yes', 'tell me more', 'how much', 'price', 'cost', \n  'register', 'sign up', 'book', 'schedule', 'appointment', 'buy',\n  'purchase', 'order', 'want', 'need', 'looking for', 'details',\n  'more information', 'brochure', 'catalog', 'demo', 'trial',\n  'subscribe', 'join', 'apply', 'confirm', 'proceed', 'next steps'\n];\n\nconst NOT_INTERESTED_KEYWORDS = [\n  'not interested', 'no thanks', 'no thank you', 'stop', 'unsubscribe',\n  'remove', 'don\\'t contact', 'spam', 'wrong number', 'busy', 'later',\n  'not now', 'maybe later', 'not looking', 'already have', 'not for me'\n];\n\nfunction generateId(): string {\n  return 'qual_' + Date.now().toString(36) + Math.random().toString(36).substr(2, 9);\n}\n\nexport async function getQualifications(): Promise<AIChatQualification[]> {\n  return mongodb.readCollection<AIChatQualification>('ai_qualifications');\n}\n\nexport async function getQualificationById(id: string): Promise<AIChatQualification | undefined> {\n  const result = await mongodb.findOne<AIChatQualification>('ai_qualifications', { id });\n  return result || undefined;\n}\n\nexport async function getQualificationByPhone(phone: string): Promise<AIChatQualification | undefined> {\n  if (!phone) return undefined;\n  \n  const qualifications = await getQualifications();\n  const normalizedPhone = (phone || '').replace(/\\D/g, '');\n  \n  if (!normalizedPhone) return undefined;\n  \n  return qualifications.find(q => {\n    const qPhone = (q.phone || '').replace(/\\D/g, '');\n    return qPhone.includes(normalizedPhone) || normalizedPhone.includes(qPhone);\n  });\n}\n\nexport async function getQualificationsByCategory(category: 'interested' | 'not_interested' | 'pending'): Promise<AIChatQualification[]> {\n  return mongodb.findMany<AIChatQualification>('ai_qualifications', { category });\n}\n\nexport async function getQualificationsBySource(source: string): Promise<AIChatQualification[]> {\n  return mongodb.findMany<AIChatQualification>('ai_qualifications', { source });\n}\n\nexport async function getQualificationsByCampaign(campaignId: string): Promise<AIChatQualification[]> {\n  return mongodb.findMany<AIChatQualification>('ai_qualifications', { campaignId });\n}\n\nexport async function getQualificationsByAgent(agentId: string): Promise<AIChatQualification[]> {\n  return mongodb.findMany<AIChatQualification>('ai_qualifications', { agentId });\n}\n\nexport async function getQualificationStats(): Promise<QualificationStats> {\n  const qualifications = await getQualifications();\n  const total = qualifications.length;\n  const interested = qualifications.filter(q => q.category === 'interested').length;\n  const notInterested = qualifications.filter(q => q.category === 'not_interested').length;\n  const pending = qualifications.filter(q => q.category === 'pending').length;\n  \n  return {\n    total,\n    interested,\n    notInterested,\n    pending,\n    interestedPercent: total > 0 ? Math.round((interested / total) * 100) : 0,\n    notInterestedPercent: total > 0 ? Math.round((notInterested / total) * 100) : 0,\n    pendingPercent: total > 0 ? Math.round((pending / total) * 100) : 0\n  };\n}\n\nexport function analyzeMessage(message: string): { category: 'interested' | 'not_interested' | 'pending'; score: number; keywords: string[] } {\n  if (!message) {\n    return { category: 'pending', score: 50, keywords: [] };\n  }\n  \n  const lowerMessage = (message || '').toLowerCase();\n  const foundInterestKeywords: string[] = [];\n  const foundNotInterestedKeywords: string[] = [];\n  \n  for (const keyword of INTEREST_KEYWORDS) {\n    if (lowerMessage.includes(keyword.toLowerCase())) {\n      foundInterestKeywords.push(keyword);\n    }\n  }\n  \n  for (const keyword of NOT_INTERESTED_KEYWORDS) {\n    if (lowerMessage.includes(keyword.toLowerCase())) {\n      foundNotInterestedKeywords.push(keyword);\n    }\n  }\n  \n  let score = 50;\n  let category: 'interested' | 'not_interested' | 'pending' = 'pending';\n  \n  if (foundNotInterestedKeywords.length > 0) {\n    score = Math.max(0, 50 - (foundNotInterestedKeywords.length * 20));\n    category = 'not_interested';\n  } else if (foundInterestKeywords.length > 0) {\n    score = Math.min(100, 50 + (foundInterestKeywords.length * 15));\n    category = 'interested';\n  }\n  \n  return {\n    category,\n    score,\n    keywords: [...foundInterestKeywords, ...foundNotInterestedKeywords]\n  };\n}\n\nexport async function createOrUpdateQualification(\n  phone: string,\n  name: string,\n  message: string,\n  source: 'ai_chat' | 'campaign' | 'ad' | 'lead_form' | 'manual',\n  options?: {\n    campaignId?: string;\n    campaignName?: string;\n    agentId?: string;\n    agentName?: string;\n    contactId?: string;\n  }\n): Promise<AIChatQualification> {\n  if (!phone) {\n    throw new Error('Phone is required for AI qualification tracking');\n  }\n  \n  const normalizedPhone = (phone || '').replace(/\\D/g, '');\n  const existing = await getQualificationByPhone(normalizedPhone);\n  const analysis = analyzeMessage(message || '');\n  const now = new Date().toISOString();\n  \n  if (existing) {\n    const updatedKeywords = Array.from(new Set([...existing.keywords, ...analysis.keywords]));\n    \n    let newCategory = existing.category;\n    let newScore = existing.score;\n    \n    if (analysis.category === 'interested' && analysis.score > existing.score) {\n      newCategory = 'interested';\n      newScore = analysis.score;\n    } else if (analysis.category === 'not_interested') {\n      newCategory = 'not_interested';\n      newScore = analysis.score;\n    } else if (existing.category === 'pending' && analysis.category !== 'pending') {\n      newCategory = analysis.category;\n      newScore = analysis.score;\n    }\n    \n    const updated: AIChatQualification = {\n      ...existing,\n      category: newCategory,\n      score: newScore,\n      totalMessages: existing.totalMessages + 1,\n      lastMessageAt: now,\n      keywords: updatedKeywords,\n      updatedAt: now,\n      campaignId: options?.campaignId || existing.campaignId,\n      campaignName: options?.campaignName || existing.campaignName,\n      agentId: options?.agentId || existing.agentId,\n      agentName: options?.agentName || existing.agentName,\n    };\n    \n    await mongodb.updateOne('ai_qualifications', { id: existing.id }, updated);\n    return updated;\n  } else {\n    const newQualification: AIChatQualification = {\n      id: generateId(),\n      contactId: options?.contactId || generateId(),\n      phone: normalizedPhone,\n      name: name || `+${normalizedPhone}`,\n      source,\n      campaignId: options?.campaignId,\n      campaignName: options?.campaignName,\n      agentId: options?.agentId,\n      agentName: options?.agentName,\n      category: analysis.category,\n      score: analysis.score,\n      totalMessages: 1,\n      lastMessageAt: now,\n      firstContactAt: now,\n      keywords: analysis.keywords,\n      notes: '',\n      createdAt: now,\n      updatedAt: now,\n    };\n    \n    await mongodb.insertOne('ai_qualifications', newQualification);\n    return newQualification;\n  }\n}\n\nexport async function updateQualificationCategory(\n  id: string, \n  category: 'interested' | 'not_interested' | 'pending',\n  notes?: string\n): Promise<AIChatQualification | null> {\n  const existing = await getQualificationById(id);\n  if (!existing) return null;\n  \n  const updated = {\n    ...existing,\n    category,\n    notes: notes || existing.notes,\n    updatedAt: new Date().toISOString(),\n  };\n  \n  await mongodb.updateOne('ai_qualifications', { id }, updated);\n  return updated;\n}\n\nexport async function updateQualificationNotes(id: string, notes: string): Promise<AIChatQualification | null> {\n  const existing = await getQualificationById(id);\n  if (!existing) return null;\n  \n  const updated = {\n    ...existing,\n    notes,\n    updatedAt: new Date().toISOString(),\n  };\n  \n  await mongodb.updateOne('ai_qualifications', { id }, updated);\n  return updated;\n}\n\nexport async function deleteQualification(id: string): Promise<boolean> {\n  return mongodb.deleteOne('ai_qualifications', { id });\n}\n\nexport async function getQualificationReport(): Promise<{\n  bySource: Record<string, QualificationStats>;\n  byCampaign: Record<string, QualificationStats & { campaignName: string }>;\n  byAgent: Record<string, QualificationStats & { agentName: string }>;\n  overall: QualificationStats;\n}> {\n  const qualifications = await getQualifications();\n  \n  const bySource: Record<string, QualificationStats> = {};\n  const sources = ['ai_chat', 'campaign', 'ad', 'lead_form', 'manual'];\n  \n  for (const source of sources) {\n    const sourceQuals = qualifications.filter(q => q.source === source);\n    const total = sourceQuals.length;\n    const interested = sourceQuals.filter(q => q.category === 'interested').length;\n    const notInterested = sourceQuals.filter(q => q.category === 'not_interested').length;\n    const pending = sourceQuals.filter(q => q.category === 'pending').length;\n    \n    bySource[source] = {\n      total,\n      interested,\n      notInterested,\n      pending,\n      interestedPercent: total > 0 ? Math.round((interested / total) * 100) : 0,\n      notInterestedPercent: total > 0 ? Math.round((notInterested / total) * 100) : 0,\n      pendingPercent: total > 0 ? Math.round((pending / total) * 100) : 0\n    };\n  }\n  \n  const byCampaign: Record<string, QualificationStats & { campaignName: string }> = {};\n  const campaignIds = Array.from(new Set(qualifications.filter(q => q.campaignId).map(q => q.campaignId!)));\n  \n  for (const campaignId of campaignIds) {\n    const campaignQuals = qualifications.filter(q => q.campaignId === campaignId);\n    const total = campaignQuals.length;\n    const interested = campaignQuals.filter(q => q.category === 'interested').length;\n    const notInterested = campaignQuals.filter(q => q.category === 'not_interested').length;\n    const pending = campaignQuals.filter(q => q.category === 'pending').length;\n    \n    byCampaign[campaignId] = {\n      campaignName: campaignQuals[0]?.campaignName || 'Unknown Campaign',\n      total,\n      interested,\n      notInterested,\n      pending,\n      interestedPercent: total > 0 ? Math.round((interested / total) * 100) : 0,\n      notInterestedPercent: total > 0 ? Math.round((notInterested / total) * 100) : 0,\n      pendingPercent: total > 0 ? Math.round((pending / total) * 100) : 0\n    };\n  }\n  \n  const byAgent: Record<string, QualificationStats & { agentName: string }> = {};\n  const agentIds = Array.from(new Set(qualifications.filter(q => q.agentId).map(q => q.agentId!)));\n  \n  for (const agentId of agentIds) {\n    const agentQuals = qualifications.filter(q => q.agentId === agentId);\n    const total = agentQuals.length;\n    const interested = agentQuals.filter(q => q.category === 'interested').length;\n    const notInterested = agentQuals.filter(q => q.category === 'not_interested').length;\n    const pending = agentQuals.filter(q => q.category === 'pending').length;\n    \n    byAgent[agentId] = {\n      agentName: agentQuals[0]?.agentName || 'Unknown Agent',\n      total,\n      interested,\n      notInterested,\n      pending,\n      interestedPercent: total > 0 ? Math.round((interested / total) * 100) : 0,\n      notInterestedPercent: total > 0 ? Math.round((notInterested / total) * 100) : 0,\n      pendingPercent: total > 0 ? Math.round((pending / total) * 100) : 0\n    };\n  }\n  \n  return {\n    bySource,\n    byCampaign,\n    byAgent,\n    overall: await getQualificationStats()\n  };\n}\n","path":null,"size_bytes":12148,"size_tokens":null},"client/src/pages/ai/AgentReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { \n  CheckCircle2, \n  XCircle, \n  Clock, \n  Users, \n  TrendingUp, \n  TrendingDown,\n  MessageSquare,\n  Phone,\n  Calendar,\n  Bot,\n  Target,\n  Filter,\n  Search,\n  Download,\n  Eye,\n  Edit,\n  BarChart3,\n  PieChart\n} from \"lucide-react\";\nimport { format, isValid } from \"date-fns\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n// Safe date formatting helper\nconst formatDate = (dateStr: string | undefined | null, formatStr: string): string => {\n  if (!dateStr) return \"N/A\";\n  const date = new Date(dateStr);\n  if (!isValid(date)) return \"N/A\";\n  return format(date, formatStr);\n};\n\ninterface Qualification {\n  id: string;\n  contactId: string;\n  phone: string;\n  name: string;\n  source: string;\n  campaignId?: string;\n  campaignName?: string;\n  agentId?: string;\n  agentName?: string;\n  category: 'interested' | 'not_interested' | 'pending';\n  score: number;\n  totalMessages: number;\n  lastMessageAt: string;\n  firstContactAt: string;\n  keywords: string[];\n  notes: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface QualificationStats {\n  total: number;\n  interested: number;\n  notInterested: number;\n  pending: number;\n  interestedPercent: number;\n  notInterestedPercent: number;\n  pendingPercent: number;\n}\n\ninterface QualificationReport {\n  bySource: Record<string, QualificationStats>;\n  byCampaign: Record<string, QualificationStats & { campaignName: string }>;\n  byAgent: Record<string, QualificationStats & { agentName: string }>;\n  overall: QualificationStats;\n}\n\nexport default function AgentReports() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [selectedQualification, setSelectedQualification] = useState<Qualification | null>(null);\n  const [detailsOpen, setDetailsOpen] = useState(false);\n  const [editOpen, setEditOpen] = useState(false);\n  const [filterCategory, setFilterCategory] = useState<string>(\"all\");\n  const [filterSource, setFilterSource] = useState<string>(\"all\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editNotes, setEditNotes] = useState(\"\");\n  const [editCategory, setEditCategory] = useState<string>(\"\");\n\n  const { data: qualifications = [], isLoading: loadingQualifications } = useQuery<Qualification[]>({\n    queryKey: [\"/api/ai-analytics/qualifications\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: stats } = useQuery<QualificationStats>({\n    queryKey: [\"/api/ai-analytics/qualifications/stats\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: report } = useQuery<QualificationReport>({\n    queryKey: [\"/api/ai-analytics/qualifications/report\"],\n    refetchInterval: 10000,\n  });\n\n  const updateCategoryMutation = useMutation({\n    mutationFn: async ({ id, category, notes }: { id: string; category: string; notes?: string }) => {\n      const response = await fetch(`/api/ai-analytics/qualifications/${id}/category`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ category, notes }),\n      });\n      if (!response.ok) throw new Error(\"Failed to update category\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai-analytics/qualifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai-analytics/qualifications/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai-analytics/qualifications/report\"] });\n      toast({ title: \"Category Updated\", description: \"Lead qualification updated successfully\" });\n      setEditOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to update category\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredQualifications = qualifications.filter(q => {\n    if (filterCategory !== \"all\" && q.category !== filterCategory) return false;\n    if (filterSource !== \"all\" && q.source !== filterSource) return false;\n    if (searchTerm) {\n      const search = searchTerm.toLowerCase();\n      return (\n        q.name.toLowerCase().includes(search) ||\n        q.phone.includes(search) ||\n        q.keywords.some(k => k.toLowerCase().includes(search))\n      );\n    }\n    return true;\n  });\n\n  const interestedLeads = filteredQualifications.filter(q => q.category === 'interested');\n  const notInterestedLeads = filteredQualifications.filter(q => q.category === 'not_interested');\n  const pendingLeads = filteredQualifications.filter(q => q.category === 'pending');\n\n  const getCategoryBadge = (category: string) => {\n    switch (category) {\n      case 'interested':\n        return <Badge className=\"bg-green-500 hover:bg-green-600\"><CheckCircle2 className=\"w-3 h-3 mr-1\" /> Interested</Badge>;\n      case 'not_interested':\n        return <Badge className=\"bg-red-500 hover:bg-red-600\"><XCircle className=\"w-3 h-3 mr-1\" /> Not Interested</Badge>;\n      case 'pending':\n        return <Badge className=\"bg-yellow-500 hover:bg-yellow-600\"><Clock className=\"w-3 h-3 mr-1\" /> Pending</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{category}</Badge>;\n    }\n  };\n\n  const getSourceBadge = (source: string) => {\n    const colors: Record<string, string> = {\n      ai_chat: \"bg-blue-500\",\n      campaign: \"bg-purple-500\",\n      ad: \"bg-orange-500\",\n      lead_form: \"bg-green-500\",\n      manual: \"bg-gray-500\"\n    };\n    const labels: Record<string, string> = {\n      ai_chat: \"AI Chat\",\n      campaign: \"Campaign\",\n      ad: \"Ad\",\n      lead_form: \"Lead Form\",\n      manual: \"Manual\"\n    };\n    return <Badge className={colors[source] || \"bg-gray-500\"}>{labels[source] || source}</Badge>;\n  };\n\n  const handleViewDetails = (qual: Qualification) => {\n    setSelectedQualification(qual);\n    setDetailsOpen(true);\n  };\n\n  const handleEditCategory = (qual: Qualification) => {\n    setSelectedQualification(qual);\n    setEditCategory(qual.category);\n    setEditNotes(qual.notes || \"\");\n    setEditOpen(true);\n  };\n\n  const handleSaveCategory = () => {\n    if (selectedQualification && editCategory) {\n      updateCategoryMutation.mutate({\n        id: selectedQualification.id,\n        category: editCategory,\n        notes: editNotes,\n      });\n    }\n  };\n\n  const exportToCSV = (data: Qualification[], filename: string) => {\n    const headers = [\"Name\", \"Phone\", \"Category\", \"Source\", \"Score\", \"Messages\", \"Keywords\", \"First Contact\", \"Last Message\", \"Notes\"];\n    const rows = data.map(q => [\n      q.name,\n      q.phone,\n      q.category,\n      q.source,\n      q.score.toString(),\n      q.totalMessages.toString(),\n      q.keywords.join(\"; \"),\n      formatDate(q.firstContactAt, \"yyyy-MM-dd HH:mm\"),\n      formatDate(q.lastMessageAt, \"yyyy-MM-dd HH:mm\"),\n      q.notes || \"\"\n    ]);\n    \n    const csvContent = [headers, ...rows].map(row => row.map(cell => `\"${cell}\"`).join(\",\")).join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `${filename}_${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const LeadTable = ({ leads, title }: { leads: Qualification[]; title: string }) => (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between\">\n        <div>\n          <CardTitle className=\"text-lg\">{title}</CardTitle>\n          <CardDescription>{leads.length} leads</CardDescription>\n        </div>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => exportToCSV(leads, title.toLowerCase().replace(/\\s+/g, \"_\"))}>\n          <Download className=\"w-4 h-4 mr-2\" />\n          Export\n        </Button>\n      </CardHeader>\n      <CardContent>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Name</TableHead>\n              <TableHead>Phone</TableHead>\n              <TableHead>Source</TableHead>\n              <TableHead>Score</TableHead>\n              <TableHead>Messages</TableHead>\n              <TableHead>Last Contact</TableHead>\n              <TableHead>Keywords</TableHead>\n              <TableHead>Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {leads.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={8} className=\"text-center text-muted-foreground py-8\">\n                  No leads in this category\n                </TableCell>\n              </TableRow>\n            ) : (\n              leads.map(qual => (\n                <TableRow key={qual.id} className=\"cursor-pointer hover:bg-muted/50\">\n                  <TableCell className=\"font-medium\">{qual.name}</TableCell>\n                  <TableCell>{qual.phone}</TableCell>\n                  <TableCell>{getSourceBadge(qual.source)}</TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-12 h-2 bg-muted rounded-full overflow-hidden\">\n                        <div \n                          className={`h-full ${qual.score >= 70 ? 'bg-green-500' : qual.score >= 40 ? 'bg-yellow-500' : 'bg-red-500'}`}\n                          style={{ width: `${qual.score}%` }}\n                        />\n                      </div>\n                      <span className=\"text-sm\">{qual.score}%</span>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-1\">\n                      <MessageSquare className=\"w-4 h-4\" />\n                      {qual.totalMessages}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-sm text-muted-foreground\">\n                    {formatDate(qual.lastMessageAt, \"MMM dd, HH:mm\")}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex flex-wrap gap-1 max-w-[150px]\">\n                      {qual.keywords.slice(0, 2).map((kw, i) => (\n                        <Badge key={i} variant=\"outline\" className=\"text-xs\">{kw}</Badge>\n                      ))}\n                      {qual.keywords.length > 2 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">+{qual.keywords.length - 2}</Badge>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex gap-1\">\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => handleViewDetails(qual)}>\n                        <Eye className=\"w-4 h-4\" />\n                      </Button>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditCategory(qual)}>\n                        <Edit className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">AI Agent Reports</h1>\n          <p className=\"text-muted-foreground\">Track lead qualification from AI conversations</p>\n        </div>\n        <Button variant=\"outline\" onClick={() => exportToCSV(qualifications, \"all_qualifications\")}>\n          <Download className=\"w-4 h-4 mr-2\" />\n          Export All\n        </Button>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Total Contacts</p>\n                <p className=\"text-3xl font-bold\">{stats?.total || 0}</p>\n              </div>\n              <Users className=\"w-10 h-10 text-blue-500 opacity-50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"border-green-200 bg-green-50/50\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-green-600\">Interested</p>\n                <p className=\"text-3xl font-bold text-green-700\">{stats?.interested || 0}</p>\n                <p className=\"text-sm text-green-600\">{stats?.interestedPercent || 0}%</p>\n              </div>\n              <TrendingUp className=\"w-10 h-10 text-green-500 opacity-50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"border-red-200 bg-red-50/50\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-red-600\">Not Interested</p>\n                <p className=\"text-3xl font-bold text-red-700\">{stats?.notInterested || 0}</p>\n                <p className=\"text-sm text-red-600\">{stats?.notInterestedPercent || 0}%</p>\n              </div>\n              <TrendingDown className=\"w-10 h-10 text-red-500 opacity-50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"border-yellow-200 bg-yellow-50/50\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-yellow-600\">Pending</p>\n                <p className=\"text-3xl font-bold text-yellow-700\">{stats?.pending || 0}</p>\n                <p className=\"text-sm text-yellow-600\">{stats?.pendingPercent || 0}%</p>\n              </div>\n              <Clock className=\"w-10 h-10 text-yellow-500 opacity-50\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-wrap gap-4 items-center\">\n            <div className=\"flex items-center gap-2\">\n              <Search className=\"w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by name, phone, or keyword...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-64\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"w-4 h-4 text-muted-foreground\" />\n              <Select value={filterCategory} onValueChange={setFilterCategory}>\n                <SelectTrigger className=\"w-40\">\n                  <SelectValue placeholder=\"Category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Categories</SelectItem>\n                  <SelectItem value=\"interested\">Interested</SelectItem>\n                  <SelectItem value=\"not_interested\">Not Interested</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={filterSource} onValueChange={setFilterSource}>\n                <SelectTrigger className=\"w-40\">\n                  <SelectValue placeholder=\"Source\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Sources</SelectItem>\n                  <SelectItem value=\"ai_chat\">AI Chat</SelectItem>\n                  <SelectItem value=\"campaign\">Campaign</SelectItem>\n                  <SelectItem value=\"ad\">Ad</SelectItem>\n                  <SelectItem value=\"lead_form\">Lead Form</SelectItem>\n                  <SelectItem value=\"manual\">Manual</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tabs for different views */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full max-w-md grid-cols-4\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"interested\" className=\"text-green-600\">Interested</TabsTrigger>\n          <TabsTrigger value=\"not_interested\" className=\"text-red-600\">Not Interested</TabsTrigger>\n          <TabsTrigger value=\"pending\" className=\"text-yellow-600\">Pending</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          {/* By Agent Report */}\n          {report?.byAgent && Object.keys(report.byAgent).length > 0 && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Bot className=\"w-5 h-5\" />\n                  <CardTitle>By AI Agent</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Agent</TableHead>\n                      <TableHead>Total</TableHead>\n                      <TableHead className=\"text-green-600\">Interested</TableHead>\n                      <TableHead className=\"text-red-600\">Not Interested</TableHead>\n                      <TableHead className=\"text-yellow-600\">Pending</TableHead>\n                      <TableHead>Conversion Rate</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {Object.entries(report.byAgent).map(([agentId, agentStats]) => (\n                      <TableRow key={agentId}>\n                        <TableCell className=\"font-medium\">{agentStats.agentName}</TableCell>\n                        <TableCell>{agentStats.total}</TableCell>\n                        <TableCell className=\"text-green-600\">{agentStats.interested}</TableCell>\n                        <TableCell className=\"text-red-600\">{agentStats.notInterested}</TableCell>\n                        <TableCell className=\"text-yellow-600\">{agentStats.pending}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-16 h-2 bg-muted rounded-full overflow-hidden\">\n                              <div className=\"h-full bg-green-500\" style={{ width: `${agentStats.interestedPercent}%` }} />\n                            </div>\n                            <span className=\"text-sm font-medium\">{agentStats.interestedPercent}%</span>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* By Source Report */}\n          {report?.bySource && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Target className=\"w-5 h-5\" />\n                  <CardTitle>By Source</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Source</TableHead>\n                      <TableHead>Total</TableHead>\n                      <TableHead className=\"text-green-600\">Interested</TableHead>\n                      <TableHead className=\"text-red-600\">Not Interested</TableHead>\n                      <TableHead className=\"text-yellow-600\">Pending</TableHead>\n                      <TableHead>Conversion Rate</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {Object.entries(report.bySource)\n                      .filter(([_, stats]) => stats.total > 0)\n                      .map(([source, sourceStats]) => (\n                        <TableRow key={source}>\n                          <TableCell>{getSourceBadge(source)}</TableCell>\n                          <TableCell>{sourceStats.total}</TableCell>\n                          <TableCell className=\"text-green-600\">{sourceStats.interested}</TableCell>\n                          <TableCell className=\"text-red-600\">{sourceStats.notInterested}</TableCell>\n                          <TableCell className=\"text-yellow-600\">{sourceStats.pending}</TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <div className=\"w-16 h-2 bg-muted rounded-full overflow-hidden\">\n                                <div className=\"h-full bg-green-500\" style={{ width: `${sourceStats.interestedPercent}%` }} />\n                              </div>\n                              <span className=\"text-sm font-medium\">{sourceStats.interestedPercent}%</span>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* By Campaign Report */}\n          {report?.byCampaign && Object.keys(report.byCampaign).length > 0 && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <BarChart3 className=\"w-5 h-5\" />\n                  <CardTitle>By Campaign</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Campaign</TableHead>\n                      <TableHead>Total</TableHead>\n                      <TableHead className=\"text-green-600\">Interested</TableHead>\n                      <TableHead className=\"text-red-600\">Not Interested</TableHead>\n                      <TableHead className=\"text-yellow-600\">Pending</TableHead>\n                      <TableHead>Conversion Rate</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {Object.entries(report.byCampaign).map(([campaignId, campaignStats]) => (\n                      <TableRow key={campaignId}>\n                        <TableCell className=\"font-medium\">{campaignStats.campaignName}</TableCell>\n                        <TableCell>{campaignStats.total}</TableCell>\n                        <TableCell className=\"text-green-600\">{campaignStats.interested}</TableCell>\n                        <TableCell className=\"text-red-600\">{campaignStats.notInterested}</TableCell>\n                        <TableCell className=\"text-yellow-600\">{campaignStats.pending}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-16 h-2 bg-muted rounded-full overflow-hidden\">\n                              <div className=\"h-full bg-green-500\" style={{ width: `${campaignStats.interestedPercent}%` }} />\n                            </div>\n                            <span className=\"text-sm font-medium\">{campaignStats.interestedPercent}%</span>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* All Leads Table */}\n          <LeadTable leads={filteredQualifications} title=\"All Leads\" />\n        </TabsContent>\n\n        <TabsContent value=\"interested\">\n          <LeadTable leads={interestedLeads} title=\"Interested Leads\" />\n        </TabsContent>\n\n        <TabsContent value=\"not_interested\">\n          <LeadTable leads={notInterestedLeads} title=\"Not Interested Leads\" />\n        </TabsContent>\n\n        <TabsContent value=\"pending\">\n          <LeadTable leads={pendingLeads} title=\"Pending Leads\" />\n        </TabsContent>\n      </Tabs>\n\n      {/* Details Dialog */}\n      <Dialog open={detailsOpen} onOpenChange={setDetailsOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Lead Details</DialogTitle>\n            <DialogDescription>\n              Complete information about this lead\n            </DialogDescription>\n          </DialogHeader>\n          {selectedQualification && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Name</label>\n                  <p className=\"font-medium\">{selectedQualification.name}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Phone</label>\n                  <p className=\"font-medium\">{selectedQualification.phone}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Category</label>\n                  <div className=\"mt-1\">{getCategoryBadge(selectedQualification.category)}</div>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Source</label>\n                  <div className=\"mt-1\">{getSourceBadge(selectedQualification.source)}</div>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Score</label>\n                  <p className=\"font-medium\">{selectedQualification.score}%</p>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Total Messages</label>\n                  <p className=\"font-medium\">{selectedQualification.totalMessages}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">First Contact</label>\n                  <p className=\"font-medium\">{formatDate(selectedQualification.firstContactAt, \"MMM dd, yyyy HH:mm\")}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Last Message</label>\n                  <p className=\"font-medium\">{formatDate(selectedQualification.lastMessageAt, \"MMM dd, yyyy HH:mm\")}</p>\n                </div>\n              </div>\n              {selectedQualification.agentName && (\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">AI Agent</label>\n                  <p className=\"font-medium\">{selectedQualification.agentName}</p>\n                </div>\n              )}\n              {selectedQualification.campaignName && (\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Campaign</label>\n                  <p className=\"font-medium\">{selectedQualification.campaignName}</p>\n                </div>\n              )}\n              <div>\n                <label className=\"text-sm text-muted-foreground\">Keywords Detected</label>\n                <div className=\"flex flex-wrap gap-1 mt-1\">\n                  {selectedQualification.keywords.length > 0 ? (\n                    selectedQualification.keywords.map((kw, i) => (\n                      <Badge key={i} variant=\"outline\">{kw}</Badge>\n                    ))\n                  ) : (\n                    <span className=\"text-muted-foreground text-sm\">No keywords detected</span>\n                  )}\n                </div>\n              </div>\n              {selectedQualification.notes && (\n                <div>\n                  <label className=\"text-sm text-muted-foreground\">Notes</label>\n                  <p className=\"text-sm mt-1\">{selectedQualification.notes}</p>\n                </div>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setDetailsOpen(false)}>Close</Button>\n            <Button onClick={() => {\n              setDetailsOpen(false);\n              if (selectedQualification) handleEditCategory(selectedQualification);\n            }}>\n              <Edit className=\"w-4 h-4 mr-2\" />\n              Edit Category\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Category Dialog */}\n      <Dialog open={editOpen} onOpenChange={setEditOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Update Lead Category</DialogTitle>\n            <DialogDescription>\n              Change the qualification category for {selectedQualification?.name}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium\">Category</label>\n              <Select value={editCategory} onValueChange={setEditCategory}>\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"interested\">\n                    <div className=\"flex items-center gap-2\">\n                      <CheckCircle2 className=\"w-4 h-4 text-green-500\" />\n                      Interested\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"not_interested\">\n                    <div className=\"flex items-center gap-2\">\n                      <XCircle className=\"w-4 h-4 text-red-500\" />\n                      Not Interested\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"pending\">\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"w-4 h-4 text-yellow-500\" />\n                      Pending\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"text-sm font-medium\">Notes (Optional)</label>\n              <Textarea\n                value={editNotes}\n                onChange={(e) => setEditNotes(e.target.value)}\n                placeholder=\"Add notes about this lead...\"\n                className=\"mt-1\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditOpen(false)}>Cancel</Button>\n            <Button onClick={handleSaveCategory} disabled={updateCategoryMutation.isPending}>\n              {updateCategoryMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":31360,"size_tokens":null},"server/modules/aiAnalytics/aiAnalytics.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport * as aiAnalyticsService from './aiAnalytics.service';\n\nconst router = Router();\n\nrouter.get('/qualifications', async (req: Request, res: Response) => {\n  try {\n    const { category, source, campaignId, agentId } = req.query;\n    \n    let qualifications = await aiAnalyticsService.getQualifications();\n    \n    if (category && typeof category === 'string') {\n      qualifications = qualifications.filter(q => q.category === category);\n    }\n    \n    if (source && typeof source === 'string') {\n      qualifications = qualifications.filter(q => q.source === source);\n    }\n    \n    if (campaignId && typeof campaignId === 'string') {\n      qualifications = qualifications.filter(q => q.campaignId === campaignId);\n    }\n    \n    if (agentId && typeof agentId === 'string') {\n      qualifications = qualifications.filter(q => q.agentId === agentId);\n    }\n    \n    qualifications.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n    \n    res.json(qualifications);\n  } catch (error) {\n    console.error('Error getting qualifications:', error);\n    res.status(500).json({ error: 'Failed to get qualifications' });\n  }\n});\n\nrouter.get('/qualifications/stats', async (req: Request, res: Response) => {\n  try {\n    const stats = await aiAnalyticsService.getQualificationStats();\n    res.json(stats);\n  } catch (error) {\n    console.error('Error getting qualification stats:', error);\n    res.status(500).json({ error: 'Failed to get qualification stats' });\n  }\n});\n\nrouter.get('/qualifications/report', async (req: Request, res: Response) => {\n  try {\n    const report = await aiAnalyticsService.getQualificationReport();\n    res.json(report);\n  } catch (error) {\n    console.error('Error getting qualification report:', error);\n    res.status(500).json({ error: 'Failed to get qualification report' });\n  }\n});\n\nrouter.get('/qualifications/:id', async (req: Request, res: Response) => {\n  try {\n    const qualification = await aiAnalyticsService.getQualificationById(req.params.id);\n    if (!qualification) {\n      return res.status(404).json({ error: 'Qualification not found' });\n    }\n    res.json(qualification);\n  } catch (error) {\n    console.error('Error getting qualification:', error);\n    res.status(500).json({ error: 'Failed to get qualification' });\n  }\n});\n\nrouter.post('/qualifications', async (req: Request, res: Response) => {\n  try {\n    const { phone, name, message, source, campaignId, campaignName, agentId, agentName, contactId } = req.body;\n    \n    if (!phone || !name) {\n      return res.status(400).json({ error: 'Phone and name are required' });\n    }\n    \n    const qualification = await aiAnalyticsService.createOrUpdateQualification(\n      phone,\n      name,\n      message || '',\n      source || 'manual',\n      { campaignId, campaignName, agentId, agentName, contactId }\n    );\n    \n    res.status(201).json(qualification);\n  } catch (error) {\n    console.error('Error creating qualification:', error);\n    res.status(500).json({ error: 'Failed to create qualification' });\n  }\n});\n\nrouter.put('/qualifications/:id/category', async (req: Request, res: Response) => {\n  try {\n    const { category, notes } = req.body;\n    \n    if (!category || !['interested', 'not_interested', 'pending'].includes(category)) {\n      return res.status(400).json({ error: 'Valid category is required (interested, not_interested, pending)' });\n    }\n    \n    const qualification = await aiAnalyticsService.updateQualificationCategory(req.params.id, category, notes);\n    if (!qualification) {\n      return res.status(404).json({ error: 'Qualification not found' });\n    }\n    \n    res.json(qualification);\n  } catch (error) {\n    console.error('Error updating qualification category:', error);\n    res.status(500).json({ error: 'Failed to update qualification category' });\n  }\n});\n\nrouter.put('/qualifications/:id/notes', async (req: Request, res: Response) => {\n  try {\n    const { notes } = req.body;\n    \n    const qualification = await aiAnalyticsService.updateQualificationNotes(req.params.id, notes || '');\n    if (!qualification) {\n      return res.status(404).json({ error: 'Qualification not found' });\n    }\n    \n    res.json(qualification);\n  } catch (error) {\n    console.error('Error updating qualification notes:', error);\n    res.status(500).json({ error: 'Failed to update qualification notes' });\n  }\n});\n\nrouter.delete('/qualifications/:id', async (req: Request, res: Response) => {\n  try {\n    const success = await aiAnalyticsService.deleteQualification(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: 'Qualification not found' });\n    }\n    res.status(204).send();\n  } catch (error) {\n    console.error('Error deleting qualification:', error);\n    res.status(500).json({ error: 'Failed to delete qualification' });\n  }\n});\n\nrouter.get('/qualifications/by-phone/:phone', async (req: Request, res: Response) => {\n  try {\n    const qualification = await aiAnalyticsService.getQualificationByPhone(req.params.phone);\n    if (!qualification) {\n      return res.status(404).json({ error: 'Qualification not found for this phone' });\n    }\n    res.json(qualification);\n  } catch (error) {\n    console.error('Error getting qualification by phone:', error);\n    res.status(500).json({ error: 'Failed to get qualification' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":5401,"size_tokens":null},"server/modules/contactAgent/contactAgent.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\n\ninterface ConversationMessage {\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: string;\n}\n\ninterface ContactAgent {\n  id: string;\n  contactId: string;\n  phone: string;\n  agentId: string;\n  agentName?: string;\n  conversationHistory: ConversationMessage[];\n  isActive: boolean;\n  autoReplyDisabled: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, '');\n}\n\nexport async function assignAgentToContact(\n  contactId: string,\n  phone: string,\n  agentId: string,\n  agentName?: string\n): Promise<ContactAgent | null> {\n  const normalizedPhone = normalizePhone(phone);\n  const now = new Date().toISOString();\n  \n  const existing = await mongodb.findOne<ContactAgent>('contact_agents', { \n    phone: { $regex: normalizedPhone.slice(-10) + '$' }\n  });\n  \n  if (existing) {\n    const updated = await mongodb.updateOne<ContactAgent>('contact_agents', \n      { id: existing.id },\n      { \n        agentId, \n        agentName,\n        isActive: true,\n        updatedAt: now \n      }\n    );\n    console.log(`[ContactAgent] Updated agent assignment for ${phone}: ${agentId}`);\n    return updated;\n  }\n  \n  const newAssignment: ContactAgent = {\n    id: `ca-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    contactId,\n    phone: normalizedPhone,\n    agentId,\n    agentName,\n    conversationHistory: [],\n    isActive: true,\n    autoReplyDisabled: false,\n    createdAt: now,\n    updatedAt: now,\n  };\n  \n  const result = await mongodb.insertOne<ContactAgent>('contact_agents', newAssignment);\n  console.log(`[ContactAgent] Created agent assignment for ${phone}: ${agentId}`);\n  return result;\n}\n\nexport async function getAgentForContact(phone: string): Promise<ContactAgent | null> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const assignment = await mongodb.findOne<ContactAgent>('contact_agents', { \n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ],\n    isActive: true\n  });\n  \n  return assignment;\n}\n\nexport async function addMessageToHistory(\n  phone: string,\n  role: 'user' | 'assistant',\n  content: string\n): Promise<boolean> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const assignment = await mongodb.findOne<ContactAgent>('contact_agents', { \n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n  \n  if (!assignment) {\n    return false;\n  }\n  \n  const newMessage: ConversationMessage = {\n    role,\n    content,\n    timestamp: new Date().toISOString()\n  };\n  \n  const updatedHistory = [...(assignment.conversationHistory || []), newMessage].slice(-20);\n  \n  await mongodb.updateOne<ContactAgent>('contact_agents', \n    { id: assignment.id },\n    { \n      conversationHistory: updatedHistory,\n      updatedAt: new Date().toISOString() \n    }\n  );\n  \n  return true;\n}\n\nexport async function getConversationHistory(phone: string): Promise<{ role: 'user' | 'assistant'; content: string }[]> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const assignment = await mongodb.findOne<ContactAgent>('contact_agents', { \n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n  \n  if (!assignment || !assignment.conversationHistory) {\n    return [];\n  }\n  \n  return assignment.conversationHistory.map(m => ({\n    role: m.role,\n    content: m.content\n  }));\n}\n\nexport async function removeAgentFromContact(phone: string): Promise<boolean> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const result = await mongodb.updateOne<ContactAgent>('contact_agents', \n    { $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]},\n    { isActive: false, updatedAt: new Date().toISOString() }\n  );\n  \n  return result !== null;\n}\n\nexport async function getAllContactAgents(): Promise<ContactAgent[]> {\n  return mongodb.readCollection<ContactAgent>('contact_agents');\n}\n\nexport async function disableAutoReply(phone: string): Promise<boolean> {\n  const normalizedPhone = normalizePhone(phone);\n  const now = new Date().toISOString();\n  \n  const existing = await mongodb.findOne<ContactAgent>('contact_agents', { \n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n  \n  if (existing) {\n    await mongodb.updateOne<ContactAgent>('contact_agents', \n      { id: existing.id },\n      { autoReplyDisabled: true, updatedAt: now }\n    );\n    console.log(`[ContactAgent] Disabled auto-reply for ${phone}`);\n    return true;\n  }\n  \n  const newRecord: ContactAgent = {\n    id: `ca-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    contactId: '',\n    phone: normalizedPhone,\n    agentId: '',\n    agentName: undefined,\n    conversationHistory: [],\n    isActive: false,\n    autoReplyDisabled: true,\n    createdAt: now,\n    updatedAt: now,\n  };\n  \n  await mongodb.insertOne<ContactAgent>('contact_agents', newRecord);\n  console.log(`[ContactAgent] Created record with auto-reply disabled for ${phone}`);\n  return true;\n}\n\nexport async function isAutoReplyDisabled(phone: string): Promise<boolean> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const record = await mongodb.findOne<ContactAgent>('contact_agents', { \n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n  \n  return record?.autoReplyDisabled === true;\n}\n\nexport async function enableAutoReply(phone: string): Promise<boolean> {\n  const normalizedPhone = normalizePhone(phone);\n  \n  const result = await mongodb.updateOne<ContactAgent>('contact_agents', \n    { $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]},\n    { autoReplyDisabled: false, updatedAt: new Date().toISOString() }\n  );\n  \n  console.log(`[ContactAgent] Enabled auto-reply for ${phone}`);\n  return result !== null;\n}\n\nexport async function enableAutoReplyForAll(): Promise<{ updated: number; total: number }> {\n  const allRecords = await mongodb.readCollection<ContactAgent>('contact_agents');\n  const disabledRecords = allRecords.filter(r => r.autoReplyDisabled === true);\n  \n  let updated = 0;\n  const now = new Date().toISOString();\n  \n  for (const record of disabledRecords) {\n    await mongodb.updateOne<ContactAgent>('contact_agents', \n      { id: record.id },\n      { autoReplyDisabled: false, updatedAt: now }\n    );\n    updated++;\n    console.log(`[ContactAgent] Re-enabled auto-reply for ${record.phone}`);\n  }\n  \n  console.log(`[ContactAgent] Bulk re-enabled auto-reply for ${updated}/${allRecords.length} contacts`);\n  return { updated, total: allRecords.length };\n}\n\nexport async function getAutoReplyStats(): Promise<{ total: number; enabled: number; disabled: number }> {\n  const allRecords = await mongodb.readCollection<ContactAgent>('contact_agents');\n  const disabled = allRecords.filter(r => r.autoReplyDisabled === true).length;\n  return {\n    total: allRecords.length,\n    enabled: allRecords.length - disabled,\n    disabled\n  };\n}\n","path":null,"size_bytes":7204,"size_tokens":null},"server/modules/prefilledText/prefilledText.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport * as prefilledTextService from './prefilledText.service';\n\nconst router = Router();\n\nrouter.get('/', async (req: Request, res: Response) => {\n  try {\n    const mappings = await prefilledTextService.getAllMappings();\n    res.json(mappings);\n  } catch (error) {\n    console.error('Error fetching prefilled text mappings:', error);\n    res.status(500).json({ error: 'Failed to fetch mappings' });\n  }\n});\n\nrouter.get('/:id', async (req: Request, res: Response) => {\n  try {\n    const mapping = await prefilledTextService.getMappingById(req.params.id);\n    if (!mapping) {\n      return res.status(404).json({ error: 'Mapping not found' });\n    }\n    res.json(mapping);\n  } catch (error) {\n    console.error('Error fetching mapping:', error);\n    res.status(500).json({ error: 'Failed to fetch mapping' });\n  }\n});\n\nrouter.post('/', async (req: Request, res: Response) => {\n  try {\n    const { prefilledText, agentId, agentName } = req.body;\n    \n    if (!prefilledText || !agentId || !agentName) {\n      return res.status(400).json({ error: 'Missing required fields: prefilledText, agentId, agentName' });\n    }\n    \n    const mapping = await prefilledTextService.createMapping({\n      prefilledText,\n      agentId,\n      agentName,\n    });\n    \n    res.status(201).json(mapping);\n  } catch (error) {\n    console.error('Error creating mapping:', error);\n    res.status(500).json({ error: 'Failed to create mapping' });\n  }\n});\n\nrouter.put('/:id', async (req: Request, res: Response) => {\n  try {\n    const mapping = await prefilledTextService.updateMapping(req.params.id, req.body);\n    if (!mapping) {\n      return res.status(404).json({ error: 'Mapping not found' });\n    }\n    res.json(mapping);\n  } catch (error) {\n    console.error('Error updating mapping:', error);\n    res.status(500).json({ error: 'Failed to update mapping' });\n  }\n});\n\nrouter.delete('/:id', async (req: Request, res: Response) => {\n  try {\n    await prefilledTextService.deleteMapping(req.params.id);\n    res.status(204).send();\n  } catch (error) {\n    console.error('Error deleting mapping:', error);\n    res.status(500).json({ error: 'Failed to delete mapping' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":2232,"size_tokens":null},"client/src/pages/ai/PrefilledTextMappings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  Plus, \n  Trash2, \n  Edit, \n  Bot, \n  MessageSquare, \n  Loader2,\n  Zap,\n  ArrowRight\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface PrefilledTextMapping {\n  id: string;\n  prefilledText: string;\n  agentId: string;\n  agentName: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\nexport default function PrefilledTextMappings() {\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [editingMapping, setEditingMapping] = useState<PrefilledTextMapping | null>(null);\n  const [prefilledText, setPrefilledText] = useState(\"\");\n  const [selectedAgentId, setSelectedAgentId] = useState(\"\");\n  const queryClient = useQueryClient();\n\n  const { data: mappings = [], isLoading } = useQuery<PrefilledTextMapping[]>({\n    queryKey: [\"/api/prefilled-text\"],\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { prefilledText: string; agentId: string; agentName: string }) => {\n      const res = await fetch(\"/api/prefilled-text\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to create mapping\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/prefilled-text\"] });\n      setIsAddOpen(false);\n      setPrefilledText(\"\");\n      setSelectedAgentId(\"\");\n      toast.success(\"Mapping created successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to create mapping\");\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, ...data }: { id: string; prefilledText?: string; agentId?: string; agentName?: string; isActive?: boolean }) => {\n      const res = await fetch(`/api/prefilled-text/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to update mapping\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/prefilled-text\"] });\n      setEditingMapping(null);\n      setPrefilledText(\"\");\n      setSelectedAgentId(\"\");\n      toast.success(\"Mapping updated successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to update mapping\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/prefilled-text/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete mapping\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/prefilled-text\"] });\n      toast.success(\"Mapping deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete mapping\");\n    },\n  });\n\n  const handleCreate = () => {\n    if (!prefilledText.trim() || !selectedAgentId) {\n      toast.error(\"Please fill in all fields\");\n      return;\n    }\n    const agent = agents.find(a => a.id === selectedAgentId);\n    if (!agent) {\n      toast.error(\"Please select an agent\");\n      return;\n    }\n    createMutation.mutate({\n      prefilledText: prefilledText.trim(),\n      agentId: selectedAgentId,\n      agentName: agent.name,\n    });\n  };\n\n  const handleUpdate = () => {\n    if (!editingMapping) return;\n    if (!prefilledText.trim() || !selectedAgentId) {\n      toast.error(\"Please fill in all fields\");\n      return;\n    }\n    const agent = agents.find(a => a.id === selectedAgentId);\n    if (!agent) {\n      toast.error(\"Please select an agent\");\n      return;\n    }\n    updateMutation.mutate({\n      id: editingMapping.id,\n      prefilledText: prefilledText.trim(),\n      agentId: selectedAgentId,\n      agentName: agent.name,\n    });\n  };\n\n  const handleToggleActive = (mapping: PrefilledTextMapping) => {\n    updateMutation.mutate({\n      id: mapping.id,\n      isActive: !mapping.isActive,\n    });\n  };\n\n  const openEditDialog = (mapping: PrefilledTextMapping) => {\n    setEditingMapping(mapping);\n    setPrefilledText(mapping.prefilledText);\n    setSelectedAgentId(mapping.agentId);\n  };\n\n  const closeDialogs = () => {\n    setIsAddOpen(false);\n    setEditingMapping(null);\n    setPrefilledText(\"\");\n    setSelectedAgentId(\"\");\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n              <Zap className=\"h-6 w-6 text-primary\" />\n              Pre-filled Text Mappings\n            </h1>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Automatically assign AI agents to WhatsApp leads based on their first message\n            </p>\n          </div>\n          <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"gap-2\">\n                <Plus className=\"h-4 w-4\" />\n                Add Mapping\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Add Pre-filled Text Mapping</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label>Pre-filled Text</Label>\n                  <Input\n                    placeholder=\"e.g., Hi, I'm interested in pricing\"\n                    value={prefilledText}\n                    onChange={(e) => setPrefilledText(e.target.value)}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    When a new contact sends a message starting with this text, the selected AI agent will respond\n                  </p>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>AI Agent</Label>\n                  <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select an AI agent\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {agents.filter(a => a.isActive).map(agent => (\n                        <SelectItem key={agent.id} value={agent.id}>\n                          <div className=\"flex items-center gap-2\">\n                            <Bot className=\"h-4 w-4\" />\n                            {agent.name}\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={closeDialogs}>Cancel</Button>\n                <Button onClick={handleCreate} disabled={createMutation.isPending}>\n                  {createMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : null}\n                  Create Mapping\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">How it works</CardTitle>\n            <CardDescription>\n              When someone who is not in your contacts list messages you on WhatsApp, the system checks if their message matches any pre-filled text you've configured. If it matches, the assigned AI agent will automatically respond and handle the conversation.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-4 p-4 bg-muted/50 rounded-lg\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <MessageSquare className=\"h-5 w-5 text-blue-500\" />\n                <span>User sends message</span>\n              </div>\n              <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Zap className=\"h-5 w-5 text-yellow-500\" />\n                <span>Match pre-filled text</span>\n              </div>\n              <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Bot className=\"h-5 w-5 text-green-500\" />\n                <span>AI Agent responds</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Configured Mappings</CardTitle>\n            <CardDescription>\n              {mappings.length} mapping{mappings.length !== 1 ? 's' : ''} configured\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex items-center justify-center h-32\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n              </div>\n            ) : mappings.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center h-32 text-muted-foreground\">\n                <Zap className=\"h-8 w-8 mb-2\" />\n                <p>No mappings configured yet</p>\n                <p className=\"text-xs\">Add a mapping to auto-assign AI agents to incoming leads</p>\n              </div>\n            ) : (\n              <ScrollArea className=\"h-[400px]\">\n                <div className=\"space-y-3\">\n                  {mappings.map((mapping) => (\n                    <div \n                      key={mapping.id}\n                      className={`flex items-center justify-between p-4 border rounded-lg ${\n                        mapping.isActive ? 'bg-background' : 'bg-muted/30 opacity-60'\n                      }`}\n                    >\n                      <div className=\"flex items-center gap-4 flex-1\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"p-2 bg-blue-100 dark:bg-blue-950 rounded-lg\">\n                            <MessageSquare className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                          </div>\n                          <div>\n                            <p className=\"font-medium\">\"{mapping.prefilledText}\"</p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              Messages starting with this text will trigger the AI\n                            </p>\n                          </div>\n                        </div>\n                        <ArrowRight className=\"h-4 w-4 text-muted-foreground mx-4\" />\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"p-2 bg-green-100 dark:bg-green-950 rounded-lg\">\n                            <Bot className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                          </div>\n                          <div>\n                            <p className=\"font-medium\">{mapping.agentName}</p>\n                            <Badge variant={mapping.isActive ? \"default\" : \"secondary\"} className=\"text-xs\">\n                              {mapping.isActive ? 'Active' : 'Inactive'}\n                            </Badge>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={mapping.isActive}\n                          onCheckedChange={() => handleToggleActive(mapping)}\n                        />\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditDialog(mapping)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => deleteMutation.mutate(mapping.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={!!editingMapping} onOpenChange={(open) => !open && closeDialogs()}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Mapping</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Pre-filled Text</Label>\n              <Input\n                placeholder=\"e.g., Hi, I'm interested in pricing\"\n                value={prefilledText}\n                onChange={(e) => setPrefilledText(e.target.value)}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>AI Agent</Label>\n              <Select value={selectedAgentId} onValueChange={setSelectedAgentId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select an AI agent\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {agents.filter(a => a.isActive).map(agent => (\n                    <SelectItem key={agent.id} value={agent.id}>\n                      <div className=\"flex items-center gap-2\">\n                        <Bot className=\"h-4 w-4\" />\n                        {agent.name}\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={closeDialogs}>Cancel</Button>\n            <Button onClick={handleUpdate} disabled={updateMutation.isPending}>\n              {updateMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n              ) : null}\n              Update Mapping\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":15221,"size_tokens":null},"server/modules/prefilledText/prefilledText.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\n\nexport interface PrefilledTextMapping {\n  id: string;\n  prefilledText: string;\n  agentId: string;\n  agentName: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport async function getAllMappings(): Promise<PrefilledTextMapping[]> {\n  const mappings = await mongodb.readCollection<PrefilledTextMapping>('prefilled_text_mappings');\n  return mappings;\n}\n\nexport async function getMappingById(id: string): Promise<PrefilledTextMapping | null> {\n  return mongodb.findOne<PrefilledTextMapping>('prefilled_text_mappings', { id });\n}\n\nexport async function getMappingByText(text: string): Promise<PrefilledTextMapping | null> {\n  const normalizedText = text.toLowerCase().trim();\n  \n  const mappings = await mongodb.readCollection<PrefilledTextMapping>('prefilled_text_mappings');\n  \n  for (const mapping of mappings) {\n    if (!mapping.isActive) continue;\n    \n    const mappingText = mapping.prefilledText.toLowerCase().trim();\n    if (normalizedText === mappingText || normalizedText.includes(mappingText) || mappingText.includes(normalizedText)) {\n      return mapping;\n    }\n  }\n  \n  return null;\n}\n\nexport async function createMapping(data: {\n  prefilledText: string;\n  agentId: string;\n  agentName: string;\n}): Promise<PrefilledTextMapping> {\n  const now = new Date().toISOString();\n  \n  const mapping: PrefilledTextMapping = {\n    id: `pft-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    prefilledText: data.prefilledText,\n    agentId: data.agentId,\n    agentName: data.agentName,\n    isActive: true,\n    createdAt: now,\n    updatedAt: now,\n  };\n  \n  await mongodb.insertOne<PrefilledTextMapping>('prefilled_text_mappings', mapping);\n  return mapping;\n}\n\nexport async function updateMapping(id: string, data: Partial<PrefilledTextMapping>): Promise<PrefilledTextMapping | null> {\n  const updated = await mongodb.updateOne<PrefilledTextMapping>(\n    'prefilled_text_mappings',\n    { id },\n    { ...data, updatedAt: new Date().toISOString() }\n  );\n  return updated;\n}\n\nexport async function deleteMapping(id: string): Promise<boolean> {\n  await mongodb.deleteOne('prefilled_text_mappings', { id });\n  return true;\n}\n\nexport async function findMatchingAgentForMessage(messageText: string): Promise<PrefilledTextMapping | null> {\n  const normalizedMessage = messageText.toLowerCase().trim();\n  \n  const mappings = await mongodb.readCollection<PrefilledTextMapping>('prefilled_text_mappings');\n  const activeMappings = mappings.filter(m => m.isActive);\n  \n  activeMappings.sort((a, b) => b.prefilledText.length - a.prefilledText.length);\n  \n  for (const mapping of activeMappings) {\n    const mappingText = mapping.prefilledText.toLowerCase().trim();\n    \n    if (normalizedMessage === mappingText) {\n      console.log(`[PrefilledText] Exact match found: \"${messageText}\" -> Agent: ${mapping.agentName}`);\n      return mapping;\n    }\n    \n    if (normalizedMessage.startsWith(mappingText)) {\n      console.log(`[PrefilledText] Prefix match found: \"${messageText}\" starts with \"${mapping.prefilledText}\" -> Agent: ${mapping.agentName}`);\n      return mapping;\n    }\n  }\n  \n  return null;\n}\n","path":null,"size_bytes":3182,"size_tokens":null},"client/src/pages/inbox/WhatsAppLeads.tsx":{"content":"import { useState, useEffect, useRef, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { \n  Search, \n  Paperclip, \n  Send, \n  Smile, \n  MoreVertical, \n  Phone, \n  Video, \n  Loader2, \n  Download, \n  Users,\n  CheckSquare,\n  Bot,\n  FileText,\n  MessageSquare,\n  Reply,\n  X,\n  MailOpen,\n  UserPlus,\n  Ban\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  phone: string;\n  email?: string;\n  tags: string[];\n}\n\ninterface Message {\n  id: string;\n  contactId: string;\n  content: string;\n  type: string;\n  direction: \"inbound\" | \"outbound\";\n  status: string;\n  timestamp: string;\n  replyToMessageId?: string;\n  replyToContent?: string;\n  mediaUrl?: string;\n}\n\ninterface Chat {\n  id: string;\n  contactId: string;\n  contact: Contact;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  lastInboundMessageTime?: string;\n  lastInboundMessage?: string;\n  unreadCount: number;\n  status: string;\n}\n\ninterface Template {\n  id: string;\n  name: string;\n  content: string;\n  variables: string[];\n  status: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  description: string;\n  isActive: boolean;\n}\n\nfunction normalizePhone(phone: string): string {\n  return phone.replace(/\\D/g, '');\n}\n\nexport default function WhatsAppLeads() {\n  const [selectedChatId, setSelectedChatId] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [selectedContacts, setSelectedContacts] = useState<string[]>([]);\n  const [isBulkSendOpen, setIsBulkSendOpen] = useState(false);\n  const [messageType, setMessageType] = useState<\"template\" | \"custom\" | \"ai\">(\"custom\");\n  const [selectedTemplate, setSelectedTemplate] = useState(\"\");\n  const [selectedAgent, setSelectedAgent] = useState(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [filterTab, setFilterTab] = useState<\"all\" | \"unread\">(\"all\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const queryClient = useQueryClient();\n  \n  const notificationAudioRef = useRef<HTMLAudioElement | null>(null);\n  const lastUnreadCountRef = useRef<number>(0);\n  const audioUnlockedRef = useRef<boolean>(false);\n  \n  useEffect(() => {\n    const beepSound = \"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2telehs/hMGyjnYsT2fJ0sJxIBw4d7O5s4VYQXzQ182bhlltndzV0JqJe3aap7KopZmRjI+TmJ6cmZePhoJ+fHx8fH2AgYSGiYyPkZOVlZaWlpWUkpCNioaDgX9+fX19fn+BhIiMkJOXmpyenp6dnJqXlJGOioaDgYB/f4CBg4aJjZCTlpmbnZ2dnJqYlZKPjImGhIKBgICAgIGChYiLjpGUl5manJ2dnJuZl5WSkI2KiIaEg4KCgoKDhIaIi42QkpWXmZqbnJybmpiWlJKQjoqJh4aFhISEhISFhoiKjI6QkpSWmJmam5uamZeWlJKQjoyKiIeGhoWFhYWGh4iKjI6QkpSVl5iZmZmYl5aUkpCOjIqIh4aFhYWFhYaHiImLjI6QkpOVlpeYmJiXlpWUkpCOjIqIh4aFhYWFhoaHiImLjY+QkpOVlpeXl5eWlZSSkI+NjIqIh4aFhYWFhoaHiImLjI6PkZKUlZaWlpaVlJOSkI+NjIqJh4aGhYaGhoaHiImKjI2PkJGTlJWVlZWVlJOSkI+OjIuJiIeGhoaGhoaHiImKi42OkJGSk5SUlJSUk5KRkI+OjIuKiYiHh4aGh4eHiImKi4yNj5CRkpOTk5OTkpGQj46NjIuKiYiHh4eHh4eIiImKi4yNjo+QkZGRkZGRkI+Pjo2MjIuKiYmIiIeIiIiIiYmKi4yNjo+PkJCQkJCQj4+OjY2MjIuKiomIiIiIiIiJiYqKi4yNjY6Pj4+Pj4+Pjo6NjYyMi4uKiomJiIiIiIiJiYqKi4yMjY2Ojo6Ojo6OjY2NjIyMi4uKiomJiYiJiYmJiYqKi4uMjI2NjY2NjY2NjY2MjIyMi4uLioqJiYmJiYmJioqKi4uMjIyMjY2NjY2NjI2MjIyMi4uLioqKiomJiYmJiYqKioqLi4uMjIyMjIyMjIyMjIyMi4uLi4uKi4qKioqKioqKioqLi4uLjIyMjIyMjIyMjIyLi4uLi4uLioqKioqKioqKioqLi4uLi4yMjIyMjIyMjIuLi4uLi4uLioqKioqKioqKioqKi4uLi4yMjIyMjIyLi4uLi4uLi4uKioqKioqKioqKi4uLi4uLi4yMjIyMi4uLi4uLi4uLi4qKioqKioqKioqLi4uLi4uMjIyLi4uLi4uLi4uLi4qKioqKioqKioqLi4uLi4uLi4uLi4uLi4uLi4uLioqKioqKioqLi4uLi4uLi4uLi4uLi4uLi4uLioqKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqKi4uLi4uLi4uLi4uLi4uLi4uLi4uKioqLi4uLi4uLi4uLi4uLi4uLi4uLi4qKioqLi4uLi4uLi4uLi4uLi4uLi4uLi4qKi4uLi4uLi4uLi4uLi4uLi4uLi4uLioqLi4uLi4uLi4uLi4uLi4uLi4uLi4uKi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4qLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4u...\";\n    notificationAudioRef.current = new Audio(beepSound);\n    notificationAudioRef.current.volume = 0.5;\n    \n    const unlockAudio = () => {\n      audioUnlockedRef.current = true;\n      if (notificationAudioRef.current) {\n        notificationAudioRef.current.play().catch(() => {});\n        notificationAudioRef.current.pause();\n        notificationAudioRef.current.currentTime = 0;\n      }\n    };\n    \n    document.addEventListener('click', unlockAudio, { once: true });\n    document.addEventListener('keydown', unlockAudio, { once: true });\n    document.addEventListener('touchstart', unlockAudio, { once: true });\n    \n    return () => {\n      document.removeEventListener('click', unlockAudio);\n      document.removeEventListener('keydown', unlockAudio);\n      document.removeEventListener('touchstart', unlockAudio);\n    };\n  }, []);\n\n  const { data: chats = [], isLoading: chatsLoading } = useQuery<Chat[]>({\n    queryKey: [\"/api/chats/whatsapp-leads\"],\n    refetchInterval: 5000,\n  });\n  \n  useEffect(() => {\n    const totalUnread = chats.reduce((sum, chat) => sum + chat.unreadCount, 0);\n    \n    if (totalUnread > lastUnreadCountRef.current && audioUnlockedRef.current && notificationAudioRef.current) {\n      notificationAudioRef.current.currentTime = 0;\n      notificationAudioRef.current.play().catch(err => console.log('Audio play failed:', err));\n    }\n    \n    lastUnreadCountRef.current = totalUnread;\n  }, [chats]);\n\n  const { data: templates = [] } = useQuery<Template[]>({\n    queryKey: [\"/api/templates\"],\n  });\n\n  const { data: agents = [] } = useQuery<Agent[]>({\n    queryKey: [\"/api/agents\"],\n  });\n\n  const selectedChat = useMemo(() => \n    chats.find(c => c.id === selectedChatId),\n    [chats, selectedChatId]\n  );\n  \n  const selectedContactId = selectedChat?.contactId;\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [\"/api/messages\", selectedContactId],\n    enabled: !!selectedContactId,\n  });\n\n  const filteredChats = useMemo(() => {\n    let result = chats;\n    \n    if (filterTab === \"unread\") {\n      result = result.filter(chat => chat.unreadCount > 0);\n    }\n    \n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      result = result.filter(chat => \n        chat.contact.name.toLowerCase().includes(query) ||\n        chat.contact.phone.includes(query)\n      );\n    }\n    \n    return result;\n  }, [chats, searchQuery, filterTab]);\n\n  const getContactName = (contact: Contact) => {\n    if (contact.name && !contact.name.startsWith('WhatsApp ') && !contact.name.startsWith('+')) {\n      return contact.name;\n    }\n    return contact.phone;\n  };\n\n  const getInitials = (contact: Contact) => {\n    const name = getContactName(contact);\n    if (name.startsWith('+') || name.match(/^\\d/)) {\n      return name.slice(-2);\n    }\n    return name.split(\" \").map(n => n[0]).join(\"\").toUpperCase().slice(0, 2);\n  };\n\n  const formatTime = (timestamp: string) => {\n    try {\n      const date = new Date(timestamp);\n      if (isNaN(date.getTime())) return \"\";\n      return date.toLocaleString(\"en-US\", {\n        month: \"short\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n        hour12: true,\n      });\n    } catch {\n      return \"\";\n    }\n  };\n\n  const renderMessageContent = (msg: Message) => {\n    const content = msg.content;\n    const mediaUrl = msg.mediaUrl;\n    \n    if (msg.type === 'image' || content.startsWith('[Image')) {\n      if (mediaUrl) {\n        const caption = content.replace(/^\\[Image\\]\\s*/, '').replace(/^\\[Image message\\]$/, '');\n        return (\n          <div className=\"space-y-2\">\n            <img \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              alt=\"Shared image\" \n              className=\"max-w-[280px] max-h-[300px] rounded-lg object-cover cursor-pointer hover:opacity-90 transition-opacity\"\n              onClick={() => window.open(`/api/webhook/whatsapp/media/${mediaUrl}`, '_blank')}\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n                (e.target as HTMLImageElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">Image expired or unavailable</span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'video' || content.startsWith('[Video')) {\n      if (mediaUrl) {\n        const caption = content.replace(/^\\[Video\\]\\s*/, '').replace(/^\\[Video message\\]$/, '');\n        return (\n          <div className=\"space-y-2\">\n            <video \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              controls\n              className=\"max-w-[280px] max-h-[300px] rounded-lg\"\n              onError={(e) => {\n                (e.target as HTMLVideoElement).style.display = 'none';\n                (e.target as HTMLVideoElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">Video expired or unavailable</span>\n            {caption && <p className=\"text-sm\">{caption}</p>}\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'audio' || content.startsWith('[Audio')) {\n      if (mediaUrl) {\n        return (\n          <div className=\"space-y-2\">\n            <audio \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              controls\n              className=\"max-w-[280px]\"\n              onError={(e) => {\n                (e.target as HTMLAudioElement).style.display = 'none';\n                (e.target as HTMLAudioElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">Audio expired or unavailable</span>\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'sticker' || content.startsWith('[Sticker')) {\n      if (mediaUrl) {\n        return (\n          <div>\n            <img \n              src={`/api/webhook/whatsapp/media/${mediaUrl}`} \n              alt=\"Sticker\" \n              className=\"max-w-[150px] max-h-[150px]\"\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n                (e.target as HTMLImageElement).nextElementSibling?.classList.remove('hidden');\n              }}\n            />\n            <span className=\"hidden text-muted-foreground italic text-sm\">Sticker expired or unavailable</span>\n          </div>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (msg.type === 'document' || content.startsWith('[Document')) {\n      if (mediaUrl) {\n        const filename = content.match(/\\[Document: ([^\\]]+)\\]/)?.[1] || 'document';\n        return (\n          <a \n            href={`/api/webhook/whatsapp/media/${mediaUrl}`} \n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"flex items-center gap-2 p-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors\"\n          >\n            <span className=\"text-lg\"></span>\n            <span className=\"text-sm underline\">{filename}</span>\n          </a>\n        );\n      }\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Location')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Contact')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    } else if (content.startsWith('[Reaction')) {\n      return <span className=\"flex items-center gap-1\">{content}</span>;\n    } else if (content.startsWith('[Unsupported')) {\n      return <span className=\"flex items-center gap-1 text-muted-foreground italic\"> {content}</span>;\n    }\n    \n    return <span>{content}</span>;\n  };\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ content, phone, contactId, replyToMessageId, replyToContent }: { \n      content: string; \n      phone: string; \n      contactId: string;\n      replyToMessageId?: string;\n      replyToContent?: string;\n    }) => {\n      const waRes = await fetchWithAuth(\"/api/webhook/whatsapp/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          to: phone,\n          message: replyToContent ? `> ${replyToContent.substring(0, 50)}${replyToContent.length > 50 ? '...' : ''}\\n\\n${content}` : content,\n        }),\n      });\n      \n      if (!waRes.ok) {\n        const error = await waRes.json();\n        throw new Error(error.error || \"Failed to send WhatsApp message\");\n      }\n      \n      const res = await fetchWithAuth(\"/api/messages\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          contactId,\n          content,\n          type: \"text\",\n          direction: \"outbound\",\n          status: \"sent\",\n          replyToMessageId,\n          replyToContent,\n        }),\n      });\n      \n      if (!res.ok) throw new Error(\"Failed to save message\");\n      return { result: await res.json(), contactId };\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/messages\", data.contactId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/whatsapp-leads\"] });\n      setMessageInput(\"\");\n      setReplyingTo(null);\n      toast.success(\"Message sent via WhatsApp\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || \"Failed to send message\");\n    },\n  });\n\n  const sendBulkMessageMutation = useMutation({\n    mutationFn: async (data: { contacts: string[], messageType: string, content: string }) => {\n      const results: { success: number; failed: number } = { success: 0, failed: 0 };\n      \n      for (const chatId of data.contacts) {\n        const chat = chats.find(c => c.id === chatId);\n        if (!chat) continue;\n        \n        const phone = chat.contact.phone.replace(/\\D/g, '');\n        \n        try {\n          await fetchWithAuth(\"/api/webhook/whatsapp/send\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              to: phone,\n              message: data.content,\n            }),\n          });\n          \n          await fetchWithAuth(\"/api/messages\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              contactId: chat.contactId,\n              content: data.content,\n              type: \"text\",\n              direction: \"outbound\",\n              status: \"sent\",\n            }),\n          });\n          \n          results.success++;\n        } catch {\n          results.failed++;\n        }\n      }\n      \n      return results;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/whatsapp-leads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setSelectedContacts([]);\n      setIsBulkSendOpen(false);\n      setCustomMessage(\"\");\n      setSelectedTemplate(\"\");\n      setSelectedAgent(\"\");\n      if (data.failed > 0) {\n        toast.success(`Sent to ${data.success} contacts, ${data.failed} failed`);\n      } else {\n        toast.success(`Message sent to ${data.success} contact${data.success > 1 ? 's' : ''}`);\n      }\n    },\n    onError: () => {\n      toast.error(\"Failed to send messages\");\n    },\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetchWithAuth(`/api/chats/${contactId}/mark-read`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as read\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/whatsapp-leads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n    },\n  });\n\n  const markAsUnreadMutation = useMutation({\n    mutationFn: async (contactId: string) => {\n      const res = await fetchWithAuth(`/api/chats/${contactId}/mark-unread`, {\n        method: \"POST\",\n      });\n      if (!res.ok) throw new Error(\"Failed to mark as unread\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/whatsapp-leads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      toast.success(\"Marked as unread\");\n    },\n  });\n\n  const [blockDialogOpen, setBlockDialogOpen] = useState(false);\n  const [contactToBlock, setContactToBlock] = useState<{ phone: string; name: string } | null>(null);\n\n  const blockContactMutation = useMutation({\n    mutationFn: async ({ phone, name }: { phone: string; name: string }) => {\n      const res = await fetchWithAuth(\"/api/contacts/block\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phone, name, reason: \"Blocked from WhatsApp Leads\" }),\n      });\n      if (!res.ok) throw new Error(\"Failed to block contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats/whatsapp-leads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/chats\"] });\n      setBlockDialogOpen(false);\n      setContactToBlock(null);\n      setSelectedChatId(null);\n      toast.success(\"Contact blocked successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to block contact\");\n    },\n  });\n\n  const handleSelectChat = (chatId: string) => {\n    setSelectedChatId(chatId);\n    const chat = chats.find(c => c.id === chatId);\n    if (chat && chat.unreadCount > 0) {\n      markAsReadMutation.mutate(chat.contactId);\n    }\n  };\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedChat || !selectedContactId) return;\n    const phone = selectedChat.contact.phone.replace(/\\D/g, '');\n    \n    sendMessageMutation.mutate({ \n      content: messageInput, \n      phone, \n      contactId: selectedContactId,\n      replyToMessageId: replyingTo?.id,\n      replyToContent: replyingTo?.content,\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      setSelectedContacts(filteredChats.map(c => c.id));\n    } else {\n      setSelectedContacts([]);\n    }\n  };\n\n  const handleSelectContact = (chatId: string, checked: boolean) => {\n    if (checked) {\n      setSelectedContacts([...selectedContacts, chatId]);\n    } else {\n      setSelectedContacts(selectedContacts.filter(id => id !== chatId));\n    }\n  };\n\n  const handleBulkSend = () => {\n    if (selectedContacts.length === 0) {\n      toast.error(\"Please select at least one contact\");\n      return;\n    }\n    setIsBulkSendOpen(true);\n  };\n\n  const handleConfirmBulkSend = () => {\n    let content = \"\";\n    \n    if (messageType === \"template\") {\n      const template = templates.find(t => t.id === selectedTemplate);\n      content = template?.content || \"\";\n    } else if (messageType === \"custom\") {\n      content = customMessage;\n    } else if (messageType === \"ai\") {\n      const agent = agents.find(a => a.id === selectedAgent);\n      content = agent?.description || \"AI agent will respond\";\n    }\n    \n    if (!content) {\n      toast.error(\"Please enter a message or select a template\");\n      return;\n    }\n    \n    sendBulkMessageMutation.mutate({\n      contacts: selectedContacts,\n      messageType,\n      content,\n    });\n  };\n\n  const handleDownloadList = () => {\n    const csvContent = [\n      [\"Name\", \"Phone\", \"Last Message\", \"Last Message Time\"].join(\",\"),\n      ...filteredChats.map(chat => [\n        getContactName(chat.contact),\n        chat.contact.phone,\n        `\"${(chat.lastInboundMessage || '').replace(/\"/g, '\"\"')}\"`,\n        chat.lastInboundMessageTime || ''\n      ].join(\",\"))\n    ].join(\"\\n\");\n    \n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `whatsapp-leads-${new Date().toISOString().split('T')[0]}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const totalUnread = chats.reduce((sum, chat) => sum + chat.unreadCount, 0);\n\n  return (\n    <DashboardLayout>\n      <div className=\"h-full flex flex-col gap-4\">\n        <div className=\"flex items-center justify-between flex-shrink-0\">\n          <div>\n            <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n              <Users className=\"h-6 w-6 text-primary\" />\n              WhatsApp Leads\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">\n              New contacts who messaged you (not in your contact list). Assign AI agents based on their first message.\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {selectedContacts.length > 0 && (\n              <Button onClick={handleBulkSend} className=\"gap-2\">\n                <Send className=\"h-4 w-4\" />\n                Send to {selectedContacts.length} Selected\n              </Button>\n            )}\n            <Button variant=\"outline\" onClick={handleDownloadList} className=\"gap-2\">\n              <Download className=\"h-4 w-4\" />\n              Download List\n            </Button>\n          </div>\n        </div>\n        \n        <div className=\"flex flex-1 min-h-0 bg-card border border-border rounded-lg overflow-hidden shadow-sm\">\n          <div className=\"w-96 border-r border-border flex flex-col bg-background min-h-0\">\n            <div className=\"p-3 space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <Checkbox \n                  checked={selectedContacts.length === filteredChats.length && filteredChats.length > 0}\n                  onCheckedChange={(checked) => handleSelectAll(checked as boolean)}\n                />\n                <span className=\"text-sm text-muted-foreground\">\n                  Select All ({filteredChats.length} leads)\n                </span>\n              </div>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input \n                  placeholder=\"Search leads...\" \n                  className=\"pl-9\" \n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n              </div>\n              <Tabs value={filterTab} onValueChange={(v) => setFilterTab(v as \"all\" | \"unread\")}>\n                <TabsList className=\"grid w-full grid-cols-2\">\n                  <TabsTrigger value=\"all\">All</TabsTrigger>\n                  <TabsTrigger value=\"unread\" className=\"gap-1\">\n                    Unread\n                    {totalUnread > 0 && (\n                      <Badge variant=\"destructive\" className=\"h-5 px-1.5 text-xs\">\n                        {totalUnread}\n                      </Badge>\n                    )}\n                  </TabsTrigger>\n                </TabsList>\n              </Tabs>\n            </div>\n            \n            <ScrollArea className=\"flex-1\">\n              {chatsLoading ? (\n                <div className=\"flex items-center justify-center h-32\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                </div>\n              ) : filteredChats.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-32 text-muted-foreground\">\n                  <Users className=\"h-8 w-8 mb-2\" />\n                  <p className=\"text-sm\">No WhatsApp leads yet</p>\n                  <p className=\"text-xs\">New contacts will appear here</p>\n                </div>\n              ) : (\n                <div className=\"divide-y divide-border\">\n                {filteredChats.map((chat) => (\n                  <div \n                    key={chat.id}\n                    className={`flex items-start gap-2 p-3 cursor-pointer hover:bg-muted/50 transition-colors ${\n                      selectedChatId === chat.id ? \"bg-muted/50\" : \"\"\n                    }`}\n                  >\n                    <Checkbox \n                      checked={selectedContacts.includes(chat.id)}\n                      onCheckedChange={(checked) => handleSelectContact(chat.id, checked as boolean)}\n                      onClick={(e) => e.stopPropagation()}\n                      className=\"mt-1\"\n                    />\n                    <div \n                      className=\"flex-1 min-w-0 flex items-start gap-2\"\n                      onClick={() => handleSelectChat(chat.id)}\n                    >\n                      <Avatar className=\"h-9 w-9\">\n                        <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                          {getInitials(chat.contact)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-1.5\">\n                            <span className=\"text-sm font-medium truncate\">{getContactName(chat.contact)}</span>\n                            {chat.unreadCount > 0 && (\n                              <span className=\"h-4 w-4 rounded-full bg-primary text-primary-foreground text-[9px] flex items-center justify-center font-medium\">\n                                {chat.unreadCount}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                          {chat.lastInboundMessage || \"No message\"}\n                        </p>\n                        <Badge variant=\"outline\" className=\"text-[10px] bg-blue-50 text-blue-700 border-blue-200 mt-1 py-0\">\n                          <UserPlus className=\"h-2.5 w-2.5 mr-0.5\" />\n                          New Lead\n                        </Badge>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n          \n          {selectedChat ? (\n            <div className=\"flex-1 flex flex-col\">\n              <div className=\"p-4 border-b border-border flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-10 w-10\">\n                    <AvatarFallback className=\"bg-primary/10 text-primary\">\n                      {getInitials(selectedChat.contact)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <h3 className=\"font-medium\">{getContactName(selectedChat.contact)}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-xs text-muted-foreground\">{selectedChat.contact.phone}</span>\n                      <Badge variant=\"outline\" className=\"text-xs bg-blue-50 text-blue-700 border-blue-200\">\n                        <UserPlus className=\"h-3 w-3 mr-1\" />\n                        WhatsApp Lead\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Button variant=\"ghost\" size=\"icon\"><Phone className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                  <Button variant=\"ghost\" size=\"icon\"><Video className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\"><MoreVertical className=\"h-5 w-5 text-muted-foreground\" /></Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem onClick={() => markAsUnreadMutation.mutate(selectedChat.contactId)}>\n                        <MailOpen className=\"mr-2 h-4 w-4\" />\n                        Mark as Unread\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        className=\"text-destructive\"\n                        onClick={() => {\n                          setContactToBlock({\n                            phone: selectedChat.contact.phone,\n                            name: selectedChat.contact.name,\n                          });\n                          setBlockDialogOpen(true);\n                        }}\n                      >\n                        <Ban className=\"mr-2 h-4 w-4\" />\n                        Block Contact\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </div>\n\n              <ScrollArea className=\"flex-1 p-6\">\n                {messagesLoading ? (\n                  <div className=\"flex items-center justify-center h-full\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                  </div>\n                ) : messages.length === 0 ? (\n                  <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                    No messages yet. Start the conversation!\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {messages.map((msg) => (\n                      <div \n                        key={msg.id} \n                        className={`flex ${msg.direction === 'inbound' ? 'justify-start' : 'justify-end'} group`}\n                      >\n                        <div className={`flex items-start gap-1 ${msg.direction === 'inbound' ? 'flex-row' : 'flex-row-reverse'}`}>\n                          {msg.direction === 'inbound' && (\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\" \n                              className=\"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                              onClick={() => setReplyingTo(msg)}\n                            >\n                              <Reply className=\"h-3 w-3\" />\n                            </Button>\n                          )}\n                          <div \n                            className={`\n                              max-w-[70%] rounded-lg px-4 py-2 shadow-sm relative\n                              ${msg.direction === 'inbound' \n                                ? 'bg-white dark:bg-card text-card-foreground rounded-tl-none' \n                                : 'bg-[#d9fdd3] dark:bg-primary/20 text-foreground rounded-tr-none'\n                              }\n                            `}\n                          >\n                            {msg.replyToContent && (\n                              <div className=\"mb-2 p-2 bg-black/5 dark:bg-white/10 rounded border-l-2 border-primary/50 text-xs text-muted-foreground\">\n                                <Reply className=\"h-3 w-3 inline mr-1\" />\n                                {msg.replyToContent.substring(0, 60)}\n                                {msg.replyToContent.length > 60 && '...'}\n                              </div>\n                            )}\n                            <div className=\"text-sm leading-relaxed\">{renderMessageContent(msg)}</div>\n                            <span className=\"text-[10px] text-muted-foreground/80 block text-right mt-1\">\n                              {formatTime(msg.timestamp)}\n                              {msg.direction === 'outbound' && (\n                                <span className={`ml-1 ${msg.status === 'read' ? 'text-blue-500' : msg.status === 'failed' ? 'text-red-500' : ''}`}>\n                                  {msg.status === 'read' ? '' : msg.status === 'delivered' ? '' : msg.status === 'failed' ? '' : ''}\n                                </span>\n                              )}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                    <div ref={messagesEndRef} />\n                  </div>\n                )}\n              </ScrollArea>\n\n              <div className=\"p-4 bg-background border-t border-border\">\n                {replyingTo && (\n                  <div className=\"mb-2 p-2 bg-muted rounded-lg flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Reply className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"text-muted-foreground\">Replying to:</span>\n                      <span className=\"truncate max-w-[300px]\">{replyingTo.content}</span>\n                    </div>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setReplyingTo(null)}>\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                )}\n                <div className=\"flex items-center gap-2\">\n                  <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground\">\n                    <Smile className=\"h-6 w-6\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground\">\n                    <Paperclip className=\"h-6 w-6\" />\n                  </Button>\n                  <Input \n                    placeholder=\"Type a message...\" \n                    className=\"flex-1 bg-secondary/50 border-none focus-visible:ring-1\"\n                    value={messageInput}\n                    onChange={(e) => setMessageInput(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                  />\n                  <Button \n                    size=\"icon\" \n                    className=\"rounded-full h-10 w-10\"\n                    onClick={handleSendMessage}\n                    disabled={!messageInput.trim() || sendMessageMutation.isPending}\n                  >\n                    {sendMessageMutation.isPending ? (\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\n                    ) : (\n                      <Send className=\"h-5 w-5\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n              <div className=\"text-center\">\n                <Users className=\"h-16 w-16 mx-auto mb-4 opacity-20\" />\n                <h3 className=\"text-lg font-medium\">Select a Lead</h3>\n                <p className=\"text-sm\">Choose a lead from the list to view conversation</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <Dialog open={isBulkSendOpen} onOpenChange={setIsBulkSendOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Send Message to {selectedContacts.length} Leads</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg text-sm text-blue-700 dark:text-blue-400\">\n              <Users className=\"h-4 w-4 inline mr-2\" />\n              You can send custom messages to WhatsApp leads without template restrictions.\n            </div>\n            \n            <Tabs value={messageType} onValueChange={(v) => setMessageType(v as \"template\" | \"custom\" | \"ai\")}>\n              <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"template\" className=\"gap-1\">\n                  <FileText className=\"h-4 w-4\" />\n                  Template\n                </TabsTrigger>\n                <TabsTrigger value=\"custom\" className=\"gap-1\">\n                  <MessageSquare className=\"h-4 w-4\" />\n                  Custom\n                </TabsTrigger>\n                <TabsTrigger value=\"ai\" className=\"gap-1\">\n                  <Bot className=\"h-4 w-4\" />\n                  AI Agent\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"template\" className=\"space-y-4 mt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select Template</Label>\n                  <Select value={selectedTemplate} onValueChange={setSelectedTemplate}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose a template\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {templates.filter(t => t.status === 'APPROVED').map(template => (\n                        <SelectItem key={template.id} value={template.id}>\n                          {template.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedTemplate && (\n                  <div className=\"p-3 bg-muted rounded-lg text-sm\">\n                    {templates.find(t => t.id === selectedTemplate)?.content}\n                  </div>\n                )}\n              </TabsContent>\n              \n              <TabsContent value=\"custom\" className=\"space-y-4 mt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Custom Message</Label>\n                  <Textarea \n                    placeholder=\"Type your message...\" \n                    value={customMessage}\n                    onChange={(e) => setCustomMessage(e.target.value)}\n                    rows={4}\n                  />\n                </div>\n              </TabsContent>\n              \n              <TabsContent value=\"ai\" className=\"space-y-4 mt-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select AI Agent</Label>\n                  <Select value={selectedAgent} onValueChange={setSelectedAgent}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose an AI agent\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {agents.filter(a => a.isActive).map(agent => (\n                        <SelectItem key={agent.id} value={agent.id}>\n                          {agent.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {selectedAgent && (\n                  <div className=\"p-3 bg-muted rounded-lg text-sm\">\n                    {agents.find(a => a.id === selectedAgent)?.description}\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsBulkSendOpen(false)}>Cancel</Button>\n            <Button \n              onClick={handleConfirmBulkSend}\n              disabled={sendBulkMessageMutation.isPending}\n            >\n              {sendBulkMessageMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Sending...\n                </>\n              ) : (\n                <>\n                  <Send className=\"mr-2 h-4 w-4\" />\n                  Send to All\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Block Contact</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to block {contactToBlock?.name || contactToBlock?.phone}? \n              They will no longer be able to send you messages.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              onClick={() => contactToBlock && blockContactMutation.mutate(contactToBlock)}\n            >\n              Block\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":42577,"size_tokens":null},"server/scripts/migrate-to-mongodb.ts":{"content":"import fs from 'fs';\nimport path from 'path';\nimport * as mongodb from '../modules/storage/mongodb.adapter';\n\nconst DATA_FILE = path.join(process.cwd(), 'data', 'storage.json');\n\ninterface StorageData {\n  users: any[];\n  contacts: any[];\n  messages: any[];\n  campaigns: any[];\n  templates: any[];\n  automations: any[];\n  teamMembers: any[];\n  whatsappSettings: any | null;\n  billing: any;\n  chats: any[];\n}\n\nasync function migrate() {\n  console.log('[Migration] Starting migration from storage.json to MongoDB...');\n  \n  if (!fs.existsSync(DATA_FILE)) {\n    console.log('[Migration] No storage.json file found. Nothing to migrate.');\n    return;\n  }\n\n  try {\n    const rawData = fs.readFileSync(DATA_FILE, 'utf-8');\n    const data: StorageData = JSON.parse(rawData);\n    \n    console.log('[Migration] Found data to migrate:');\n    console.log(`  - Users: ${data.users?.length || 0}`);\n    console.log(`  - Contacts: ${data.contacts?.length || 0}`);\n    console.log(`  - Messages: ${data.messages?.length || 0}`);\n    console.log(`  - Campaigns: ${data.campaigns?.length || 0}`);\n    console.log(`  - Templates: ${data.templates?.length || 0}`);\n    console.log(`  - Automations: ${data.automations?.length || 0}`);\n    console.log(`  - Team Members: ${data.teamMembers?.length || 0}`);\n    console.log(`  - Chats: ${data.chats?.length || 0}`);\n    \n    await mongodb.connectToMongoDB();\n    \n    if (data.users?.length > 0) {\n      console.log('[Migration] Migrating users...');\n      const existingUsers = await mongodb.findMany<any>('users', {});\n      const existingIds = new Set(existingUsers.map((u: any) => u.id));\n      const newUsers = data.users.filter(u => !existingIds.has(u.id));\n      if (newUsers.length > 0) {\n        await mongodb.insertMany('users', newUsers);\n      }\n      console.log(`[Migration] Users migrated: ${newUsers.length} new, ${data.users.length - newUsers.length} existing`);\n    }\n\n    if (data.contacts?.length > 0) {\n      console.log('[Migration] Migrating contacts...');\n      const existingContacts = await mongodb.findMany<any>('contacts', {});\n      const existingIds = new Set(existingContacts.map((c: any) => c.id));\n      const newContacts = data.contacts.filter(c => !existingIds.has(c.id));\n      if (newContacts.length > 0) {\n        await mongodb.insertMany('contacts', newContacts);\n      }\n      console.log(`[Migration] Contacts migrated: ${newContacts.length} new, ${data.contacts.length - newContacts.length} existing`);\n    }\n\n    if (data.messages?.length > 0) {\n      console.log('[Migration] Migrating messages...');\n      const existingMessages = await mongodb.findMany<any>('messages', {});\n      const existingIds = new Set(existingMessages.map((m: any) => m.id));\n      const newMessages = data.messages.filter(m => !existingIds.has(m.id));\n      if (newMessages.length > 0) {\n        const batchSize = 100;\n        for (let i = 0; i < newMessages.length; i += batchSize) {\n          const batch = newMessages.slice(i, i + batchSize);\n          await mongodb.insertMany('messages', batch);\n          console.log(`[Migration] Messages batch ${Math.floor(i/batchSize) + 1}/${Math.ceil(newMessages.length/batchSize)} migrated`);\n        }\n      }\n      console.log(`[Migration] Messages migrated: ${newMessages.length} new, ${data.messages.length - newMessages.length} existing`);\n    }\n\n    if (data.campaigns?.length > 0) {\n      console.log('[Migration] Migrating campaigns...');\n      const existingCampaigns = await mongodb.findMany<any>('campaigns', {});\n      const existingIds = new Set(existingCampaigns.map((c: any) => c.id));\n      const newCampaigns = data.campaigns.filter(c => !existingIds.has(c.id));\n      if (newCampaigns.length > 0) {\n        await mongodb.insertMany('campaigns', newCampaigns);\n      }\n      console.log(`[Migration] Campaigns migrated: ${newCampaigns.length} new`);\n    }\n\n    if (data.templates?.length > 0) {\n      console.log('[Migration] Migrating templates...');\n      const existingTemplates = await mongodb.findMany<any>('templates', {});\n      const existingIds = new Set(existingTemplates.map((t: any) => t.id));\n      const newTemplates = data.templates.filter(t => !existingIds.has(t.id));\n      if (newTemplates.length > 0) {\n        await mongodb.insertMany('templates', newTemplates);\n      }\n      console.log(`[Migration] Templates migrated: ${newTemplates.length} new`);\n    }\n\n    if (data.automations?.length > 0) {\n      console.log('[Migration] Migrating automations...');\n      const existingAutomations = await mongodb.findMany<any>('automations', {});\n      const existingIds = new Set(existingAutomations.map((a: any) => a.id));\n      const newAutomations = data.automations.filter(a => !existingIds.has(a.id));\n      if (newAutomations.length > 0) {\n        await mongodb.insertMany('automations', newAutomations);\n      }\n      console.log(`[Migration] Automations migrated: ${newAutomations.length} new`);\n    }\n\n    if (data.teamMembers?.length > 0) {\n      console.log('[Migration] Migrating team members...');\n      const existingMembers = await mongodb.findMany<any>('team_members', {});\n      const existingIds = new Set(existingMembers.map((m: any) => m.id));\n      const newMembers = data.teamMembers.filter(m => !existingIds.has(m.id));\n      if (newMembers.length > 0) {\n        await mongodb.insertMany('team_members', newMembers);\n      }\n      console.log(`[Migration] Team members migrated: ${newMembers.length} new`);\n    }\n\n    if (data.whatsappSettings) {\n      console.log('[Migration] Migrating WhatsApp settings...');\n      const existing = await mongodb.findOne('whatsapp_settings', { id: data.whatsappSettings.id });\n      if (!existing) {\n        await mongodb.insertOne('whatsapp_settings', data.whatsappSettings);\n        console.log('[Migration] WhatsApp settings migrated');\n      } else {\n        console.log('[Migration] WhatsApp settings already exist');\n      }\n    }\n\n    if (data.billing) {\n      console.log('[Migration] Migrating billing...');\n      const existing = await mongodb.findOne('billing', { id: data.billing.id });\n      if (!existing) {\n        await mongodb.insertOne('billing', data.billing);\n        console.log('[Migration] Billing migrated');\n      } else {\n        console.log('[Migration] Billing already exists');\n      }\n    }\n\n    console.log('[Migration] Creating chats from contacts and messages...');\n    const contacts = await mongodb.findMany<any>('contacts', {});\n    const messages = await mongodb.findMany<any>('messages', {});\n    const existingChats = await mongodb.findMany<any>('chats', {});\n    const existingChatContactIds = new Set(existingChats.map((c: any) => c.contactId));\n    \n    const newChats: any[] = [];\n    for (const contact of contacts) {\n      if (!existingChatContactIds.has(contact.id)) {\n        const contactMessages = messages.filter((m: any) => m.contactId === contact.id);\n        const lastMessage = contactMessages[contactMessages.length - 1];\n        const inboundMessages = contactMessages.filter((m: any) => m.direction === \"inbound\");\n        const lastInboundMessage = inboundMessages[inboundMessages.length - 1];\n        \n        newChats.push({\n          id: `chat-${contact.id}`,\n          contactId: contact.id,\n          lastMessage: lastMessage?.content,\n          lastMessageTime: lastMessage?.timestamp,\n          lastInboundMessageTime: lastInboundMessage?.timestamp,\n          lastInboundMessage: lastInboundMessage?.content,\n          unreadCount: contactMessages.filter((m: any) => m.direction === \"inbound\" && m.status !== \"read\").length,\n          status: \"open\",\n          notes: [],\n        });\n      }\n    }\n    \n    if (newChats.length > 0) {\n      await mongodb.insertMany('chats', newChats);\n    }\n    console.log(`[Migration] Chats created: ${newChats.length} new, ${existingChats.length} existing`);\n\n    console.log('[Migration] Migration completed successfully!');\n    console.log('[Migration] You can now safely delete storage.json if everything works correctly.');\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('[Migration] Error during migration:', error);\n    process.exit(1);\n  }\n}\n\nmigrate();\n","path":null,"size_bytes":8162,"size_tokens":null},"server/modules/credentials/credentials.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport { requireAuth, getUserId } from '../auth/auth.routes';\nimport * as credentialsService from './credentials.service';\nimport { decrypt } from '../encryption/encryption.service';\n\nconst router = Router();\n\nrouter.get('/', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const stored = await credentialsService.getCredentialsByUserId(userId);\n    \n    if (!stored) {\n      return res.json({ \n        hasCredentials: false,\n        credentials: null,\n        status: { hasWhatsApp: false, hasOpenAI: false, hasGemini: false, hasFacebook: false, isVerified: false }\n      });\n    }\n\n    const masked = await credentialsService.getMaskedCredentialsForUser(userId);\n    const status = await credentialsService.getCredentialStatus(userId);\n\n    res.json({\n      hasCredentials: true,\n      credentials: masked,\n      status,\n      isVerified: stored.isVerified,\n      lastVerifiedAt: stored.lastVerifiedAt,\n    });\n  } catch (error) {\n    console.error('[Credentials API] Error fetching credentials:', error);\n    res.status(500).json({ error: 'Failed to fetch credentials' });\n  }\n});\n\nrouter.post('/', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const {\n      whatsappToken,\n      phoneNumberId,\n      businessAccountId,\n      webhookVerifyToken,\n      appId,\n      appSecret,\n      openaiApiKey,\n      geminiApiKey,\n      facebookAccessToken,\n      facebookPageId,\n    } = req.body;\n\n    const saved = await credentialsService.saveCredentials(userId, {\n      whatsappToken,\n      phoneNumberId,\n      businessAccountId,\n      webhookVerifyToken,\n      appId,\n      appSecret,\n      openaiApiKey,\n      geminiApiKey,\n      facebookAccessToken,\n      facebookPageId,\n    });\n\n    if (!saved) {\n      return res.status(500).json({ error: 'Failed to save credentials' });\n    }\n\n    const masked = await credentialsService.getMaskedCredentialsForUser(userId);\n    const status = await credentialsService.getCredentialStatus(userId);\n\n    res.json({\n      success: true,\n      message: 'Credentials saved successfully',\n      credentials: masked,\n      status,\n    });\n  } catch (error) {\n    console.error('[Credentials API] Error saving credentials:', error);\n    res.status(500).json({ error: 'Failed to save credentials' });\n  }\n});\n\nrouter.post('/test/whatsapp', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const creds = await credentialsService.getDecryptedCredentials(userId);\n    if (!creds || !creds.whatsappToken || !creds.phoneNumberId) {\n      return res.status(400).json({ error: 'WhatsApp credentials not configured' });\n    }\n\n    const testResponse = await fetch(\n      `https://graph.facebook.com/v18.0/${creds.phoneNumberId}?fields=verified_name,display_phone_number`,\n      {\n        headers: {\n          Authorization: `Bearer ${creds.whatsappToken}`,\n        },\n      }\n    );\n\n    if (!testResponse.ok) {\n      const errorData = await testResponse.json();\n      await credentialsService.updateVerificationStatus(userId, false);\n      return res.status(400).json({ \n        error: 'WhatsApp API connection failed',\n        details: errorData.error?.message || 'Invalid credentials'\n      });\n    }\n\n    const data = await testResponse.json();\n    await credentialsService.updateVerificationStatus(userId, true);\n\n    res.json({\n      success: true,\n      message: 'WhatsApp API connection successful',\n      phoneNumber: data.display_phone_number,\n      verifiedName: data.verified_name,\n    });\n  } catch (error: any) {\n    console.error('[Credentials API] WhatsApp test error:', error);\n    const errorUserId = getUserId(req);\n    if (errorUserId) {\n      await credentialsService.updateVerificationStatus(errorUserId, false);\n    }\n    res.status(500).json({ error: 'Failed to test WhatsApp connection', details: error.message });\n  }\n});\n\nrouter.post('/test/openai', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const creds = await credentialsService.getDecryptedCredentials(userId);\n    if (!creds || !creds.openaiApiKey) {\n      return res.status(400).json({ error: 'OpenAI API key not configured' });\n    }\n\n    const testResponse = await fetch('https://api.openai.com/v1/models', {\n      headers: {\n        Authorization: `Bearer ${creds.openaiApiKey}`,\n      },\n    });\n\n    if (!testResponse.ok) {\n      return res.status(400).json({ \n        error: 'OpenAI API connection failed',\n        details: 'Invalid API key'\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'OpenAI API connection successful',\n    });\n  } catch (error: any) {\n    console.error('[Credentials API] OpenAI test error:', error);\n    res.status(500).json({ error: 'Failed to test OpenAI connection', details: error.message });\n  }\n});\n\nrouter.post('/test/facebook', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const creds = await credentialsService.getDecryptedCredentials(userId);\n    if (!creds || !creds.facebookAccessToken) {\n      return res.status(400).json({ error: 'Facebook access token not configured' });\n    }\n\n    const testResponse = await fetch(\n      `https://graph.facebook.com/v18.0/me?fields=id,name&access_token=${creds.facebookAccessToken}`\n    );\n\n    if (!testResponse.ok) {\n      return res.status(400).json({ \n        error: 'Facebook API connection failed',\n        details: 'Invalid access token'\n      });\n    }\n\n    const data = await testResponse.json();\n    res.json({\n      success: true,\n      message: 'Facebook API connection successful',\n      name: data.name,\n    });\n  } catch (error: any) {\n    console.error('[Credentials API] Facebook test error:', error);\n    res.status(500).json({ error: 'Failed to test Facebook connection', details: error.message });\n  }\n});\n\nrouter.delete('/', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    await credentialsService.deleteCredentials(userId);\n    res.json({ success: true, message: 'Credentials deleted successfully' });\n  } catch (error) {\n    console.error('[Credentials API] Error deleting credentials:', error);\n    res.status(500).json({ error: 'Failed to delete credentials' });\n  }\n});\n\nrouter.get('/status', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const status = await credentialsService.getCredentialStatus(userId);\n    res.json(status);\n  } catch (error) {\n    console.error('[Credentials API] Error getting status:', error);\n    res.status(500).json({ error: 'Failed to get credentials status' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":7438,"size_tokens":null},"server/modules/encryption/encryption.service.ts":{"content":"import crypto from 'crypto';\n\nconst ALGORITHM = 'aes-256-gcm';\nconst IV_LENGTH = 16;\nconst AUTH_TAG_LENGTH = 16;\nconst SALT_LENGTH = 32;\n\nfunction getEncryptionKey(): Buffer {\n  const masterKey = process.env.CREDENTIAL_ENCRYPTION_KEY;\n  if (!masterKey) {\n    console.warn('[Encryption] CREDENTIAL_ENCRYPTION_KEY not set, using fallback key (NOT SECURE FOR PRODUCTION)');\n    return crypto.scryptSync('default-insecure-key-change-me', 'salt', 32);\n  }\n  return crypto.scryptSync(masterKey, 'whatsapp-saas-salt', 32);\n}\n\nexport function encrypt(plaintext: string): string {\n  if (!plaintext) return '';\n  \n  const key = getEncryptionKey();\n  const iv = crypto.randomBytes(IV_LENGTH);\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n  \n  let encrypted = cipher.update(plaintext, 'utf8', 'base64');\n  encrypted += cipher.final('base64');\n  \n  const authTag = cipher.getAuthTag();\n  \n  const combined = Buffer.concat([\n    iv,\n    authTag,\n    Buffer.from(encrypted, 'base64')\n  ]);\n  \n  return combined.toString('base64');\n}\n\nexport function decrypt(encryptedData: string): string {\n  if (!encryptedData) return '';\n  \n  try {\n    const key = getEncryptionKey();\n    const combined = Buffer.from(encryptedData, 'base64');\n    \n    const iv = combined.subarray(0, IV_LENGTH);\n    const authTag = combined.subarray(IV_LENGTH, IV_LENGTH + AUTH_TAG_LENGTH);\n    const encrypted = combined.subarray(IV_LENGTH + AUTH_TAG_LENGTH);\n    \n    const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n    decipher.setAuthTag(authTag);\n    \n    let decrypted = decipher.update(encrypted);\n    decrypted = Buffer.concat([decrypted, decipher.final()]);\n    \n    return decrypted.toString('utf8');\n  } catch (error) {\n    console.error('[Encryption] Decryption failed:', error);\n    return '';\n  }\n}\n\nexport function maskSecret(secret: string, visibleChars: number = 4): string {\n  if (!secret || secret.length <= visibleChars * 2) {\n    return '';\n  }\n  const start = secret.substring(0, visibleChars);\n  const end = secret.substring(secret.length - visibleChars);\n  return `${start}${end}`;\n}\n\nexport function isEncrypted(value: string): boolean {\n  if (!value) return false;\n  try {\n    const decoded = Buffer.from(value, 'base64');\n    return decoded.length > IV_LENGTH + AUTH_TAG_LENGTH;\n  } catch {\n    return false;\n  }\n}\n\nexport interface EncryptedCredentials {\n  whatsappToken?: string;\n  phoneNumberId?: string;\n  businessAccountId?: string;\n  webhookVerifyToken?: string;\n  appId?: string;\n  appSecret?: string;\n  openaiApiKey?: string;\n  facebookAccessToken?: string;\n  facebookPageId?: string;\n}\n\nexport interface DecryptedCredentials {\n  whatsappToken: string;\n  phoneNumberId: string;\n  businessAccountId: string;\n  webhookVerifyToken: string;\n  appId: string;\n  appSecret: string;\n  openaiApiKey: string;\n  facebookAccessToken: string;\n  facebookPageId: string;\n}\n\nexport function encryptCredentials(credentials: Partial<DecryptedCredentials>): EncryptedCredentials {\n  const encrypted: EncryptedCredentials = {};\n  \n  if (credentials.whatsappToken) encrypted.whatsappToken = encrypt(credentials.whatsappToken);\n  if (credentials.phoneNumberId) encrypted.phoneNumberId = encrypt(credentials.phoneNumberId);\n  if (credentials.businessAccountId) encrypted.businessAccountId = encrypt(credentials.businessAccountId);\n  if (credentials.webhookVerifyToken) encrypted.webhookVerifyToken = encrypt(credentials.webhookVerifyToken);\n  if (credentials.appId) encrypted.appId = encrypt(credentials.appId);\n  if (credentials.appSecret) encrypted.appSecret = encrypt(credentials.appSecret);\n  if (credentials.openaiApiKey) encrypted.openaiApiKey = encrypt(credentials.openaiApiKey);\n  if (credentials.facebookAccessToken) encrypted.facebookAccessToken = encrypt(credentials.facebookAccessToken);\n  if (credentials.facebookPageId) encrypted.facebookPageId = encrypt(credentials.facebookPageId);\n  \n  return encrypted;\n}\n\nexport function decryptCredentials(encrypted: EncryptedCredentials): DecryptedCredentials {\n  return {\n    whatsappToken: encrypted.whatsappToken ? decrypt(encrypted.whatsappToken) : '',\n    phoneNumberId: encrypted.phoneNumberId ? decrypt(encrypted.phoneNumberId) : '',\n    businessAccountId: encrypted.businessAccountId ? decrypt(encrypted.businessAccountId) : '',\n    webhookVerifyToken: encrypted.webhookVerifyToken ? decrypt(encrypted.webhookVerifyToken) : '',\n    appId: encrypted.appId ? decrypt(encrypted.appId) : '',\n    appSecret: encrypted.appSecret ? decrypt(encrypted.appSecret) : '',\n    openaiApiKey: encrypted.openaiApiKey ? decrypt(encrypted.openaiApiKey) : '',\n    facebookAccessToken: encrypted.facebookAccessToken ? decrypt(encrypted.facebookAccessToken) : '',\n    facebookPageId: encrypted.facebookPageId ? decrypt(encrypted.facebookPageId) : '',\n  };\n}\n\nexport function getMaskedCredentials(encrypted: EncryptedCredentials): Record<string, string> {\n  const decrypted = decryptCredentials(encrypted);\n  return {\n    whatsappToken: maskSecret(decrypted.whatsappToken),\n    phoneNumberId: decrypted.phoneNumberId ? maskSecret(decrypted.phoneNumberId, 3) : '',\n    businessAccountId: decrypted.businessAccountId ? maskSecret(decrypted.businessAccountId, 3) : '',\n    webhookVerifyToken: maskSecret(decrypted.webhookVerifyToken),\n    appId: decrypted.appId ? maskSecret(decrypted.appId, 3) : '',\n    appSecret: maskSecret(decrypted.appSecret),\n    openaiApiKey: maskSecret(decrypted.openaiApiKey, 3),\n    facebookAccessToken: maskSecret(decrypted.facebookAccessToken),\n    facebookPageId: decrypted.facebookPageId ? maskSecret(decrypted.facebookPageId, 3) : '',\n  };\n}\n","path":null,"size_bytes":5656,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { MessageSquare, Lock, Mail, AlertCircle, User, AtSign } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\nexport default function Login() {\n  const [identifier, setIdentifier] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"login\");\n  const { login, register } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    try {\n      const success = await login(identifier, password);\n      if (success) {\n        toast.success(\"Welcome back!\");\n        setLocation(\"/\");\n      } else {\n        setError(\"Invalid email/username or password\");\n      }\n    } catch (err) {\n      setError(\"Login failed. Please try again.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    if (password.length < 6) {\n      setError(\"Password must be at least 6 characters\");\n      setLoading(false);\n      return;\n    }\n\n    try {\n      const result = await register(email, password, name, email);\n      if (result.success) {\n        toast.success(\"Account created successfully!\");\n        setLocation(\"/\");\n      } else {\n        setError(result.error || \"Registration failed\");\n      }\n    } catch (err) {\n      setError(\"Registration failed. Please try again.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 via-white to-teal-50\">\n      <Card className=\"w-full max-w-md mx-4 shadow-xl border-0\">\n        <CardHeader className=\"text-center space-y-4 pb-2\">\n          <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg\">\n            <MessageSquare className=\"h-8 w-8 text-white\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl font-bold text-gray-900\">WhatsApp Business API</CardTitle>\n            <CardDescription className=\"text-gray-500 mt-1\">\n              {activeTab === \"login\" ? \"Sign in to your dashboard\" : \"Create your account\"}\n            </CardDescription>\n          </div>\n        </CardHeader>\n        <CardContent className=\"pt-4\">\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n              <TabsTrigger value=\"login\">Sign In</TabsTrigger>\n              <TabsTrigger value=\"register\">Register</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"login\">\n              <form onSubmit={handleLogin} className=\"space-y-4\">\n                {error && (\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    {error}\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"login-identifier\" className=\"text-gray-700\">Email or Username</Label>\n                  <div className=\"relative\">\n                    <AtSign className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"login-identifier\"\n                      type=\"text\"\n                      placeholder=\"Enter email or username\"\n                      value={identifier}\n                      onChange={(e) => setIdentifier(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"login-password\" className=\"text-gray-700\">Password</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"login-password\"\n                      type=\"password\"\n                      placeholder=\"Enter your password\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                    />\n                  </div>\n                </div>\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700\"\n                  disabled={loading}\n                >\n                  {loading ? \"Signing in...\" : \"Sign In\"}\n                </Button>\n              </form>\n              <div className=\"mt-6 p-3 bg-gray-50 rounded-lg border border-gray-100\">\n              \n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"register\">\n              <form onSubmit={handleRegister} className=\"space-y-4\">\n                {error && (\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    {error}\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"register-name\" className=\"text-gray-700\">Full Name</Label>\n                  <div className=\"relative\">\n                    <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"register-name\"\n                      type=\"text\"\n                      placeholder=\"Your name\"\n                      value={name}\n                      onChange={(e) => setName(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"register-email\" className=\"text-gray-700\">Email</Label>\n                  <div className=\"relative\">\n                    <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"register-email\"\n                      type=\"email\"\n                      placeholder=\"you@example.com\"\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"register-password\" className=\"text-gray-700\">Password</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                    <Input\n                      id=\"register-password\"\n                      type=\"password\"\n                      placeholder=\"Min. 6 characters\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                      minLength={6}\n                    />\n                  </div>\n                </div>\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700\"\n                  disabled={loading}\n                >\n                  {loading ? \"Creating account...\" : \"Create Account\"}\n                </Button>\n              </form>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":8531,"size_tokens":null},"server/modules/auth/auth.routes.ts":{"content":"import { Router, Request, Response, NextFunction } from 'express';\nimport * as authService from './auth.service';\nimport { findUserById } from './auth.service';\n\nconst router = Router();\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  const userId = req.headers['x-user-id'] as string;\n  if (!userId) {\n    return res.status(401).json({ error: 'Unauthorized. Please log in.' });\n  }\n  next();\n}\n\nexport function getUserId(req: Request): string | null {\n  return (req.headers['x-user-id'] as string) || null;\n}\n\nexport function getUser(req: Request): authService.AuthUser | null {\n  const userHeader = req.headers['x-user'] as string;\n  if (!userHeader) return null;\n  try {\n    return JSON.parse(userHeader);\n  } catch {\n    return null;\n  }\n}\n\nrouter.post('/login', async (req: Request, res: Response) => {\n  try {\n    const { username, password } = req.body;\n    \n    if (!username || !password) {\n      return res.status(400).json({ error: 'Username and password are required' });\n    }\n\n    const user = await authService.validateLogin(username, password);\n    \n    if (!user) {\n      return res.status(401).json({ error: 'Invalid username or password' });\n    }\n\n    res.json({ \n      success: true, \n      user: {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n        pageAccess: user.pageAccess,\n      }\n    });\n  } catch (error) {\n    console.error('[Auth] Login error:', error);\n    res.status(500).json({ error: 'Login failed' });\n  }\n});\n\nrouter.post('/register', async (req: Request, res: Response) => {\n  try {\n    const { username, password, name, email } = req.body;\n    \n    if (!username || !password || !name) {\n      return res.status(400).json({ error: 'Username, password, and name are required' });\n    }\n\n    if (password.length < 6) {\n      return res.status(400).json({ error: 'Password must be at least 6 characters' });\n    }\n\n    const user = await authService.createUser(username, password, name, email);\n    \n    if (!user) {\n      return res.status(409).json({ error: 'Username already exists' });\n    }\n\n    res.json({ \n      success: true, \n      user: {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n      }\n    });\n  } catch (error) {\n    console.error('[Auth] Register error:', error);\n    res.status(500).json({ error: 'Registration failed' });\n  }\n});\n\nrouter.post('/logout', (req: Request, res: Response) => {\n  res.json({ success: true });\n});\n\nrouter.get('/me', async (req: Request, res: Response) => {\n  const userId = req.headers['x-user-id'] as string;\n  if (!userId) {\n    return res.status(401).json({ error: 'Not authenticated' });\n  }\n  \n  const user = await findUserById(userId);\n  if (!user) {\n    return res.status(401).json({ error: 'User not found' });\n  }\n  \n  res.json({\n    user: {\n      id: user.id,\n      username: user.username,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n      pageAccess: user.pageAccess,\n    }\n  });\n});\n\nrouter.get('/check', async (req: Request, res: Response) => {\n  const userId = req.headers['x-user-id'] as string;\n  if (!userId) {\n    return res.json({ authenticated: false, user: null });\n  }\n  \n  const user = await findUserById(userId);\n  res.json({\n    authenticated: !!user,\n    user: user ? {\n      id: user.id,\n      username: user.username,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n      pageAccess: user.pageAccess,\n    } : null\n  });\n});\n\nrouter.put('/update-profile', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = req.headers['x-user-id'] as string;\n    const { name, email, phone } = req.body;\n    \n    const updatedUser = await authService.updateUserProfile(userId, { name, email, phone });\n    \n    if (!updatedUser) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n    \n    res.json({\n      success: true,\n      user: {\n        id: updatedUser.id,\n        username: updatedUser.username,\n        name: updatedUser.name,\n        email: updatedUser.email,\n        role: updatedUser.role,\n        pageAccess: updatedUser.pageAccess,\n      }\n    });\n  } catch (error) {\n    console.error('[Auth] Update profile error:', error);\n    res.status(500).json({ error: 'Failed to update profile' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":4440,"size_tokens":null},"server/modules/credentials/credentials.service.ts":{"content":"import crypto from 'crypto';\nimport { UserCredentials } from '../storage/mongodb.adapter';\n\nexport interface CredentialInput {\n  whatsappToken?: string;\n  phoneNumberId?: string;\n  businessAccountId?: string;\n  webhookVerifyToken?: string;\n  appId?: string;\n  appSecret?: string;\n  openaiApiKey?: string;\n  geminiApiKey?: string;\n  facebookAccessToken?: string;\n  facebookPageId?: string;\n}\n\nexport interface StoredCredentials {\n  id: string;\n  userId: string;\n  whatsappToken?: string;\n  phoneNumberId?: string;\n  businessAccountId?: string;\n  webhookVerifyToken?: string;\n  appId?: string;\n  appSecret?: string;\n  openaiApiKey?: string;\n  geminiApiKey?: string;\n  facebookAccessToken?: string;\n  facebookPageId?: string;\n  isVerified: boolean;\n  lastVerifiedAt?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface DecryptedCredentials {\n  whatsappToken: string;\n  phoneNumberId: string;\n  businessAccountId: string;\n  webhookVerifyToken: string;\n  appId: string;\n  appSecret: string;\n  openaiApiKey: string;\n  geminiApiKey: string;\n  facebookAccessToken: string;\n  facebookPageId: string;\n}\n\nexport async function getCredentialsByUserId(userId: string): Promise<StoredCredentials | null> {\n  try {\n    const creds = await UserCredentials.findOne({ userId });\n    if (!creds) return null;\n    return creds.toObject() as StoredCredentials;\n  } catch (error) {\n    console.error('[Credentials] Error getting credentials:', error);\n    return null;\n  }\n}\n\nexport async function getDecryptedCredentials(userId: string): Promise<DecryptedCredentials | null> {\n  try {\n    const stored = await getCredentialsByUserId(userId);\n    if (!stored) return null;\n    \n    return {\n      whatsappToken: stored.whatsappToken || '',\n      phoneNumberId: stored.phoneNumberId || '',\n      businessAccountId: stored.businessAccountId || '',\n      webhookVerifyToken: stored.webhookVerifyToken || '',\n      appId: stored.appId || '',\n      appSecret: stored.appSecret || '',\n      openaiApiKey: stored.openaiApiKey || '',\n      geminiApiKey: stored.geminiApiKey || '',\n      facebookAccessToken: stored.facebookAccessToken || '',\n      facebookPageId: stored.facebookPageId || '',\n    };\n  } catch (error) {\n    console.error('[Credentials] Error getting credentials:', error);\n    return null;\n  }\n}\n\nexport async function getMaskedCredentialsForUser(userId: string): Promise<Record<string, string> | null> {\n  try {\n    const stored = await getCredentialsByUserId(userId);\n    if (!stored) return null;\n    \n    const mask = (val?: string) => {\n      if (!val) return '';\n      if (val.length <= 8) return '****';\n      return val.substring(0, 4) + '****' + val.substring(val.length - 4);\n    };\n    \n    return {\n      whatsappToken: mask(stored.whatsappToken),\n      phoneNumberId: mask(stored.phoneNumberId),\n      businessAccountId: mask(stored.businessAccountId),\n      webhookVerifyToken: mask(stored.webhookVerifyToken),\n      appId: mask(stored.appId),\n      appSecret: mask(stored.appSecret),\n      openaiApiKey: mask(stored.openaiApiKey),\n      geminiApiKey: mask(stored.geminiApiKey),\n      facebookAccessToken: mask(stored.facebookAccessToken),\n      facebookPageId: mask(stored.facebookPageId),\n    };\n  } catch (error) {\n    console.error('[Credentials] Error masking credentials:', error);\n    return null;\n  }\n}\n\nexport async function saveCredentials(userId: string, input: CredentialInput): Promise<StoredCredentials | null> {\n  try {\n    const now = new Date().toISOString();\n    const existing = await UserCredentials.findOne({ userId });\n    \n    const data: Record<string, string> = {};\n    if (input.whatsappToken) data.whatsappToken = input.whatsappToken;\n    if (input.phoneNumberId) data.phoneNumberId = input.phoneNumberId;\n    if (input.businessAccountId) data.businessAccountId = input.businessAccountId;\n    if (input.webhookVerifyToken) data.webhookVerifyToken = input.webhookVerifyToken;\n    if (input.appId) data.appId = input.appId;\n    if (input.appSecret) data.appSecret = input.appSecret;\n    if (input.openaiApiKey) data.openaiApiKey = input.openaiApiKey;\n    if (input.geminiApiKey) data.geminiApiKey = input.geminiApiKey;\n    if (input.facebookAccessToken) data.facebookAccessToken = input.facebookAccessToken;\n    if (input.facebookPageId) data.facebookPageId = input.facebookPageId;\n    \n    if (existing) {\n      const updateData: Record<string, any> = {\n        ...data,\n        updatedAt: now,\n      };\n      \n      await UserCredentials.updateOne(\n        { userId },\n        { $set: updateData }\n      );\n      \n      const updated = await UserCredentials.findOne({ userId });\n      return updated ? updated.toObject() as StoredCredentials : null;\n    } else {\n      const newCreds = await UserCredentials.create({\n        id: crypto.randomUUID(),\n        userId,\n        ...data,\n        isVerified: false,\n        createdAt: now,\n        updatedAt: now,\n      });\n      return newCreds.toObject() as StoredCredentials;\n    }\n  } catch (error) {\n    console.error('[Credentials] Error saving credentials:', error);\n    return null;\n  }\n}\n\nexport async function updateVerificationStatus(userId: string, isVerified: boolean): Promise<boolean> {\n  try {\n    const now = new Date().toISOString();\n    await UserCredentials.updateOne(\n      { userId },\n      { \n        $set: { \n          isVerified,\n          lastVerifiedAt: isVerified ? now : undefined,\n          updatedAt: now,\n        }\n      }\n    );\n    return true;\n  } catch (error) {\n    console.error('[Credentials] Error updating verification status:', error);\n    return false;\n  }\n}\n\nexport async function deleteCredentials(userId: string): Promise<boolean> {\n  try {\n    await UserCredentials.deleteOne({ userId });\n    return true;\n  } catch (error) {\n    console.error('[Credentials] Error deleting credentials:', error);\n    return false;\n  }\n}\n\nexport async function getCredentialsByPhoneNumberId(phoneNumberId: string): Promise<{ userId: string; credentials: DecryptedCredentials } | null> {\n  try {\n    const cred = await UserCredentials.findOne({ phoneNumberId });\n    if (cred) {\n      const decrypted = await getDecryptedCredentials(cred.userId);\n      if (decrypted) {\n        return { userId: cred.userId, credentials: decrypted };\n      }\n    }\n    return null;\n  } catch (error) {\n    console.error('[Credentials] Error finding credentials by phone ID:', error);\n    return null;\n  }\n}\n\nexport async function hasCredentials(userId: string): Promise<boolean> {\n  try {\n    const creds = await UserCredentials.findOne({ userId });\n    return !!creds;\n  } catch (error) {\n    return false;\n  }\n}\n\nexport async function getCredentialStatus(userId: string): Promise<{\n  hasWhatsApp: boolean;\n  hasOpenAI: boolean;\n  hasGemini: boolean;\n  hasFacebook: boolean;\n  isVerified: boolean;\n}> {\n  try {\n    const creds = await getCredentialsByUserId(userId);\n    if (!creds) {\n      return { hasWhatsApp: false, hasOpenAI: false, hasGemini: false, hasFacebook: false, isVerified: false };\n    }\n    \n    return {\n      hasWhatsApp: !!(creds.whatsappToken && creds.phoneNumberId),\n      hasOpenAI: !!creds.openaiApiKey,\n      hasGemini: !!creds.geminiApiKey,\n      hasFacebook: !!creds.facebookAccessToken,\n      isVerified: creds.isVerified,\n    };\n  } catch (error) {\n    return { hasWhatsApp: false, hasOpenAI: false, hasGemini: false, hasFacebook: false, isVerified: false };\n  }\n}\n\nexport async function findUserByPhoneNumberId(phoneNumberId: string): Promise<string | null> {\n  try {\n    const cred = await UserCredentials.findOne({ phoneNumberId });\n    return cred ? cred.userId : null;\n  } catch (error) {\n    console.error('[Credentials] Error finding user by phone ID:', error);\n    return null;\n  }\n}\n\nexport const credentialsService = {\n  getCredentialsByUserId,\n  getDecryptedCredentials,\n  getMaskedCredentialsForUser,\n  saveCredentials,\n  updateVerificationStatus,\n  deleteCredentials,\n  getCredentialsByPhoneNumberId,\n  hasCredentials,\n  getCredentialStatus,\n  findUserByPhoneNumberId,\n};\n","path":null,"size_bytes":8017,"size_tokens":null},"server/modules/auth/auth.service.ts":{"content":"import crypto from 'crypto';\nimport { User, UserCredentials } from '../storage/mongodb.adapter';\nimport { SystemUser } from '../users/user.model';\n\nexport interface AuthUser {\n  id: string;\n  username: string;\n  name: string;\n  email?: string;\n  role: string;\n  pageAccess?: string[];\n}\n\nexport function hashPassword(password: string): string {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.pbkdf2Sync(password, salt, 10000, 64, 'sha512').toString('hex');\n  return `${salt}:${hash}`;\n}\n\nexport function verifyPassword(password: string, storedHash: string): boolean {\n  const [salt, hash] = storedHash.split(':');\n  if (!salt || !hash) return false;\n  const verifyHash = crypto.pbkdf2Sync(password, salt, 10000, 64, 'sha512').toString('hex');\n  return hash === verifyHash;\n}\n\nexport async function findUserByUsername(username: string): Promise<any | null> {\n  try {\n    const user = await User.findOne({ username });\n    return user;\n  } catch (error) {\n    console.error('[Auth] Error finding user:', error);\n    return null;\n  }\n}\n\nexport async function findUserById(id: string): Promise<any | null> {\n  try {\n    const user = await User.findOne({ id });\n    if (user) return user;\n    \n    const systemUser = await SystemUser.findOne({ id, isActive: true });\n    if (systemUser) {\n      return {\n        id: systemUser.id,\n        username: systemUser.username,\n        name: systemUser.name,\n        email: systemUser.email,\n        role: systemUser.role,\n        pageAccess: systemUser.pageAccess,\n      };\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('[Auth] Error finding user by id:', error);\n    return null;\n  }\n}\n\nexport async function createUser(username: string, password: string, name: string, email?: string): Promise<AuthUser | null> {\n  try {\n    const existingUser = await User.findOne({ username });\n    if (existingUser) {\n      return null;\n    }\n\n    const id = crypto.randomUUID();\n    const hashedPassword = hashPassword(password);\n    \n    const user = await User.create({\n      id,\n      username,\n      password: hashedPassword,\n      name,\n      email: email || '',\n      role: 'user',\n      createdAt: new Date().toISOString(),\n    });\n\n    return {\n      id: user.id,\n      username: user.username,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n    };\n  } catch (error) {\n    console.error('[Auth] Error creating user:', error);\n    return null;\n  }\n}\n\nexport async function updateUserProfile(\n  userId: string, \n  updates: { name?: string; email?: string; phone?: string }\n): Promise<AuthUser | null> {\n  try {\n    const user = await User.findOne({ id: userId });\n    if (user) {\n      if (updates.name) user.name = updates.name;\n      if (updates.email) user.email = updates.email;\n      await user.save();\n      return {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n      };\n    }\n\n    const systemUser = await SystemUser.findOne({ id: userId });\n    if (systemUser) {\n      if (updates.name) systemUser.name = updates.name;\n      if (updates.email) systemUser.email = updates.email;\n      await systemUser.save();\n      return {\n        id: systemUser.id,\n        username: systemUser.username,\n        name: systemUser.name,\n        email: systemUser.email,\n        role: systemUser.role,\n        pageAccess: systemUser.pageAccess,\n      };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('[Auth] Error updating profile:', error);\n    return null;\n  }\n}\n\nexport async function validateLogin(username: string, password: string): Promise<AuthUser | null> {\n  try {\n    const user = await findUserByUsername(username);\n    if (user) {\n      if (!verifyPassword(password, user.password)) {\n        return null;\n      }\n      return {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n      };\n    }\n\n    const systemUser = await SystemUser.findOne({ \n      $or: [{ username }, { email: username }],\n      isActive: true \n    });\n    if (systemUser) {\n      if (!verifyPassword(password, systemUser.password)) {\n        return null;\n      }\n      return {\n        id: systemUser.id,\n        username: systemUser.username,\n        name: systemUser.name,\n        email: systemUser.email,\n        role: systemUser.role,\n        pageAccess: systemUser.pageAccess,\n      };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('[Auth] Error validating login:', error);\n    return null;\n  }\n}\n\nexport async function ensureDefaultAdmin(): Promise<void> {\n  try {\n    const adminExists = await User.findOne({ username: 'admin@whatsapp.com' });\n    if (!adminExists) {\n      console.log('[Auth] Creating default admin user...');\n      await createUser('admin@whatsapp.com', 'admin123', 'Admin', 'admin@whatsapp.com');\n      console.log('[Auth] Default admin user created (admin@whatsapp.com / admin123)');\n    }\n    \n    const admin = await User.findOne({ username: 'admin@whatsapp.com' });\n    if (admin) {\n      if (admin.role !== 'super_admin') {\n        admin.role = 'super_admin';\n        await admin.save();\n        console.log('[Auth] Admin role updated to super_admin');\n      }\n      await seedAdminCredentials(admin.id);\n    }\n  } catch (error) {\n    console.error('[Auth] Error ensuring default admin:', error);\n  }\n}\n\nasync function seedAdminCredentials(adminUserId: string): Promise<void> {\n  try {\n    const existingCreds = await UserCredentials.findOne({ userId: adminUserId });\n    if (existingCreds) {\n      console.log('[Auth] Admin credentials already exist in database');\n      return;\n    }\n\n    const whatsappToken = process.env.WHATSAPP_TOKEN_NEW || process.env.WHATSAPP_TOKEN || '';\n    const phoneNumberId = process.env.PHONE_NUMBER_ID || '';\n    const businessAccountId = process.env.WHATSAPP_BUSINESS_ACCOUNT_ID || '';\n    const webhookVerifyToken = process.env.WEBHOOK_VERIFY_TOKEN || '';\n    const openaiApiKey = process.env.OPENAI_API_KEY || '';\n    const facebookAccessToken = process.env.FB_ACCESS_TOKEN || process.env.FACEBOOK_ACCESS_TOKEN || '';\n    const facebookPageId = process.env.FACEBOOK_PAGE_ID || '';\n    const appId = process.env.FACEBOOK_APP_ID || '';\n    const appSecret = process.env.FACEBOOK_APP_SECRET || '';\n\n    const hasAnyCreds = whatsappToken || openaiApiKey || facebookAccessToken;\n    if (!hasAnyCreds) {\n      console.log('[Auth] No environment credentials to seed');\n      return;\n    }\n\n    const now = new Date().toISOString();\n    await UserCredentials.create({\n      id: crypto.randomUUID(),\n      userId: adminUserId,\n      whatsappToken: whatsappToken || '',\n      phoneNumberId: phoneNumberId || '',\n      businessAccountId: businessAccountId || '',\n      webhookVerifyToken: webhookVerifyToken || '',\n      openaiApiKey: openaiApiKey || '',\n      facebookAccessToken: facebookAccessToken || '',\n      facebookPageId: facebookPageId || '',\n      appId: appId || '',\n      appSecret: appSecret || '',\n      isVerified: true,\n      createdAt: now,\n      updatedAt: now,\n    });\n\n    console.log('[Auth] Seeded admin credentials from environment variables');\n  } catch (error) {\n    console.error('[Auth] Error seeding admin credentials:', error);\n  }\n}\n","path":null,"size_bytes":7302,"size_tokens":null},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\n\ninterface User {\n  id: string;\n  username: string;\n  name: string;\n  email?: string;\n  role: string;\n  pageAccess?: string[];\n}\n\ninterface AuthContextType {\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  user: User | null;\n  login: (username: string, password: string) => Promise<boolean>;\n  register: (username: string, password: string, name: string, email?: string) => Promise<{ success: boolean; error?: string }>;\n  logout: () => Promise<void>;\n  checkAuth: () => Promise<void>;\n}\n\nconst AUTH_STORAGE_KEY = \"whatsapp_auth_user\";\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nfunction getStoredUser(): User | null {\n  try {\n    const stored = localStorage.getItem(AUTH_STORAGE_KEY);\n    return stored ? JSON.parse(stored) : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction setStoredUser(user: User | null) {\n  if (user) {\n    localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(user));\n  } else {\n    localStorage.removeItem(AUTH_STORAGE_KEY);\n  }\n}\n\nexport function getAuthHeaders(): Record<string, string> {\n  const user = getStoredUser();\n  if (!user) return {};\n  return {\n    \"x-user-id\": user.id || '',\n    \"x-user-role\": user.role || 'user',\n    \"x-user-name\": user.name || '',\n    \"x-user\": JSON.stringify(user),\n  };\n}\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [user, setUser] = useState<User | null>(null);\n\n  const checkAuth = async () => {\n    try {\n      const storedUser = getStoredUser();\n      if (!storedUser) {\n        setIsAuthenticated(false);\n        setUser(null);\n        setIsLoading(false);\n        return;\n      }\n\n      const res = await fetch(\"/api/auth/check\", {\n        headers: getAuthHeaders(),\n      });\n      const data = await res.json();\n      \n      if (data.authenticated && data.user) {\n        setIsAuthenticated(true);\n        setUser(data.user);\n        setStoredUser(data.user);\n      } else {\n        setIsAuthenticated(false);\n        setUser(null);\n        setStoredUser(null);\n      }\n    } catch (error) {\n      console.error(\"Auth check failed:\", error);\n      setIsAuthenticated(false);\n      setUser(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const login = async (username: string, password: string): Promise<boolean> => {\n    try {\n      const res = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username, password }),\n      });\n\n      const data = await res.json();\n      \n      if (res.ok && data.success) {\n        setIsAuthenticated(true);\n        setUser(data.user);\n        setStoredUser(data.user);\n        return true;\n      }\n      \n      return false;\n    } catch (error) {\n      console.error(\"Login failed:\", error);\n      return false;\n    }\n  };\n\n  const register = async (\n    username: string, \n    password: string, \n    name: string, \n    email?: string\n  ): Promise<{ success: boolean; error?: string }> => {\n    try {\n      const res = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username, password, name, email }),\n      });\n\n      const data = await res.json();\n      \n      if (res.ok && data.success) {\n        setIsAuthenticated(true);\n        setUser(data.user);\n        setStoredUser(data.user);\n        return { success: true };\n      }\n      \n      return { success: false, error: data.error || \"Registration failed\" };\n    } catch (error) {\n      console.error(\"Registration failed:\", error);\n      return { success: false, error: \"Registration failed\" };\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { \n        method: \"POST\",\n        headers: getAuthHeaders(),\n      });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      setIsAuthenticated(false);\n      setUser(null);\n      setStoredUser(null);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ isAuthenticated, isLoading, user, login, register, logout, checkAuth }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":4597,"size_tokens":null},"server/modules/whatsapp/whatsapp.service.ts":{"content":"import { credentialsService } from '../credentials/credentials.service';\n\nexport interface WhatsAppCredentials {\n  token: string;\n  phoneNumberId: string;\n  businessAccountId?: string;\n}\n\nexport interface SendMessageResult {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\nexport interface TemplateComponent {\n  type: string;\n  parameters?: Array<{\n    type: string;\n    text?: string;\n    parameter_name?: string;\n  }>;\n}\n\nexport async function getUserWhatsAppCredentials(userId: string): Promise<WhatsAppCredentials | null> {\n  try {\n    const creds = await credentialsService.getDecryptedCredentials(userId);\n    \n    if (creds?.whatsappToken && creds?.phoneNumberId) {\n      return {\n        token: creds.whatsappToken,\n        phoneNumberId: creds.phoneNumberId,\n        businessAccountId: creds.businessAccountId,\n      };\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('[WhatsApp Service] Error getting user credentials:', error);\n    return null;\n  }\n}\n\nexport async function getWhatsAppCredentialsForUser(userId?: string): Promise<WhatsAppCredentials | null> {\n  if (userId) {\n    const userCreds = await getUserWhatsAppCredentials(userId);\n    if (userCreds) {\n      return userCreds;\n    }\n  }\n  \n  return null;\n}\n\nexport async function getWhatsAppCredentialsStrict(userId?: string): Promise<WhatsAppCredentials | null> {\n  if (!userId) {\n    return null;\n  }\n  \n  const userCreds = await getUserWhatsAppCredentials(userId);\n  if (userCreds) {\n    return userCreds;\n  }\n  \n  return null;\n}\n\nexport async function sendTextMessage(\n  to: string,\n  message: string,\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    console.error('[WhatsApp Service] Credentials not configured');\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          recipient_type: 'individual',\n          to,\n          type: 'text',\n          text: { body: message },\n        }),\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    }\n    \n    return { \n      success: false, \n      error: data.error?.message || 'Failed to send message' \n    };\n  } catch (error) {\n    console.error('[WhatsApp Service] Error sending message:', error);\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function sendTemplateMessage(\n  to: string,\n  templateName: string,\n  languageCode: string = 'en',\n  components: TemplateComponent[] = [],\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    console.error('[WhatsApp Service] Credentials not configured');\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  const metaTemplateName = templateName.toLowerCase().replace(/\\s+/g, '_');\n  console.log(`[WhatsApp Service] Sending template: \"${metaTemplateName}\" to ${to}`);\n  \n  const languageCodesToTry = [languageCode, 'en', 'en_US', 'en_GB'];\n  const uniqueLanguages = Array.from(new Set(languageCodesToTry));\n  \n  for (const langCode of uniqueLanguages) {\n    const payload: Record<string, unknown> = {\n      messaging_product: 'whatsapp',\n      recipient_type: 'individual',\n      to,\n      type: 'template',\n      template: {\n        name: metaTemplateName,\n        language: { code: langCode },\n      },\n    };\n    \n    if (components.length > 0) {\n      (payload.template as Record<string, unknown>).components = components;\n    }\n    \n    try {\n      const response = await fetch(\n        `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${credentials.token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n        }\n      );\n      \n      const data = await response.json();\n      \n      if (response.ok && data.messages?.[0]?.id) {\n        console.log(`[WhatsApp Service] Template sent successfully with lang: ${langCode}`);\n        return { success: true, messageId: data.messages[0].id };\n      }\n      \n      const errorCode = data.error?.code;\n      const errorMsg = data.error?.message || '';\n      \n      if (errorCode === 132001 || errorMsg.includes('does not exist')) {\n        console.log(`[WhatsApp Service] Template not found with lang \"${langCode}\", trying next...`);\n        continue;\n      }\n      \n      return { \n        success: false, \n        error: data.error?.message || 'Failed to send template' \n      };\n    } catch (error) {\n      console.error('[WhatsApp Service] Error sending template:', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : 'Unknown error' \n      };\n    }\n  }\n  \n  return { \n    success: false, \n    error: `Template \"${templateName}\" not found in any supported language` \n  };\n}\n\nexport async function sendImageMessage(\n  to: string,\n  imageUrl: string,\n  caption?: string,\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  try {\n    const payload: Record<string, unknown> = {\n      messaging_product: 'whatsapp',\n      recipient_type: 'individual',\n      to,\n      type: 'image',\n      image: { link: imageUrl },\n    };\n    \n    if (caption) {\n      (payload.image as Record<string, unknown>).caption = caption;\n    }\n    \n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    }\n    \n    return { \n      success: false, \n      error: data.error?.message || 'Failed to send image' \n    };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function sendDocumentMessage(\n  to: string,\n  documentUrl: string,\n  filename: string,\n  caption?: string,\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  try {\n    const payload: Record<string, unknown> = {\n      messaging_product: 'whatsapp',\n      recipient_type: 'individual',\n      to,\n      type: 'document',\n      document: { \n        link: documentUrl,\n        filename,\n      },\n    };\n    \n    if (caption) {\n      (payload.document as Record<string, unknown>).caption = caption;\n    }\n    \n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    }\n    \n    return { \n      success: false, \n      error: data.error?.message || 'Failed to send document' \n    };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function sendVideoMessage(\n  to: string,\n  videoUrl: string,\n  caption?: string,\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  try {\n    const payload: Record<string, unknown> = {\n      messaging_product: 'whatsapp',\n      recipient_type: 'individual',\n      to,\n      type: 'video',\n      video: { link: videoUrl },\n    };\n    \n    if (caption) {\n      (payload.video as Record<string, unknown>).caption = caption;\n    }\n    \n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    }\n    \n    return { \n      success: false, \n      error: data.error?.message || 'Failed to send video' \n    };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function sendReplyMessage(\n  to: string,\n  message: string,\n  replyToMessageId: string,\n  userId?: string\n): Promise<SendMessageResult> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    return { success: false, error: 'WhatsApp credentials not configured' };\n  }\n  \n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          recipient_type: 'individual',\n          to,\n          context: { message_id: replyToMessageId },\n          type: 'text',\n          text: { body: message },\n        }),\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.ok && data.messages?.[0]?.id) {\n      return { success: true, messageId: data.messages[0].id };\n    }\n    \n    return { \n      success: false, \n      error: data.error?.message || 'Failed to send reply' \n    };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function markMessageAsRead(\n  messageId: string,\n  userId?: string\n): Promise<boolean> {\n  const credentials = await getWhatsAppCredentialsForUser(userId);\n  \n  if (!credentials) {\n    return false;\n  }\n  \n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${credentials.phoneNumberId}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${credentials.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          status: 'read',\n          message_id: messageId,\n        }),\n      }\n    );\n    \n    return response.ok;\n  } catch (error) {\n    console.error('[WhatsApp Service] Error marking message as read:', error);\n    return false;\n  }\n}\n\nexport async function getUserByPhoneNumberId(phoneNumberId: string): Promise<string | null> {\n  try {\n    const userId = await credentialsService.findUserByPhoneNumberId(phoneNumberId);\n    return userId;\n  } catch (error) {\n    console.error('[WhatsApp Service] Error finding user by phone number ID:', error);\n    return null;\n  }\n}\n","path":null,"size_bytes":12148,"size_tokens":null},"server/modules/contacts/contacts.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport { requireAuth, getUserId } from '../auth/auth.routes';\nimport { BlockedContact, Chat, Message, Contact } from '../storage/mongodb.adapter';\nimport crypto from 'crypto';\n\nconst router = Router();\n\nrouter.post('/block', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const { phone, name, reason } = req.body;\n    \n    if (!phone) {\n      return res.status(400).json({ error: 'Phone number is required' });\n    }\n\n    const normalizedPhone = phone.replace(/\\D/g, '');\n    \n    const existing = await BlockedContact.findOne({ userId, phone: normalizedPhone });\n    if (existing) {\n      if (existing.isActive) {\n        return res.status(400).json({ error: 'Contact is already blocked' });\n      }\n      await BlockedContact.updateOne(\n        { userId, phone: normalizedPhone },\n        { $set: { isActive: true, reason: reason || '', blockedAt: new Date().toISOString() } }\n      );\n    } else {\n      await BlockedContact.create({\n        id: crypto.randomUUID(),\n        userId,\n        phone: normalizedPhone,\n        name: name || '',\n        reason: reason || '',\n        blockedAt: new Date().toISOString(),\n        isActive: true,\n      });\n    }\n\n    res.json({ success: true, message: 'Contact blocked successfully' });\n  } catch (error: any) {\n    console.error('[Contacts] Error blocking contact:', error);\n    res.status(500).json({ error: 'Failed to block contact' });\n  }\n});\n\nrouter.post('/unblock', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const { phone } = req.body;\n    \n    if (!phone) {\n      return res.status(400).json({ error: 'Phone number is required' });\n    }\n\n    const normalizedPhone = phone.replace(/\\D/g, '');\n    \n    const result = await BlockedContact.updateOne(\n      { userId, phone: normalizedPhone },\n      { $set: { isActive: false } }\n    );\n\n    if (result.matchedCount === 0) {\n      return res.status(404).json({ error: 'Blocked contact not found' });\n    }\n\n    res.json({ success: true, message: 'Contact unblocked successfully' });\n  } catch (error: any) {\n    console.error('[Contacts] Error unblocking contact:', error);\n    res.status(500).json({ error: 'Failed to unblock contact' });\n  }\n});\n\nrouter.get('/blocked', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const blockedContacts = await BlockedContact.find({ userId, isActive: true })\n      .sort({ blockedAt: -1 })\n      .lean();\n\n    res.json(blockedContacts);\n  } catch (error: any) {\n    console.error('[Contacts] Error fetching blocked contacts:', error);\n    res.status(500).json({ error: 'Failed to fetch blocked contacts' });\n  }\n});\n\nrouter.delete('/:contactId', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const { contactId } = req.params;\n    \n    await Chat.deleteOne({ contactId });\n    await Message.deleteMany({ contactId });\n    await Contact.deleteOne({ id: contactId });\n\n    res.json({ success: true, message: 'Contact deleted successfully' });\n  } catch (error: any) {\n    console.error('[Contacts] Error deleting contact:', error);\n    res.status(500).json({ error: 'Failed to delete contact' });\n  }\n});\n\nrouter.patch('/chats/:chatId/read', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const { chatId } = req.params;\n    \n    await Chat.updateOne(\n      { id: chatId },\n      { $set: { unreadCount: 0 } }\n    );\n\n    res.json({ success: true });\n  } catch (error: any) {\n    console.error('[Contacts] Error marking chat as read:', error);\n    res.status(500).json({ error: 'Failed to mark chat as read' });\n  }\n});\n\nrouter.patch('/chats/contact/:contactId/read', requireAuth, async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n\n    const { contactId } = req.params;\n    \n    await Chat.updateOne(\n      { contactId },\n      { $set: { unreadCount: 0 } }\n    );\n\n    res.json({ success: true });\n  } catch (error: any) {\n    console.error('[Contacts] Error marking chat as read:', error);\n    res.status(500).json({ error: 'Failed to mark chat as read' });\n  }\n});\n\nexport async function isContactBlocked(userId: string, phone: string): Promise<boolean> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  console.log(`[BlockCheck] Checking if ${normalizedPhone} is blocked for user ${userId}`);\n  const blocked = await BlockedContact.findOne({ \n    userId, \n    phone: normalizedPhone, \n    isActive: true \n  });\n  console.log(`[BlockCheck] Result for ${normalizedPhone}: ${blocked ? 'BLOCKED' : 'not blocked'}`);\n  return !!blocked;\n}\n\nexport async function isPhoneBlocked(phone: string): Promise<{ blocked: boolean; userId?: string }> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  console.log(`[BlockCheck] Checking if ${normalizedPhone} is blocked by any user`);\n  const blocked = await BlockedContact.findOne({ \n    phone: normalizedPhone, \n    isActive: true \n  });\n  if (blocked) {\n    console.log(`[BlockCheck] Found: ${normalizedPhone} is blocked by user ${blocked.userId}`);\n    return { blocked: true, userId: blocked.userId };\n  }\n  console.log(`[BlockCheck] ${normalizedPhone} is not blocked by anyone`);\n  return { blocked: false };\n}\n\nexport async function listAllBlockedContacts(): Promise<any[]> {\n  const all = await BlockedContact.find({ isActive: true }).lean();\n  console.log(`[BlockCheck] All blocked contacts:`, JSON.stringify(all, null, 2));\n  return all;\n}\n\nexport default router;\n","path":null,"size_bytes":6177,"size_tokens":null},"client/src/pages/reports/BlockedContacts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Search, Ban, UserCheck, Loader2, Phone, Calendar, MessageSquare, TrendingUp } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format } from \"date-fns\";\nimport { fetchWithAuth } from \"@/lib/fetchWithAuth\";\n\ninterface BlockedContact {\n  id: string;\n  userId: string;\n  phone: string;\n  name: string;\n  reason: string;\n  blockedAt: string;\n  isActive: boolean;\n}\n\ninterface BlockedReportData {\n  contacts: BlockedContact[];\n  summary: {\n    totalBlocked: number;\n    blockedThisMonth: number;\n    blockedThisWeek: number;\n    blockedToday: number;\n    withReason: number;\n    topReasons: { reason: string; count: number }[];\n  };\n  recentBlocked: BlockedContact[];\n}\n\nexport default function BlockedContacts() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [unblockDialogOpen, setUnblockDialogOpen] = useState(false);\n  const [selectedContact, setSelectedContact] = useState<BlockedContact | null>(null);\n  const queryClient = useQueryClient();\n\n  const { data, isLoading } = useQuery<BlockedReportData>({\n    queryKey: [\"/api/reports/blocked-contacts\"],\n    queryFn: async () => {\n      const res = await fetchWithAuth(\"/api/reports/blocked-contacts\");\n      if (!res.ok) throw new Error(\"Failed to fetch blocked contacts\");\n      return res.json();\n    },\n  });\n\n  const unblockMutation = useMutation({\n    mutationFn: async (phone: string) => {\n      const res = await fetchWithAuth(\"/api/contacts/unblock\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phone }),\n      });\n      if (!res.ok) throw new Error(\"Failed to unblock contact\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/blocked-contacts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/contacts/blocked\"] });\n      setUnblockDialogOpen(false);\n      setSelectedContact(null);\n      toast.success(\"Contact unblocked successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to unblock contact\");\n    },\n  });\n\n  const blockedContacts = data?.contacts || [];\n  const summary = data?.summary || { totalBlocked: 0, blockedThisMonth: 0, blockedThisWeek: 0, blockedToday: 0, withReason: 0, topReasons: [] };\n\n  const filteredContacts = blockedContacts.filter(contact => {\n    const query = searchQuery.toLowerCase();\n    return (\n      contact.phone.toLowerCase().includes(query) ||\n      contact.name.toLowerCase().includes(query) ||\n      contact.reason?.toLowerCase().includes(query)\n    );\n  });\n\n  const formatPhone = (phone: string) => {\n    if (phone.startsWith(\"+\")) return phone;\n    return `+${phone}`;\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n        <div>\n          <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n            <Ban className=\"h-8 w-8 text-red-500\" />\n            Blocked Contacts Report\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage contacts you've blocked from sending messages\n          </p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-5\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Ban className=\"h-4 w-4\" />\n                Total Blocked\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-600\">{summary.totalBlocked}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4\" />\n                This Month\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{summary.blockedThisMonth}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                This Week\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{summary.blockedThisWeek}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4\" />\n                Today\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{summary.blockedToday}</div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4\" />\n                With Reason\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{summary.withReason}</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {summary.topReasons.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Top Block Reasons</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap gap-2\">\n                {summary.topReasons.map((item, index) => (\n                  <Badge key={index} variant=\"outline\" className=\"text-sm py-1 px-3\">\n                    {item.reason} ({item.count})\n                  </Badge>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Blocked Contacts List</CardTitle>\n            <CardDescription>\n              View and manage all blocked contacts. Unblock contacts to resume receiving their messages.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-4 mb-4\">\n              <div className=\"relative flex-1 max-w-sm\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by phone, name, or reason...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                />\n              </div>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n              </div>\n            ) : filteredContacts.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n                <Ban className=\"h-12 w-12 mb-4 opacity-50\" />\n                <p className=\"text-lg font-medium\">No blocked contacts</p>\n                <p className=\"text-sm\">\n                  {searchQuery ? \"No contacts match your search\" : \"You haven't blocked any contacts yet\"}\n                </p>\n              </div>\n            ) : (\n              <div className=\"border rounded-lg\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Contact</TableHead>\n                      <TableHead>Phone</TableHead>\n                      <TableHead>Reason</TableHead>\n                      <TableHead>Blocked Date</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredContacts.map((contact) => (\n                      <TableRow key={contact.id}>\n                        <TableCell className=\"font-medium\">\n                          {contact.name || \"Unknown\"}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                            {formatPhone(contact.phone)}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"max-w-[200px]\">\n                          {contact.reason ? (\n                            <span className=\"text-sm text-muted-foreground truncate block\">\n                              {contact.reason}\n                            </span>\n                          ) : (\n                            <span className=\"text-sm text-muted-foreground italic\">No reason provided</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {contact.blockedAt ? format(new Date(contact.blockedAt), \"MMM d, yyyy h:mm a\") : \"Unknown\"}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"destructive\" className=\"bg-orange-100 text-orange-800 border-orange-200\">\n                            <Ban className=\"h-3 w-3 mr-1\" />\n                            Blocked\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedContact(contact);\n                              setUnblockDialogOpen(true);\n                            }}\n                          >\n                            <UserCheck className=\"h-4 w-4 mr-1\" />\n                            Unblock\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <AlertDialog open={unblockDialogOpen} onOpenChange={setUnblockDialogOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Unblock Contact</AlertDialogTitle>\n              <AlertDialogDescription>\n                Are you sure you want to unblock {selectedContact?.name || selectedContact?.phone}? \n                They will be able to send messages again and may receive AI responses.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={() => selectedContact && unblockMutation.mutate(selectedContact.phone)}\n                disabled={unblockMutation.isPending}\n              >\n                {unblockMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : null}\n                Unblock\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":12286,"size_tokens":null},"client/src/lib/fetchWithAuth.ts":{"content":"const AUTH_STORAGE_KEY = \"whatsapp_auth_user\";\n\nfunction getAuthHeaders(): Record<string, string> {\n  try {\n    const stored = localStorage.getItem(AUTH_STORAGE_KEY);\n    if (!stored) return {};\n    const user = JSON.parse(stored);\n    return {\n      \"x-user-id\": user.id,\n      \"x-user\": JSON.stringify(user),\n    };\n  } catch {\n    return {};\n  }\n}\n\nexport async function fetchWithAuth(url: string, options: RequestInit = {}): Promise<Response> {\n  const authHeaders = getAuthHeaders();\n  return fetch(url, {\n    ...options,\n    headers: {\n      ...authHeaders,\n      ...(options.headers || {}),\n    },\n  });\n}\n","path":null,"size_bytes":613,"size_tokens":null},"server/modules/reports/reports.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport { reportsService, TimeFilter } from './reports.service';\nimport { getUserId } from '../auth/auth.routes';\n\nconst router = Router();\n\nfunction parseTimeFilter(req: Request): TimeFilter {\n  const period = (req.query.period as string) || 'week';\n  const startDate = req.query.startDate as string;\n  const endDate = req.query.endDate as string;\n  \n  return {\n    period: period as TimeFilter['period'],\n    startDate,\n    endDate,\n  };\n}\n\nrouter.get('/ai-agents', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getAIAgentPerformance(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching AI agent performance:', error);\n    res.status(500).json({ error: 'Failed to fetch AI agent performance data' });\n  }\n});\n\nrouter.get('/customer-replies', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getCustomerReplies(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching customer replies:', error);\n    res.status(500).json({ error: 'Failed to fetch customer replies data' });\n  }\n});\n\nrouter.get('/user-engagement', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getUserEngagement(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching user engagement:', error);\n    res.status(500).json({ error: 'Failed to fetch user engagement data' });\n  }\n});\n\nrouter.get('/spending', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getSpendingReport(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching spending report:', error);\n    res.status(500).json({ error: 'Failed to fetch spending data' });\n  }\n});\n\nrouter.get('/overview', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getDashboardOverview(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching overview:', error);\n    res.status(500).json({ error: 'Failed to fetch overview data' });\n  }\n});\n\nrouter.get('/campaign-performance', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getCampaignPerformance(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching campaign performance:', error);\n    res.status(500).json({ error: 'Failed to fetch campaign performance data' });\n  }\n});\n\nrouter.get('/blocked-contacts', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req);\n    if (!userId) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n    const data = await reportsService.getBlockedContactsReport(userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching blocked contacts report:', error);\n    res.status(500).json({ error: 'Failed to fetch blocked contacts report' });\n  }\n});\n\nrouter.get('/24hour-window', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.get24HourWindowStats(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching 24-hour window stats:', error);\n    res.status(500).json({ error: 'Failed to fetch 24-hour window stats' });\n  }\n});\n\nrouter.get('/enhanced-dashboard', async (req: Request, res: Response) => {\n  try {\n    const userId = getUserId(req) || undefined;\n    const filter = parseTimeFilter(req);\n    const data = await reportsService.getEnhancedDashboardStats(filter, userId);\n    res.json(data);\n  } catch (error) {\n    console.error('[Reports] Error fetching enhanced dashboard stats:', error);\n    res.status(500).json({ error: 'Failed to fetch enhanced dashboard stats' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":4548,"size_tokens":null},"server/modules/reports/reports.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\n\nexport interface DateRange {\n  startDate: Date;\n  endDate: Date;\n}\n\nexport interface TimeFilter {\n  period: 'today' | 'yesterday' | 'week' | 'month' | 'custom';\n  startDate?: string;\n  endDate?: string;\n}\n\nexport function getDateRange(filter: TimeFilter): DateRange {\n  const now = new Date();\n  let startDate: Date;\n  let endDate = new Date(now);\n  \n  switch (filter.period) {\n    case 'today':\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n      break;\n    case 'yesterday':\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);\n      endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n      break;\n    case 'week':\n      startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      break;\n    case 'month':\n      startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n      break;\n    case 'custom':\n      startDate = filter.startDate ? new Date(filter.startDate) : new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      endDate = filter.endDate ? new Date(filter.endDate) : now;\n      break;\n    default:\n      startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n  }\n  \n  return { startDate, endDate };\n}\n\nexport async function getAIAgentPerformance(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const agents = await mongodb.readCollection<any>('agents');\n  const messages = await mongodb.readCollection<any>('messages');\n  const contactAgents = await mongodb.readCollection<any>('contact_agents');\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const agentStats = agents.map(agent => {\n    const assignments = contactAgents.filter(ca => ca.agentId === agent.id);\n    const contactIds = assignments.map(a => a.contactId);\n    \n    const agentMessages = filteredMessages.filter(m => \n      contactIds.includes(m.contactId) && m.direction === 'outbound'\n    );\n    \n    const inboundMessages = filteredMessages.filter(m =>\n      contactIds.includes(m.contactId) && m.direction === 'inbound'\n    );\n    \n    const responseCount = agentMessages.length;\n    const uniqueChats = new Set(agentMessages.map(m => m.contactId)).size;\n    \n    const avgResponseTime = calculateAvgResponseTime(inboundMessages, agentMessages);\n    \n    return {\n      id: agent.id,\n      name: agent.name,\n      model: agent.model || 'gpt-4o',\n      chatsHandled: uniqueChats,\n      messagesGenerated: responseCount,\n      avgResponseTime: formatResponseTime(avgResponseTime),\n      avgResponseTimeMs: avgResponseTime,\n      isActive: agent.isActive,\n      temperature: agent.temperature,\n    };\n  });\n  \n  const sortedAgents = agentStats.sort((a, b) => b.chatsHandled - a.chatsHandled);\n  \n  const totalChats = sortedAgents.reduce((sum, a) => sum + a.chatsHandled, 0);\n  const totalMessages = sortedAgents.reduce((sum, a) => sum + a.messagesGenerated, 0);\n  const activeAgents = sortedAgents.filter(a => a.isActive).length;\n  \n  const avgResponseTimes = sortedAgents.filter(a => a.avgResponseTimeMs > 0).map(a => a.avgResponseTimeMs);\n  const overallAvgResponseTime = avgResponseTimes.length > 0 \n    ? avgResponseTimes.reduce((a, b) => a + b, 0) / avgResponseTimes.length \n    : 0;\n  \n  return {\n    agents: sortedAgents,\n    summary: {\n      totalAgents: agents.length,\n      activeAgents,\n      totalChats,\n      totalMessages,\n      avgResponseTime: formatResponseTime(overallAvgResponseTime),\n    },\n    period: filter.period,\n  };\n}\n\nfunction calculateAvgResponseTime(inboundMessages: any[], outboundMessages: any[]): number {\n  let totalTime = 0;\n  let count = 0;\n  \n  for (const inbound of inboundMessages) {\n    const inboundTime = new Date(inbound.timestamp || inbound.createdAt).getTime();\n    \n    const response = outboundMessages.find(out => {\n      const outTime = new Date(out.timestamp || out.createdAt).getTime();\n      return out.contactId === inbound.contactId && outTime > inboundTime && outTime - inboundTime < 300000;\n    });\n    \n    if (response) {\n      const responseTime = new Date(response.timestamp || response.createdAt).getTime();\n      totalTime += responseTime - inboundTime;\n      count++;\n    }\n  }\n  \n  return count > 0 ? totalTime / count : 0;\n}\n\nfunction formatResponseTime(ms: number): string {\n  if (ms === 0) return 'N/A';\n  const seconds = Math.floor(ms / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const remainingSeconds = seconds % 60;\n  \n  if (minutes > 0) {\n    return `${minutes}m ${remainingSeconds}s`;\n  }\n  return `${remainingSeconds}s`;\n}\n\nexport async function getCustomerReplies(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const contacts = await mongodb.readCollection<any>('contacts');\n  \n  const contactMap = new Map(contacts.map(c => [c.id, c]));\n  \n  const inboundMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return m.direction === 'inbound' && timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const recentReplies = inboundMessages\n    .sort((a, b) => new Date(b.timestamp || b.createdAt).getTime() - new Date(a.timestamp || a.createdAt).getTime())\n    .slice(0, 50)\n    .map(m => {\n      const contact = contactMap.get(m.contactId);\n      const timeDiff = Date.now() - new Date(m.timestamp || m.createdAt).getTime();\n      \n      return {\n        id: m.id,\n        contactId: m.contactId,\n        name: contact?.name || `Unknown (${m.contactId})`,\n        phone: contact?.phone || '',\n        message: m.content?.substring(0, 100) + (m.content?.length > 100 ? '...' : ''),\n        fullMessage: m.content,\n        time: formatTimeAgo(timeDiff),\n        timestamp: m.timestamp || m.createdAt,\n        type: m.type || 'text',\n        sentiment: analyzeSentiment(m.content),\n      };\n    });\n  \n  const sentimentCounts = {\n    positive: recentReplies.filter(r => r.sentiment === 'Positive').length,\n    negative: recentReplies.filter(r => r.sentiment === 'Negative').length,\n    neutral: recentReplies.filter(r => r.sentiment === 'Neutral').length,\n  };\n  \n  const totalReplies = inboundMessages.length;\n  const positivePercentage = totalReplies > 0 \n    ? Math.round((sentimentCounts.positive / totalReplies) * 100) \n    : 0;\n  \n  const unsubscribeKeywords = ['stop', 'unsubscribe', 'remove', 'opt out', 'cancel'];\n  const unsubscribeRequests = inboundMessages.filter(m => \n    unsubscribeKeywords.some(kw => m.content?.toLowerCase().includes(kw))\n  ).length;\n  \n  return {\n    replies: recentReplies,\n    summary: {\n      totalReplies,\n      positiveSentiment: positivePercentage,\n      unsubscribeRequests,\n      sentimentBreakdown: sentimentCounts,\n    },\n    period: filter.period,\n  };\n}\n\nfunction analyzeSentiment(text: string): 'Positive' | 'Negative' | 'Neutral' {\n  if (!text) return 'Neutral';\n  \n  const positiveWords = ['yes', 'thanks', 'thank', 'great', 'good', 'interested', 'love', 'amazing', 'excellent', 'perfect', 'wonderful', 'awesome'];\n  const negativeWords = ['no', 'stop', 'unsubscribe', 'spam', 'annoying', 'hate', 'bad', 'terrible', 'worst', 'cancel', 'remove'];\n  \n  const lowerText = text.toLowerCase();\n  const positiveCount = positiveWords.filter(w => lowerText.includes(w)).length;\n  const negativeCount = negativeWords.filter(w => lowerText.includes(w)).length;\n  \n  if (positiveCount > negativeCount) return 'Positive';\n  if (negativeCount > positiveCount) return 'Negative';\n  return 'Neutral';\n}\n\nfunction formatTimeAgo(ms: number): string {\n  const seconds = Math.floor(ms / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n  const days = Math.floor(hours / 24);\n  \n  if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;\n  if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n  if (minutes > 0) return `${minutes} min${minutes > 1 ? 's' : ''} ago`;\n  return 'Just now';\n}\n\nexport async function getUserEngagement(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const contacts = await mongodb.readCollection<any>('contacts');\n  \n  const contactMap = new Map(contacts.map(c => [c.id, c]));\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const contactStats = new Map<string, {\n    messagesReceived: number;\n    messagesRead: number;\n    replies: number;\n    contact: any;\n  }>();\n  \n  for (const msg of filteredMessages) {\n    const contactId = msg.contactId;\n    if (!contactStats.has(contactId)) {\n      contactStats.set(contactId, {\n        messagesReceived: 0,\n        messagesRead: 0,\n        replies: 0,\n        contact: contactMap.get(contactId),\n      });\n    }\n    \n    const stats = contactStats.get(contactId)!;\n    \n    if (msg.direction === 'outbound') {\n      stats.messagesReceived++;\n      if (msg.status === 'read' || msg.status === 'delivered') {\n        stats.messagesRead++;\n      }\n    } else if (msg.direction === 'inbound') {\n      stats.replies++;\n    }\n  }\n  \n  const engagementData = Array.from(contactStats.entries()).map(([contactId, stats]) => {\n    const readRate = stats.messagesReceived > 0 \n      ? (stats.messagesRead / stats.messagesReceived) * 100 \n      : 0;\n    const replyRate = stats.messagesReceived > 0 \n      ? (stats.replies / stats.messagesReceived) * 100 \n      : 0;\n    const engagement = (readRate * 0.4 + replyRate * 0.6);\n    \n    return {\n      id: contactId,\n      name: stats.contact?.name || `Contact ${contactId.slice(0, 8)}`,\n      phone: stats.contact?.phone || '',\n      messagesReceived: stats.messagesReceived,\n      messagesRead: stats.messagesRead,\n      replies: stats.replies,\n      readRate: Math.round(readRate * 10) / 10,\n      replyRate: Math.round(replyRate * 10) / 10,\n      engagement: Math.round(engagement * 10) / 10,\n    };\n  });\n  \n  const sortedData = engagementData\n    .filter(d => d.messagesReceived > 0)\n    .sort((a, b) => b.engagement - a.engagement);\n  \n  const totalUsers = sortedData.length;\n  const avgReadRate = totalUsers > 0 \n    ? sortedData.reduce((sum, u) => sum + u.readRate, 0) / totalUsers \n    : 0;\n  const avgReplyRate = totalUsers > 0 \n    ? sortedData.reduce((sum, u) => sum + u.replyRate, 0) / totalUsers \n    : 0;\n  const totalReplies = sortedData.reduce((sum, u) => sum + u.replies, 0);\n  const totalMessages = sortedData.reduce((sum, u) => sum + u.messagesReceived, 0);\n  \n  const distribution = [\n    { range: '90-100%', count: sortedData.filter(u => u.engagement >= 90).length, color: '#22c55e' },\n    { range: '80-89%', count: sortedData.filter(u => u.engagement >= 80 && u.engagement < 90).length, color: '#84cc16' },\n    { range: '70-79%', count: sortedData.filter(u => u.engagement >= 70 && u.engagement < 80).length, color: '#eab308' },\n    { range: '60-69%', count: sortedData.filter(u => u.engagement >= 60 && u.engagement < 70).length, color: '#f97316' },\n    { range: '50-59%', count: sortedData.filter(u => u.engagement >= 50 && u.engagement < 60).length, color: '#ef4444' },\n    { range: '40-49%', count: sortedData.filter(u => u.engagement >= 40 && u.engagement < 50).length, color: '#dc2626' },\n    { range: '<40%', count: sortedData.filter(u => u.engagement < 40).length, color: '#991b1b' },\n  ];\n  \n  return {\n    users: sortedData.slice(0, 100),\n    distribution,\n    summary: {\n      totalUsers,\n      avgReadRate: Math.round(avgReadRate * 10) / 10,\n      avgReplyRate: Math.round(avgReplyRate * 10) / 10,\n      totalReplies,\n      totalMessages,\n    },\n    period: filter.period,\n  };\n}\n\nexport async function getSpendingReport(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const broadcastLogs = await mongodb.readCollection<any>('broadcast_logs');\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return m.direction === 'outbound' && timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const MARKETING_RATE = 0.08;\n  const UTILITY_RATE = 0.05;\n  const SERVICE_RATE = 0.03;\n  \n  const dailyData = new Map<string, { marketing: number; utility: number; service: number; total: number }>();\n  \n  for (const msg of filteredMessages) {\n    const date = new Date(msg.timestamp || msg.createdAt);\n    const dateKey = date.toISOString().split('T')[0];\n    \n    if (!dailyData.has(dateKey)) {\n      dailyData.set(dateKey, { marketing: 0, utility: 0, service: 0, total: 0 });\n    }\n    \n    const data = dailyData.get(dateKey)!;\n    \n    const isBroadcast = broadcastLogs.some(bl => bl.messageId === msg.id);\n    \n    if (isBroadcast) {\n      data.marketing += MARKETING_RATE;\n    } else if (msg.type === 'template') {\n      data.utility += UTILITY_RATE;\n    } else {\n      data.service += SERVICE_RATE;\n    }\n    \n    data.total = data.marketing + data.utility + data.service;\n  }\n  \n  const dailySpending = Array.from(dailyData.entries())\n    .map(([date, data]) => ({\n      date: new Date(date).toLocaleDateString('en-US', { weekday: 'short' }),\n      fullDate: date,\n      marketing: Math.round(data.marketing * 100) / 100,\n      utility: Math.round(data.utility * 100) / 100,\n      service: Math.round(data.service * 100) / 100,\n      total: Math.round(data.total * 100) / 100,\n    }))\n    .sort((a, b) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime())\n    .slice(-7);\n  \n  const totalSpend = dailySpending.reduce((sum, d) => sum + d.total, 0);\n  const avgDailySpend = dailySpending.length > 0 ? totalSpend / dailySpending.length : 0;\n  const projectedMonthly = avgDailySpend * 30;\n  \n  const totalMarketing = dailySpending.reduce((sum, d) => sum + d.marketing, 0);\n  const totalUtility = dailySpending.reduce((sum, d) => sum + d.utility, 0);\n  const totalService = dailySpending.reduce((sum, d) => sum + d.service, 0);\n  \n  return {\n    dailySpending,\n    summary: {\n      totalSpend: Math.round(totalSpend * 100) / 100,\n      avgDailySpend: Math.round(avgDailySpend * 100) / 100,\n      projectedMonthly: Math.round(projectedMonthly * 100) / 100,\n      totalMarketing: Math.round(totalMarketing * 100) / 100,\n      totalUtility: Math.round(totalUtility * 100) / 100,\n      totalService: Math.round(totalService * 100) / 100,\n      marketingRate: MARKETING_RATE,\n      utilityRate: UTILITY_RATE,\n      serviceRate: SERVICE_RATE,\n    },\n    period: filter.period,\n  };\n}\n\nexport async function getDashboardOverview(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const contacts = await mongodb.readCollection<any>('contacts');\n  const campaigns = await mongodb.readCollection<any>('campaigns');\n  const agents = await mongodb.readCollection<any>('agents');\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const outbound = filteredMessages.filter(m => m.direction === 'outbound');\n  const inbound = filteredMessages.filter(m => m.direction === 'inbound');\n  const delivered = outbound.filter(m => m.status === 'delivered' || m.status === 'read');\n  const read = outbound.filter(m => m.status === 'read');\n  \n  const deliveryRate = outbound.length > 0 ? (delivered.length / outbound.length) * 100 : 0;\n  const readRate = outbound.length > 0 ? (read.length / outbound.length) * 100 : 0;\n  const replyRate = outbound.length > 0 ? (inbound.length / outbound.length) * 100 : 0;\n  \n  return {\n    messages: {\n      total: filteredMessages.length,\n      outbound: outbound.length,\n      inbound: inbound.length,\n      delivered: delivered.length,\n      read: read.length,\n    },\n    rates: {\n      delivery: Math.round(deliveryRate * 10) / 10,\n      read: Math.round(readRate * 10) / 10,\n      reply: Math.round(replyRate * 10) / 10,\n    },\n    counts: {\n      contacts: contacts.length,\n      campaigns: campaigns.length,\n      agents: agents.length,\n      activeAgents: agents.filter(a => a.isActive).length,\n    },\n    period: filter.period,\n  };\n}\n\nexport async function getCampaignPerformance(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const campaigns = await mongodb.readCollection<any>('campaigns');\n  const broadcastLogs = await mongodb.readCollection<any>('broadcast_logs');\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const filteredLogs = broadcastLogs.filter(log => {\n    const timestamp = new Date(log.sentAt || log.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const campaignMap = new Map<string, any>();\n  \n  for (const campaign of campaigns) {\n    campaignMap.set(campaign.id, {\n      id: campaign.id,\n      name: campaign.name,\n      date: campaign.createdAt ? new Date(campaign.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'N/A',\n      sent: 0,\n      delivered: 0,\n      read: 0,\n      replied: 0,\n      failed: 0,\n    });\n  }\n  \n  for (const log of filteredLogs) {\n    const campaignName = log.campaignName || log.templateName || 'Unknown Campaign';\n    \n    if (!campaignMap.has(campaignName)) {\n      campaignMap.set(campaignName, {\n        id: campaignName,\n        name: campaignName,\n        date: log.sentAt ? new Date(log.sentAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'N/A',\n        sent: 0,\n        delivered: 0,\n        read: 0,\n        replied: 0,\n        failed: 0,\n      });\n    }\n    \n    const campaign = campaignMap.get(campaignName);\n    campaign.sent++;\n    \n    if (log.status === 'delivered' || log.status === 'read' || log.status === 'sent') {\n      campaign.delivered++;\n    }\n    if (log.status === 'read') {\n      campaign.read++;\n    }\n    if (log.replied) {\n      campaign.replied++;\n    }\n    if (log.status === 'failed') {\n      campaign.failed++;\n    }\n  }\n  \n  const outboundByCampaign = new Map<string, any[]>();\n  for (const msg of filteredMessages) {\n    if (msg.direction === 'outbound' && msg.campaignId) {\n      if (!outboundByCampaign.has(msg.campaignId)) {\n        outboundByCampaign.set(msg.campaignId, []);\n      }\n      outboundByCampaign.get(msg.campaignId)!.push(msg);\n    }\n  }\n  \n  outboundByCampaign.forEach((msgs, campaignId) => {\n    if (campaignMap.has(campaignId)) {\n      const campaign = campaignMap.get(campaignId);\n      campaign.sent += msgs.length;\n      campaign.delivered += msgs.filter((m: any) => m.status === 'delivered' || m.status === 'read').length;\n      campaign.read += msgs.filter((m: any) => m.status === 'read').length;\n    }\n  });\n  \n  const campaignList = Array.from(campaignMap.values())\n    .filter(c => c.sent > 0)\n    .map(c => ({\n      ...c,\n      deliveryRate: c.sent > 0 ? Math.round((c.delivered / c.sent) * 100) : 0,\n      readRate: c.sent > 0 ? Math.round((c.read / c.sent) * 100) : 0,\n      replyRate: c.sent > 0 ? Math.round((c.replied / c.sent) * 100 * 10) / 10 : 0,\n      cost: (c.sent * 0.009).toFixed(2),\n    }))\n    .sort((a, b) => b.sent - a.sent);\n  \n  const chartData = campaignList.slice(0, 6).map(c => ({\n    name: c.name.length > 15 ? c.name.substring(0, 15) + '...' : c.name,\n    sent: c.sent,\n    read: c.read,\n    replied: c.replied,\n  }));\n  \n  const totalSent = campaignList.reduce((sum, c) => sum + c.sent, 0);\n  const totalDelivered = campaignList.reduce((sum, c) => sum + c.delivered, 0);\n  const totalRead = campaignList.reduce((sum, c) => sum + c.read, 0);\n  const totalReplied = campaignList.reduce((sum, c) => sum + c.replied, 0);\n  \n  return {\n    campaigns: campaignList,\n    chartData,\n    summary: {\n      totalCampaigns: campaignList.length,\n      totalSent,\n      totalDelivered,\n      totalRead,\n      totalReplied,\n      avgDeliveryRate: totalSent > 0 ? Math.round((totalDelivered / totalSent) * 100) : 0,\n      avgReadRate: totalSent > 0 ? Math.round((totalRead / totalSent) * 100) : 0,\n      avgReplyRate: totalSent > 0 ? Math.round((totalReplied / totalSent) * 100 * 10) / 10 : 0,\n      totalCost: (totalSent * 0.009).toFixed(2),\n    },\n    period: filter.period,\n  };\n}\n\nexport async function getBlockedContactsReport(userId: string) {\n  const blockedContacts = await mongodb.readCollection<any>('blocked_contacts');\n  \n  const userBlocked = blockedContacts.filter(c => c.userId === userId && c.isActive !== false);\n  \n  const now = new Date();\n  const thisMonth = userBlocked.filter(c => {\n    const blockDate = new Date(c.blockedAt);\n    return blockDate.getMonth() === now.getMonth() && blockDate.getFullYear() === now.getFullYear();\n  });\n  \n  const thisWeek = userBlocked.filter(c => {\n    const blockDate = new Date(c.blockedAt);\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    return blockDate >= weekAgo;\n  });\n  \n  const today = userBlocked.filter(c => {\n    const blockDate = new Date(c.blockedAt);\n    return blockDate.toDateString() === now.toDateString();\n  });\n  \n  const withReason = userBlocked.filter(c => c.reason && c.reason.trim() !== '');\n  \n  const reasonCounts = new Map<string, number>();\n  for (const contact of withReason) {\n    const reason = contact.reason || 'No reason';\n    reasonCounts.set(reason, (reasonCounts.get(reason) || 0) + 1);\n  }\n  \n  const topReasons = Array.from(reasonCounts.entries())\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5)\n    .map(([reason, count]) => ({ reason, count }));\n  \n  const recentBlocked = userBlocked\n    .sort((a, b) => new Date(b.blockedAt).getTime() - new Date(a.blockedAt).getTime())\n    .slice(0, 10);\n  \n  return {\n    contacts: userBlocked,\n    summary: {\n      totalBlocked: userBlocked.length,\n      blockedThisMonth: thisMonth.length,\n      blockedThisWeek: thisWeek.length,\n      blockedToday: today.length,\n      withReason: withReason.length,\n      topReasons,\n    },\n    recentBlocked,\n  };\n}\n\nexport async function get24HourWindowStats(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const messages = await mongodb.readCollection<any>('messages');\n  const chats = await mongodb.readCollection<any>('chats');\n  const contactAgents = await mongodb.readCollection<any>('contact_agents');\n  const contacts = await mongodb.readCollection<any>('contacts');\n  \n  const lastInboundMap = new Map<string, Date>();\n  for (const chat of chats) {\n    if (chat.lastInboundMessageTime) {\n      lastInboundMap.set(chat.contactId, new Date(chat.lastInboundMessageTime));\n    }\n  }\n  \n  const filteredMessages = messages.filter(m => {\n    const timestamp = new Date(m.timestamp || m.createdAt);\n    return timestamp >= startDate && timestamp <= endDate;\n  });\n  \n  const outbound = filteredMessages.filter(m => m.direction === 'outbound');\n  const inbound = filteredMessages.filter(m => m.direction === 'inbound');\n  \n  let windowCompliant = 0;\n  let windowNonCompliant = 0;\n  let aiInWindow = 0;\n  let humanInWindow = 0;\n  \n  for (const msg of outbound) {\n    const lastInbound = lastInboundMap.get(msg.contactId);\n    const msgTime = new Date(msg.timestamp || msg.createdAt);\n    \n    if (lastInbound) {\n      const hoursDiff = (msgTime.getTime() - lastInbound.getTime()) / (1000 * 60 * 60);\n      if (hoursDiff <= 24 && hoursDiff >= 0) {\n        windowCompliant++;\n        if (msg.agentId && msg.agentId !== 'manual') {\n          aiInWindow++;\n        } else {\n          humanInWindow++;\n        }\n      } else {\n        windowNonCompliant++;\n      }\n    } else {\n      windowNonCompliant++;\n    }\n  }\n  \n  const uniqueContacts = new Set(filteredMessages.map(m => m.contactId));\n  const newContacts = contacts.filter(c => {\n    const createdAt = new Date(c.createdAt);\n    return createdAt >= startDate && createdAt <= endDate;\n  });\n  \n  const activeAgentAssignments = contactAgents.filter(ca => ca.isActive);\n  const aiConversations = activeAgentAssignments.length;\n  \n  const totalAiResponses = outbound.filter(m => m.agentId && m.agentId !== 'manual').length;\n  const totalHumanResponses = outbound.filter(m => !m.agentId || m.agentId === 'manual').length;\n  \n  const delivered = outbound.filter(m => ['delivered', 'read'].includes(m.status)).length;\n  const read = outbound.filter(m => m.status === 'read').length;\n  \n  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  const dayWise: { day: string; sent: number; delivered: number; read: number; inbound: number; ai: number; human: number }[] = [];\n  \n  const duration = endDate.getTime() - startDate.getTime();\n  const days = Math.ceil(duration / (24 * 60 * 60 * 1000));\n  \n  for (let d = 0; d < Math.min(days, 30); d++) {\n    const dayStart = new Date(startDate.getTime() + d * 24 * 60 * 60 * 1000);\n    dayStart.setHours(0, 0, 0, 0);\n    const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n    \n    const dayMessages = filteredMessages.filter(m => {\n      const timestamp = new Date(m.timestamp || m.createdAt);\n      return timestamp >= dayStart && timestamp < dayEnd;\n    });\n    \n    const dayOutbound = dayMessages.filter(m => m.direction === 'outbound');\n    const dayInbound = dayMessages.filter(m => m.direction === 'inbound');\n    const dayDelivered = dayOutbound.filter(m => ['delivered', 'read'].includes(m.status));\n    const dayRead = dayOutbound.filter(m => m.status === 'read');\n    const dayAi = dayOutbound.filter(m => m.agentId && m.agentId !== 'manual');\n    const dayHuman = dayOutbound.filter(m => !m.agentId || m.agentId === 'manual');\n    \n    dayWise.push({\n      day: days <= 7 ? dayNames[dayStart.getDay()] : `${dayStart.getDate()}/${dayStart.getMonth() + 1}`,\n      sent: dayOutbound.length,\n      delivered: dayDelivered.length,\n      read: dayRead.length,\n      inbound: dayInbound.length,\n      ai: dayAi.length,\n      human: dayHuman.length\n    });\n  }\n  \n  return {\n    summary: {\n      totalMessages: filteredMessages.length,\n      outboundMessages: outbound.length,\n      inboundMessages: inbound.length,\n      delivered,\n      read,\n      deliveryRate: outbound.length > 0 ? Math.round((delivered / outbound.length) * 100) : 0,\n      readRate: delivered > 0 ? Math.round((read / delivered) * 100) : 0,\n      windowCompliant,\n      windowNonCompliant,\n      windowComplianceRate: outbound.length > 0 ? Math.round((windowCompliant / outbound.length) * 100) : 0,\n      aiInWindow,\n      humanInWindow,\n      totalAiResponses,\n      totalHumanResponses,\n      aiPercentage: outbound.length > 0 ? Math.round((totalAiResponses / outbound.length) * 100) : 0,\n      activeContacts: uniqueContacts.size,\n      newContacts: newContacts.length,\n      aiConversations,\n    },\n    dayWise,\n    period: filter.period,\n  };\n}\n\nexport async function getEnhancedDashboardStats(filter: TimeFilter, userId?: string) {\n  const { startDate, endDate } = getDateRange(filter);\n  \n  const previousDuration = endDate.getTime() - startDate.getTime();\n  const previousStartDate = new Date(startDate.getTime() - previousDuration);\n  const previousEndDate = new Date(startDate.getTime());\n  \n  const [currentStats, previousStats] = await Promise.all([\n    get24HourWindowStats(filter, userId),\n    get24HourWindowStats({ period: 'custom', startDate: previousStartDate.toISOString(), endDate: previousEndDate.toISOString() }, userId)\n  ]);\n  \n  const calculateChange = (current: number, previous: number) => {\n    if (previous === 0) return current > 0 ? 100 : 0;\n    return Math.round(((current - previous) / previous) * 100);\n  };\n  \n  return {\n    ...currentStats,\n    changes: {\n      messagesChange: calculateChange(currentStats.summary.totalMessages, previousStats.summary.totalMessages),\n      outboundChange: calculateChange(currentStats.summary.outboundMessages, previousStats.summary.outboundMessages),\n      deliveredChange: calculateChange(currentStats.summary.delivered, previousStats.summary.delivered),\n      readRateChange: calculateChange(currentStats.summary.readRate, previousStats.summary.readRate),\n      aiChange: calculateChange(currentStats.summary.totalAiResponses, previousStats.summary.totalAiResponses),\n      newContactsChange: calculateChange(currentStats.summary.newContacts, previousStats.summary.newContacts),\n      windowComplianceChange: calculateChange(currentStats.summary.windowComplianceRate, previousStats.summary.windowComplianceRate),\n    }\n  };\n}\n\nexport const reportsService = {\n  getDateRange,\n  getAIAgentPerformance,\n  getCustomerReplies,\n  getUserEngagement,\n  getSpendingReport,\n  get24HourWindowStats,\n  getEnhancedDashboardStats,\n  getDashboardOverview,\n  getCampaignPerformance,\n  getBlockedContactsReport,\n};\n","path":null,"size_bytes":29206,"size_tokens":null},"server/modules/gemini/gemini.service.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\nimport { credentialsService } from '../credentials/credentials.service';\n\nconst SYSTEM_GEMINI_API_KEY = process.env.GEMINI_API_KEY || process.env.GOOGLE_API_KEY;\n\ninterface ChatMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  systemPrompt?: string;\n  instructions?: string;\n  model?: string;\n  temperature?: number;\n}\n\nasync function getGeminiApiKey(userId?: string): Promise<string | null> {\n  if (userId) {\n    try {\n      const creds = await credentialsService.getDecryptedCredentials(userId);\n      if (creds?.geminiApiKey) {\n        return creds.geminiApiKey;\n      }\n    } catch (error) {\n      console.error('[Gemini Service] Error getting user API key:', error);\n    }\n  }\n  \n  return SYSTEM_GEMINI_API_KEY || null;\n}\n\nfunction mapModelName(model: string): string {\n  const modelMap: { [key: string]: string } = {\n    'gemini-2.5-flash': 'gemini-2.5-flash',\n    'gemini-2.5-pro': 'gemini-2.5-pro',\n    'gemini-2.0-flash': 'gemini-2.0-flash',\n    'gemini-1.5-flash': 'gemini-1.5-flash',\n    'gemini-1.5-pro': 'gemini-1.5-pro',\n  };\n  return modelMap[model] || 'gemini-2.5-flash';\n}\n\nexport async function sendGeminiCompletion(\n  messages: ChatMessage[],\n  agent?: Agent,\n  userId?: string\n): Promise<string> {\n  const apiKey = await getGeminiApiKey(userId);\n  \n  if (!apiKey) {\n    throw new Error('Gemini API key is not configured. Please add your API key in Settings > API Credentials.');\n  }\n\n  const ai = new GoogleGenAI({ apiKey });\n  const model = mapModelName(agent?.model || 'gemini-2.5-flash');\n\n  const systemPromptContent = agent?.systemPrompt || agent?.instructions || '';\n  \n  const userMessages = messages.filter(m => m.role !== 'system');\n  const conversationContent = userMessages.map(m => ({\n    role: m.role === 'assistant' ? 'model' : 'user',\n    parts: [{ text: m.content }]\n  }));\n\n  try {\n    const response = await ai.models.generateContent({\n      model,\n      contents: conversationContent,\n      config: {\n        systemInstruction: systemPromptContent || undefined,\n        temperature: agent?.temperature ?? 0.7,\n        maxOutputTokens: 1024,\n      },\n    });\n\n    const responseText = response.text || '';\n    \n    // Detect and filter refusal responses from Gemini\n    const refusalPatterns = [\n      'I am sorry, I cannot fulfill this request',\n      'I cannot generate personalized messages',\n      'I am not able to generate',\n      'I\\'m sorry, I cannot',\n      'I cannot assist with',\n      'I\\'m not able to help with',\n    ];\n    \n    const isRefusal = refusalPatterns.some(pattern => \n      responseText.toLowerCase().includes(pattern.toLowerCase())\n    );\n    \n    if (isRefusal || !responseText.trim()) {\n      console.log('[Gemini] Detected refusal or empty response, using fallback');\n      // Return a neutral follow-up message based on the agent's purpose\n      if (systemPromptContent.toLowerCase().includes('award') || systemPromptContent.toLowerCase().includes('life changer')) {\n        return \"Please reply if you are interested in the award, and I will share the benefits again.\";\n      }\n      return \"Thank you for your message! How can I assist you today?\";\n    }\n    \n    return responseText;\n  } catch (error) {\n    console.error('Gemini API error:', error);\n    throw error;\n  }\n}\n\nexport async function generateGeminiAgentResponse(\n  userMessage: string,\n  agent: Agent,\n  conversationHistory: ChatMessage[] = [],\n  userId?: string\n): Promise<string> {\n  const messages: ChatMessage[] = [\n    ...conversationHistory,\n    { role: 'user', content: userMessage },\n  ];\n\n  return sendGeminiCompletion(messages, agent, userId);\n}\n\nexport async function testGeminiConnection(userId?: string): Promise<boolean> {\n  const apiKey = await getGeminiApiKey(userId);\n  \n  if (!apiKey) {\n    return false;\n  }\n  \n  try {\n    const ai = new GoogleGenAI({ apiKey });\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: 'Hello',\n    });\n    \n    return !!response.text;\n  } catch (error) {\n    console.error('[Gemini Service] Connection test failed:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":4203,"size_tokens":null},"server/modules/ai/ai.service.ts":{"content":"import { sendChatCompletion, generateAgentResponse as generateOpenAIResponse } from '../openai/openai.service';\nimport { sendGeminiCompletion, generateGeminiAgentResponse } from '../gemini/gemini.service';\n\ninterface ChatMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\ninterface Agent {\n  id: string;\n  name: string;\n  systemPrompt?: string;\n  instructions?: string;\n  model?: string;\n  temperature?: number;\n}\n\nfunction isGeminiModel(model: string): boolean {\n  return model.startsWith('gemini-');\n}\n\nfunction isOpenAIModel(model: string): boolean {\n  return model.startsWith('gpt-') || !isGeminiModel(model);\n}\n\nexport async function generateAIResponse(\n  messages: ChatMessage[],\n  agent?: Agent,\n  userId?: string\n): Promise<string> {\n  const model = agent?.model || 'gpt-4o';\n  \n  if (isGeminiModel(model)) {\n    return sendGeminiCompletion(messages, agent, userId);\n  }\n  \n  return sendChatCompletion(messages, agent, userId);\n}\n\nexport async function generateAgentResponse(\n  userMessage: string,\n  agent: Agent,\n  conversationHistory: ChatMessage[] = [],\n  userId?: string\n): Promise<string> {\n  const model = agent?.model || 'gpt-4o';\n  \n  if (isGeminiModel(model)) {\n    return generateGeminiAgentResponse(userMessage, agent, conversationHistory, userId);\n  }\n  \n  return generateOpenAIResponse(userMessage, agent, conversationHistory, userId);\n}\n\nexport function getProviderForModel(model: string): 'openai' | 'gemini' {\n  return isGeminiModel(model) ? 'gemini' : 'openai';\n}\n\nexport const aiService = {\n  generateAIResponse,\n  generateAgentResponse,\n  getProviderForModel,\n  isGeminiModel,\n  isOpenAIModel,\n};\n","path":null,"size_bytes":1647,"size_tokens":null},"server/modules/email/email.service.ts":{"content":"import nodemailer from 'nodemailer';\n\nconst SMTP_EMAIL = process.env.SMTP_EMAIL;\nconst SMTP_PASSWORD = process.env.SMTP_PASSWORD;\n\nconst transporter = nodemailer.createTransport({\n  host: \"smtp.zoho.in\",\n  port: 465,\n  secure: true,\n  auth: {\n    user: SMTP_EMAIL,\n    pass: SMTP_PASSWORD,\n  },\n});\n\nexport async function sendCredentialsEmail(\n  toEmail: string,\n  name: string,\n  username: string,\n  password: string\n): Promise<boolean> {\n  if (!SMTP_EMAIL || !SMTP_PASSWORD) {\n    console.error('[Email] SMTP credentials not configured');\n    return false;\n  }\n\n  try {\n    const mailOptions = {\n      from: `\"WhatsApp Business API\" <${SMTP_EMAIL}>`,\n      to: toEmail,\n      subject: 'Your WhatsApp Business API Dashboard Login Credentials',\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        </head>\n        <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <div style=\"background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); padding: 30px; border-radius: 10px 10px 0 0; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 24px;\">WhatsApp Business API Dashboard</h1>\n          </div>\n          \n          <div style=\"background: #ffffff; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 10px 10px;\">\n            <h2 style=\"color: #111827; margin-top: 0;\">Welcome, ${name}!</h2>\n            \n            <p style=\"color: #4b5563;\">Your account has been created successfully. Here are your login credentials:</p>\n            \n            <div style=\"background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n              <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                  <td style=\"padding: 10px 0; color: #6b7280; font-weight: 500;\">Username:</td>\n                  <td style=\"padding: 10px 0; color: #111827; font-weight: 600;\">${username}</td>\n                </tr>\n                <tr>\n                  <td style=\"padding: 10px 0; color: #6b7280; font-weight: 500;\">Password:</td>\n                  <td style=\"padding: 10px 0; color: #111827; font-weight: 600;\">${password}</td>\n                </tr>\n              </table>\n            </div>\n            \n            <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 0 8px 8px 0;\">\n              <p style=\"margin: 0; color: #92400e; font-size: 14px;\">\n                <strong>Important:</strong> Please keep these credentials secure and do not share them with anyone. We recommend changing your password after your first login.\n              </p>\n            </div>\n            \n            <p style=\"color: #4b5563;\">If you have any questions or need assistance, please contact your administrator.</p>\n            \n            <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n            \n            <p style=\"color: #9ca3af; font-size: 12px; text-align: center; margin: 0;\">\n              This is an automated message from WhatsApp Business API Dashboard. Please do not reply to this email.\n            </p>\n          </div>\n        </body>\n        </html>\n      `,\n      text: `\nWelcome to WhatsApp Business API Dashboard!\n\nHi ${name},\n\nYour account has been created successfully. Here are your login credentials:\n\nUsername: ${username}\nPassword: ${password}\n\nImportant: Please keep these credentials secure and do not share them with anyone. We recommend changing your password after your first login.\n\nIf you have any questions or need assistance, please contact your administrator.\n\nThis is an automated message. Please do not reply to this email.\n      `.trim()\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`[Email] Credentials sent successfully to ${toEmail}`);\n    return true;\n  } catch (error) {\n    console.error('[Email] Failed to send credentials email:', error);\n    return false;\n  }\n}\n\nexport async function sendPasswordResetEmail(\n  toEmail: string,\n  name: string,\n  username: string,\n  newPassword: string\n): Promise<boolean> {\n  if (!SMTP_EMAIL || !SMTP_PASSWORD) {\n    console.error('[Email] SMTP credentials not configured');\n    return false;\n  }\n\n  try {\n    const mailOptions = {\n      from: `\"WhatsApp Business API\" <${SMTP_EMAIL}>`,\n      to: toEmail,\n      subject: 'Your Password Has Been Reset - WhatsApp Business API Dashboard',\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        </head>\n        <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <div style=\"background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); padding: 30px; border-radius: 10px 10px 0 0; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 24px;\">WhatsApp Business API Dashboard</h1>\n          </div>\n          \n          <div style=\"background: #ffffff; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 10px 10px;\">\n            <h2 style=\"color: #111827; margin-top: 0;\">Password Reset</h2>\n            \n            <p style=\"color: #4b5563;\">Hi ${name}, your password has been reset by an administrator. Here are your new login credentials:</p>\n            \n            <div style=\"background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n              <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                  <td style=\"padding: 10px 0; color: #6b7280; font-weight: 500;\">Username:</td>\n                  <td style=\"padding: 10px 0; color: #111827; font-weight: 600;\">${username}</td>\n                </tr>\n                <tr>\n                  <td style=\"padding: 10px 0; color: #6b7280; font-weight: 500;\">New Password:</td>\n                  <td style=\"padding: 10px 0; color: #111827; font-weight: 600;\">${newPassword}</td>\n                </tr>\n              </table>\n            </div>\n            \n            <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 0 8px 8px 0;\">\n              <p style=\"margin: 0; color: #92400e; font-size: 14px;\">\n                <strong>Important:</strong> Please keep these credentials secure. We recommend changing your password after logging in.\n              </p>\n            </div>\n            \n            <p style=\"color: #4b5563;\">If you did not request this password reset, please contact your administrator immediately.</p>\n            \n            <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n            \n            <p style=\"color: #9ca3af; font-size: 12px; text-align: center; margin: 0;\">\n              This is an automated message from WhatsApp Business API Dashboard. Please do not reply to this email.\n            </p>\n          </div>\n        </body>\n        </html>\n      `,\n      text: `\nPassword Reset - WhatsApp Business API Dashboard\n\nHi ${name},\n\nYour password has been reset by an administrator. Here are your new login credentials:\n\nUsername: ${username}\nNew Password: ${newPassword}\n\nImportant: Please keep these credentials secure. We recommend changing your password after logging in.\n\nIf you did not request this password reset, please contact your administrator immediately.\n\nThis is an automated message. Please do not reply to this email.\n      `.trim()\n    };\n\n    await transporter.sendMail(mailOptions);\n    console.log(`[Email] Password reset email sent successfully to ${toEmail}`);\n    return true;\n  } catch (error) {\n    console.error('[Email] Failed to send password reset email:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":7964,"size_tokens":null},"server/modules/users/user.model.ts":{"content":"import mongoose, { Document, Schema } from 'mongoose';\nimport crypto from 'crypto';\n\nexport interface ISystemUser extends Document {\n  id: string;\n  email: string;\n  name: string;\n  username: string;\n  password: string;\n  role: 'super_admin' | 'sub_admin' | 'manager' | 'user';\n  pageAccess: string[];\n  isActive: boolean;\n  createdBy: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst SystemUserSchema = new Schema<ISystemUser>({\n  id: { type: String, required: true, unique: true },\n  email: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  username: { type: String, required: true, unique: true },\n  password: { type: String, required: true },\n  role: { \n    type: String, \n    enum: ['super_admin', 'sub_admin', 'manager', 'user'],\n    default: 'user'\n  },\n  pageAccess: [{ type: String }],\n  isActive: { type: Boolean, default: true },\n  createdBy: { type: String },\n  createdAt: { type: Date, default: Date.now },\n  updatedAt: { type: Date, default: Date.now }\n});\n\nSystemUserSchema.pre('save', function() {\n  this.updatedAt = new Date();\n});\n\nexport const SystemUser = mongoose.model<ISystemUser>('SystemUser', SystemUserSchema);\n\nexport const AVAILABLE_PAGES = [\n  { id: 'dashboard', name: 'Dashboard', icon: 'LayoutDashboard', path: '/' },\n  { id: 'window-inbox', name: '24-Hour Window Inbox', icon: 'Clock', path: '/inbox/window' },\n  { id: 'inbox', name: 'Inbox', icon: 'MessageSquare', path: '/inbox' },\n  { id: 'contacts', name: 'Contacts', icon: 'Users', path: '/contacts' },\n  { id: 'broadcast', name: 'Broadcast', icon: 'Radio', path: '/broadcast' },\n  { id: 'templates', name: 'Templates', icon: 'FileText', path: '/templates' },\n  { id: 'ai-agents', name: 'AI Agents', icon: 'Bot', path: '/ai-agents' },\n  { id: 'whatsapp-leads', name: 'WhatsApp Leads', icon: 'UserPlus', path: '/whatsapp-leads' },\n  { id: 'facebook-leads', name: 'Facebook Leads', icon: 'Facebook', path: '/facebook-leads' },\n  { id: 'auto-reply', name: 'Auto Reply System', icon: 'Zap', path: '/auto-reply' },\n  { id: 'flow-builder', name: 'Flow Builder', icon: 'GitBranch', path: '/flow-builder' },\n  { id: 'reports-campaign', name: 'Campaign Performance', icon: 'BarChart3', path: '/reports/campaign-performance' },\n  { id: 'reports-blocked', name: 'Blocked Contacts', icon: 'Ban', path: '/reports/blocked-contacts' },\n  { id: 'reports-engagement', name: 'User Engagement', icon: 'TrendingUp', path: '/reports/user-engagement' },\n  { id: 'settings', name: 'Settings', icon: 'Settings', path: '/settings' },\n  { id: 'user-management', name: 'User Management', icon: 'UserCog', path: '/user-management' }\n];\n\nexport const ROLE_LABELS: Record<string, string> = {\n  'super_admin': 'Super Admin',\n  'sub_admin': 'Sub Admin',\n  'manager': 'Manager',\n  'user': 'Regular User'\n};\n\nexport function generateUsername(name: string): string {\n  const base = name.toLowerCase().replace(/[^a-z0-9]/g, '');\n  const suffix = crypto.randomBytes(3).toString('hex');\n  return `${base}${suffix}`;\n}\n\nexport function generatePassword(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';\n  let password = '';\n  for (let i = 0; i < 10; i++) {\n    password += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return password;\n}\n\nexport function hashPassword(password: string): string {\n  return crypto.createHash('sha256').update(password).digest('hex');\n}\n\nexport function verifyPassword(password: string, hash: string): boolean {\n  return hashPassword(password) === hash;\n}\n","path":null,"size_bytes":3535,"size_tokens":null},"server/modules/users/users.routes.ts":{"content":"import { Router, Request, Response, NextFunction } from 'express';\nimport crypto from 'crypto';\nimport { \n  SystemUser, \n  AVAILABLE_PAGES, \n  ROLE_LABELS,\n  generateUsername, \n  generatePassword \n} from './user.model';\nimport { hashPassword } from '../auth/auth.service';\nimport { requireAuth, getUser } from '../auth/auth.routes';\nimport { sendCredentialsEmail, sendPasswordResetEmail } from '../email/email.service';\n\nfunction generateId(): string {\n  return crypto.randomUUID();\n}\n\nfunction requireAdmin(req: Request, res: Response, next: NextFunction) {\n  const user = getUser(req);\n  if (!user) {\n    return res.status(401).json({ error: 'Unauthorized' });\n  }\n  const isMainUser = !user.pageAccess || user.pageAccess.length === 0;\n  const isAdmin = user.role === 'super_admin' || user.role === 'sub_admin';\n  if (!isMainUser && !isAdmin) {\n    return res.status(403).json({ error: 'Admin access required' });\n  }\n  next();\n}\n\nconst router = Router();\n\nrouter.get('/pages', async (_req: Request, res: Response) => {\n  try {\n    res.json(AVAILABLE_PAGES);\n  } catch (error) {\n    console.error('Error fetching pages:', error);\n    res.status(500).json({ error: 'Failed to fetch pages' });\n  }\n});\n\nrouter.get('/roles', async (_req: Request, res: Response) => {\n  try {\n    const roles = Object.entries(ROLE_LABELS).map(([id, name]) => ({ id, name }));\n    res.json(roles);\n  } catch (error) {\n    console.error('Error fetching roles:', error);\n    res.status(500).json({ error: 'Failed to fetch roles' });\n  }\n});\n\nrouter.get('/', requireAuth, requireAdmin, async (_req: Request, res: Response) => {\n  try {\n    const users = await SystemUser.find({ role: { $ne: 'super_admin' } })\n      .select('-password')\n      .sort({ createdAt: -1 });\n    res.json(users);\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    res.status(500).json({ error: 'Failed to fetch users' });\n  }\n});\n\nrouter.get('/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n  try {\n    const user = await SystemUser.findOne({ id: req.params.id }).select('-password');\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n    res.json(user);\n  } catch (error) {\n    console.error('Error fetching user:', error);\n    res.status(500).json({ error: 'Failed to fetch user' });\n  }\n});\n\nrouter.post('/', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n  try {\n    const { email, name, role, pageAccess, createdBy } = req.body;\n\n    if (!email || !name) {\n      return res.status(400).json({ error: 'Email and name are required' });\n    }\n\n    const existingUser = await SystemUser.findOne({ email });\n    if (existingUser) {\n      return res.status(400).json({ error: 'User with this email already exists' });\n    }\n\n    const username = generateUsername(name);\n    const plainPassword = generatePassword();\n    const hashedPassword = hashPassword(plainPassword);\n\n    const user = new SystemUser({\n      id: generateId(),\n      email,\n      name,\n      username,\n      password: hashedPassword,\n      role: role || 'user',\n      pageAccess: pageAccess || ['dashboard'],\n      isActive: true,\n      createdBy: createdBy || 'system'\n    });\n\n    await user.save();\n\n    const emailSent = await sendCredentialsEmail(email, name, username, plainPassword);\n\n    res.status(201).json({\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        username: user.username,\n        role: user.role,\n        pageAccess: user.pageAccess,\n        isActive: user.isActive\n      },\n      credentials: {\n        username,\n        password: plainPassword\n      },\n      emailSent\n    });\n  } catch (error) {\n    console.error('Error creating user:', error);\n    res.status(500).json({ error: 'Failed to create user' });\n  }\n});\n\nrouter.put('/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n  try {\n    const { name, email, role, pageAccess, isActive } = req.body;\n\n    const user = await SystemUser.findOne({ id: req.params.id });\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    if (email && email !== user.email) {\n      const existingUser = await SystemUser.findOne({ email });\n      if (existingUser) {\n        return res.status(400).json({ error: 'Email already in use' });\n      }\n      user.email = email;\n    }\n\n    if (name) user.name = name;\n    if (role) user.role = role;\n    if (pageAccess) user.pageAccess = pageAccess;\n    if (typeof isActive === 'boolean') user.isActive = isActive;\n\n    await user.save();\n\n    res.json({\n      id: user.id,\n      email: user.email,\n      name: user.name,\n      username: user.username,\n      role: user.role,\n      pageAccess: user.pageAccess,\n      isActive: user.isActive\n    });\n  } catch (error) {\n    console.error('Error updating user:', error);\n    res.status(500).json({ error: 'Failed to update user' });\n  }\n});\n\nrouter.post('/:id/reset-password', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n  try {\n    const user = await SystemUser.findOne({ id: req.params.id });\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    const plainPassword = generatePassword();\n    user.password = hashPassword(plainPassword);\n    await user.save();\n\n    const emailSent = await sendPasswordResetEmail(user.email, user.name, user.username, plainPassword);\n\n    res.json({\n      username: user.username,\n      password: plainPassword,\n      emailSent\n    });\n  } catch (error) {\n    console.error('Error resetting password:', error);\n    res.status(500).json({ error: 'Failed to reset password' });\n  }\n});\n\nrouter.delete('/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n  try {\n    const user = await SystemUser.findOne({ id: req.params.id });\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    if (user.role === 'super_admin') {\n      return res.status(403).json({ error: 'Cannot delete super admin' });\n    }\n\n    await SystemUser.deleteOne({ id: req.params.id });\n    res.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting user:', error);\n    res.status(500).json({ error: 'Failed to delete user' });\n  }\n});\n\nrouter.get('/me/permissions', async (req: Request, res: Response) => {\n  try {\n    const userId = req.headers['x-user-id'] as string;\n    \n    if (!userId) {\n      return res.json({ \n        role: 'super_admin', \n        pageAccess: AVAILABLE_PAGES.map(p => p.id) \n      });\n    }\n\n    const user = await SystemUser.findOne({ id: userId });\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    res.json({\n      role: user.role,\n      pageAccess: user.pageAccess\n    });\n  } catch (error) {\n    console.error('Error fetching permissions:', error);\n    res.status(500).json({ error: 'Failed to fetch permissions' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":6961,"size_tokens":null},"client/src/pages/UserManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { \n  UserPlus, \n  UserCog, \n  MoreVertical, \n  Key, \n  Trash2, \n  Edit, \n  Shield, \n  Copy, \n  Check, \n  Loader2,\n  Users,\n  LayoutDashboard,\n  Clock,\n  MessageSquare,\n  Radio,\n  FileText,\n  Bot,\n  Zap,\n  GitBranch,\n  BarChart3,\n  Ban,\n  TrendingUp,\n  Settings,\n  Facebook\n} from \"lucide-react\";\n\ninterface SystemUser {\n  id: string;\n  email: string;\n  name: string;\n  username: string;\n  role: string;\n  pageAccess: string[];\n  isActive: boolean;\n  createdAt: string;\n}\n\ninterface Page {\n  id: string;\n  name: string;\n  icon: string;\n  path: string;\n}\n\ninterface Role {\n  id: string;\n  name: string;\n}\n\nconst ICON_MAP: Record<string, React.ReactNode> = {\n  LayoutDashboard: <LayoutDashboard className=\"h-4 w-4\" />,\n  Clock: <Clock className=\"h-4 w-4\" />,\n  MessageSquare: <MessageSquare className=\"h-4 w-4\" />,\n  Users: <Users className=\"h-4 w-4\" />,\n  Radio: <Radio className=\"h-4 w-4\" />,\n  FileText: <FileText className=\"h-4 w-4\" />,\n  Bot: <Bot className=\"h-4 w-4\" />,\n  UserPlus: <UserPlus className=\"h-4 w-4\" />,\n  Facebook: <Facebook className=\"h-4 w-4\" />,\n  Zap: <Zap className=\"h-4 w-4\" />,\n  GitBranch: <GitBranch className=\"h-4 w-4\" />,\n  BarChart3: <BarChart3 className=\"h-4 w-4\" />,\n  Ban: <Ban className=\"h-4 w-4\" />,\n  TrendingUp: <TrendingUp className=\"h-4 w-4\" />,\n  Settings: <Settings className=\"h-4 w-4\" />,\n  UserCog: <UserCog className=\"h-4 w-4\" />\n};\n\nconst ROLE_COLORS: Record<string, string> = {\n  super_admin: \"bg-red-100 text-red-800 border-red-200\",\n  sub_admin: \"bg-purple-100 text-purple-800 border-purple-200\",\n  manager: \"bg-blue-100 text-blue-800 border-blue-200\",\n  user: \"bg-gray-100 text-gray-800 border-gray-200\"\n};\n\nexport default function UserManagement() {\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [isEditOpen, setIsEditOpen] = useState(false);\n  const [isDeleteOpen, setIsDeleteOpen] = useState(false);\n  const [isCredentialsOpen, setIsCredentialsOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<SystemUser | null>(null);\n  const [newCredentials, setNewCredentials] = useState<{ username: string; password: string } | null>(null);\n  const [copied, setCopied] = useState(false);\n\n  const [formData, setFormData] = useState({\n    email: \"\",\n    name: \"\",\n    role: \"user\",\n    pageAccess: [\"dashboard\"] as string[]\n  });\n\n  const queryClient = useQueryClient();\n\n  const { data: users = [], isLoading: usersLoading } = useQuery<SystemUser[]>({\n    queryKey: [\"/api/users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/users\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch users\");\n      return res.json();\n    }\n  });\n\n  const { data: pages = [] } = useQuery<Page[]>({\n    queryKey: [\"/api/users/pages\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/users/pages\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch pages\");\n      return res.json();\n    }\n  });\n\n  const { data: roles = [] } = useQuery<Role[]>({\n    queryKey: [\"/api/users/roles\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/users/roles\", {\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch roles\");\n      return res.json();\n    }\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/users\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", ...getAuthHeaders() },\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to create user\");\n      }\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setNewCredentials(data.credentials);\n      setIsCreateOpen(false);\n      setIsCredentialsOpen(true);\n      resetForm();\n      if (data.emailSent) {\n        toast.success(\"User created successfully. Credentials have been emailed.\");\n      } else {\n        toast.success(\"User created successfully. Email could not be sent - share credentials manually.\");\n      }\n    },\n    onError: (error: Error) => {\n      toast.error(error.message);\n    }\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async (data: { id: string } & Partial<typeof formData>) => {\n      const res = await fetch(`/api/users/${data.id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\", ...getAuthHeaders() },\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsEditOpen(false);\n      setSelectedUser(null);\n      resetForm();\n      toast.success(\"User updated successfully\");\n    },\n    onError: (error: Error) => {\n      toast.error(error.message);\n    }\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/users/${id}`, { \n        method: \"DELETE\",\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to delete user\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsDeleteOpen(false);\n      setSelectedUser(null);\n      toast.success(\"User deleted successfully\");\n    },\n    onError: () => {\n      toast.error(\"Failed to delete user\");\n    }\n  });\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/users/${id}/reset-password`, { \n        method: \"POST\",\n        headers: getAuthHeaders()\n      });\n      if (!res.ok) throw new Error(\"Failed to reset password\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setNewCredentials(data);\n      setIsCredentialsOpen(true);\n      if (data.emailSent) {\n        toast.success(\"Password reset successfully. New credentials have been emailed.\");\n      } else {\n        toast.success(\"Password reset successfully. Email could not be sent - share credentials manually.\");\n      }\n    },\n    onError: () => {\n      toast.error(\"Failed to reset password\");\n    }\n  });\n\n  const resetForm = () => {\n    setFormData({\n      email: \"\",\n      name: \"\",\n      role: \"user\",\n      pageAccess: [\"dashboard\"]\n    });\n  };\n\n  const handleEditUser = (user: SystemUser) => {\n    setSelectedUser(user);\n    setFormData({\n      email: user.email,\n      name: user.name,\n      role: user.role,\n      pageAccess: user.pageAccess\n    });\n    setIsEditOpen(true);\n  };\n\n  const handlePageToggle = (pageId: string) => {\n    setFormData(prev => ({\n      ...prev,\n      pageAccess: prev.pageAccess.includes(pageId)\n        ? prev.pageAccess.filter(p => p !== pageId)\n        : [...prev.pageAccess, pageId]\n    }));\n  };\n\n  const handleSelectAllPages = () => {\n    if (formData.pageAccess.length === pages.length) {\n      setFormData(prev => ({ ...prev, pageAccess: [\"dashboard\"] }));\n    } else {\n      setFormData(prev => ({ ...prev, pageAccess: pages.map(p => p.id) }));\n    }\n  };\n\n  const copyCredentials = () => {\n    if (newCredentials) {\n      navigator.clipboard.writeText(`Username: ${newCredentials.username}\\nPassword: ${newCredentials.password}`);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n      toast.success(\"Credentials copied to clipboard\");\n    }\n  };\n\n  const formatDate = (date: string) => {\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\"\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 animate-in fade-in duration-500\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n              <UserCog className=\"h-7 w-7 text-primary\" />\n              User Management\n            </h2>\n            <p className=\"text-muted-foreground\">\n              Create and manage users, assign roles and page access permissions\n            </p>\n          </div>\n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <Button onClick={() => { resetForm(); setIsCreateOpen(true); }}>\n                <UserPlus className=\"mr-2 h-4 w-4\" />\n                Create User\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n              <DialogHeader>\n                <DialogTitle>Create New User</DialogTitle>\n                <DialogDescription>\n                  Add a new user to the system. They will receive login credentials after creation.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"flex-1 overflow-y-auto space-y-4 py-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Full Name</Label>\n                    <Input\n                      id=\"name\"\n                      placeholder=\"John Doe\"\n                      value={formData.name}\n                      onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email Address</Label>\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder=\"john@example.com\"\n                      value={formData.email}\n                      onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Role</Label>\n                  <Select value={formData.role} onValueChange={(value) => setFormData(prev => ({ ...prev, role: value }))}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a role\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {roles.filter(r => r.id !== 'super_admin').map(role => (\n                        <SelectItem key={role.id} value={role.id}>\n                          <div className=\"flex items-center gap-2\">\n                            <Shield className=\"h-4 w-4\" />\n                            {role.name}\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label>Page Access</Label>\n                    <Button variant=\"ghost\" size=\"sm\" onClick={handleSelectAllPages}>\n                      {formData.pageAccess.length === pages.length ? \"Deselect All\" : \"Select All\"}\n                    </Button>\n                  </div>\n                  <Card>\n                    <ScrollArea className=\"h-[200px]\">\n                      <div className=\"p-4 grid grid-cols-2 gap-3\">\n                        {pages.map(page => (\n                          <div\n                            key={page.id}\n                            className={`flex items-center gap-3 p-2 rounded-lg border cursor-pointer transition-colors ${\n                              formData.pageAccess.includes(page.id)\n                                ? \"bg-primary/10 border-primary\"\n                                : \"hover:bg-muted\"\n                            }`}\n                            onClick={() => handlePageToggle(page.id)}\n                          >\n                            <Checkbox\n                              checked={formData.pageAccess.includes(page.id)}\n                              onCheckedChange={() => handlePageToggle(page.id)}\n                            />\n                            <div className=\"flex items-center gap-2\">\n                              {ICON_MAP[page.icon] || <LayoutDashboard className=\"h-4 w-4\" />}\n                              <span className=\"text-sm font-medium\">{page.name}</span>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  </Card>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {formData.pageAccess.length} page(s) selected\n                  </p>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsCreateOpen(false)}>Cancel</Button>\n                <Button \n                  onClick={() => createUserMutation.mutate(formData)}\n                  disabled={!formData.name || !formData.email || createUserMutation.isPending}\n                >\n                  {createUserMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  Create User\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              System Users\n            </CardTitle>\n            <CardDescription>\n              {users.length} user{users.length !== 1 ? \"s\" : \"\"} in the system\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {usersLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n              </div>\n            ) : users.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No users created yet</p>\n                <p className=\"text-sm\">Create your first user to get started</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User</TableHead>\n                    <TableHead>Username</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Pages</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead className=\"w-[50px]\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {users.map(user => (\n                    <TableRow key={user.id}>\n                      <TableCell>\n                        <div>\n                          <p className=\"font-medium\">{user.name}</p>\n                          <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <code className=\"text-sm bg-muted px-2 py-1 rounded\">{user.username}</code>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className={ROLE_COLORS[user.role] || ROLE_COLORS.user}>\n                          {roles.find(r => r.id === user.role)?.name || user.role}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\">\n                          {user.pageAccess.length} pages\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={user.isActive ? \"default\" : \"destructive\"}>\n                          {user.isActive ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground text-sm\">\n                        {formatDate(user.createdAt)}\n                      </TableCell>\n                      <TableCell>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\">\n                              <MoreVertical className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => handleEditUser(user)}>\n                              <Edit className=\"mr-2 h-4 w-4\" />\n                              Edit User\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => resetPasswordMutation.mutate(user.id)}>\n                              <Key className=\"mr-2 h-4 w-4\" />\n                              Reset Password\n                            </DropdownMenuItem>\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => { setSelectedUser(user); setIsDeleteOpen(true); }}\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Delete User\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col\">\n            <DialogHeader>\n              <DialogTitle>Edit User</DialogTitle>\n              <DialogDescription>\n                Update user details and permissions\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"flex-1 overflow-y-auto space-y-4 py-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-name\">Full Name</Label>\n                  <Input\n                    id=\"edit-name\"\n                    value={formData.name}\n                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-email\">Email Address</Label>\n                  <Input\n                    id=\"edit-email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Role</Label>\n                <Select value={formData.role} onValueChange={(value) => setFormData(prev => ({ ...prev, role: value }))}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {roles.filter(r => r.id !== 'super_admin').map(role => (\n                      <SelectItem key={role.id} value={role.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <Shield className=\"h-4 w-4\" />\n                          {role.name}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <Label>Page Access</Label>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={handleSelectAllPages}>\n                    {formData.pageAccess.length === pages.length ? \"Deselect All\" : \"Select All\"}\n                  </Button>\n                </div>\n                <Card>\n                  <ScrollArea className=\"h-[200px]\">\n                    <div className=\"p-4 grid grid-cols-2 gap-3\">\n                      {pages.map(page => (\n                        <div\n                          key={page.id}\n                          className={`flex items-center gap-3 p-2 rounded-lg border cursor-pointer transition-colors ${\n                            formData.pageAccess.includes(page.id)\n                              ? \"bg-primary/10 border-primary\"\n                              : \"hover:bg-muted\"\n                          }`}\n                          onClick={() => handlePageToggle(page.id)}\n                        >\n                          <Checkbox\n                            checked={formData.pageAccess.includes(page.id)}\n                            onCheckedChange={() => handlePageToggle(page.id)}\n                          />\n                          <div className=\"flex items-center gap-2\">\n                            {ICON_MAP[page.icon] || <LayoutDashboard className=\"h-4 w-4\" />}\n                            <span className=\"text-sm font-medium\">{page.name}</span>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                </Card>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsEditOpen(false)}>Cancel</Button>\n              <Button \n                onClick={() => selectedUser && updateUserMutation.mutate({ id: selectedUser.id, ...formData })}\n                disabled={updateUserMutation.isPending}\n              >\n                {updateUserMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Save Changes\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isCredentialsOpen} onOpenChange={setIsCredentialsOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Key className=\"h-5 w-5 text-primary\" />\n                User Credentials\n              </DialogTitle>\n              <DialogDescription>\n                Share these credentials with the user. The password cannot be viewed again.\n              </DialogDescription>\n            </DialogHeader>\n            {newCredentials && (\n              <div className=\"space-y-4 py-4\">\n                <Card className=\"bg-muted/50\">\n                  <CardContent className=\"pt-6 space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-muted-foreground\">Username</Label>\n                      <div className=\"flex items-center gap-2\">\n                        <code className=\"flex-1 bg-background p-3 rounded-lg font-mono text-lg\">\n                          {newCredentials.username}\n                        </code>\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-muted-foreground\">Password</Label>\n                      <div className=\"flex items-center gap-2\">\n                        <code className=\"flex-1 bg-background p-3 rounded-lg font-mono text-lg\">\n                          {newCredentials.password}\n                        </code>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                <Button className=\"w-full\" variant=\"outline\" onClick={copyCredentials}>\n                  {copied ? <Check className=\"mr-2 h-4 w-4\" /> : <Copy className=\"mr-2 h-4 w-4\" />}\n                  {copied ? \"Copied!\" : \"Copy Credentials\"}\n                </Button>\n              </div>\n            )}\n            <DialogFooter>\n              <Button onClick={() => { setIsCredentialsOpen(false); setNewCredentials(null); }}>\n                Done\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <AlertDialog open={isDeleteOpen} onOpenChange={setIsDeleteOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Delete User</AlertDialogTitle>\n              <AlertDialogDescription>\n                Are you sure you want to delete {selectedUser?.name}? This action cannot be undone.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\n              <AlertDialogAction\n                className=\"bg-destructive hover:bg-destructive/90\"\n                onClick={() => selectedUser && deleteUserMutation.mutate(selectedUser.id)}\n              >\n                Delete User\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":26745,"size_tokens":null},"client/src/pages/reports/ContactReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  Users, \n  ThumbsUp, \n  ThumbsDown, \n  Minus, \n  Star, \n  Bot,\n  Clock,\n  MessageCircle,\n  Search,\n  RefreshCw,\n  TrendingUp,\n  Eye,\n  Loader2,\n  AlertCircle,\n  CheckCircle2\n} from \"lucide-react\";\nimport { PieChart, Pie, Cell, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, Legend } from \"recharts\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AgentInteraction {\n  agentId: string;\n  agentName: string;\n  messagesCount: number;\n  firstInteraction: string;\n  lastInteraction: string;\n  durationMinutes: number;\n}\n\ninterface ContactAnalytics {\n  id: string;\n  contactId: string;\n  phone: string;\n  contactName: string;\n  interestLevel: 'interested' | 'not_interested' | 'neutral' | 'highly_interested' | 'pending';\n  interestScore: number;\n  interestReason: string;\n  totalMessages: number;\n  inboundMessages: number;\n  outboundMessages: number;\n  aiAgentInteractions: AgentInteraction[];\n  firstContactTime: string;\n  lastContactTime: string;\n  conversationDuration: number;\n  keyTopics: string[];\n  objections: string[];\n  positiveSignals: string[];\n  negativeSignals: string[];\n  lastAnalyzedAt: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface AnalyticsSummary {\n  total: number;\n  byInterestLevel: { level: string; count: number; percentage: number }[];\n  averageScore: number;\n  topAgents: { agentName: string; contactsHandled: number }[];\n}\n\nconst INTEREST_COLORS = {\n  highly_interested: '#22c55e',\n  interested: '#84cc16',\n  neutral: '#f59e0b',\n  not_interested: '#ef4444',\n  pending: '#94a3b8',\n};\n\nconst INTEREST_LABELS = {\n  highly_interested: 'Highly Interested',\n  interested: 'Interested',\n  neutral: 'Neutral',\n  not_interested: 'Not Interested',\n  pending: 'Pending Analysis',\n};\n\nconst getInterestIcon = (level: string) => {\n  switch (level) {\n    case 'highly_interested':\n      return <Star className=\"h-4 w-4 text-green-500\" />;\n    case 'interested':\n      return <ThumbsUp className=\"h-4 w-4 text-lime-500\" />;\n    case 'neutral':\n      return <Minus className=\"h-4 w-4 text-amber-500\" />;\n    case 'not_interested':\n      return <ThumbsDown className=\"h-4 w-4 text-red-500\" />;\n    default:\n      return <Clock className=\"h-4 w-4 text-slate-400\" />;\n  }\n};\n\nconst getInterestBadge = (level: string) => {\n  const color = INTEREST_COLORS[level as keyof typeof INTEREST_COLORS] || INTEREST_COLORS.pending;\n  return (\n    <Badge \n      className=\"flex items-center gap-1\"\n      style={{ backgroundColor: color, color: 'white' }}\n    >\n      {getInterestIcon(level)}\n      {INTEREST_LABELS[level as keyof typeof INTEREST_LABELS] || 'Unknown'}\n    </Badge>\n  );\n};\n\nexport default function ContactReports() {\n  const [filter, setFilter] = useState<string>(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedContact, setSelectedContact] = useState<ContactAnalytics | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: reportsData, isLoading: reportsLoading } = useQuery<{ reports: ContactAnalytics[]; total: number }>({\n    queryKey: [\"/api/contact-analytics/reports\", filter],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (filter !== \"all\") params.set(\"interestLevel\", filter);\n      params.set(\"limit\", \"100\");\n      const response = await fetch(`/api/contact-analytics/reports?${params}`);\n      if (!response.ok) throw new Error(\"Failed to fetch reports\");\n      return response.json();\n    },\n  });\n\n  const { data: summary, isLoading: summaryLoading } = useQuery<AnalyticsSummary>({\n    queryKey: [\"/api/contact-analytics/summary\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/contact-analytics/summary\");\n      if (!response.ok) throw new Error(\"Failed to fetch summary\");\n      return response.json();\n    },\n  });\n\n  const analyzeAllMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/contact-analytics/analyze-all\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to analyze contacts\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Analysis Complete\",\n        description: `Analyzed ${data.analyzed} contacts`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/contact-analytics\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Analysis Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredReports = reportsData?.reports?.filter(report => {\n    if (!searchQuery) return true;\n    const query = searchQuery.toLowerCase();\n    return (\n      report.phone.includes(query) ||\n      report.contactName.toLowerCase().includes(query)\n    );\n  }) || [];\n\n  const pieData = summary?.byInterestLevel?.map(item => ({\n    name: INTEREST_LABELS[item.level as keyof typeof INTEREST_LABELS] || item.level,\n    value: item.count,\n    color: INTEREST_COLORS[item.level as keyof typeof INTEREST_COLORS] || INTEREST_COLORS.pending,\n  })) || [];\n\n  const agentData = summary?.topAgents?.map(agent => ({\n    name: agent.agentName,\n    contacts: agent.contactsHandled,\n  })) || [];\n\n  const formatDuration = (minutes: number) => {\n    if (minutes < 60) return `${minutes}m`;\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours}h ${mins}m`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    if (!dateStr) return 'N/A';\n    const date = new Date(dateStr);\n    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Contact Analytics</h1>\n            <p className=\"text-muted-foreground\">\n              AI-powered analysis of contact interest levels and conversation insights\n            </p>\n          </div>\n          <Button \n            onClick={() => analyzeAllMutation.mutate()}\n            disabled={analyzeAllMutation.isPending}\n          >\n            {analyzeAllMutation.isPending ? (\n              <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n            ) : (\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n            )}\n            Analyze All Contacts\n          </Button>\n        </div>\n\n        {/* Summary Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Total Contacts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{summary?.total || 0}</div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Average Interest Score\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"text-2xl font-bold\">{summary?.averageScore || 0}</div>\n                <Progress value={summary?.averageScore || 0} className=\"w-20\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Interested Leads\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                {(summary?.byInterestLevel?.find(l => l.level === 'interested')?.count || 0) +\n                 (summary?.byInterestLevel?.find(l => l.level === 'highly_interested')?.count || 0)}\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Not Interested\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-500\">\n                {summary?.byInterestLevel?.find(l => l.level === 'not_interested')?.count || 0}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Charts Row */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Interest Level Distribution</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[250px]\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <PieChart>\n                    <Pie\n                      data={pieData}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={60}\n                      outerRadius={80}\n                      paddingAngle={5}\n                      dataKey=\"value\"\n                    >\n                      {pieData.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip />\n                    <Legend />\n                  </PieChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Top AI Agents by Contacts</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[250px]\">\n                {agentData.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart data={agentData} layout=\"vertical\">\n                      <XAxis type=\"number\" />\n                      <YAxis dataKey=\"name\" type=\"category\" width={120} />\n                      <Tooltip />\n                      <Bar dataKey=\"contacts\" fill=\"#8b5cf6\" radius={4} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                    No agent data available\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Filters and Search */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex flex-col md:flex-row gap-4 justify-between\">\n              <div>\n                <CardTitle>Contact Reports</CardTitle>\n                <CardDescription>\n                  Click on a contact to view detailed analysis\n                </CardDescription>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"relative w-64\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search by name or phone...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n                <Select value={filter} onValueChange={setFilter}>\n                  <SelectTrigger className=\"w-48\">\n                    <SelectValue placeholder=\"Filter by interest\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Contacts</SelectItem>\n                    <SelectItem value=\"highly_interested\">Highly Interested</SelectItem>\n                    <SelectItem value=\"interested\">Interested</SelectItem>\n                    <SelectItem value=\"neutral\">Neutral</SelectItem>\n                    <SelectItem value=\"not_interested\">Not Interested</SelectItem>\n                    <SelectItem value=\"pending\">Pending Analysis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {reportsLoading ? (\n              <div className=\"flex justify-center py-8\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredReports.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No contact reports found</p>\n                <p className=\"text-sm mt-2\">Click \"Analyze All Contacts\" to generate reports</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Contact</TableHead>\n                    <TableHead>Interest Level</TableHead>\n                    <TableHead>Score</TableHead>\n                    <TableHead>Messages</TableHead>\n                    <TableHead>AI Agents</TableHead>\n                    <TableHead>Duration</TableHead>\n                    <TableHead>Last Contact</TableHead>\n                    <TableHead></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredReports.map((report) => (\n                    <TableRow \n                      key={report.id} \n                      className=\"cursor-pointer hover:bg-muted/50\"\n                      onClick={() => setSelectedContact(report)}\n                    >\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{report.contactName}</div>\n                          <div className=\"text-sm text-muted-foreground\">{report.phone}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>{getInterestBadge(report.interestLevel)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">{report.interestScore}</span>\n                          <Progress value={report.interestScore} className=\"w-16 h-2\" />\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <MessageCircle className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>{report.totalMessages}</span>\n                          <span className=\"text-muted-foreground text-xs\">\n                            ({report.inboundMessages} in / {report.outboundMessages} out)\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Bot className=\"h-4 w-4 text-purple-500\" />\n                          <span>{report.aiAgentInteractions?.length || 0}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>{formatDuration(report.conversationDuration)}</TableCell>\n                      <TableCell className=\"text-muted-foreground text-sm\">\n                        {formatDate(report.lastContactTime)}\n                      </TableCell>\n                      <TableCell>\n                        <Button variant=\"ghost\" size=\"sm\">\n                          <Eye className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Contact Detail Dialog */}\n        <Dialog open={!!selectedContact} onOpenChange={() => setSelectedContact(null)}>\n          <DialogContent className=\"max-w-3xl max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-3\">\n                <span>{selectedContact?.contactName || 'Unknown'}</span>\n                {selectedContact && getInterestBadge(selectedContact.interestLevel)}\n              </DialogTitle>\n              <DialogDescription>{selectedContact?.phone}</DialogDescription>\n            </DialogHeader>\n            \n            {selectedContact && (\n              <ScrollArea className=\"max-h-[70vh]\">\n                <div className=\"space-y-6 pr-4\">\n                  {/* Interest Analysis */}\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm\">Interest Score</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"text-3xl font-bold\">{selectedContact.interestScore}</div>\n                          <Progress value={selectedContact.interestScore} className=\"flex-1\" />\n                        </div>\n                      </CardContent>\n                    </Card>\n                    \n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm\">Conversation Duration</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                          <span className=\"text-2xl font-bold\">\n                            {formatDuration(selectedContact.conversationDuration)}\n                          </span>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n\n                  {/* Interest Reason */}\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">AI Analysis Reason</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{selectedContact.interestReason}</p>\n                    </CardContent>\n                  </Card>\n\n                  {/* Signals */}\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    {selectedContact.positiveSignals?.length > 0 && (\n                      <Card>\n                        <CardHeader className=\"pb-2\">\n                          <CardTitle className=\"text-sm flex items-center gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                            Positive Signals\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <ul className=\"space-y-1\">\n                            {selectedContact.positiveSignals.map((signal, i) => (\n                              <li key={i} className=\"text-sm text-green-600\">+ {signal}</li>\n                            ))}\n                          </ul>\n                        </CardContent>\n                      </Card>\n                    )}\n                    \n                    {selectedContact.negativeSignals?.length > 0 && (\n                      <Card>\n                        <CardHeader className=\"pb-2\">\n                          <CardTitle className=\"text-sm flex items-center gap-2\">\n                            <AlertCircle className=\"h-4 w-4 text-red-500\" />\n                            Negative Signals\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <ul className=\"space-y-1\">\n                            {selectedContact.negativeSignals.map((signal, i) => (\n                              <li key={i} className=\"text-sm text-red-600\">- {signal}</li>\n                            ))}\n                          </ul>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  {/* Key Topics */}\n                  {selectedContact.keyTopics?.length > 0 && (\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm\">Key Topics Discussed</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"flex flex-wrap gap-2\">\n                          {selectedContact.keyTopics.map((topic, i) => (\n                            <Badge key={i} variant=\"secondary\">{topic}</Badge>\n                          ))}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {/* Objections */}\n                  {selectedContact.objections?.length > 0 && (\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm\">Objections Raised</CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <ul className=\"space-y-1\">\n                          {selectedContact.objections.map((objection, i) => (\n                            <li key={i} className=\"text-sm text-amber-600\">{objection}</li>\n                          ))}\n                        </ul>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  <Separator />\n\n                  {/* AI Agent Interactions */}\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm flex items-center gap-2\">\n                        <Bot className=\"h-4 w-4 text-purple-500\" />\n                        AI Agent Interactions\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      {selectedContact.aiAgentInteractions?.length > 0 ? (\n                        <div className=\"space-y-3\">\n                          {selectedContact.aiAgentInteractions.map((interaction, i) => (\n                            <div key={i} className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                              <div>\n                                <div className=\"font-medium\">{interaction.agentName}</div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                  {interaction.messagesCount} messages | Duration: {formatDuration(interaction.durationMinutes)}\n                                </div>\n                              </div>\n                              <div className=\"text-right text-sm text-muted-foreground\">\n                                <div>First: {formatDate(interaction.firstInteraction)}</div>\n                                <div>Last: {formatDate(interaction.lastInteraction)}</div>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      ) : (\n                        <p className=\"text-muted-foreground text-sm\">No AI agent interactions recorded</p>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  {/* Message Stats */}\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">Message Statistics</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"grid grid-cols-3 gap-4\">\n                        <div className=\"text-center\">\n                          <div className=\"text-2xl font-bold\">{selectedContact.totalMessages}</div>\n                          <div className=\"text-sm text-muted-foreground\">Total</div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-2xl font-bold text-blue-600\">{selectedContact.inboundMessages}</div>\n                          <div className=\"text-sm text-muted-foreground\">Inbound</div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-2xl font-bold text-green-600\">{selectedContact.outboundMessages}</div>\n                          <div className=\"text-sm text-muted-foreground\">Outbound</div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  {/* Timeline */}\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">Contact Timeline</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                        <div>\n                          <span className=\"text-muted-foreground\">First Contact:</span>\n                          <div>{formatDate(selectedContact.firstContactTime)}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-muted-foreground\">Last Contact:</span>\n                          <div>{formatDate(selectedContact.lastContactTime)}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-muted-foreground\">Last Analyzed:</span>\n                          <div>{selectedContact.lastAnalyzedAt ? formatDate(selectedContact.lastAnalyzedAt) : 'Never'}</div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              </ScrollArea>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":27161,"size_tokens":null},"server/modules/contactAnalytics/contactAnalytics.controller.ts":{"content":"import { Router, Request, Response } from 'express';\nimport { contactAnalyticsService } from './contactAnalytics.service';\nimport * as mongodb from '../storage/mongodb.adapter';\nimport { storage } from '../../storage';\n\nconst router = Router();\n\nrouter.get('/reports', async (req: Request, res: Response) => {\n  try {\n    const { interestLevel, limit, offset } = req.query;\n    \n    const result = await contactAnalyticsService.getAllContactReports({\n      interestLevel: interestLevel as string,\n      limit: limit ? parseInt(limit as string) : 50,\n      offset: offset ? parseInt(offset as string) : 0,\n    });\n    \n    res.json(result);\n  } catch (error) {\n    console.error('[ContactAnalytics] Error fetching reports:', error);\n    res.status(500).json({ error: 'Failed to fetch contact reports' });\n  }\n});\n\nrouter.get('/reports/:phone', async (req: Request, res: Response) => {\n  try {\n    const { phone } = req.params;\n    const report = await contactAnalyticsService.getContactReport(phone);\n    \n    if (!report) {\n      return res.status(404).json({ error: 'Contact report not found' });\n    }\n    \n    res.json(report);\n  } catch (error) {\n    console.error('[ContactAnalytics] Error fetching report:', error);\n    res.status(500).json({ error: 'Failed to fetch contact report' });\n  }\n});\n\nrouter.post('/analyze/:phone', async (req: Request, res: Response) => {\n  try {\n    const { phone } = req.params;\n    const { contactId, contactName } = req.body;\n    const userId = (req as any).userId;\n    \n    const normalizedPhone = phone.replace(/\\D/g, '');\n    const phoneLast10 = normalizedPhone.slice(-10);\n    \n    const messages = await mongodb.readCollection<any>('messages');\n    const contactMessages = messages.filter((m: any) => {\n      const msgContactId = (m.contactId || '').replace(/\\D/g, '');\n      const msgPhone = (m.phone || '').replace(/\\D/g, '');\n      const msgIdLast10 = msgContactId.slice(-10);\n      const msgPhoneLast10 = msgPhone.slice(-10);\n      return msgIdLast10 === phoneLast10 || msgPhoneLast10 === phoneLast10 ||\n             msgContactId === normalizedPhone || msgPhone === normalizedPhone;\n    });\n    \n    contactMessages.sort((a: any, b: any) => \n      new Date(a.timestamp || a.createdAt).getTime() - new Date(b.timestamp || b.createdAt).getTime()\n    );\n    \n    const report = await contactAnalyticsService.analyzeAndUpdateContact(\n      contactId || `contact-${normalizedPhone}`,\n      normalizedPhone,\n      contactName || 'Unknown',\n      contactMessages,\n      userId\n    );\n    \n    res.json(report);\n  } catch (error) {\n    console.error('[ContactAnalytics] Error analyzing contact:', error);\n    res.status(500).json({ error: 'Failed to analyze contact' });\n  }\n});\n\nrouter.post('/analyze-all', async (req: Request, res: Response) => {\n  try {\n    const userId = (req as any).userId;\n    \n    const chats = await storage.getChats();\n    const contactAgents = await mongodb.readCollection<any>('contact_agents');\n    \n    console.log(`[ContactAnalytics] Analyzing ${chats.length} chats, ${contactAgents.length} agent assignments`);\n    \n    const results = [];\n    let processed = 0;\n    let errors = 0;\n    \n    for (const chat of chats) {\n      try {\n        if (!chat.contact) {\n          console.log(`[ContactAnalytics] Chat ${chat.id} has no contact, skipping`);\n          continue;\n        }\n        \n        const contactPhone = (chat.contact.phone || '').replace(/\\D/g, '') || '';\n        if (!contactPhone) {\n          console.log(`[ContactAnalytics] Chat ${chat.id} has no phone, skipping`);\n          continue;\n        }\n        \n        const phoneLast10 = contactPhone.slice(-10);\n        const assignment = contactAgents.find((a: any) => {\n          const assignPhone = (a.phone || '').replace(/\\D/g, '');\n          return assignPhone.includes(phoneLast10) || phoneLast10.includes(assignPhone.slice(-10));\n        });\n        \n        let conversationMessages: any[] = [];\n        \n        if (assignment && assignment.conversationHistory && assignment.conversationHistory.length > 0) {\n          conversationMessages = assignment.conversationHistory.map((h: any) => ({\n            direction: h.role === 'user' ? 'inbound' : 'outbound',\n            content: h.content,\n            timestamp: h.timestamp || new Date().toISOString()\n          }));\n        } else if (chat.lastInboundMessage || chat.lastMessage) {\n          if (chat.lastInboundMessage) {\n            conversationMessages.push({\n              direction: 'inbound',\n              content: chat.lastInboundMessage,\n              timestamp: chat.lastInboundMessageTime || new Date().toISOString()\n            });\n          }\n          if (chat.lastMessage && chat.lastMessage !== chat.lastInboundMessage) {\n            conversationMessages.push({\n              direction: 'outbound',\n              content: chat.lastMessage,\n              timestamp: chat.lastMessageTime || new Date().toISOString()\n            });\n          }\n        }\n        \n        if (conversationMessages.length > 0) {\n          conversationMessages.sort((a: any, b: any) => \n            new Date(a.timestamp || 0).getTime() - new Date(b.timestamp || 0).getTime()\n          );\n          \n          processed++;\n          console.log(`[ContactAnalytics] Processing ${contactPhone} with ${conversationMessages.length} messages`);\n          \n          const report = await contactAnalyticsService.analyzeAndUpdateContact(\n            chat.contact.id || chat.contactId,\n            contactPhone,\n            chat.contact.name || 'Unknown',\n            conversationMessages,\n            userId\n          );\n          \n          results.push({\n            phone: contactPhone,\n            name: chat.contact.name,\n            interestLevel: report.interestLevel,\n            interestScore: report.interestScore,\n          });\n        } else {\n          console.log(`[ContactAnalytics] Chat ${chat.id} has no messages, skipping`);\n        }\n      } catch (err) {\n        errors++;\n        console.error(`[ContactAnalytics] Error analyzing chat ${chat.id}:`, err);\n      }\n    }\n    \n    console.log(`[ContactAnalytics] Completed: processed=${processed}, results=${results.length}, errors=${errors}`);\n    \n    res.json({\n      analyzed: results.length,\n      results,\n    });\n  } catch (error) {\n    console.error('[ContactAnalytics] Error analyzing all contacts:', error);\n    res.status(500).json({ error: 'Failed to analyze contacts' });\n  }\n});\n\nrouter.get('/summary', async (req: Request, res: Response) => {\n  try {\n    const summary = await contactAnalyticsService.getContactAnalyticsSummary();\n    res.json(summary);\n  } catch (error) {\n    console.error('[ContactAnalytics] Error fetching summary:', error);\n    res.status(500).json({ error: 'Failed to fetch analytics summary' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":6818,"size_tokens":null},"server/modules/contactAnalytics/contactAnalytics.service.ts":{"content":"import * as mongodb from '../storage/mongodb.adapter';\nimport { generateAIResponse } from '../ai/ai.service';\n\ninterface ContactAnalytics {\n  id: string;\n  contactId: string;\n  phone: string;\n  contactName: string;\n  interestLevel: 'interested' | 'not_interested' | 'neutral' | 'highly_interested' | 'pending';\n  interestScore: number;\n  interestReason: string;\n  totalMessages: number;\n  inboundMessages: number;\n  outboundMessages: number;\n  aiAgentInteractions: AgentInteraction[];\n  firstContactTime: string;\n  lastContactTime: string;\n  conversationDuration: number;\n  keyTopics: string[];\n  objections: string[];\n  positiveSignals: string[];\n  negativeSignals: string[];\n  lastAnalyzedAt: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface AgentInteraction {\n  agentId: string;\n  agentName: string;\n  messagesCount: number;\n  firstInteraction: string;\n  lastInteraction: string;\n  durationMinutes: number;\n}\n\ninterface ConversationMessage {\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: string;\n}\n\nconst INTEREST_ANALYSIS_PROMPT = `You are an expert sales analyst. Analyze the WhatsApp conversation below and determine the customer's interest level.\n\nIMPORTANT: You MUST respond with ONLY a valid JSON object. No explanations, no markdown, no text before or after. Just pure JSON.\n\nRequired JSON format:\n{\"interestLevel\":\"interested\",\"interestScore\":75,\"interestReason\":\"Customer asked about pricing\",\"keyTopics\":[\"award\",\"pricing\"],\"objections\":[],\"positiveSignals\":[\"asked questions\"],\"negativeSignals\":[]}\n\nField rules:\n- interestLevel: MUST be exactly one of: \"highly_interested\", \"interested\", \"neutral\", \"not_interested\"\n- interestScore: number from 1-100\n- interestReason: short string explaining your assessment\n- keyTopics, objections, positiveSignals, negativeSignals: arrays of strings (can be empty [])\n\nInterest Level Guidelines:\n- highly_interested (score 75-100): Customer wants to proceed, asks about payment, provides details eagerly\n- interested (score 50-74): Customer shows positive engagement, asks questions, considers the offer\n- neutral (score 25-49): Customer is non-committal, short responses, neither positive nor negative\n- not_interested (score 1-24): Customer declines, shows disinterest, stops responding, or says no\n\nConversation to analyze:\n`;\n\nexport async function analyzeContactConversation(\n  phone: string,\n  messages: ConversationMessage[],\n  userId?: string\n): Promise<{\n  interestLevel: string;\n  interestScore: number;\n  interestReason: string;\n  keyTopics: string[];\n  objections: string[];\n  positiveSignals: string[];\n  negativeSignals: string[];\n}> {\n  if (messages.length === 0) {\n    return {\n      interestLevel: 'pending',\n      interestScore: 0,\n      interestReason: 'No conversation history available',\n      keyTopics: [],\n      objections: [],\n      positiveSignals: [],\n      negativeSignals: [],\n    };\n  }\n\n  const conversationText = messages\n    .map(m => `${m.role === 'user' ? 'Customer' : 'Agent'}: ${m.content}`)\n    .join('\\n');\n\n  try {\n    const response = await generateAIResponse(\n      [\n        { role: 'system', content: INTEREST_ANALYSIS_PROMPT },\n        { role: 'user', content: conversationText }\n      ],\n      { id: 'analysis', name: 'Conversation Analyzer', model: 'gemini-2.5-flash', temperature: 0.1 },\n      userId\n    );\n\n    let cleanedResponse = response\n      .replace(/```json\\n?/g, '')\n      .replace(/```\\n?/g, '')\n      .trim();\n    \n    const jsonMatch = cleanedResponse.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      cleanedResponse = jsonMatch[0];\n    }\n    \n    const analysis = JSON.parse(cleanedResponse);\n\n    return {\n      interestLevel: analysis.interestLevel || 'neutral',\n      interestScore: analysis.interestScore || 50,\n      interestReason: analysis.interestReason || 'Unable to determine',\n      keyTopics: analysis.keyTopics || [],\n      objections: analysis.objections || [],\n      positiveSignals: analysis.positiveSignals || [],\n      negativeSignals: analysis.negativeSignals || [],\n    };\n  } catch (error) {\n    console.error('[ContactAnalytics] Error analyzing conversation:', error);\n    \n    const userMessages = messages.filter(m => m.role === 'user');\n    const hasPositive = userMessages.some(m => \n      /interested|yes|sure|okay|want|need|details|price|payment/i.test(m.content)\n    );\n    const hasNegative = userMessages.some(m => \n      /no|not interested|later|busy|expensive|can't|don't/i.test(m.content)\n    );\n\n    return {\n      interestLevel: hasPositive && !hasNegative ? 'interested' : hasNegative ? 'not_interested' : 'neutral',\n      interestScore: hasPositive ? 60 : hasNegative ? 30 : 50,\n      interestReason: 'Keyword-based analysis (AI analysis failed)',\n      keyTopics: [],\n      objections: [],\n      positiveSignals: hasPositive ? ['Shows interest in keywords'] : [],\n      negativeSignals: hasNegative ? ['Shows disinterest in keywords'] : [],\n    };\n  }\n}\n\nexport async function getOrCreateContactAnalytics(\n  contactId: string,\n  phone: string,\n  contactName: string\n): Promise<ContactAnalytics> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  \n  let analytics = await mongodb.findOne<ContactAnalytics>('contact_analytics', {\n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n\n  if (!analytics) {\n    const now = new Date().toISOString();\n    analytics = {\n      id: `ca-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      contactId,\n      phone: normalizedPhone,\n      contactName,\n      interestLevel: 'pending',\n      interestScore: 0,\n      interestReason: 'Not yet analyzed',\n      totalMessages: 0,\n      inboundMessages: 0,\n      outboundMessages: 0,\n      aiAgentInteractions: [],\n      firstContactTime: now,\n      lastContactTime: now,\n      conversationDuration: 0,\n      keyTopics: [],\n      objections: [],\n      positiveSignals: [],\n      negativeSignals: [],\n      lastAnalyzedAt: '',\n      createdAt: now,\n      updatedAt: now,\n    };\n    await mongodb.insertOne('contact_analytics', analytics);\n  }\n\n  return analytics;\n}\n\nexport async function updateContactAnalytics(\n  phone: string,\n  updates: Partial<ContactAnalytics>\n): Promise<ContactAnalytics | null> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  \n  return mongodb.updateOne<ContactAnalytics>(\n    'contact_analytics',\n    { $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]},\n    { ...updates, updatedAt: new Date().toISOString() }\n  );\n}\n\nexport async function trackAgentInteraction(\n  phone: string,\n  agentId: string,\n  agentName: string\n): Promise<void> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  const now = new Date().toISOString();\n  \n  const analytics = await mongodb.findOne<ContactAnalytics>('contact_analytics', {\n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n\n  if (!analytics) return;\n\n  const existingInteraction = analytics.aiAgentInteractions.find(i => i.agentId === agentId);\n  \n  if (existingInteraction) {\n    existingInteraction.messagesCount++;\n    existingInteraction.lastInteraction = now;\n    const firstTime = new Date(existingInteraction.firstInteraction).getTime();\n    const lastTime = new Date(now).getTime();\n    existingInteraction.durationMinutes = Math.round((lastTime - firstTime) / 60000);\n  } else {\n    analytics.aiAgentInteractions.push({\n      agentId,\n      agentName,\n      messagesCount: 1,\n      firstInteraction: now,\n      lastInteraction: now,\n      durationMinutes: 0,\n    });\n  }\n\n  await mongodb.updateOne<ContactAnalytics>(\n    'contact_analytics',\n    { id: analytics.id },\n    { \n      aiAgentInteractions: analytics.aiAgentInteractions,\n      lastContactTime: now,\n      updatedAt: now,\n    }\n  );\n}\n\nexport async function getContactReport(phone: string, userId?: string): Promise<ContactAnalytics | null> {\n  const normalizedPhone = phone.replace(/\\D/g, '');\n  \n  const analytics = await mongodb.findOne<ContactAnalytics>('contact_analytics', {\n    $or: [\n      { phone: normalizedPhone },\n      { phone: { $regex: normalizedPhone.slice(-10) + '$' } }\n    ]\n  });\n\n  return analytics;\n}\n\nexport async function getAllContactReports(\n  filter?: { interestLevel?: string; limit?: number; offset?: number }\n): Promise<{ reports: ContactAnalytics[]; total: number }> {\n  const allAnalytics = await mongodb.readCollection<ContactAnalytics>('contact_analytics');\n  \n  let filtered = allAnalytics;\n  if (filter?.interestLevel && filter.interestLevel !== 'all') {\n    filtered = allAnalytics.filter(a => a.interestLevel === filter.interestLevel);\n  }\n\n  filtered.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n\n  const offset = filter?.offset || 0;\n  const limit = filter?.limit || 50;\n  const paginated = filtered.slice(offset, offset + limit);\n\n  return {\n    reports: paginated,\n    total: filtered.length,\n  };\n}\n\nexport async function analyzeAndUpdateContact(\n  contactId: string,\n  phone: string,\n  contactName: string,\n  messages: any[],\n  userId?: string\n): Promise<ContactAnalytics> {\n  const analytics = await getOrCreateContactAnalytics(contactId, phone, contactName);\n  \n  const conversationMessages: ConversationMessage[] = messages.map(m => ({\n    role: m.direction === 'inbound' ? 'user' : 'assistant',\n    content: m.content,\n    timestamp: m.timestamp || m.createdAt,\n  }));\n\n  const analysis = await analyzeContactConversation(phone, conversationMessages, userId);\n  \n  const inbound = messages.filter(m => m.direction === 'inbound').length;\n  const outbound = messages.filter(m => m.direction === 'outbound').length;\n  \n  let firstTime = analytics.firstContactTime;\n  let lastTime = analytics.lastContactTime;\n  \n  if (messages.length > 0) {\n    const sortedMessages = [...messages].sort((a, b) => \n      new Date(a.timestamp || a.createdAt).getTime() - new Date(b.timestamp || b.createdAt).getTime()\n    );\n    firstTime = sortedMessages[0].timestamp || sortedMessages[0].createdAt;\n    lastTime = sortedMessages[sortedMessages.length - 1].timestamp || sortedMessages[sortedMessages.length - 1].createdAt;\n  }\n  \n  const durationMinutes = Math.round(\n    (new Date(lastTime).getTime() - new Date(firstTime).getTime()) / 60000\n  );\n\n  const updated = await updateContactAnalytics(phone, {\n    contactName,\n    interestLevel: analysis.interestLevel as ContactAnalytics['interestLevel'],\n    interestScore: analysis.interestScore,\n    interestReason: analysis.interestReason,\n    totalMessages: messages.length,\n    inboundMessages: inbound,\n    outboundMessages: outbound,\n    keyTopics: analysis.keyTopics,\n    objections: analysis.objections,\n    positiveSignals: analysis.positiveSignals,\n    negativeSignals: analysis.negativeSignals,\n    firstContactTime: firstTime,\n    lastContactTime: lastTime,\n    conversationDuration: durationMinutes,\n    lastAnalyzedAt: new Date().toISOString(),\n  });\n\n  return updated || analytics;\n}\n\nexport async function getContactAnalyticsSummary(): Promise<{\n  total: number;\n  byInterestLevel: { level: string; count: number; percentage: number }[];\n  averageScore: number;\n  topAgents: { agentName: string; contactsHandled: number }[];\n}> {\n  const allAnalytics = await mongodb.readCollection<ContactAnalytics>('contact_analytics');\n  \n  const total = allAnalytics.length;\n  \n  const interestCounts: Record<string, number> = {\n    highly_interested: 0,\n    interested: 0,\n    neutral: 0,\n    not_interested: 0,\n    pending: 0,\n  };\n  \n  let totalScore = 0;\n  const agentContactsMap: Record<string, number> = {};\n  \n  for (const analytics of allAnalytics) {\n    interestCounts[analytics.interestLevel] = (interestCounts[analytics.interestLevel] || 0) + 1;\n    totalScore += analytics.interestScore;\n    \n    for (const interaction of analytics.aiAgentInteractions) {\n      agentContactsMap[interaction.agentName] = (agentContactsMap[interaction.agentName] || 0) + 1;\n    }\n  }\n  \n  const byInterestLevel = Object.entries(interestCounts).map(([level, count]) => ({\n    level,\n    count,\n    percentage: total > 0 ? Math.round((count / total) * 100) : 0,\n  }));\n  \n  const topAgents = Object.entries(agentContactsMap)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5)\n    .map(([agentName, contactsHandled]) => ({ agentName, contactsHandled }));\n  \n  return {\n    total,\n    byInterestLevel,\n    averageScore: total > 0 ? Math.round(totalScore / total) : 0,\n    topAgents,\n  };\n}\n\nexport const contactAnalyticsService = {\n  analyzeContactConversation,\n  getOrCreateContactAnalytics,\n  updateContactAnalytics,\n  trackAgentInteraction,\n  getContactReport,\n  getAllContactReports,\n  analyzeAndUpdateContact,\n  getContactAnalyticsSummary,\n};\n","path":null,"size_bytes":12775,"size_tokens":null},"server/modules/leadManagement/leadManagement.service.ts":{"content":"import { \n  LeadAssignment, \n  TeamHierarchy, \n  ActivityLog, \n  UserActivityStats,\n  Contact,\n  Chat,\n  Message\n} from '../storage/mongodb.adapter';\nimport { SystemUser } from '../users/user.model';\n\nfunction generateId(prefix: string): string {\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n}\n\nfunction normalizePhone(phone: string): string {\n  if (!phone) return '';\n  return phone.replace(/\\D/g, '');\n}\n\nexport interface LeadAssignmentData {\n  contactId: string;\n  chatId?: string;\n  phone: string;\n  contactName?: string;\n  assignedToUserId: string;\n  assignedToUserName?: string;\n  assignedByUserId: string;\n  assignedByUserName?: string;\n  priority?: 'low' | 'medium' | 'high' | 'urgent';\n  notes?: string;\n  slaDeadline?: string;\n}\n\nexport interface BulkAssignmentData {\n  contactIds: string[];\n  assignedToUserId: string;\n  assignedByUserId: string;\n  priority?: 'low' | 'medium' | 'high' | 'urgent';\n  notes?: string;\n}\n\nexport interface UserRoleContext {\n  userId: string;\n  role: 'super_admin' | 'sub_admin' | 'manager' | 'user';\n  name?: string;\n}\n\nexport async function assignLead(data: LeadAssignmentData): Promise<any> {\n  const now = new Date().toISOString();\n  \n  const existingAssignment = await LeadAssignment.findOne({ \n    contactId: data.contactId,\n    status: { $in: ['assigned', 'in_progress'] }\n  });\n\n  if (existingAssignment) {\n    const previousAssignment = {\n      userId: existingAssignment.assignedToUserId,\n      userName: existingAssignment.assignedToUserName,\n      assignedAt: existingAssignment.createdAt,\n      unassignedAt: now,\n      reason: 'reassigned'\n    };\n\n    existingAssignment.previousAssignments = existingAssignment.previousAssignments || [];\n    existingAssignment.previousAssignments.push(previousAssignment);\n    existingAssignment.assignedToUserId = data.assignedToUserId;\n    existingAssignment.assignedToUserName = data.assignedToUserName || '';\n    existingAssignment.assignedByUserId = data.assignedByUserId;\n    existingAssignment.assignedByUserName = data.assignedByUserName || '';\n    existingAssignment.status = 'reassigned';\n    existingAssignment.updatedAt = now;\n    \n    if (data.priority) existingAssignment.priority = data.priority;\n    if (data.notes) existingAssignment.notes = data.notes;\n    \n    await existingAssignment.save();\n\n    await logActivity({\n      userId: data.assignedByUserId,\n      userName: data.assignedByUserName || '',\n      actionType: 'lead_reassigned',\n      contactId: data.contactId,\n      contactPhone: data.phone,\n      contactName: data.contactName,\n      leadAssignmentId: existingAssignment.id,\n      metadata: { \n        previousUserId: previousAssignment.userId,\n        newUserId: data.assignedToUserId\n      }\n    });\n\n    const updatedAssignment = await LeadAssignment.findOneAndUpdate(\n      { id: existingAssignment.id },\n      { $set: { status: 'assigned' } },\n      { new: true }\n    );\n\n    return updatedAssignment;\n  }\n\n  const assignment = new LeadAssignment({\n    id: generateId('la'),\n    contactId: data.contactId,\n    chatId: data.chatId,\n    phone: normalizePhone(data.phone),\n    contactName: data.contactName || '',\n    assignedToUserId: data.assignedToUserId,\n    assignedToUserName: data.assignedToUserName || '',\n    assignedByUserId: data.assignedByUserId,\n    assignedByUserName: data.assignedByUserName || '',\n    status: 'assigned',\n    priority: data.priority || 'medium',\n    notes: data.notes || '',\n    slaDeadline: data.slaDeadline,\n    previousAssignments: [],\n    createdAt: now,\n    updatedAt: now,\n  });\n\n  await assignment.save();\n\n  await logActivity({\n    userId: data.assignedByUserId,\n    userName: data.assignedByUserName || '',\n    actionType: 'lead_assigned',\n    contactId: data.contactId,\n    contactPhone: data.phone,\n    contactName: data.contactName,\n    leadAssignmentId: assignment.id,\n    metadata: { assignedToUserId: data.assignedToUserId }\n  });\n\n  await updateUserActivityStats(data.assignedToUserId, 'leadsAssigned');\n\n  return assignment;\n}\n\nexport async function bulkAssignLeads(data: BulkAssignmentData): Promise<any[]> {\n  const results: any[] = [];\n  \n  const assignedByUser = await SystemUser.findOne({ id: data.assignedByUserId });\n  const assignedToUser = await SystemUser.findOne({ id: data.assignedToUserId });\n\n  for (const contactId of data.contactIds) {\n    const contact = await Contact.findOne({ id: contactId });\n    if (!contact) continue;\n\n    const chat = await Chat.findOne({ contactId });\n\n    const assignment = await assignLead({\n      contactId,\n      chatId: chat?.id,\n      phone: contact.phone,\n      contactName: contact.name,\n      assignedToUserId: data.assignedToUserId,\n      assignedToUserName: assignedToUser?.name,\n      assignedByUserId: data.assignedByUserId,\n      assignedByUserName: assignedByUser?.name,\n      priority: data.priority,\n      notes: data.notes,\n    });\n\n    results.push(assignment);\n  }\n\n  return results;\n}\n\nexport async function unassignLead(assignmentId: string, userId: string, reason?: string): Promise<any> {\n  const assignment = await LeadAssignment.findOne({ id: assignmentId });\n  if (!assignment) return null;\n\n  const now = new Date().toISOString();\n\n  assignment.previousAssignments = assignment.previousAssignments || [];\n  assignment.previousAssignments.push({\n    userId: assignment.assignedToUserId,\n    userName: assignment.assignedToUserName,\n    assignedAt: assignment.createdAt,\n    unassignedAt: now,\n    reason: reason || 'unassigned'\n  });\n\n  assignment.status = 'unassigned';\n  assignment.updatedAt = now;\n  await assignment.save();\n\n  await logActivity({\n    userId,\n    actionType: 'lead_reassigned',\n    contactId: assignment.contactId,\n    leadAssignmentId: assignmentId,\n    metadata: { action: 'unassigned', reason }\n  });\n\n  return assignment;\n}\n\nexport async function updateLeadStatus(\n  assignmentId: string, \n  status: 'assigned' | 'in_progress' | 'completed' | 'reassigned' | 'unassigned',\n  userId: string\n): Promise<any> {\n  const now = new Date().toISOString();\n  \n  const updateData: any = { status, updatedAt: now };\n  \n  if (status === 'in_progress' && !await LeadAssignment.findOne({ id: assignmentId, firstResponseAt: { $exists: true } })) {\n    updateData.firstResponseAt = now;\n  }\n  \n  if (status === 'completed') {\n    updateData.resolvedAt = now;\n    await updateUserActivityStats(userId, 'leadsCompleted');\n  }\n\n  const assignment = await LeadAssignment.findOneAndUpdate(\n    { id: assignmentId },\n    { $set: updateData },\n    { new: true }\n  );\n\n  if (assignment && status === 'completed') {\n    await logActivity({\n      userId,\n      actionType: 'lead_completed',\n      contactId: assignment.contactId,\n      leadAssignmentId: assignmentId,\n    });\n  }\n\n  return assignment;\n}\n\nexport async function getLeadAssignment(contactId: string): Promise<any> {\n  return LeadAssignment.findOne({ \n    contactId,\n    status: { $in: ['assigned', 'in_progress'] }\n  }).lean();\n}\n\nexport async function getLeadAssignmentsByUser(userId: string, status?: string): Promise<any[]> {\n  const query: any = { assignedToUserId: userId };\n  if (status) query.status = status;\n  \n  return LeadAssignment.find(query).sort({ createdAt: -1 }).lean();\n}\n\nexport async function getAllLeadAssignments(filters?: { \n  status?: string | string[]; \n  userId?: string;\n  fromDate?: string;\n  toDate?: string;\n}): Promise<any[]> {\n  const query: any = {};\n  \n  if (filters?.status) {\n    if (Array.isArray(filters.status)) {\n      query.status = { $in: filters.status };\n    } else {\n      query.status = filters.status;\n    }\n  }\n  if (filters?.userId) query.assignedToUserId = filters.userId;\n  if (filters?.fromDate || filters?.toDate) {\n    query.createdAt = {};\n    if (filters.fromDate) query.createdAt.$gte = filters.fromDate;\n    if (filters.toDate) query.createdAt.$lte = filters.toDate;\n  }\n  \n  return LeadAssignment.find(query).sort({ createdAt: -1 }).lean();\n}\n\nexport async function getAssignableUsers(): Promise<any[]> {\n  const users = await SystemUser.find({ \n    isActive: true,\n    role: { $in: ['sub_admin', 'manager', 'user'] }\n  }).select('-password').lean();\n  \n  return users;\n}\n\nexport async function getPermittedUserIds(context: UserRoleContext): Promise<string[] | null> {\n  if (context.role === 'super_admin' || context.role === 'sub_admin') {\n    return null;\n  }\n  \n  if (context.role === 'manager') {\n    const teamHierarchy = await TeamHierarchy.findOne({ managerId: context.userId });\n    const teamMemberIds = teamHierarchy?.teamMembers?.map((m: any) => m.userId) || [];\n    return [context.userId, ...teamMemberIds];\n  }\n  \n  return [context.userId];\n}\n\nexport async function getFilteredChatsForUser(context: UserRoleContext): Promise<string[]> {\n  const permittedUserIds = await getPermittedUserIds(context);\n  \n  if (permittedUserIds === null) {\n    return [];\n  }\n  \n  const assignments = await LeadAssignment.find({\n    assignedToUserId: { $in: permittedUserIds },\n    status: { $in: ['assigned', 'in_progress'] }\n  }).select('contactId').lean();\n  \n  return assignments.map((a: any) => a.contactId);\n}\n\nexport async function setTeamHierarchy(managerId: string, managerName: string, teamMemberIds: string[]): Promise<any> {\n  const now = new Date().toISOString();\n  \n  const teamMembers = await Promise.all(\n    teamMemberIds.map(async (userId) => {\n      const user = await SystemUser.findOne({ id: userId });\n      return {\n        userId,\n        userName: user?.name || '',\n        addedAt: now\n      };\n    })\n  );\n\n  const existing = await TeamHierarchy.findOne({ managerId });\n  \n  if (existing) {\n    existing.teamMembers = teamMembers;\n    existing.managerName = managerName;\n    existing.updatedAt = now;\n    await existing.save();\n    return existing;\n  }\n\n  const hierarchy = new TeamHierarchy({\n    id: generateId('th'),\n    managerId,\n    managerName,\n    teamMembers,\n    createdAt: now,\n    updatedAt: now,\n  });\n\n  await hierarchy.save();\n  return hierarchy;\n}\n\nexport async function getTeamHierarchy(managerId: string): Promise<any> {\n  return TeamHierarchy.findOne({ managerId }).lean();\n}\n\nexport async function getAllTeamHierarchies(): Promise<any[]> {\n  return TeamHierarchy.find({}).lean();\n}\n\nasync function logActivity(data: {\n  userId: string;\n  userName?: string;\n  userRole?: string;\n  actionType: string;\n  contactId?: string;\n  contactPhone?: string;\n  contactName?: string;\n  leadAssignmentId?: string;\n  metadata?: any;\n}): Promise<void> {\n  try {\n    const log = new ActivityLog({\n      id: generateId('al'),\n      userId: data.userId,\n      userName: data.userName || '',\n      userRole: data.userRole || '',\n      actionType: data.actionType,\n      contactId: data.contactId,\n      contactPhone: data.contactPhone,\n      contactName: data.contactName,\n      leadAssignmentId: data.leadAssignmentId,\n      metadata: data.metadata || {},\n      timestamp: new Date().toISOString(),\n    });\n    await log.save();\n  } catch (error) {\n    console.error('[LeadManagement] Error logging activity:', error);\n  }\n}\n\nexport async function logUserActivity(data: {\n  userId: string;\n  userName?: string;\n  userRole?: string;\n  actionType: 'message_sent' | 'message_received' | 'lead_viewed' | 'login' | 'logout';\n  contactId?: string;\n  contactPhone?: string;\n  contactName?: string;\n  metadata?: any;\n}): Promise<void> {\n  await logActivity(data);\n  \n  if (data.actionType === 'message_sent') {\n    await updateUserActivityStats(data.userId, 'messagesSent');\n  } else if (data.actionType === 'message_received') {\n    await updateUserActivityStats(data.userId, 'messagesReceived');\n  }\n}\n\nasync function updateUserActivityStats(userId: string, field: string): Promise<void> {\n  try {\n    const today = new Date().toISOString().split('T')[0];\n    const user = await SystemUser.findOne({ id: userId });\n    \n    const existing = await UserActivityStats.findOne({ userId, date: today });\n    \n    if (existing) {\n      await UserActivityStats.updateOne(\n        { userId, date: today },\n        { \n          $inc: { [field]: 1 },\n          $set: { updatedAt: new Date().toISOString() }\n        }\n      );\n    } else {\n      const stats = new UserActivityStats({\n        id: generateId('uas'),\n        userId,\n        userName: user?.name || '',\n        date: today,\n        [field]: 1,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      });\n      await stats.save();\n    }\n  } catch (error) {\n    console.error('[LeadManagement] Error updating activity stats:', error);\n  }\n}\n\nexport async function getLeadAssignmentReport(filters?: {\n  userId?: string;\n  fromDate?: string;\n  toDate?: string;\n  groupBy?: 'user' | 'day' | 'status' | 'priority';\n}): Promise<any> {\n  const matchStage: any = {};\n  \n  if (filters?.userId) matchStage.assignedToUserId = filters.userId;\n  if (filters?.fromDate || filters?.toDate) {\n    matchStage.createdAt = {};\n    if (filters?.fromDate) matchStage.createdAt.$gte = filters.fromDate;\n    if (filters?.toDate) matchStage.createdAt.$lte = filters.toDate;\n  }\n\n  const groupBy = filters?.groupBy || 'user';\n  \n  let groupStage: any;\n  switch (groupBy) {\n    case 'user':\n      groupStage = {\n        $group: {\n          _id: '$assignedToUserId',\n          userName: { $first: '$assignedToUserName' },\n          totalAssigned: { $sum: 1 },\n          assigned: { $sum: { $cond: [{ $eq: ['$status', 'assigned'] }, 1, 0] } },\n          inProgress: { $sum: { $cond: [{ $eq: ['$status', 'in_progress'] }, 1, 0] } },\n          completed: { $sum: { $cond: [{ $eq: ['$status', 'completed'] }, 1, 0] } },\n          reassigned: { $sum: { $cond: [{ $eq: ['$status', 'reassigned'] }, 1, 0] } },\n        }\n      };\n      break;\n    case 'day':\n      groupStage = {\n        $group: {\n          _id: { $substr: ['$createdAt', 0, 10] },\n          totalAssigned: { $sum: 1 },\n          assigned: { $sum: { $cond: [{ $eq: ['$status', 'assigned'] }, 1, 0] } },\n          completed: { $sum: { $cond: [{ $eq: ['$status', 'completed'] }, 1, 0] } },\n        }\n      };\n      break;\n    case 'status':\n      groupStage = {\n        $group: {\n          _id: '$status',\n          count: { $sum: 1 },\n        }\n      };\n      break;\n    case 'priority':\n      groupStage = {\n        $group: {\n          _id: '$priority',\n          count: { $sum: 1 },\n        }\n      };\n      break;\n  }\n\n  const pipeline = [\n    { $match: matchStage },\n    groupStage,\n    { $sort: { totalAssigned: -1, count: -1, _id: 1 } }\n  ];\n\n  const results = await LeadAssignment.aggregate(pipeline);\n  \n  const summary = await LeadAssignment.aggregate([\n    { $match: matchStage },\n    {\n      $group: {\n        _id: null,\n        total: { $sum: 1 },\n        assigned: { $sum: { $cond: [{ $eq: ['$status', 'assigned'] }, 1, 0] } },\n        inProgress: { $sum: { $cond: [{ $eq: ['$status', 'in_progress'] }, 1, 0] } },\n        completed: { $sum: { $cond: [{ $eq: ['$status', 'completed'] }, 1, 0] } },\n        reassigned: { $sum: { $cond: [{ $eq: ['$status', 'reassigned'] }, 1, 0] } },\n        unassigned: { $sum: { $cond: [{ $eq: ['$status', 'unassigned'] }, 1, 0] } },\n      }\n    }\n  ]);\n\n  return {\n    data: results,\n    summary: summary[0] || { total: 0, assigned: 0, inProgress: 0, completed: 0, reassigned: 0, unassigned: 0 },\n  };\n}\n\nexport async function getUserActivityReport(filters?: {\n  userId?: string;\n  fromDate?: string;\n  toDate?: string;\n}): Promise<any> {\n  const matchStage: any = {};\n  \n  if (filters?.userId) matchStage.userId = filters.userId;\n  if (filters?.fromDate || filters?.toDate) {\n    matchStage.date = {};\n    if (filters?.fromDate) matchStage.date.$gte = filters.fromDate;\n    if (filters?.toDate) matchStage.date.$lte = filters.toDate;\n  }\n\n  const stats = await UserActivityStats.find(matchStage).sort({ date: -1 }).lean();\n\n  const userSummary = await UserActivityStats.aggregate([\n    { $match: matchStage },\n    {\n      $group: {\n        _id: '$userId',\n        userName: { $first: '$userName' },\n        totalMessagesSent: { $sum: '$messagesSent' },\n        totalMessagesReceived: { $sum: '$messagesReceived' },\n        totalLeadsAssigned: { $sum: '$leadsAssigned' },\n        totalLeadsCompleted: { $sum: '$leadsCompleted' },\n        avgResponseTime: { $avg: '$avgResponseTimeMinutes' },\n        daysActive: { $sum: 1 },\n      }\n    },\n    { $sort: { totalLeadsCompleted: -1 } }\n  ]);\n\n  const activityLogs = await ActivityLog.find(matchStage.userId ? { userId: matchStage.userId } : {})\n    .sort({ timestamp: -1 })\n    .limit(100)\n    .lean();\n\n  return {\n    dailyStats: stats,\n    userSummary,\n    recentActivity: activityLogs,\n  };\n}\n\nexport async function getWorkloadDistribution(): Promise<any> {\n  const activeAssignments = await LeadAssignment.aggregate([\n    { $match: { status: { $in: ['assigned', 'in_progress'] } } },\n    {\n      $group: {\n        _id: '$assignedToUserId',\n        userName: { $first: '$assignedToUserName' },\n        activeLeads: { $sum: 1 },\n        highPriority: { $sum: { $cond: [{ $eq: ['$priority', 'high'] }, 1, 0] } },\n        urgentPriority: { $sum: { $cond: [{ $eq: ['$priority', 'urgent'] }, 1, 0] } },\n      }\n    },\n    { $sort: { activeLeads: -1 } }\n  ]);\n\n  return activeAssignments;\n}\n","path":null,"size_bytes":17225,"size_tokens":null},"client/src/pages/lead-assignment-reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Download, Users, UserCheck, Clock, TrendingUp, AlertTriangle, Loader2, RefreshCw, Calendar, Filter } from \"lucide-react\";\nimport { format, subDays, startOfDay, endOfDay } from \"date-fns\";\n\ninterface AssignmentSummary {\n  totalAssignments: number;\n  activeAssignments: number;\n  completedAssignments: number;\n  averageResponseTime: number;\n  byUser: UserAssignmentSummary[];\n  byPriority: { priority: string; count: number }[];\n  byStatus: { status: string; count: number }[];\n}\n\ninterface UserAssignmentSummary {\n  userId: string;\n  userName: string;\n  userRole: string;\n  totalAssigned: number;\n  active: number;\n  completed: number;\n  inProgress: number;\n  avgResponseTime: number;\n  lastActivityAt?: string;\n}\n\ninterface AssignmentDetail {\n  _id: string;\n  contactId: string;\n  phone: string;\n  contactName: string;\n  assignedToUserId: string;\n  assignedToUserName: string;\n  assignedByUserId: string;\n  assignedByUserName: string;\n  priority: string;\n  status: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function LeadAssignmentReportsPage() {\n  const [dateRange, setDateRange] = useState(\"7\");\n  const [filterUserId, setFilterUserId] = useState<string>(\"all\");\n  const [filterPriority, setFilterPriority] = useState<string>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<string>(\"all\");\n\n  const { data: summary, isLoading: summaryLoading, refetch: refetchSummary } = useQuery<AssignmentSummary>({\n    queryKey: [\"/api/lead-management/reports/summary\", dateRange],\n    queryFn: async () => {\n      const startDate = subDays(new Date(), parseInt(dateRange));\n      const res = await fetch(`/api/lead-management/reports/summary?startDate=${startDate.toISOString()}`, {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch summary\");\n      return res.json();\n    },\n  });\n\n  const { data: assignments, isLoading: assignmentsLoading, refetch: refetchAssignments } = useQuery<AssignmentDetail[]>({\n    queryKey: [\"/api/lead-management/reports/assignments\", dateRange, filterUserId, filterPriority, filterStatus],\n    queryFn: async () => {\n      const startDate = subDays(new Date(), parseInt(dateRange));\n      const params = new URLSearchParams({\n        startDate: startDate.toISOString(),\n      });\n      if (filterUserId !== \"all\") params.append(\"userId\", filterUserId);\n      if (filterPriority !== \"all\") params.append(\"priority\", filterPriority);\n      if (filterStatus !== \"all\") params.append(\"status\", filterStatus);\n      \n      const res = await fetch(`/api/lead-management/reports/assignments?${params}`, {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch assignments\");\n      return res.json();\n    },\n  });\n\n  const { data: users } = useQuery<{id: string; name: string; role: string}[]>({\n    queryKey: [\"/api/users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/users\", {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) return [];\n      return res.json();\n    },\n  });\n\n  const handleRefresh = () => {\n    refetchSummary();\n    refetchAssignments();\n  };\n\n  const handleExportCSV = () => {\n    if (!assignments) return;\n    \n    const headers = [\"Contact Name\", \"Phone\", \"Assigned To\", \"Assigned By\", \"Priority\", \"Status\", \"Created At\"];\n    const rows = assignments.map(a => [\n      a.contactName,\n      a.phone,\n      a.assignedToUserName,\n      a.assignedByUserName,\n      a.priority,\n      a.status,\n      format(new Date(a.createdAt), \"yyyy-MM-dd HH:mm\"),\n    ]);\n    \n    const csv = [headers.join(\",\"), ...rows.map(r => r.join(\",\"))].join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `lead-assignments-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n  };\n\n  const getPriorityBadge = (priority: string) => {\n    const colors: Record<string, string> = {\n      urgent: \"bg-red-100 text-red-700 border-red-200\",\n      high: \"bg-orange-100 text-orange-700 border-orange-200\",\n      medium: \"bg-yellow-100 text-yellow-700 border-yellow-200\",\n      low: \"bg-green-100 text-green-700 border-green-200\",\n    };\n    return <Badge variant=\"outline\" className={colors[priority] || \"\"}>{priority}</Badge>;\n  };\n\n  const getStatusBadge = (status: string) => {\n    const colors: Record<string, string> = {\n      assigned: \"bg-blue-100 text-blue-700 border-blue-200\",\n      in_progress: \"bg-yellow-100 text-yellow-700 border-yellow-200\",\n      completed: \"bg-green-100 text-green-700 border-green-200\",\n      transferred: \"bg-purple-100 text-purple-700 border-purple-200\",\n    };\n    const labels: Record<string, string> = {\n      assigned: \"Active\",\n      in_progress: \"In Progress\",\n      completed: \"Completed\",\n      transferred: \"Transferred\",\n    };\n    return <Badge variant=\"outline\" className={colors[status] || \"\"}>{labels[status] || status.replace(\"_\", \" \")}</Badge>;\n  };\n\n  const formatResponseTime = (minutes: number) => {\n    if (minutes < 60) return `${Math.round(minutes)} min`;\n    if (minutes < 1440) return `${Math.round(minutes / 60)} hrs`;\n    return `${Math.round(minutes / 1440)} days`;\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Lead Assignment Reports</h1>\n            <p className=\"text-muted-foreground\">Track lead distribution and team performance</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Select value={dateRange} onValueChange={setDateRange}>\n              <SelectTrigger className=\"w-40\">\n                <Calendar className=\"h-4 w-4 mr-2\" />\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"1\">Today</SelectItem>\n                <SelectItem value=\"7\">Last 7 days</SelectItem>\n                <SelectItem value=\"30\">Last 30 days</SelectItem>\n                <SelectItem value=\"90\">Last 90 days</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"icon\" onClick={handleRefresh}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportCSV}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export CSV\n            </Button>\n          </div>\n        </div>\n\n        {summaryLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : summary ? (\n          <>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Users className=\"h-4 w-4\" />\n                    Total Assignments\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">{summary.totalAssignments}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    In selected period\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    Active Assignments\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">{summary.activeAssignments}</div>\n                  <Progress \n                    value={(summary.activeAssignments / Math.max(summary.totalAssignments, 1)) * 100} \n                    className=\"mt-2 h-2\" \n                  />\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <TrendingUp className=\"h-4 w-4\" />\n                    Completed\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold text-green-600\">{summary.completedAssignments}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {summary.totalAssignments > 0 \n                      ? `${Math.round((summary.completedAssignments / summary.totalAssignments) * 100)}% completion rate`\n                      : \"No data\"}\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4\" />\n                    Avg Response Time\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">\n                    {formatResponseTime(summary.averageResponseTime || 0)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    First contact after assignment\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Tabs defaultValue=\"by-user\">\n              <TabsList>\n                <TabsTrigger value=\"by-user\">By Team Member</TabsTrigger>\n                <TabsTrigger value=\"by-priority\">By Priority</TabsTrigger>\n                <TabsTrigger value=\"all-assignments\">All Assignments</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"by-user\" className=\"mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Team Member Performance</CardTitle>\n                    <CardDescription>Lead distribution and response metrics per team member</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    {summary.byUser.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        No assignments found in selected period\n                      </div>\n                    ) : (\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Team Member</TableHead>\n                            <TableHead>Role</TableHead>\n                            <TableHead className=\"text-center\">Total</TableHead>\n                            <TableHead className=\"text-center\">Active</TableHead>\n                            <TableHead className=\"text-center\">In Progress</TableHead>\n                            <TableHead className=\"text-center\">Completed</TableHead>\n                            <TableHead className=\"text-center\">Avg Response</TableHead>\n                            <TableHead>Last Activity</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {summary.byUser.map((user) => (\n                            <TableRow key={user.userId}>\n                              <TableCell className=\"font-medium\">{user.userName}</TableCell>\n                              <TableCell>\n                                <Badge variant=\"secondary\">{user.userRole}</Badge>\n                              </TableCell>\n                              <TableCell className=\"text-center\">{user.totalAssigned}</TableCell>\n                              <TableCell className=\"text-center\">\n                                <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700\">{user.active}</Badge>\n                              </TableCell>\n                              <TableCell className=\"text-center\">\n                                <Badge variant=\"outline\" className=\"bg-yellow-50 text-yellow-700\">{user.inProgress}</Badge>\n                              </TableCell>\n                              <TableCell className=\"text-center\">\n                                <Badge variant=\"outline\" className=\"bg-green-50 text-green-700\">{user.completed}</Badge>\n                              </TableCell>\n                              <TableCell className=\"text-center\">\n                                {formatResponseTime(user.avgResponseTime || 0)}\n                              </TableCell>\n                              <TableCell className=\"text-muted-foreground text-sm\">\n                                {user.lastActivityAt \n                                  ? format(new Date(user.lastActivityAt), \"MMM d, HH:mm\")\n                                  : \"N/A\"}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"by-priority\" className=\"mt-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Priority Distribution</CardTitle>\n                      <CardDescription>Assignments by priority level</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-4\">\n                        {[\"urgent\", \"high\", \"medium\", \"low\"].map((priority) => {\n                          const item = summary.byPriority.find(p => p.priority === priority);\n                          const count = item?.count || 0;\n                          const percentage = summary.totalAssignments > 0 \n                            ? (count / summary.totalAssignments) * 100 \n                            : 0;\n                          return (\n                            <div key={priority} className=\"space-y-2\">\n                              <div className=\"flex items-center justify-between\">\n                                {getPriorityBadge(priority)}\n                                <span className=\"text-sm font-medium\">{count} ({Math.round(percentage)}%)</span>\n                              </div>\n                              <Progress value={percentage} className=\"h-2\" />\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Status Distribution</CardTitle>\n                      <CardDescription>Assignments by current status</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-4\">\n                        {[\"assigned\", \"in_progress\", \"completed\", \"transferred\"].map((status) => {\n                          const item = summary.byStatus.find(s => s.status === status);\n                          const count = item?.count || 0;\n                          const percentage = summary.totalAssignments > 0 \n                            ? (count / summary.totalAssignments) * 100 \n                            : 0;\n                          return (\n                            <div key={status} className=\"space-y-2\">\n                              <div className=\"flex items-center justify-between\">\n                                {getStatusBadge(status)}\n                                <span className=\"text-sm font-medium\">{count} ({Math.round(percentage)}%)</span>\n                              </div>\n                              <Progress value={percentage} className=\"h-2\" />\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"all-assignments\" className=\"mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>All Assignments</CardTitle>\n                    <CardDescription>Detailed list of all lead assignments</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex items-center gap-4 mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Filter className=\"h-4 w-4 text-muted-foreground\" />\n                        <Label className=\"text-sm\">Filters:</Label>\n                      </div>\n                      <Select value={filterUserId} onValueChange={setFilterUserId}>\n                        <SelectTrigger className=\"w-40\">\n                          <SelectValue placeholder=\"All Users\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">All Users</SelectItem>\n                          {users?.map(user => (\n                            <SelectItem key={user.id} value={user.id}>{user.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Select value={filterPriority} onValueChange={setFilterPriority}>\n                        <SelectTrigger className=\"w-32\">\n                          <SelectValue placeholder=\"Priority\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">All Priority</SelectItem>\n                          <SelectItem value=\"urgent\">Urgent</SelectItem>\n                          <SelectItem value=\"high\">High</SelectItem>\n                          <SelectItem value=\"medium\">Medium</SelectItem>\n                          <SelectItem value=\"low\">Low</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Select value={filterStatus} onValueChange={setFilterStatus}>\n                        <SelectTrigger className=\"w-32\">\n                          <SelectValue placeholder=\"Status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">All Status</SelectItem>\n                          <SelectItem value=\"assigned\">Active</SelectItem>\n                          <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                          <SelectItem value=\"completed\">Completed</SelectItem>\n                          <SelectItem value=\"transferred\">Transferred</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {assignmentsLoading ? (\n                      <div className=\"flex items-center justify-center py-8\">\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                      </div>\n                    ) : !assignments || assignments.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        No assignments found matching filters\n                      </div>\n                    ) : (\n                      <ScrollArea className=\"h-[400px]\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead>Contact</TableHead>\n                              <TableHead>Phone</TableHead>\n                              <TableHead>Assigned To</TableHead>\n                              <TableHead>Assigned By</TableHead>\n                              <TableHead>Priority</TableHead>\n                              <TableHead>Status</TableHead>\n                              <TableHead>Created</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {assignments.map((assignment) => (\n                              <TableRow key={assignment._id}>\n                                <TableCell className=\"font-medium\">{assignment.contactName}</TableCell>\n                                <TableCell className=\"text-muted-foreground\">{assignment.phone}</TableCell>\n                                <TableCell>{assignment.assignedToUserName}</TableCell>\n                                <TableCell className=\"text-muted-foreground\">{assignment.assignedByUserName}</TableCell>\n                                <TableCell>{getPriorityBadge(assignment.priority)}</TableCell>\n                                <TableCell>{getStatusBadge(assignment.status)}</TableCell>\n                                <TableCell className=\"text-muted-foreground text-sm\">\n                                  {format(new Date(assignment.createdAt), \"MMM d, HH:mm\")}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </ScrollArea>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </>\n        ) : (\n          <Card>\n            <CardContent className=\"py-8\">\n              <div className=\"text-center text-muted-foreground\">\n                <AlertTriangle className=\"h-8 w-8 mx-auto mb-2\" />\n                <p>Failed to load report data. Please try again.</p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":22912,"size_tokens":null},"server/modules/leadManagement/leadManagement.routes.ts":{"content":"import { Router, Request, Response } from 'express';\nimport * as leadManagementService from './leadManagement.service';\nimport { SystemUser } from '../users/user.model';\n\nconst router = Router();\n\nfunction getUser(req: Request): any {\n  const userId = req.headers['x-user-id'] as string;\n  const userRole = req.headers['x-user-role'] as string;\n  const userName = req.headers['x-user-name'] as string;\n  \n  return {\n    userId: userId || null,\n    role: userRole || 'super_admin',\n    name: userName || 'Admin',\n  };\n}\n\nfunction isAdmin(user: any): boolean {\n  return user.role === 'super_admin' || user.role === 'sub_admin' || !user.userId;\n}\n\nrouter.post('/assign', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to assign leads' });\n    }\n\n    const { contactId, chatId, phone, contactName, assignedToUserId, priority, notes, slaDeadline } = req.body;\n\n    if (!contactId || !phone || !assignedToUserId) {\n      return res.status(400).json({ error: 'contactId, phone, and assignedToUserId are required' });\n    }\n\n    const assignedToUser = await SystemUser.findOne({ id: assignedToUserId });\n    if (!assignedToUser) {\n      return res.status(404).json({ error: 'Assigned user not found' });\n    }\n\n    const assignment = await leadManagementService.assignLead({\n      contactId,\n      chatId,\n      phone,\n      contactName,\n      assignedToUserId,\n      assignedToUserName: assignedToUser.name,\n      assignedByUserId: user.userId || 'admin',\n      assignedByUserName: user.name,\n      priority,\n      notes,\n      slaDeadline,\n    });\n\n    res.json(assignment);\n  } catch (error) {\n    console.error('Error assigning lead:', error);\n    res.status(500).json({ error: 'Failed to assign lead' });\n  }\n});\n\nrouter.post('/bulk-assign', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to assign leads' });\n    }\n\n    const { contactIds, assignedToUserId, priority, notes } = req.body;\n\n    if (!contactIds?.length || !assignedToUserId) {\n      return res.status(400).json({ error: 'contactIds and assignedToUserId are required' });\n    }\n\n    const results = await leadManagementService.bulkAssignLeads({\n      contactIds,\n      assignedToUserId,\n      assignedByUserId: user.userId || 'admin',\n      priority,\n      notes,\n    });\n\n    res.json({ \n      success: true, \n      assigned: results.length,\n      assignments: results \n    });\n  } catch (error) {\n    console.error('Error bulk assigning leads:', error);\n    res.status(500).json({ error: 'Failed to bulk assign leads' });\n  }\n});\n\nrouter.patch('/:id/status', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    const { status } = req.body;\n    \n    if (!['assigned', 'in_progress', 'completed', 'unassigned'].includes(status)) {\n      return res.status(400).json({ error: 'Invalid status' });\n    }\n\n    const assignment = await leadManagementService.updateLeadStatus(\n      req.params.id,\n      status,\n      user.userId || 'admin'\n    );\n\n    if (!assignment) {\n      return res.status(404).json({ error: 'Assignment not found' });\n    }\n\n    res.json(assignment);\n  } catch (error) {\n    console.error('Error updating lead status:', error);\n    res.status(500).json({ error: 'Failed to update lead status' });\n  }\n});\n\nrouter.post('/:id/unassign', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to unassign leads' });\n    }\n\n    const { reason } = req.body;\n    const assignment = await leadManagementService.unassignLead(\n      req.params.id,\n      user.userId || 'admin',\n      reason\n    );\n\n    if (!assignment) {\n      return res.status(404).json({ error: 'Assignment not found' });\n    }\n\n    res.json(assignment);\n  } catch (error) {\n    console.error('Error unassigning lead:', error);\n    res.status(500).json({ error: 'Failed to unassign lead' });\n  }\n});\n\nrouter.get('/contact/:contactId', async (req: Request, res: Response) => {\n  try {\n    const assignment = await leadManagementService.getLeadAssignment(req.params.contactId);\n    res.json(assignment || null);\n  } catch (error) {\n    console.error('Error getting lead assignment:', error);\n    res.status(500).json({ error: 'Failed to get lead assignment' });\n  }\n});\n\nrouter.get('/my-leads', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    const { status } = req.query;\n\n    const assignments = await leadManagementService.getLeadAssignmentsByUser(\n      user.userId || 'admin',\n      status as string\n    );\n\n    res.json(assignments);\n  } catch (error) {\n    console.error('Error getting user leads:', error);\n    res.status(500).json({ error: 'Failed to get user leads' });\n  }\n});\n\nrouter.get('/all', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    \n    if (!isAdmin(user) && user.role !== 'manager') {\n      const assignments = await leadManagementService.getLeadAssignmentsByUser(user.userId);\n      return res.json(assignments);\n    }\n\n    const { status, userId, fromDate, toDate } = req.query;\n\n    const assignments = await leadManagementService.getAllLeadAssignments({\n      status: status as string,\n      userId: userId as string,\n      fromDate: fromDate as string,\n      toDate: toDate as string,\n    });\n\n    res.json(assignments);\n  } catch (error) {\n    console.error('Error getting all lead assignments:', error);\n    res.status(500).json({ error: 'Failed to get lead assignments' });\n  }\n});\n\nrouter.get('/assignable-users', async (req: Request, res: Response) => {\n  try {\n    const users = await leadManagementService.getAssignableUsers();\n    res.json(users);\n  } catch (error) {\n    console.error('Error getting assignable users:', error);\n    res.status(500).json({ error: 'Failed to get assignable users' });\n  }\n});\n\nrouter.get('/filtered-contacts', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    \n    const contactIds = await leadManagementService.getFilteredChatsForUser({\n      userId: user.userId,\n      role: user.role,\n      name: user.name,\n    });\n\n    res.json({ contactIds, isFiltered: contactIds.length > 0 || user.role === 'user' });\n  } catch (error) {\n    console.error('Error getting filtered contacts:', error);\n    res.status(500).json({ error: 'Failed to get filtered contacts' });\n  }\n});\n\nrouter.post('/team-hierarchy', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user)) {\n      return res.status(403).json({ error: 'Admin access required' });\n    }\n\n    const { managerId, managerName, teamMemberIds } = req.body;\n\n    if (!managerId || !teamMemberIds) {\n      return res.status(400).json({ error: 'managerId and teamMemberIds are required' });\n    }\n\n    const hierarchy = await leadManagementService.setTeamHierarchy(\n      managerId,\n      managerName || '',\n      teamMemberIds\n    );\n\n    res.json(hierarchy);\n  } catch (error) {\n    console.error('Error setting team hierarchy:', error);\n    res.status(500).json({ error: 'Failed to set team hierarchy' });\n  }\n});\n\nrouter.get('/team-hierarchy/:managerId', async (req: Request, res: Response) => {\n  try {\n    const hierarchy = await leadManagementService.getTeamHierarchy(req.params.managerId);\n    res.json(hierarchy || { teamMembers: [] });\n  } catch (error) {\n    console.error('Error getting team hierarchy:', error);\n    res.status(500).json({ error: 'Failed to get team hierarchy' });\n  }\n});\n\nrouter.get('/team-hierarchies', async (req: Request, res: Response) => {\n  try {\n    const hierarchies = await leadManagementService.getAllTeamHierarchies();\n    res.json(hierarchies);\n  } catch (error) {\n    console.error('Error getting team hierarchies:', error);\n    res.status(500).json({ error: 'Failed to get team hierarchies' });\n  }\n});\n\nrouter.get('/reports/summary', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const { startDate } = req.query;\n    \n    const report = await leadManagementService.getLeadAssignmentReport({\n      fromDate: startDate as string,\n    });\n\n    const byUserReport = await leadManagementService.getLeadAssignmentReport({\n      fromDate: startDate as string,\n      groupBy: 'user',\n    });\n\n    const byStatusReport = await leadManagementService.getLeadAssignmentReport({\n      fromDate: startDate as string,\n      groupBy: 'status',\n    });\n\n    const byPriorityReport = await leadManagementService.getLeadAssignmentReport({\n      fromDate: startDate as string,\n      groupBy: 'priority',\n    });\n\n    const summary = report.summary;\n    const byUser = byUserReport.data.map((u: any) => ({\n      userId: u._id,\n      userName: u.userName,\n      userRole: 'user',\n      totalAssigned: u.totalAssigned || 0,\n      active: u.assigned || 0,\n      completed: u.completed || 0,\n      inProgress: u.inProgress || 0,\n      avgResponseTime: 0,\n    }));\n\n    const priorityCounts = new Map(byPriorityReport.data.map((p: any) => [p._id, p.count || 0]));\n    const byPriority = [\n      { priority: 'urgent', count: priorityCounts.get('urgent') || 0 },\n      { priority: 'high', count: priorityCounts.get('high') || 0 },\n      { priority: 'medium', count: priorityCounts.get('medium') || 0 },\n      { priority: 'low', count: priorityCounts.get('low') || 0 },\n    ];\n\n    const byStatus = byStatusReport.data.map((s: any) => ({\n      status: s._id,\n      count: s.count || 0,\n    }));\n\n    res.json({\n      totalAssignments: summary.total || 0,\n      activeAssignments: (summary.assigned || 0) + (summary.inProgress || 0),\n      completedAssignments: summary.completed || 0,\n      averageResponseTime: 0,\n      byUser,\n      byPriority,\n      byStatus,\n    });\n  } catch (error) {\n    console.error('Error getting summary report:', error);\n    res.status(500).json({ error: 'Failed to get summary report' });\n  }\n});\n\nrouter.get('/reports/assignments', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const { userId, startDate, priority, status } = req.query;\n\n    const assignments = await leadManagementService.getAllLeadAssignments({\n      userId: userId as string,\n      fromDate: startDate as string,\n      status: status as string,\n    });\n\n    let filtered = assignments;\n    if (priority && priority !== 'all') {\n      filtered = filtered.filter((a: any) => a.priority === priority);\n    }\n\n    res.json(filtered);\n  } catch (error) {\n    console.error('Error getting assignment report:', error);\n    res.status(500).json({ error: 'Failed to get assignment report' });\n  }\n});\n\nrouter.get('/reports/activity', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const { userId, fromDate, toDate } = req.query;\n\n    const report = await leadManagementService.getUserActivityReport({\n      userId: userId as string,\n      fromDate: fromDate as string,\n      toDate: toDate as string,\n    });\n\n    res.json(report);\n  } catch (error) {\n    console.error('Error getting activity report:', error);\n    res.status(500).json({ error: 'Failed to get activity report' });\n  }\n});\n\nrouter.get('/reports/activity-stats', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const { startDate } = req.query;\n\n    const report = await leadManagementService.getUserActivityReport({\n      fromDate: startDate as string,\n    });\n\n    const byAction = [\n      { action: 'assign', count: 0 },\n      { action: 'bulk_assign', count: 0 },\n      { action: 'unassign', count: 0 },\n      { action: 'update', count: 0 },\n    ];\n\n    const byEntityType = [\n      { entityType: 'lead_assignment', count: 0 },\n    ];\n\n    report.recentActivity?.forEach((log: any) => {\n      const actionIndex = byAction.findIndex(a => a.action === log.actionType);\n      if (actionIndex >= 0) byAction[actionIndex].count++;\n      \n      const entityIndex = byEntityType.findIndex(e => e.entityType === 'lead_assignment');\n      if (entityIndex >= 0) byEntityType[entityIndex].count++;\n    });\n\n    const byUser = report.userSummary?.map((u: any) => ({\n      userId: u._id,\n      userName: u.userName,\n      userRole: 'user',\n      totalActions: u.totalLeadsAssigned + u.totalLeadsCompleted + u.totalMessagesSent,\n      lastActivityAt: new Date().toISOString(),\n      actionBreakdown: [\n        { action: 'assign', count: u.totalLeadsAssigned || 0 },\n        { action: 'complete', count: u.totalLeadsCompleted || 0 },\n        { action: 'message', count: u.totalMessagesSent || 0 },\n      ],\n    })) || [];\n\n    const uniqueUsers = new Set(report.recentActivity?.map((a: any) => a.userId) || []);\n\n    res.json({\n      totalActivities: report.recentActivity?.length || 0,\n      uniqueUsers: uniqueUsers.size,\n      byAction,\n      byEntityType,\n      byUser,\n    });\n  } catch (error) {\n    console.error('Error getting activity stats:', error);\n    res.status(500).json({ error: 'Failed to get activity stats' });\n  }\n});\n\nrouter.get('/reports/activity-logs', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const { userId, action, startDate, limit } = req.query;\n\n    const report = await leadManagementService.getUserActivityReport({\n      userId: userId as string,\n      fromDate: startDate as string,\n    });\n\n    let logs = report.recentActivity || [];\n    \n    if (action && action !== 'all') {\n      logs = logs.filter((l: any) => l.actionType === action);\n    }\n    \n    if (limit) {\n      logs = logs.slice(0, parseInt(limit as string));\n    }\n\n    const formattedLogs = logs.map((log: any) => ({\n      _id: log.id || log._id,\n      userId: log.userId,\n      userName: log.userName || 'Unknown',\n      userRole: log.userRole || 'user',\n      action: log.actionType,\n      entityType: 'lead_assignment',\n      entityId: log.leadAssignmentId,\n      details: log.metadata || {},\n      createdAt: log.timestamp,\n    }));\n\n    res.json(formattedLogs);\n  } catch (error) {\n    console.error('Error getting activity logs:', error);\n    res.status(500).json({ error: 'Failed to get activity logs' });\n  }\n});\n\nrouter.get('/reports/workload', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    if (!isAdmin(user) && user.role !== 'manager') {\n      return res.status(403).json({ error: 'Not authorized to view reports' });\n    }\n\n    const workload = await leadManagementService.getWorkloadDistribution();\n    res.json(workload);\n  } catch (error) {\n    console.error('Error getting workload distribution:', error);\n    res.status(500).json({ error: 'Failed to get workload distribution' });\n  }\n});\n\nrouter.post('/log-activity', async (req: Request, res: Response) => {\n  try {\n    const user = getUser(req);\n    const { actionType, contactId, contactPhone, contactName, metadata } = req.body;\n\n    await leadManagementService.logUserActivity({\n      userId: user.userId || 'admin',\n      userName: user.name,\n      userRole: user.role,\n      actionType,\n      contactId,\n      contactPhone,\n      contactName,\n      metadata,\n    });\n\n    res.json({ success: true });\n  } catch (error) {\n    console.error('Error logging activity:', error);\n    res.status(500).json({ error: 'Failed to log activity' });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":16198,"size_tokens":null},"client/src/pages/user-activity-reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { getAuthHeaders } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Download, Activity, UserCheck, History, Loader2, RefreshCw, Calendar, Clock, Eye, Edit, Plus, Trash2 } from \"lucide-react\";\nimport { format, subDays } from \"date-fns\";\n\ninterface ActivityLog {\n  _id: string;\n  userId: string;\n  userName: string;\n  userRole: string;\n  action: string;\n  entityType: string;\n  entityId?: string;\n  details: Record<string, unknown>;\n  ipAddress?: string;\n  userAgent?: string;\n  createdAt: string;\n}\n\ninterface UserActivitySummary {\n  userId: string;\n  userName: string;\n  userRole: string;\n  totalActions: number;\n  lastActivityAt: string;\n  actionBreakdown: {action: string; count: number}[];\n}\n\ninterface ActivityStats {\n  totalActivities: number;\n  uniqueUsers: number;\n  byAction: {action: string; count: number}[];\n  byEntityType: {entityType: string; count: number}[];\n  byUser: UserActivitySummary[];\n}\n\nexport default function UserActivityReportsPage() {\n  const [dateRange, setDateRange] = useState(\"7\");\n  const [filterUserId, setFilterUserId] = useState<string>(\"all\");\n  const [filterAction, setFilterAction] = useState<string>(\"all\");\n\n  const { data: stats, isLoading: statsLoading, refetch: refetchStats } = useQuery<ActivityStats>({\n    queryKey: [\"/api/lead-management/reports/activity-stats\", dateRange],\n    queryFn: async () => {\n      const startDate = subDays(new Date(), parseInt(dateRange));\n      const res = await fetch(`/api/lead-management/reports/activity-stats?startDate=${startDate.toISOString()}`, {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch activity stats\");\n      return res.json();\n    },\n  });\n\n  const { data: activities, isLoading: activitiesLoading, refetch: refetchActivities } = useQuery<ActivityLog[]>({\n    queryKey: [\"/api/lead-management/reports/activity-logs\", dateRange, filterUserId, filterAction],\n    queryFn: async () => {\n      const startDate = subDays(new Date(), parseInt(dateRange));\n      const params = new URLSearchParams({\n        startDate: startDate.toISOString(),\n        limit: \"200\",\n      });\n      if (filterUserId !== \"all\") params.append(\"userId\", filterUserId);\n      if (filterAction !== \"all\") params.append(\"action\", filterAction);\n      \n      const res = await fetch(`/api/lead-management/reports/activity-logs?${params}`, {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch activity logs\");\n      return res.json();\n    },\n  });\n\n  const { data: users } = useQuery<{id: string; name: string; role: string}[]>({\n    queryKey: [\"/api/users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/users\", {\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) return [];\n      return res.json();\n    },\n  });\n\n  const handleRefresh = () => {\n    refetchStats();\n    refetchActivities();\n  };\n\n  const handleExportCSV = () => {\n    if (!activities) return;\n    \n    const headers = [\"User\", \"Role\", \"Action\", \"Entity Type\", \"Details\", \"Timestamp\"];\n    const rows = activities.map(a => [\n      a.userName,\n      a.userRole,\n      a.action,\n      a.entityType,\n      JSON.stringify(a.details),\n      format(new Date(a.createdAt), \"yyyy-MM-dd HH:mm:ss\"),\n    ]);\n    \n    const csv = [headers.join(\",\"), ...rows.map(r => r.map(c => `\"${c}\"`).join(\",\"))].join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `user-activity-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n  };\n\n  const getActionIcon = (action: string) => {\n    switch (action) {\n      case \"create\":\n      case \"assign\":\n        return <Plus className=\"h-4 w-4 text-green-600\" />;\n      case \"update\":\n      case \"reassign\":\n        return <Edit className=\"h-4 w-4 text-blue-600\" />;\n      case \"delete\":\n      case \"unassign\":\n        return <Trash2 className=\"h-4 w-4 text-red-600\" />;\n      case \"view\":\n        return <Eye className=\"h-4 w-4 text-gray-600\" />;\n      default:\n        return <Activity className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getActionBadge = (action: string) => {\n    const colors: Record<string, string> = {\n      create: \"bg-green-100 text-green-700 border-green-200\",\n      assign: \"bg-green-100 text-green-700 border-green-200\",\n      update: \"bg-blue-100 text-blue-700 border-blue-200\",\n      reassign: \"bg-blue-100 text-blue-700 border-blue-200\",\n      delete: \"bg-red-100 text-red-700 border-red-200\",\n      unassign: \"bg-red-100 text-red-700 border-red-200\",\n      view: \"bg-gray-100 text-gray-700 border-gray-200\",\n      bulk_assign: \"bg-purple-100 text-purple-700 border-purple-200\",\n    };\n    return (\n      <Badge variant=\"outline\" className={colors[action] || \"bg-gray-100 text-gray-700\"}>\n        <span className=\"flex items-center gap-1\">\n          {getActionIcon(action)}\n          {action.replace(\"_\", \" \")}\n        </span>\n      </Badge>\n    );\n  };\n\n  const formatDetails = (details: Record<string, unknown>) => {\n    const keys = Object.keys(details);\n    if (keys.length === 0) return \"-\";\n    \n    return keys.slice(0, 3).map(key => {\n      const value = details[key];\n      const displayValue = typeof value === 'string' ? value : JSON.stringify(value);\n      return `${key}: ${displayValue.slice(0, 30)}${displayValue.length > 30 ? '...' : ''}`;\n    }).join(\", \");\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">User Activity Reports</h1>\n            <p className=\"text-muted-foreground\">Track team member actions and system activity</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Select value={dateRange} onValueChange={setDateRange}>\n              <SelectTrigger className=\"w-40\">\n                <Calendar className=\"h-4 w-4 mr-2\" />\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"1\">Today</SelectItem>\n                <SelectItem value=\"7\">Last 7 days</SelectItem>\n                <SelectItem value=\"30\">Last 30 days</SelectItem>\n                <SelectItem value=\"90\">Last 90 days</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"icon\" onClick={handleRefresh}>\n              <RefreshCw className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportCSV}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export CSV\n            </Button>\n          </div>\n        </div>\n\n        {statsLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : stats ? (\n          <>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" />\n                    Total Activities\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">{stats.totalActivities}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    In selected period\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    Active Users\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">{stats.uniqueUsers}</div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Team members with activity\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <History className=\"h-4 w-4\" />\n                    Assignment Actions\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">\n                    {stats.byAction.filter(a => a.action === \"assign\" || a.action === \"bulk_assign\").reduce((sum, a) => sum + a.count, 0)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Lead assignments made\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4\" />\n                    Avg Daily Actions\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-3xl font-bold\">\n                    {Math.round(stats.totalActivities / parseInt(dateRange))}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Per day average\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Tabs defaultValue=\"by-user\">\n              <TabsList>\n                <TabsTrigger value=\"by-user\">By Team Member</TabsTrigger>\n                <TabsTrigger value=\"all-activities\">Activity Log</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"by-user\" className=\"mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Team Member Activity Summary</CardTitle>\n                    <CardDescription>Actions performed by each team member</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    {stats.byUser.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        No activity found in selected period\n                      </div>\n                    ) : (\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Team Member</TableHead>\n                            <TableHead>Role</TableHead>\n                            <TableHead className=\"text-center\">Total Actions</TableHead>\n                            <TableHead>Action Breakdown</TableHead>\n                            <TableHead>Last Activity</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {stats.byUser.map((user) => (\n                            <TableRow key={user.userId}>\n                              <TableCell className=\"font-medium\">{user.userName}</TableCell>\n                              <TableCell>\n                                <Badge variant=\"secondary\">{user.userRole}</Badge>\n                              </TableCell>\n                              <TableCell className=\"text-center\">\n                                <Badge variant=\"outline\">{user.totalActions}</Badge>\n                              </TableCell>\n                              <TableCell>\n                                <div className=\"flex flex-wrap gap-1\">\n                                  {user.actionBreakdown.slice(0, 4).map(ab => (\n                                    <Badge \n                                      key={ab.action} \n                                      variant=\"outline\" \n                                      className=\"text-xs\"\n                                    >\n                                      {ab.action}: {ab.count}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </TableCell>\n                              <TableCell className=\"text-muted-foreground text-sm\">\n                                {user.lastActivityAt \n                                  ? format(new Date(user.lastActivityAt), \"MMM d, HH:mm\")\n                                  : \"N/A\"}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"all-activities\" className=\"mt-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Activity Log</CardTitle>\n                    <CardDescription>Detailed log of all user activities</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex items-center gap-4 mb-4\">\n                      <Select value={filterUserId} onValueChange={setFilterUserId}>\n                        <SelectTrigger className=\"w-40\">\n                          <SelectValue placeholder=\"All Users\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">All Users</SelectItem>\n                          {users?.map(user => (\n                            <SelectItem key={user.id} value={user.id}>{user.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Select value={filterAction} onValueChange={setFilterAction}>\n                        <SelectTrigger className=\"w-36\">\n                          <SelectValue placeholder=\"All Actions\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">All Actions</SelectItem>\n                          <SelectItem value=\"assign\">Assign</SelectItem>\n                          <SelectItem value=\"bulk_assign\">Bulk Assign</SelectItem>\n                          <SelectItem value=\"unassign\">Unassign</SelectItem>\n                          <SelectItem value=\"reassign\">Reassign</SelectItem>\n                          <SelectItem value=\"update\">Update</SelectItem>\n                          <SelectItem value=\"view\">View</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {activitiesLoading ? (\n                      <div className=\"flex items-center justify-center py-8\">\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                      </div>\n                    ) : !activities || activities.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        No activities found matching filters\n                      </div>\n                    ) : (\n                      <ScrollArea className=\"h-[400px]\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead>User</TableHead>\n                              <TableHead>Action</TableHead>\n                              <TableHead>Entity Type</TableHead>\n                              <TableHead>Details</TableHead>\n                              <TableHead>Timestamp</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {activities.map((activity) => (\n                              <TableRow key={activity._id}>\n                                <TableCell>\n                                  <div>\n                                    <div className=\"font-medium\">{activity.userName}</div>\n                                    <div className=\"text-xs text-muted-foreground\">{activity.userRole}</div>\n                                  </div>\n                                </TableCell>\n                                <TableCell>{getActionBadge(activity.action)}</TableCell>\n                                <TableCell className=\"text-muted-foreground\">\n                                  {activity.entityType}\n                                </TableCell>\n                                <TableCell className=\"text-sm text-muted-foreground max-w-[200px] truncate\">\n                                  {formatDetails(activity.details)}\n                                </TableCell>\n                                <TableCell className=\"text-muted-foreground text-sm whitespace-nowrap\">\n                                  {format(new Date(activity.createdAt), \"MMM d, HH:mm:ss\")}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </ScrollArea>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </>\n        ) : (\n          <Card>\n            <CardContent className=\"py-8\">\n              <div className=\"text-center text-muted-foreground\">\n                <Activity className=\"h-8 w-8 mx-auto mb-2\" />\n                <p>Failed to load activity data. Please try again.</p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":18597,"size_tokens":null}},"version":2}